<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>java8æ–°ç‰¹æ€§åŸç†ä»¥åŠå®æˆ˜åº”ç”¨-lambdaå‡½æ•°å¼ç¼–ç¨‹ä¸æ—¥æœŸç¯‡</title>
      <link href="2021/10/10/java8-lambda-with-date-process/"/>
      <url>2021/10/10/java8-lambda-with-date-process/</url>
      
        <content type="html"><![CDATA[<h2 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1:ç®€ä»‹"></a>1:ç®€ä»‹</h2><p>ç›®å‰æˆªæ­¢2021å¹´9æœˆjavaæœ€æ–°çš„jdkç‰ˆæœ¬ä¸º17,è€Œæˆ‘ä»¬ç›®å‰å¤§éƒ¨åˆ†å…¬å¸ç°åœ¨çš„javaé¡¹ç›®éƒ½è¿˜åœ¨è¿è¡Œçš„æ˜¯java8çš„ç‰ˆæœ¬,å¯¹äºæˆ‘ä»¬ç›®å‰çš„é¡¹ç›®è€Œè¨€,java8å·²ç»èƒ½å¤Ÿæ»¡è¶³æˆ‘ä»¬å¤§éƒ¨åˆ†å·¥ä½œä¸­çš„åº”ç”¨åœºæ™¯ã€‚è€Œä¸”æˆªæ­¢ç›®å‰ä¸ºæ­¢oracleå…¬å¸è¿˜ä»åœ¨ç»§ç»­ç»´æŠ¤ç€java8çš„æ›´æ–°æ“ä½œã€‚å…¶å®java8æ—©åœ¨2014å¹´å°±å·²ç»æ¨å‡ºäº†å‘å‹ç‰ˆã€‚é‚£ä¹ˆjava8éƒ½æœ‰å“ªäº›æ–°ç‰¹æ€§å‘¢?æˆ‘ä»¬æ˜¯å¦éƒ½ä¸€ä¸€æŒæ¡äº†ï¼Ÿæˆ‘æƒ³å¦‚æœæˆ‘ä»¬éƒ½æŒæ¡å¹¶ç†ŸçŸ¥äº†java8çš„æ–°ç‰¹æ€§ä»¥åŠåº”ç”¨æŠ€å·§ä¹‹å,ä¸€å®šä¼šå¯¹æˆ‘ä»¬æ—¥å¸¸çš„å¼€å‘æ•ˆç‡ä¼šæœ‰æˆ–å¤šæˆ–å°‘çš„å¸®åŠ©,æå‡æˆ‘ä»¬çš„æ’¸ç æ•ˆç‡,é¿å…è¸©å‘ã€‚è§„é¿é¡¹ç›®ä¸­ä¸€äº›ä¸å¿…è¦çš„é£é™©ã€‚æ€»ä¹‹æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆæƒ³,å¦‚æœæˆ‘ä»¬éƒ½ä¸äº†è§£java8æ–°ç‰¹æ–°çš„é­…åŠ›,åˆæ€ä¼šä½“éªŒåˆ°java14çš„å¿«ä¹ã€‚(å“ˆå“ˆğŸ˜,é¢˜å¤–è¯)</p><h2 id="2-æ–°ç‰¹æ€§ä»‹ç»ä¸åºè¨€"><a href="#2-æ–°ç‰¹æ€§ä»‹ç»ä¸åºè¨€" class="headerlink" title="2:æ–°ç‰¹æ€§ä»‹ç»ä¸åºè¨€"></a>2:æ–°ç‰¹æ€§ä»‹ç»ä¸åºè¨€</h2><p>åœ¨å¼€å§‹ä»‹ç»java8æ–°ç‰¹æ€§ä¹‹å‰,å¿…é¡»å…ˆå¼•å‡ºä¸€ç¯‡oracleå®˜æ–¹éå¸¸å…·æœ‰æƒå¨çš„<a href="https://www.oracle.com/technetwork/java/javase/8-whats-new-2157071.html">java8æ–°ç‰¹æ€§(ç›¸å¯¹äºjava8ä»¥å‰çš„ç‰ˆæœ¬)</a>å…¶å®å¯ä»¥å‚è€ƒæˆ‘ä»¬å¦‚ä¸‹è¿™å¼ å›¾<br><img src="/images/java8-lambda-with-date-process/jdk1.8-new-characteristic.png" alt="JDK8æ–°ç‰¹æ€§.png"><br>ç®€å•ä»‹ç»jdepsç±»ä¾èµ–åˆ†æå™¨å·¥å…·çš„ä½¿ç”¨ã€‚ç€é‡è®²è§£Lambdaç‰¹æ€§å’ŒStramã€æ—¥æœŸ,é…åˆèµ·æ¥ç”¨å¯ä»¥æå¤§æé«˜ç”Ÿäº§åŠ›ï¼Œå†™å‡ºé«˜æ•ˆç‡ã€å¹²å‡€ã€ç®€æ´çš„ä»£ç ã€‚</p><h2 id="3-jdepså·¥å…·çš„ä½¿ç”¨"><a href="#3-jdepså·¥å…·çš„ä½¿ç”¨" class="headerlink" title="3:jdepså·¥å…·çš„ä½¿ç”¨"></a>3:jdepså·¥å…·çš„ä½¿ç”¨</h2><p>ç†Ÿæ‚‰javaçš„å°ä¼™ä¼´åº”è¯¥æ¸…æ¥šjdkåœ¨é»˜è®¤ç»™æˆ‘ä»¬è‡ªå¸¦äº†ä¸€äº›æ–¹ä¾¿çš„toolsæ‰§è¡Œå·¥å…·å¦‚:<br>jps:æ˜¯JDK 1.5æä¾›çš„ä¸€ä¸ªæ˜¾ç¤ºå½“å‰æ‰€æœ‰javaè¿›ç¨‹pidçš„å‘½ä»¤ï¼Œç®€å•å®ç”¨ï¼Œéå¸¸é€‚åˆåœ¨linux/unixå¹³å°ä¸Šç®€å•å¯Ÿçœ‹å½“å‰javaè¿›ç¨‹çš„ä¸€äº›ç®€å•æƒ…å†µã€‚</p><p>javac: è¯¥å·¥å…·å¯ä»¥å°†åç¼€åä¸º.javaçš„æºæ–‡ä»¶ç¼–è¯‘ä¸ºåç¼€åä¸º.classçš„å¯ä»¥è¿è¡ŒäºJavaè™šæ‹Ÿæœºçš„å­—èŠ‚ç .</p><p>java: æ‰§è¡Œå¯åŠ¨javaæœåŠ¡,å¯ä»¥æ‰§è¡Œ.classåç¼€æ–‡ä»¶æˆ–è€…æ˜¯jar file</p><p>javap:javapæ˜¯jdkè‡ªå¸¦çš„åè§£æå·¥å…·ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯æ ¹æ®classå­—èŠ‚ç æ–‡ä»¶ï¼Œåè§£æå‡ºå½“å‰ç±»å¯¹åº”çš„codeåŒºï¼ˆæ±‡ç¼–æŒ‡ä»¤ï¼‰ã€æœ¬åœ°å˜é‡è¡¨ã€å¼‚å¸¸è¡¨å’Œä»£ç è¡Œåç§»é‡æ˜ å°„è¡¨ã€å¸¸é‡æ± ç­‰ç­‰ä¿¡æ¯ã€‚</p><p>jjs ç­‰ç­‰â€¦..<br>è¿™æ ·çš„å‘½ä»¤å·¥å…·æœ‰å¥½å¤š,æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹ä¸‹jdeps</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//å°†javaæ–‡ä»¶ç¼–è¯‘ä¸ºclassæ–‡ä»¶</span>javac <span class="token operator">/</span>Users<span class="token operator">/</span>xiaozhangge<span class="token operator">/</span>ideaProjects<span class="token operator">/</span>java8feature<span class="token operator">/</span>src<span class="token operator">/</span>main<span class="token operator">/</span>java<span class="token operator">/</span>com<span class="token operator">/</span>xes<span class="token operator">/</span>sample<span class="token operator">/</span>function<span class="token operator">/</span>OptionalTest<span class="token punctuation">.</span>java<span class="token comment" spellcheck="true">//jdepså‘½ä»¤æ‰§è¡Œå¯ä»¥çœ‹åˆ°classçš„ä¾èµ–å…³ç³»</span>jdeps <span class="token operator">/</span>Users<span class="token operator">/</span>xiaozhangge<span class="token operator">/</span>ideaProjects<span class="token operator">/</span>java8feature<span class="token operator">/</span>src<span class="token operator">/</span>main<span class="token operator">/</span>java<span class="token operator">/</span>com<span class="token operator">/</span>xes<span class="token operator">/</span>sample<span class="token operator">/</span>function<span class="token operator">/</span>OptionalTest<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token class-name">OptionalTest<span class="token punctuation">.</span>class</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token operator">/</span>Library<span class="token operator">/</span>Java<span class="token operator">/</span>JavaVirtualMachines<span class="token operator">/</span>jdk1<span class="token number">.8</span><span class="token punctuation">.</span>0_231<span class="token punctuation">.</span>jdk<span class="token operator">/</span>Contents<span class="token operator">/</span>Home<span class="token operator">/</span>jre<span class="token operator">/</span>lib<span class="token operator">/</span>rt<span class="token punctuation">.</span>jar   com<span class="token punctuation">.</span>xes<span class="token punctuation">.</span>sample<span class="token punctuation">.</span><span class="token function">function</span> <span class="token punctuation">(</span>OptionalTest<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>      <span class="token operator">-</span><span class="token operator">></span> java<span class="token punctuation">.</span>io      <span class="token operator">-</span><span class="token operator">></span> java<span class="token punctuation">.</span>lang      <span class="token operator">-</span><span class="token operator">></span> java<span class="token punctuation">.</span>time      <span class="token operator">-</span><span class="token operator">></span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>format      <span class="token operator">-</span><span class="token operator">></span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>temporal<span class="token comment" spellcheck="true">//ä¸ä»…å¯ä»¥åˆ†æclassæ–‡ä»¶è¿˜å¯ä»¥åˆ†æjaråŒ…,æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œå°è¯•</span></code></pre><h2 id="4-Streamæµç¼–ç¨‹å®æˆ˜"><a href="#4-Streamæµç¼–ç¨‹å®æˆ˜" class="headerlink" title="4:Streamæµç¼–ç¨‹å®æˆ˜"></a>4:Streamæµç¼–ç¨‹å®æˆ˜</h2><p>ç°åœ¨æˆ‘ä»¬å¼€å§‹è¿›å…¥jdk1.8 streamæµç¼–ç¨‹,è¿™æ˜¯jdk1.8ä¸­æœ€å¤§çš„äº®ç‚¹,ä¹Ÿæ˜¯æœ€æœ‰ç”¨çš„ä¸€ä¸ªç‰¹æ€§ã€‚<br>æ¦‚å¿µ:<br>  é¦–å…ˆstreamæ˜¯ä¸€ä¸ªé«˜çº§çš„è¿­ä»£å™¨,å•å‘,ä¸å¯å¾€å¤,æ•°æ®åªèƒ½éå†ä¸€æ¬¡,éå†è¿‡ä¸€æ¬¡åå³ç”¨å°½äº†,å°±å¥½æ¯”æµæ°´ä»é¢å‰æµè¿‡,ä¸€å»ä¸å¤è¿”ã€‚å®ƒä¸æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„,ä¹Ÿä¸æ˜¯ä¸€ä¸ªé›†åˆ,å®ƒä¸ä¼šå­˜æ”¾æ•°æ®,streamæœ€å…³æ³¨çš„äº‹æƒ…<br>æ˜¯å¦‚ä½•å°†æ•°æ®è¿›è¡Œé«˜æ•ˆçš„å¤„ç†,å®ƒå…¶å®å°±æ˜¯å°†æ•°æ®åœ¨æµæ°´çº¿ä¸€æ ·çš„ç¯å¢ƒä¸­è¿›è¡Œå¤„ç†(parallelStream)ã€‚<br>è€Œå’Œä¼ ç»Ÿè¿­ä»£å™¨åˆä¸åŒçš„æ˜¯,Streamå¯ä»¥å¹¶è¡ŒåŒ–æ“ä½œ,è¿­ä»£å™¨åªèƒ½å‘½ä»¤å¼åœ°ã€ä¸²è¡ŒåŒ–æ“ä½œã€‚é¡¾åæ€ä¹‰,å½“ä½¿ç”¨ä¸²è¡Œæ–¹å¼å»éå†æ—¶,æ¯ä¸ªitemè¯»å®Œåå†è¯»ä¸‹ä¸€ä¸ª itemã€‚è€Œä½¿ç”¨å¹¶è¡Œå»éå†æ—¶,æ•°æ®ä¼šè¢«åˆ†æˆå¤šä¸ªæ®µï¼Œ<br>å…¶ä¸­æ¯ä¸€ä¸ªéƒ½åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­å¤„ç†,ç„¶åå°†ç»“æœä¸€èµ·è¾“å‡ºã€‚Streamçš„å¹¶è¡Œæ“ä½œä¾èµ–äºJava7ä¸­å¼•å…¥çš„Fork/Joinæ¡†æ¶ï¼ˆJSR166yï¼‰æ¥æ‹†åˆ†ä»»åŠ¡å’ŒåŠ é€Ÿå¤„ç†è¿‡ç¨‹ã€‚</p><h3 id="4-1-åˆè¯†Stream"><a href="#4-1-åˆè¯†Stream" class="headerlink" title="4.1:åˆè¯†Stream:"></a>4.1:åˆè¯†Stream:</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>IntStream<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StreamDemeo2</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//ä½¿ç”¨Streamå†…éƒ¨è¿­ä»£</span>        <span class="token comment" spellcheck="true">//mapå°±æ˜¯ä¸­é—´æ“ä½œ(è¿”å›Streamçš„æ“ä½œ)</span>        <span class="token comment" spellcheck="true">//sumå°±æ˜¯ç»ˆæ­¢æ“ä½œ</span>         <span class="token keyword">int</span> sum <span class="token operator">=</span> IntStream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>i <span class="token operator">-</span><span class="token operator">></span> i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> intNum <span class="token operator">=</span> IntStream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>StreamDemeo2<span class="token operator">:</span><span class="token operator">:</span>integerNum<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>intNum<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æƒ°æ€§æ±‚å€¼å°±æ˜¯æœ€ç»ˆæ²¡æœ‰è°ƒç”¨çš„æƒ…å†µä¸‹,ä¸­é—´æ“ä½œä¸ä¼šè¢«æ‰§è¡Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        IntStream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>StreamDemeo2<span class="token operator">:</span><span class="token operator">:</span>integerNum<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * æ±‚å€¼è¿ç®—     *     * @param i     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">integerNum</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œäº†ä¹˜ä»¥2æ“ä½œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>é€šè¿‡ä»¥ä¸Šçš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°,å¦‚æœæ–¹æ³•è¿”å›çš„æ•°æ®ç±»å‹æ˜¯streamæµå¯¹è±¡,é‚£ä¹ˆé»˜è®¤ç¨‹åºæ˜¯ä¸ä¼šåšä»»ä½•æ“ä½œçš„,åªæœ‰çœŸæ­£æœ€åæœ‰å–å€¼æ“ä½œæ‰ä¼šè¿›è¡Œä¸­é—´è¿‡ç¨‹çš„é€»è¾‘è¿ç®—ã€‚</p><h3 id="4-2-Streamæµç¼–ç¨‹åˆ›å»º"><a href="#4-2-Streamæµç¼–ç¨‹åˆ›å»º" class="headerlink" title="4.2:Streamæµç¼–ç¨‹åˆ›å»º:"></a>4.2:Streamæµç¼–ç¨‹åˆ›å»º:</h3><table>    <tbody><tr bgcolor="gray">        <td>ç±»åˆ«</td>         <td>ç›¸å…³æ–¹æ³•</td>    </tr>   <tr>        <td>é›†åˆ</td>         <td>Collection.stream/parallelStream</td>    </tr>   <tr>        <td>æ•°ç»„</td>         <td>Arrays.stream</td>    </tr>    <tr>        <td rowspan="2">æ•°å­—Stream</td>            <td>IntSream/LongStream</td>      </tr>    <tr>        <td>Random.ins/longs/doubles</td>      </tr><tr>        <td>è‡ªå·±åˆ›å»º</td>         <td>Stream.generate/iterate</td>    </tr></tbody></table><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Arrays<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Random<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>IntStream<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>Stream<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StreamDemo</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        List<span class="token operator">&lt;</span>String<span class="token operator">></span> list <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//ä»ç»“åˆåˆ›å»º'</span>        list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//ä»æ•°ç»„åˆ›å»º</span>        Arrays<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//åˆ›å»ºæ•°å­—æµ</span>        IntStream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        IntStream<span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//ä½¿ç”¨randomåˆ›å»ºä¸€ä¸ªæ— é™æµ</span>        <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Random random<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//è‡ªå·±äº§ç”Ÿæµ</span>        Stream<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="4-3-Streamæµç¼–ç¨‹-ä¸­é—´æ“ä½œ"><a href="#4-3-Streamæµç¼–ç¨‹-ä¸­é—´æ“ä½œ" class="headerlink" title="4.3:Streamæµç¼–ç¨‹-ä¸­é—´æ“ä½œ"></a>4.3:Streamæµç¼–ç¨‹-ä¸­é—´æ“ä½œ</h3><table>    <tbody><tr>        <td colspan="2">ç›¸å…³æ–¹æ³•</td>         <td>æè¿°</td>    </tr>    <tr>        <td rowspan="5">æ— çŠ¶æ€æ“ä½œ</td>            <td>map/mapToXxx</td>          <td rowspan="5">æ— çŠ¶æ€å°±è¡¨ç¤ºæˆ‘å½“å‰çš„æ“ä½œè·Ÿå…¶å®ƒå…ƒç´ çš„å‰åæ²¡æœ‰ä¾èµ–å…³ç³»</td>       </tr>    <tr>        <td>flatMap/flatMapToXxx</td>      </tr>    <tr>        <td>filter</td>      </tr><tr>        <td>peek</td>      </tr><tr>        <td>unordered</td>      </tr> <tr>        <td rowspan="3">æœ‰çŠ¶æ€æ“ä½œ</td>            <td>distinct</td>          <td rowspan="3">æœ‰çŠ¶æ€çš„ç»“æœéœ€è¦ä¾èµ–äºå…¶å®ƒå…ƒç´ </td>       </tr>  <tr>        <td>sorted</td>      </tr>  <tr>        <td>limit/skip</td>      </tr></tbody></table><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Random<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>Stream<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StreamDemo</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        String str <span class="token operator">=</span> <span class="token string">"my name is 007"</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//è¾“å‡ºæ¯ä¸ªå•è¯çš„é•¿åº¦</span>        Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>world <span class="token operator">-</span><span class="token operator">></span> world<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//è¾“å‡ºç¬¦åˆé•¿åº¦çš„å•è¯</span>        Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>world <span class="token operator">-</span><span class="token operator">></span> world<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//é•¿åº¦å¤§äº3å•è¯çš„é•¿åº¦åˆ†åˆ«æœ‰å“ªäº›</span>        Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>world <span class="token operator">-</span><span class="token operator">></span> world<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>world <span class="token operator">-</span><span class="token operator">></span> world<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//flatMapæ“ä½œ</span>        Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>s <span class="token operator">-</span><span class="token operator">></span> s<span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">boxed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//peekæ“ä½œ peekä¸»è¦ç”¨äºdebug æ˜¯ä¸­é—´æ“ä½œ è€ŒforEachæ˜¯ç»ˆæ­¢æ“ä½œ</span>        Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//limitä½¿ç”¨ä¸»è¦ç”¨äºæ— é™æµ</span>        <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>i <span class="token operator">-</span><span class="token operator">></span> i <span class="token operator">></span> <span class="token number">100</span> <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="4-4-Streamæµç¼–ç¨‹-ç»ˆæ­¢æ“ä½œ"><a href="#4-4-Streamæµç¼–ç¨‹-ç»ˆæ­¢æ“ä½œ" class="headerlink" title="4.4:Streamæµç¼–ç¨‹-ç»ˆæ­¢æ“ä½œ"></a>4.4:Streamæµç¼–ç¨‹-ç»ˆæ­¢æ“ä½œ</h3><table>    <tbody><tr>        <td colspan="2">ç›¸å…³æ–¹æ³•</td>         <td>æè¿°</td>    </tr>   <tr>        <td rowspan="4">éçŸ­è·¯æ“ä½œ</td>         <td>forEach/forEachOrderd</td>         <td rowspan="4">åªæœ‰å°†æ‰€æœ‰çš„æ•°æ®è¿›è¡Œæ±‡æ€»å®Œæ¯•æ‰ä¼šä¸­æ–­æµç¨‹</td>       </tr>    <tr>         <td>collect/toArray</td>      </tr>    <tr>        <td>reduce</td>      </tr>    <tr>        <td>min/max/count</td>      </tr> <tr>        <td rowspan="2">çŸ­è·¯æ“ä½œ</td>         <td>findFirst/findAny</td>         <td rowspan="2">æˆ‘ä»¬ä¸éœ€è¦æ‰€æœ‰çš„ç»“æœè®¡ç®—å®Œå°±å¯ä»¥ç»“æŸè¿™ä¸ªæµçš„æ“ä½œ</td>       </tr>    <tr>         <td>allMatch/anyMatch/noneMatch</td>      </tr></tbody></table><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Comparator<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Optional<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>OptionalInt<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Random<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>Collectors<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>Stream<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StreamDemo</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        String str <span class="token operator">=</span> <span class="token string">"my name is 007"</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=======================éçŸ­è·¯æ“ä½œ===================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//ä½¿ç”¨å¹¶è¡Œæµæ“ä½œ</span>        str<span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>i <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"i = "</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//ä½¿ç”¨forEachOrderedæ¥ä¿è¯æœ‰åº</span>        str<span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEachOrdered</span><span class="token punctuation">(</span>i <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"i = "</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æ”¶é›†list</span>        List<span class="token operator">&lt;</span>String<span class="token operator">></span> collect <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//reduceç»“æœé›†</span>        Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> reduce <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> s1 <span class="token operator">+</span> <span class="token string">"|"</span> <span class="token operator">+</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>reduce<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//maxæ“ä½œ</span>        Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>Comparator<span class="token punctuation">.</span><span class="token function">comparingInt</span><span class="token punctuation">(</span>String<span class="token operator">:</span><span class="token operator">:</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=======================çŸ­è·¯æ“ä½œ===================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        OptionalInt first <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>first<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="4-5-Streamæµç¼–ç¨‹-å¹¶è¡Œæµ"><a href="#4-5-Streamæµç¼–ç¨‹-å¹¶è¡Œæµ" class="headerlink" title="4.5:Streamæµç¼–ç¨‹-å¹¶è¡Œæµ"></a>4.5:Streamæµç¼–ç¨‹-å¹¶è¡Œæµ</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>ForkJoinPool<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>TimeUnit<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>IntStream<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StreamDemo</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//åŒæ­¥æ‰§è¡Œ</span>        IntStream<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span>StreamDemo<span class="token operator">:</span><span class="token operator">:</span>debug<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//å¹¶è¡Œæµæ‰§è¡Œ</span>        IntStream<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span>StreamDemo<span class="token operator">:</span><span class="token operator">:</span>debug<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//å…ˆå¹¶è¡Œåœ¨ä¸²è¡Œ</span>        <span class="token comment" spellcheck="true">//ç»“è®º:å¤šæ¬¡è°ƒç”¨parallelå’Œsequential,ä»¥æœ€åä¸€æ¬¡è°ƒç”¨ä¸ºå‡†</span>        IntStream<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>                <span class="token comment" spellcheck="true">//è°ƒç”¨paralleläº§ç”Ÿå¹¶è¡Œæµ</span>                <span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span>StreamDemo<span class="token operator">:</span><span class="token operator">:</span>debug<span class="token punctuation">)</span>                <span class="token comment" spellcheck="true">//è°ƒç”¨sequentialäº§ç”Ÿä¸²è¡Œæµ</span>                <span class="token punctuation">.</span><span class="token function">sequential</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span>StreamDemo<span class="token operator">:</span><span class="token operator">:</span>debug2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//å¹¶è¡Œæµä½¿ç”¨çš„çº¿ç¨‹æ± ä¸ºForkJoinPool.commonPool</span>        <span class="token comment" spellcheck="true">//é»˜è®¤çº¿ç¨‹æ± æ•°æ˜¯å½“å‰æœºå™¨çš„cpuä¸ªæ•°,å¯ä»¥é€šè¿‡ä»¥ä¸‹å‚æ•°è¿›è¡Œä¿®æ”¹çº¿ç¨‹æ•°,æˆ‘ä»¬å¯ä»¥é€šè¿‡java.util.concurrent.ForkJoinPoolç±»çš„</span>        <span class="token comment" spellcheck="true">//makeCommonPool()æ–¹æ³•è¿›è¡Œå‚è€ƒ:</span>        System<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"java.util.concurrent.ForkJoinPool.common.parallelism"</span><span class="token punctuation">,</span> <span class="token string">"20"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        IntStream<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span>StreamDemo<span class="token operator">:</span><span class="token operator">:</span>debug<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//ä½¿ç”¨è‡ªå·±çš„çº¿ç¨‹æ± ,ä¸ä½¿ç”¨é»˜è®¤çš„,é˜²æ­¢ä»»åŠ¡è¢«é˜»å¡</span>        ForkJoinPool pool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinPool</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pool<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> IntStream<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span>StreamDemo<span class="token operator">:</span><span class="token operator">:</span>debug<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>pool<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                pool<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">debug</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"debug"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">debug2</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"debug"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="4-6-Streamæµç¼–ç¨‹-æ”¶é›†å™¨"><a href="#4-6-Streamæµç¼–ç¨‹-æ”¶é›†å™¨" class="headerlink" title="4.6:Streamæµç¼–ç¨‹-æ”¶é›†å™¨"></a>4.6:Streamæµç¼–ç¨‹-æ”¶é›†å™¨</h3><p>æ”¶é›†å™¨è¨€å¤–ä¹‹æ„å°±æ˜¯è¦å°†æˆ‘ä»¬æµå¤„ç†çš„æ•°æ®æ”¶é›†èµ·æ¥ã€‚å®ƒå¯ä»¥è¿”å›Listã€Mapç­‰ã€‚ä½¿ç”¨æ”¶é›†å™¨çš„åœ°æ–¹æ¯”è¾ƒå¤š,æ¯”å¦‚sum/count/distinct/group by</p><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>Data<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>collections4<span class="token punctuation">.</span>MapUtils<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Arrays<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>IntSummaryStatistics<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Set<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>TreeSet<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>Collectors<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * æ€§åˆ« */</span><span class="token keyword">enum</span> Gender <span class="token punctuation">{</span>    MALE<span class="token punctuation">,</span> FEMALE<span class="token punctuation">}</span><span class="token comment" spellcheck="true">/** * ç­çº§ */</span><span class="token keyword">enum</span> Grade <span class="token punctuation">{</span>    ONE<span class="token punctuation">,</span> TWO<span class="token punctuation">,</span> THREE<span class="token punctuation">,</span> FOUR<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/** * å­¦ç”Ÿ å¯¹è±¡ */</span><span class="token annotation punctuation">@Data</span><span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * å§“å     */</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * å¹´é¾„     */</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * æ€§åˆ«     */</span>    <span class="token keyword">private</span> Gender gender<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * ç­çº§     */</span>    <span class="token keyword">private</span> Grade grade<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">Student</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">,</span> Gender gender<span class="token punctuation">,</span> Grade grade<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>gender <span class="token operator">=</span> gender<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>grade <span class="token operator">=</span> grade<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"[name="</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">", age="</span> <span class="token operator">+</span> age <span class="token operator">+</span> <span class="token string">", gender="</span> <span class="token operator">+</span> gender                <span class="token operator">+</span> <span class="token string">", grade="</span> <span class="token operator">+</span> grade <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StreamDemo</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// æµ‹è¯•æ•°æ®</span>        List<span class="token operator">&lt;</span>Student<span class="token operator">></span> students <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>                <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"å°æ˜"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> Gender<span class="token punctuation">.</span>MALE<span class="token punctuation">,</span> Grade<span class="token punctuation">.</span>ONE<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"å¤§æ˜"</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> Gender<span class="token punctuation">.</span>MALE<span class="token punctuation">,</span> Grade<span class="token punctuation">.</span>THREE<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"å°ç™½"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> Gender<span class="token punctuation">.</span>FEMALE<span class="token punctuation">,</span> Grade<span class="token punctuation">.</span>TWO<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"å°é»‘"</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> Gender<span class="token punctuation">.</span>FEMALE<span class="token punctuation">,</span> Grade<span class="token punctuation">.</span>FOUR<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"å°çº¢"</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> Gender<span class="token punctuation">.</span>FEMALE<span class="token punctuation">,</span> Grade<span class="token punctuation">.</span>THREE<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"å°é»„"</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> Gender<span class="token punctuation">.</span>MALE<span class="token punctuation">,</span> Grade<span class="token punctuation">.</span>ONE<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"å°é’"</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> Gender<span class="token punctuation">.</span>FEMALE<span class="token punctuation">,</span> Grade<span class="token punctuation">.</span>THREE<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"å°ç´«"</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> Gender<span class="token punctuation">.</span>FEMALE<span class="token punctuation">,</span> Grade<span class="token punctuation">.</span>TWO<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"å°ç‹"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> Gender<span class="token punctuation">.</span>MALE<span class="token punctuation">,</span> Grade<span class="token punctuation">.</span>ONE<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"å°æ"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> Gender<span class="token punctuation">.</span>MALE<span class="token punctuation">,</span> Grade<span class="token punctuation">.</span>ONE<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"å°é©¬"</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> Gender<span class="token punctuation">.</span>FEMALE<span class="token punctuation">,</span> Grade<span class="token punctuation">.</span>FOUR<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"å°åˆ˜"</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> Gender<span class="token punctuation">.</span>MALE<span class="token punctuation">,</span> Grade<span class="token punctuation">.</span>FOUR<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// å¾—åˆ°æ‰€æœ‰å­¦ç”Ÿçš„å¹´é¾„åˆ—è¡¨</span>        <span class="token comment" spellcheck="true">// s -> s.getAge() --> Student::getAge , ä¸ä¼šå¤šç”Ÿæˆä¸€ä¸ªç±»ä¼¼ lambda$0è¿™æ ·çš„å‡½æ•°</span>        Set<span class="token operator">&lt;</span>Integer<span class="token operator">></span> ages <span class="token operator">=</span> students<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Student<span class="token operator">:</span><span class="token operator">:</span>getAge<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toCollection</span><span class="token punctuation">(</span>TreeSet<span class="token operator">:</span><span class="token operator">:</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰€æœ‰å­¦ç”Ÿçš„å¹´é¾„:"</span> <span class="token operator">+</span> ages<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// ç»Ÿè®¡æ±‡æ€»ä¿¡æ¯</span>        IntSummaryStatistics agesSummaryStatistics <span class="token operator">=</span> students<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">summarizingInt</span><span class="token punctuation">(</span>Student<span class="token operator">:</span><span class="token operator">:</span>getAge<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¹´é¾„æ±‡æ€»ä¿¡æ¯:"</span> <span class="token operator">+</span> agesSummaryStatistics<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// åˆ†å—</span>        Map<span class="token operator">&lt;</span>Boolean<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Student<span class="token operator">>></span> genders <span class="token operator">=</span> students<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>                Collectors<span class="token punctuation">.</span><span class="token function">partitioningBy</span><span class="token punctuation">(</span>s <span class="token operator">-</span><span class="token operator">></span> s<span class="token punctuation">.</span><span class="token function">getGender</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> Gender<span class="token punctuation">.</span>MALE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// System.out.println("ç”·å¥³å­¦ç”Ÿåˆ—è¡¨:" + genders);</span>        MapUtils<span class="token punctuation">.</span><span class="token function">verbosePrint</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token punctuation">,</span> <span class="token string">"ç”·å¥³å­¦ç”Ÿåˆ—è¡¨"</span><span class="token punctuation">,</span> genders<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// åˆ†ç»„</span>        Map<span class="token operator">&lt;</span>Grade<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Student<span class="token operator">>></span> grades <span class="token operator">=</span> students<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span>Student<span class="token operator">:</span><span class="token operator">:</span>getGrade<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        MapUtils<span class="token punctuation">.</span><span class="token function">verbosePrint</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token punctuation">,</span> <span class="token string">"å­¦ç”Ÿç­çº§åˆ—è¡¨"</span><span class="token punctuation">,</span> grades<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// å¾—åˆ°æ‰€æœ‰ç­çº§å­¦ç”Ÿçš„ä¸ªæ•°</span>        Map<span class="token operator">&lt;</span>Grade<span class="token punctuation">,</span> Long<span class="token operator">></span> gradesCount <span class="token operator">=</span> students<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors                <span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span>Student<span class="token operator">:</span><span class="token operator">:</span>getGrade<span class="token punctuation">,</span> Collectors<span class="token punctuation">.</span><span class="token function">counting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        MapUtils<span class="token punctuation">.</span><span class="token function">verbosePrint</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token punctuation">,</span> <span class="token string">"ç­çº§å­¦ç”Ÿä¸ªæ•°åˆ—è¡¨"</span><span class="token punctuation">,</span> gradesCount<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><h2 id="5-ä»å…¥é—¨å¼€å§‹æ·±åº¦ç†è§£lambda"><a href="#5-ä»å…¥é—¨å¼€å§‹æ·±åº¦ç†è§£lambda" class="headerlink" title="5:ä»å…¥é—¨å¼€å§‹æ·±åº¦ç†è§£lambda"></a>5:ä»å…¥é—¨å¼€å§‹æ·±åº¦ç†è§£lambda</h2><p>å…ˆä»å‡ æ®µä»£ç ä¸­è¿›è¡Œç®€å•å»ç†è§£:</p><pre class=" language-java"><code class="language-java"><span class="token operator">--</span><span class="token operator">--</span>predicate test<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token comment" spellcheck="true">//æ–­è¨€æµ‹è¯•,è¾“å…¥ä»»æ„ç±»å‹,è¾“å‡ºboolean</span>Predicate<span class="token operator">&lt;</span>Integer<span class="token operator">></span> predicate <span class="token operator">=</span> i <span class="token operator">-</span><span class="token operator">></span> i <span class="token operator">></span> <span class="token number">30</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>predicate<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//åªæ¥æ”¶intå€¼çš„æ–­è¨€</span>IntPredicate intPredicate <span class="token operator">=</span> i <span class="token operator">-</span><span class="token operator">></span> <span class="token number">5</span> <span class="token operator">></span> i<span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>intPredicate<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ¥æ”¶ä¸¤ä¸ªå‚æ•°çš„æ–­è¨€åˆ¤æ–­</span>BiPredicate<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> Integer<span class="token operator">></span> biPredicate <span class="token operator">=</span> <span class="token punctuation">(</span>i1<span class="token punctuation">,</span> i2<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> i1 <span class="token operator">+</span> i2 <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>biPredicate<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token operator">--</span><span class="token operator">--</span>Consumer testç®€å•ç‰ˆä½¿ç”¨<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token comment" spellcheck="true">//æ¶ˆè´¹å‡½æ•°,åªæœ‰è¾“å…¥æ— ä»»ä½•è¿”å›,ç®­å¤´å·¦è¾¹ä¸ºæ–¹æ³•å…¥å‚,ç®­å¤´å³è¾¹ä¸ºå‡½æ•°æ‰§è¡Œè¿‡ç¨‹</span>Consumer<span class="token operator">&lt;</span>String<span class="token operator">></span> consumer <span class="token operator">=</span> content <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>consumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">"å°å¼ å“¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ç”±äºå·¦ä¾§çš„è¾“å…¥å‚æ•°å’Œå³ä¾§çš„è¾“å‡ºå‚æ•°ç›¸åŒ,æ‰€æˆ‘ä»¬å®Œå…¨å¯ä»¥ä½¿ç”¨æ–¹æ³•å¼•ç”¨çš„æ–¹å¼ç»§ç»­ç²¾ç®€å…¶è¾“å‡º</span>Consumer<span class="token operator">&lt;</span>String<span class="token operator">></span> simplify <span class="token operator">=</span> System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">;</span>simplify<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">"ç®€åŒ–ç‰ˆ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="5-1-æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”æ–¹æ³•å¼•ç”¨"><a href="#5-1-æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”æ–¹æ³•å¼•ç”¨" class="headerlink" title="5.1:æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”æ–¹æ³•å¼•ç”¨:"></a>5.1:æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”æ–¹æ³•å¼•ç”¨:</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span>Consumer<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span>Function<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span>IntUnaryOperator<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span>UnaryOperator<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String name <span class="token operator">=</span> <span class="token string">"å°é»„"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> food <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * ç‹—å«çš„é™æ€æ–¹æ³•     *     * @param dog     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">bark</span><span class="token punctuation">(</span>Dog dog<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dog <span class="token operator">+</span> <span class="token string">"å«äº†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * åƒç‹—ç²®     *     * @param num     * @return è¿˜å‰©å¤šå°‘æ–¤     */</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åƒäº†"</span> <span class="token operator">+</span> num <span class="token operator">+</span> <span class="token string">"æ–¤ç‹—ç²®"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>food <span class="token operator">-=</span> num<span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>food<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//é™æ€æ–¹æ³•å¼•ç”¨</span>        Consumer<span class="token operator">&lt;</span>Dog<span class="token operator">></span> dogConsumer <span class="token operator">=</span> Dog<span class="token operator">:</span><span class="token operator">:</span>bark<span class="token punctuation">;</span>        dogConsumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//éé™æ€æ–¹æ³•ä½¿ç”¨å¯¹è±¡å®ä¾‹å¼•ç”¨,eatæ–¹æ³•ç¬¦åˆè¾“å…¥/è¾“å‡ºå‚æ•°çš„å½¢å¼</span>        Function<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> Integer<span class="token operator">></span> eatFunction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token operator">:</span>eat<span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"eatFunctionè¿˜å‰©"</span> <span class="token operator">+</span> eatFunction<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"æ–¤ç‹—ç²®"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//ç”±äºè¾“å…¥å’Œè¾“å‡ºçš„å‚æ•°ç±»å‹ä¸€è‡´,æˆ‘ä»¬å¯ä»¥æ›¿æ¢ä¸ºä¸€å…ƒå‡½æ•°å½¢å¼è°ƒç”¨</span>        UnaryOperator<span class="token operator">&lt;</span>Integer<span class="token operator">></span> unaryDog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token operator">:</span>eat<span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"unaryDogè¿˜å‰©"</span> <span class="token operator">+</span> unaryDog<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"æ–¤ç‹—ç²®"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//å½“ç„¶jdk1.8é’ˆå¯¹è¾“å…¥å’Œè¾“å‡ºå‚æ•°ç›¸åŒçš„æ“ä½œè¿˜æŒ‡å®šäº†å…·ä½“ç±»å‹çš„ä¸€å…ƒå‡½æ•°,è¿™æ ·æˆ‘ä»¬åœ¨æ“ä½œåŒ»é™¢è¿˜æ˜¯å°±ä¸éœ€è¦å†æŒ‡æ˜å‚å…·ä½“å‚æ•°çš„æ³›å‹</span>        IntUnaryOperator intUnaryDog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token operator">:</span>eat<span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"intUnaryDogè¿˜å‰©"</span> <span class="token operator">+</span> intUnaryDog<span class="token punctuation">.</span><span class="token function">applyAsInt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"æ–¤ç‹—ç²®"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>åæ€:ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ä¸­è°ƒç”¨é™æ€æ–¹æ³•å¯ä»¥ä½¿ç”¨Dog::bark;è¿›è¡Œå¼•ç”¨æ–¹æ³•çš„å®ä¾‹ã€‚é‚£ä¹ˆéé™æ€çš„æ–¹æ³•æˆ‘ä»¬è¯¥å¦‚ä½•è¿›è¡Œä½¿ç”¨Dog::eatæ–¹å¼æ¥è¿›è¡Œå¼•ç”¨å‘¢?è¿™é‡Œç‰µæ¶‰åˆ°ä¸åŒçš„è¯­è¨€é‡Œé¢å¯¹thisçš„å®ç°æ–¹æ³•ã€‚æˆ‘ä»¬çŸ¥é“é™æ€æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•çš„åŒºåˆ«æ˜¯å®ä¾‹æ–¹æ³•æœ‰thisï¼Œé™æ€æ–¹æ³•æ²¡æœ‰ã€‚javaé‡Œé¢æ˜¯æ€ä¹ˆæ ·å®ç°thisçš„å‘¢ï¼Ÿ<br><strong>javaé‡Œé¢é»˜è®¤æŠŠthisä½œä¸ºå‚æ•°,æ”¾åˆ°å®ä¾‹(éé™æ€)æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°</strong><br>å°±æ˜¯è¯´</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åƒäº†"</span> <span class="token operator">+</span> num <span class="token operator">+</span> <span class="token string">"æ–¤ç‹—ç²®"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>food <span class="token operator">-=</span> num<span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>food<span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>ç¼–è¯‘ä¹‹åå’Œä¸‹é¢è¿™æ ·çš„ä»£ç ç¼–è¯‘ä¹‹åæ˜¯ä¸€æ ·çš„ï¼</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">eat</span><span class="token punctuation">(</span>Dog <span class="token keyword">this</span><span class="token punctuation">,</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åƒäº†"</span> <span class="token operator">+</span> num <span class="token operator">+</span> <span class="token string">"æ–¤ç‹—ç²®"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>food <span class="token operator">-=</span> num<span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>food<span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>æ‰§è¡Œ javap -c -s -v -l Dog.class å…¶ä¸­æˆ‘ä»¬çœ‹åˆ°å¦‚ä¸‹:<br><img src="/images/java8-lambda-with-date-process/jdk1.8-lambda-this-problem.png" alt="éé™æ€æ–¹æ³•thisåŸç†.png"><br>æœ¬åœ°å˜é‡è¡¨æŸ¥çœ‹:<br><img src="/images/java8-lambda-with-date-process/jdk1.8-local-variable-table.png" alt="éé™æ€æ–¹æ³•æœ¬åœ°å˜é‡è¡¨.png"><br>æ‰€ä»¥,æˆ‘çš„ç†è§£,javaé‡Œé¢çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•,åªæ˜¯æœ‰äº›æ–¹æ³•æœ‰thiså˜é‡,æœ‰äº›æ²¡æœ‰ã€‚<br>æ‰€ä»¥,æˆå‘˜æ–¹æ³•æˆ‘ä»¬ä¹Ÿå¯ä»¥å†™æˆé™æ€æ–¹æ³•çš„æ–¹æ³•å¼•ç”¨ã€‚å¦‚ä¸‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span>BiFunction<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span>Function<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span>Supplier<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String name <span class="token operator">=</span> <span class="token string">"å°é»„"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> food <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token function">Dog</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * ç‹—å«çš„é™æ€æ–¹æ³•     *     * @param dog     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">bark</span><span class="token punctuation">(</span>Dog dog<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dog <span class="token operator">+</span> <span class="token string">"å«äº†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * åƒç‹—ç²®     *     * @param num     * @return è¿˜å‰©å¤šå°‘æ–¤     */</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åƒäº†"</span> <span class="token operator">+</span> num <span class="token operator">+</span> <span class="token string">"æ–¤ç‹—ç²®"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>food <span class="token operator">-=</span> num<span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>food<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//å®ä¾‹æ–¹æ³•é€šè¿‡ç±»åå¼•ç”¨</span>        BiFunction<span class="token operator">&lt;</span>Dog<span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> Integer<span class="token operator">></span> biFunction <span class="token operator">=</span> Dog<span class="token operator">:</span><span class="token operator">:</span>eat<span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>biFunction<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æ— å‚æ•°æ„é€ å¼•ç”¨</span>        Supplier<span class="token operator">&lt;</span>Dog<span class="token operator">></span> supplierDog <span class="token operator">=</span> Dog<span class="token operator">:</span><span class="token operator">:</span><span class="token keyword">new</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>supplierDog<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//å¸¦å‚æ•°çš„æ„é€ å¼•ç”¨</span>        Function<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Dog<span class="token operator">></span> functionDog <span class="token operator">=</span> Dog<span class="token operator">:</span><span class="token operator">:</span><span class="token keyword">new</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>functionDog<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token string">"å°èŠ±"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="5-2-æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”ç±»å‹æ¨æ–­-æœ‰æ—¶éœ€è¦æˆ‘ä»¬è¿›è¡Œæ˜¾ç¤ºè¿›è¡Œç±»å‹è½¬æ¢"><a href="#5-2-æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”ç±»å‹æ¨æ–­-æœ‰æ—¶éœ€è¦æˆ‘ä»¬è¿›è¡Œæ˜¾ç¤ºè¿›è¡Œç±»å‹è½¬æ¢" class="headerlink" title="5.2:æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”ç±»å‹æ¨æ–­(æœ‰æ—¶éœ€è¦æˆ‘ä»¬è¿›è¡Œæ˜¾ç¤ºè¿›è¡Œç±»å‹è½¬æ¢):"></a>5.2:æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”ç±»å‹æ¨æ–­(æœ‰æ—¶éœ€è¦æˆ‘ä»¬è¿›è¡Œæ˜¾ç¤ºè¿›è¡Œç±»å‹è½¬æ¢):</h3><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@FunctionalInterface</span><span class="token keyword">interface</span> <span class="token class-name">IMath</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token annotation punctuation">@FunctionalInterface</span><span class="token keyword">interface</span> <span class="token class-name">IMath2</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TypeDemo</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//å˜é‡ç±»å‹å®šä¹‰</span>        IMath lambda <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æ•°ç»„å®šä¹‰</span>        IMath<span class="token punctuation">[</span><span class="token punctuation">]</span> lambdas <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> x <span class="token operator">+</span> y<span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//å¼ºè½¬ç±»å‹</span>        Object lambdaObj <span class="token operator">=</span> <span class="token punctuation">(</span>IMath<span class="token punctuation">)</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//é€šè¿‡æ–¹æ³•è¿”å›ç±»å‹</span>        IMath createLambda <span class="token operator">=</span> <span class="token function">createLambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">executeIMath</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">executeIMath</span><span class="token punctuation">(</span>IMath iMath<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token comment" spellcheck="true">//    public static void executeIMath(IMath2 iMath) {</span><span class="token comment" spellcheck="true">//</span><span class="token comment" spellcheck="true">//    }</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> IMath <span class="token function">createLambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="5-3-æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”å˜é‡å¼•ç”¨"><a href="#5-3-æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”å˜é‡å¼•ç”¨" class="headerlink" title="5.3:æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”å˜é‡å¼•ç”¨:"></a>5.3:æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”å˜é‡å¼•ç”¨:</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span>Consumer<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VarDemo</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">/**         * åŒ¿åå†…éƒ¨ç±»å¼•ç”¨å¤–éƒ¨å˜é‡ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯final?         * åŸå› æ˜¯javaçš„ä¼ é€’æ˜¯å€¼ä¼ é€’è€Œä¸æ˜¯å¼•ç”¨ä¼ é€’ã€‚å¦‚æœæ˜¯å€¼ä¼ é€’çš„è¯,å‡è®¾å¤–é¢çš„å‚æ•°å€¼è¿›è¡Œäº†ä¿®æ”¹,         * é‚£ä¹ˆä¼šå¯¼è‡´å†…éƒ¨ç±»ä¸­çš„è®¡ç®—å®ç°ä¸æ­£ç¡®æ€§ã€‚lambdaä¸ºäº†é¿å…è¿™æ ·çš„é—®é¢˜æ‰€ä»¥éšå¼çš„ç»™ä¸ºå†…éƒ¨ç±»å¤–é¢çš„         * å˜é‡è®¾ç½®ä¸ºäº†final,å¦‚æœæ˜¯å¼•ç”¨ä¼ é€’,é‚£ä¹ˆåŒ¿åå†…éƒ¨ç±»å°±ä¸éœ€è¦è¿™æ ·çš„è€ƒè™‘äº†ã€‚         */</span>        String str <span class="token operator">=</span> <span class="token string">"æˆ‘ä»¬çš„æ—¶é—´"</span><span class="token punctuation">;</span>        Consumer<span class="token operator">&lt;</span>String<span class="token operator">></span> consumer <span class="token operator">=</span> s <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>        consumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">"20191022"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å€¼ä¼ é€’:<br><img src="/images/java8-lambda-with-date-process/jdk1.8-pass-by-value.png" alt="å€¼ä¼ é€’.png"><br>å¼•ç”¨ä¼ é€’:<br><img src="/images/java8-lambda-with-date-process/jdk1.8-pass-by-reference.png" alt="å¼•ç”¨ä¼ é€’.png"></p><h3 id="5-4-æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”çº§è”è¡¨è¾¾å¼åŠæŸ¯é‡ŒåŒ–"><a href="#5-4-æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”çº§è”è¡¨è¾¾å¼åŠæŸ¯é‡ŒåŒ–" class="headerlink" title="5.4:æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”çº§è”è¡¨è¾¾å¼åŠæŸ¯é‡ŒåŒ–:"></a>5.4:æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”çº§è”è¡¨è¾¾å¼åŠæŸ¯é‡ŒåŒ–:</h3><p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒæŸ¯é‡ŒåŒ–ï¼ˆè‹±è¯­ï¼šCurryingï¼‰ï¼Œåˆè¯‘ä¸ºå¡ç‘åŒ–æˆ–åŠ é‡ŒåŒ–ï¼Œæ˜¯æŠŠæ¥å—å¤šä¸ªå‚æ•°çš„å‡½æ•°å˜æ¢æˆæ¥å—ä¸€ä¸ªå•ä¸€å‚æ•°ï¼ˆæœ€åˆå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰çš„å‡½æ•°ï¼Œå¹¶ä¸”è¿”å›æ¥å—ä½™ä¸‹çš„å‚æ•°è€Œä¸”è¿”å›ç»“æœçš„æ–°å‡½æ•°çš„æŠ€æœ¯ã€‚<br>è¿™ä¸ªæŠ€æœ¯ç”±å…‹é‡Œæ–¯æ‰˜å¼—Â·æ–¯ç‰¹é›·å¥‡ä»¥é€»è¾‘å­¦å®¶å“ˆæ–¯å‡¯å°”Â·åŠ é‡Œå‘½åçš„ï¼Œå°½ç®¡å®ƒæ˜¯Moses SchÃ¶nfinkelå’Œæˆˆç‰¹æ´›å¸ƒÂ·å¼—é›·æ ¼å‘æ˜çš„ã€‚â€”â€“æ‘˜è‡ªç»´åŸºç™¾ç§‘(wikipedia)</p><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span>Function<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span>IntFunction<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span>IntUnaryOperator<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @Author zyf * @Date 2019/12/15 8:50 PM * @Description çº§è”è¡¨è¾¾å¼å’ŒæŸ¯é‡ŒåŒ– * æŸ¯é‡ŒåŒ–:å°†å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬æ¢ä¸ºåªæœ‰ä¸€ä¸ªå‚æ•°çš„å‡½æ•° * æŸ¯é‡ŒåŒ–çš„ç›®çš„:å‡½æ•°çš„æ ‡å‡†åŒ– * é«˜é˜¶å‡½æ•°:è¿”å›å‡½æ•°çš„å‡½æ•° */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CurryDemo</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//å®ç°x+yçš„çº§è”è¡¨è¾¾å¼(åµŒå¥—å¤šå±‚Function)</span>        Function<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> Function<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> Integer<span class="token operator">>></span> fun <span class="token operator">=</span> x <span class="token operator">-</span><span class="token operator">></span> y <span class="token operator">-</span><span class="token operator">></span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fun<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        IntFunction<span class="token operator">&lt;</span>IntFunction<span class="token operator">&lt;</span>IntUnaryOperator<span class="token operator">>></span> f <span class="token operator">=</span> x <span class="token operator">-</span><span class="token operator">></span> y <span class="token operator">-</span><span class="token operator">></span> z <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span>x <span class="token operator">+</span> y<span class="token punctuation">)</span> <span class="token operator">*</span> z<span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">applyAsInt</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//54</span>        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        Function funObj <span class="token operator">=</span> fun<span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>funObj <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                Object obj <span class="token operator">=</span> funObj<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    funObj <span class="token operator">=</span> <span class="token punctuation">(</span>Function<span class="token punctuation">)</span> obj<span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è°ƒç”¨ç»“æŸäº†"</span> <span class="token operator">+</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="5-4-æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”çº§è”è¡¨è¾¾å¼åŠæŸ¯é‡ŒåŒ–-1"><a href="#5-4-æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”çº§è”è¡¨è¾¾å¼åŠæŸ¯é‡ŒåŒ–-1" class="headerlink" title="5.4:æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”çº§è”è¡¨è¾¾å¼åŠæŸ¯é‡ŒåŒ–:"></a>5.4:æ—¥å¸¸å¼€å‘ä¸­é«˜çº§ä½¿ç”¨â€”çº§è”è¡¨è¾¾å¼åŠæŸ¯é‡ŒåŒ–:</h3><p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒæŸ¯é‡ŒåŒ–ï¼ˆè‹±è¯­ï¼šCurryingï¼‰ï¼Œåˆè¯‘ä¸ºå¡ç‘åŒ–æˆ–åŠ é‡ŒåŒ–ï¼Œæ˜¯æŠŠæ¥å—å¤šä¸ªå‚æ•°çš„å‡½æ•°å˜æ¢æˆæ¥å—ä¸€ä¸ªå•ä¸€å‚æ•°ï¼ˆæœ€åˆå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰çš„å‡½æ•°ï¼Œå¹¶ä¸”è¿”å›æ¥å—ä½™ä¸‹çš„å‚æ•°è€Œä¸”è¿”å›ç»“æœçš„æ–°å‡½æ•°çš„æŠ€æœ¯ã€‚<br>è¿™ä¸ªæŠ€æœ¯ç”±å…‹é‡Œæ–¯æ‰˜å¼—Â·æ–¯ç‰¹é›·å¥‡ä»¥é€»è¾‘å­¦å®¶å“ˆæ–¯å‡¯å°”Â·åŠ é‡Œå‘½åçš„ï¼Œå°½ç®¡å®ƒæ˜¯Moses SchÃ¶nfinkelå’Œæˆˆç‰¹æ´›å¸ƒÂ·å¼—é›·æ ¼å‘æ˜çš„ã€‚â€”â€“æ‘˜è‡ªç»´åŸºç™¾ç§‘(wikipedia)</p><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span>Function<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span>IntFunction<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span>IntUnaryOperator<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @Author zyf * @Date 2019/12/15 8:50 PM * @Description çº§è”è¡¨è¾¾å¼å’ŒæŸ¯é‡ŒåŒ– * æŸ¯é‡ŒåŒ–:å°†å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬æ¢ä¸ºåªæœ‰ä¸€ä¸ªå‚æ•°çš„å‡½æ•° * æŸ¯é‡ŒåŒ–çš„ç›®çš„:å‡½æ•°çš„æ ‡å‡†åŒ– * é«˜é˜¶å‡½æ•°:è¿”å›å‡½æ•°çš„å‡½æ•° */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CurryDemo</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//å®ç°x+yçš„çº§è”è¡¨è¾¾å¼(åµŒå¥—å¤šå±‚Function)</span>        Function<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> Function<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> Integer<span class="token operator">>></span> fun <span class="token operator">=</span> x <span class="token operator">-</span><span class="token operator">></span> y <span class="token operator">-</span><span class="token operator">></span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fun<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        IntFunction<span class="token operator">&lt;</span>IntFunction<span class="token operator">&lt;</span>IntUnaryOperator<span class="token operator">>></span> f <span class="token operator">=</span> x <span class="token operator">-</span><span class="token operator">></span> y <span class="token operator">-</span><span class="token operator">></span> z <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span>x <span class="token operator">+</span> y<span class="token punctuation">)</span> <span class="token operator">*</span> z<span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">applyAsInt</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//54</span>        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        Function funObj <span class="token operator">=</span> fun<span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>funObj <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                Object obj <span class="token operator">=</span> funObj<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    funObj <span class="token operator">=</span> <span class="token punctuation">(</span>Function<span class="token punctuation">)</span> obj<span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è°ƒç”¨ç»“æŸäº†"</span> <span class="token operator">+</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="6-æ·±å…¥ç†è§£å‡½æ•°å¼æ¥å£-amp-è‡ªå®šä¹‰lambda"><a href="#6-æ·±å…¥ç†è§£å‡½æ•°å¼æ¥å£-amp-è‡ªå®šä¹‰lambda" class="headerlink" title="6:æ·±å…¥ç†è§£å‡½æ•°å¼æ¥å£&amp;è‡ªå®šä¹‰lambda"></a>6:æ·±å…¥ç†è§£å‡½æ•°å¼æ¥å£&amp;è‡ªå®šä¹‰lambda</h3><p>è¦æƒ³çœŸæ­£å½»åº•çš„ç†è§£å‡½æ•°å¼æ¥å£ä»¥åŠlambdaçš„çœŸæ­£å®ç°ç»†èŠ‚åŸç†,æˆ‘ä»¬å¿…é¡»å…ˆå¾—ç†Ÿæ‚‰å’Œç†è§£ä»¥ä¸‹å‡ ä¸ªå‡½æ•°å¼æ¥å£ã€‚</p><pre class=" language-java"><code class="language-java">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>functionä¸­å®šä¹‰äº†å‡ ç»„ç±»å‹çš„å‡½æ•°å¼æ¥å£ä»¥åŠé’ˆå¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„å­æ¥å£ã€‚Predicate <span class="token operator">--</span> ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªboolç»“æœ<span class="token punctuation">,</span>æ–¹æ³•ä¸º<span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span>Consumer <span class="token operator">--</span> ä¼ å…¥ä¸€ä¸ªå‚æ•°<span class="token punctuation">,</span>æ— è¿”å›å€¼<span class="token punctuation">,</span>çº¯æ¶ˆè´¹ã€‚ æ–¹æ³•ä¸º<span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span>Function <span class="token operator">--</span> ä¼ å…¥ä¸€ä¸ªå‚æ•°<span class="token punctuation">,</span>è¿”å›ä¸€ä¸ªç»“æœ<span class="token punctuation">,</span>æ–¹æ³•ä¸ºR <span class="token function">apply</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span>Supplier <span class="token operator">--</span> æ— å‚æ•°ä¼ å…¥<span class="token punctuation">,</span>è¿”å›ä¸€ä¸ªç»“æœ<span class="token punctuation">,</span>æ–¹æ³•ä¸ºT <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>UnaryOperator <span class="token operator">--</span> ä¸€å…ƒæ“ä½œç¬¦<span class="token punctuation">,</span> ç»§æ‰¿Function<span class="token punctuation">,</span>ä¼ å…¥å‚æ•°çš„ç±»å‹å’Œè¿”å›ç±»å‹ç›¸åŒã€‚BiFunction<span class="token operator">--</span> äºŒå…ƒæ“ä½œç¬¦<span class="token punctuation">,</span> ä¼ å…¥ä¸¤ä¸ªå‚æ•°è¿”å›ä¸€ä¸ªç»“æœã€‚è¿™ä¸ªç»“æœçš„ç±»å‹å¯ä»¥ä¸ä»»ä¸€å‚æ•°çš„ç±»å‹ä¸ç›¸åŒã€‚BinaryOperator <span class="token operator">--</span> äºŒå…ƒæ“ä½œç¬¦<span class="token punctuation">,</span> ä¼ å…¥çš„ä¸¤ä¸ªå‚æ•°çš„ç±»å‹å’Œè¿”å›ç±»å‹ç›¸åŒ<span class="token punctuation">,</span>ç»§æ‰¿BiFunction</code></pre><p><a href="https://www.runoob.com/java/java8-functional-interfaces.html">è¯¦ç»†æ›´å¤šè¯·å‚è€ƒ</a><br>ä¸‹é¢æˆªå›¾ä¸­åˆ—å‡ºäº†è¿™äº›æ¥å£åœ¨jdk rt.jaråŒ…ä¸‹çš„java.util.functionåŒ…<br><img src="/images/java8-lambda-with-date-process/jdk1.8-lambda-function-detail-info.png" alt="å‡½æ•°è¡¨è¾¾å¼å¸¸ç”¨interfaceæ¥å£.png"></p><h3 id="6-1åˆè¯†java-lambdaè¡¨è¾¾å¼"><a href="#6-1åˆè¯†java-lambdaè¡¨è¾¾å¼" class="headerlink" title="6.1åˆè¯†java lambdaè¡¨è¾¾å¼"></a>6.1åˆè¯†java lambdaè¡¨è¾¾å¼</h3><p>æƒ³è¦åˆæ­¥äº†è§£javaä¸­çš„lambdaè¡¨è¾¾å¼,å…ˆæ¥çœ‹ä¸‹ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­,é€è¿‡ä¾‹å­æ¥ç†Ÿæ‚‰lambdaè¡¨è¾¾å¼çš„ç®€æ´ä¸å¼ºå¤§ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>IntStream<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArrayMin</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">660</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> min <span class="token operator">=</span> Integer<span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> num <span class="token operator">:</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">&lt;</span> min<span class="token punctuation">)</span> <span class="token punctuation">{</span>                min <span class="token operator">=</span> num<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>min<span class="token punctuation">)</span><span class="token punctuation">;</span>        min <span class="token operator">=</span> IntStream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAsInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>min<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//å½“ç„¶æ•°æ®é‡è¿‡å¤§çš„è¯æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å¹¶å‘çš„æ–¹å¼è¿›è¡Œå¤„ç†æˆ‘ä»¬çš„æ•°æ®ä¿¡æ¯</span>        min <span class="token operator">=</span> IntStream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAsInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>min<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å¯¹ç¨‹åºå‘˜æ¥è¯´æœ€ç›´è§‚çš„æ„Ÿå—å°±æ˜¯ç”¨Lambdaè¡¨è¾¾å¼å¯ä»¥ç®€åŒ–å¾ˆå¤šä»£ç ã€‚ä½¿ç”¨å®ƒå¯ä»¥å¾ˆè½»æ¾çš„å°†å¾ˆå¤šè¡Œä»£ç ç¼©å‡æˆä¸€è¡Œã€‚ä¹Ÿå¯ä»¥æ›´æœ‰æ•ˆæé«˜æˆ‘ä»¬ä»£ç çš„æ‰§è¡Œæ•ˆç‡,Java Lambdaè¡¨è¾¾å¼çš„ä¸€ä¸ªé‡è¦ç”¨æ³•æ˜¯ç®€åŒ–æŸäº›åŒ¿åå†…éƒ¨ç±»(Anonymous Classes)çš„å†™æ³•ã€‚<br>åœ¨jdk1.8ä»¥ä¸‹,æ— æ³•å°†å‡½æ•°ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ç»™ä¸€ä¸ªæ–¹æ³•,ä¹Ÿæ— æ³•å£°æ˜è¿”å›ä¸€ä¸ªå‡½æ•°çš„æ–¹æ³•ã€‚æ‰€ä»¥éœ€è¦lambdaå‡½æ•°å¼ç¼–ç¨‹ã€‚</p><h3 id="6-2lambdaåŒ¿åå†…éƒ¨ç±»çŸ¥è¯†ç‚¹"><a href="#6-2lambdaåŒ¿åå†…éƒ¨ç±»çŸ¥è¯†ç‚¹" class="headerlink" title="6.2lambdaåŒ¿åå†…éƒ¨ç±»çŸ¥è¯†ç‚¹:"></a>6.2lambdaåŒ¿åå†…éƒ¨ç±»çŸ¥è¯†ç‚¹:</h3><p>   1:lambdaåŒ¿åå†…éƒ¨ç±»çš„è¿è¡ŒåŸç†<br>            åŒ¿åå†…éƒ¨ç±»ä»ç„¶æ˜¯ä¸€ä¸ªç±»,åªæ˜¯ä¸éœ€è¦ç¨‹åºå‘˜æ˜¾ç¤ºæŒ‡å®šç±»å,ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºè¯¥ç±»å–å.å› æ­¤å¦‚æœæœ‰å¦‚ä¸‹å½¢å¼çš„ä»£ç ,ç¼–è¯‘ä¹‹åå°†ä¼šäº§ç”Ÿä¸¤ä¸ªclassæ–‡ä»¶ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainAnonymousClass</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Anonymous Class Thread run()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ‰§è¡Œå‘½ä»¤ javac MainAnonymousClass.java,ç¼–è¯‘ä¹‹åæ–‡ä»¶åˆ†å¸ƒå¦‚ä¸‹,ä¸¤ä¸ªclassæ–‡ä»¶åˆ†åˆ«æ˜¯ä¸»ç±»å’ŒåŒ¿åå†…éƒ¨ç±»äº§ç”Ÿçš„ï¼š<br><img src="/images/java8-lambda-with-date-process/jdk1.8-javac-command-show-detail.png" alt="lambdaåŒ¿åå†…éƒ¨ç±»æ ¸å¿ƒå®ç°.png"><br>è¿›ä¸€æ­¥åˆ†æä¸»ç±»MainAnonymousClass.classçš„å­—èŠ‚ç ,å¯å‘ç°å…¶åˆ›å»ºäº†åŒ¿åå†…éƒ¨ç±»çš„å¯¹è±¡ï¼š</p><pre class=" language-java"><code class="language-java">xiaozhanggedeMacBook<span class="token operator">-</span>Pro<span class="token operator">:</span>Desktop xiaozhangge$ javap <span class="token operator">-</span>c MainAnonymousClass<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token class-name">Compiled</span> from <span class="token string">"MainAnonymousClass.java"</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainAnonymousClass</span> <span class="token punctuation">{</span>  <span class="token keyword">public</span> <span class="token function">MainAnonymousClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Code       <span class="token number">0</span><span class="token operator">:</span> aload_0       <span class="token number">1</span><span class="token operator">:</span> invokespecial #<span class="token number">1</span>                  <span class="token comment" spellcheck="true">// Method java/lang/Object."&lt;init>":()V</span>       <span class="token number">4</span><span class="token operator">:</span> <span class="token keyword">return</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Code<span class="token operator">:</span>       <span class="token number">0</span><span class="token operator">:</span> <span class="token keyword">new</span>           #<span class="token number">2</span>                  <span class="token comment" spellcheck="true">// class java/lang/Thread</span>       <span class="token number">3</span><span class="token operator">:</span> dup       <span class="token number">4</span><span class="token operator">:</span> <span class="token keyword">new</span>           #<span class="token number">3</span>                  <span class="token comment" spellcheck="true">// class MainAnonymousClass$1 åˆ›å»ºäº†å†…éƒ¨ç±»å¯¹è±¡</span>       <span class="token number">7</span><span class="token operator">:</span> dup       <span class="token number">8</span><span class="token operator">:</span> invokespecial #<span class="token number">4</span>                  <span class="token comment" spellcheck="true">// Method MainAnonymousClass$1."&lt;init>":()V</span>      <span class="token number">11</span><span class="token operator">:</span> invokespecial #<span class="token number">5</span>                  <span class="token comment" spellcheck="true">// Method java/lang/Thread."&lt;init>":(Ljava/lang/Runnable;)V</span>      <span class="token number">14</span><span class="token operator">:</span> invokevirtual #<span class="token number">6</span>                  <span class="token comment" spellcheck="true">// Method java/lang/Thread.start:()V</span>      <span class="token number">17</span><span class="token operator">:</span> <span class="token keyword">return</span><span class="token punctuation">}</span></code></pre><p>2:lambdaåŒ¿åå†…éƒ¨ç±»thisçš„ä½œç”¨åŸŸ<br>lambdaè¡¨è¾¾å¼æœ€ç»ˆä¼šè¿”å›ä¸€ä¸ªå®ç°äº†æŒ‡å®šæ¥å£çš„å®ä¾‹,çœ‹ä¸Šå»å’Œå†…éƒ¨åŒ¿åç±»å¾ˆåƒ,ä½†æœ‰ä¸€ä¸ªæœ€å¤§çš„åŒºåˆ«å°±æ˜¯ä»£ç é‡Œé¢çš„this,å†…éƒ¨åŒ¿åç±»<br><strong>thisæŒ‡å‘çš„å°±æ˜¯åŒ¿åç±»,è€Œlambdaè¡¨è¾¾å¼é‡Œé¢çš„thisæŒ‡å‘çš„å½“å‰ç±»ã€‚</strong></p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * lambdaè¡¨è¾¾å¼çš„this * */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThisDemo</span> <span class="token punctuation">{</span>  <span class="token keyword">private</span> String name <span class="token operator">=</span> <span class="token string">"ThisDemo"</span><span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// åŒ¿åç±»å®ç°</span>    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">private</span> String name <span class="token operator">=</span> <span class="token string">"Runnable"</span><span class="token punctuation">;</span>      <span class="token annotation punctuation">@Override</span>      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿™é‡Œçš„thisæŒ‡å‘åŒ¿åç±»:"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// lambdaå®ç°</span>    <span class="token comment" spellcheck="true">// ä¸‹é¢ä¼šè‡ªåŠ¨ç”Ÿæˆlambda$0æ–¹æ³•,ç”±äºä½¿ç”¨äº†this,æ‰€ä»¥æ˜¯éstaticæ–¹æ³•</span>    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿™é‡Œçš„thisæŒ‡å‘å½“å‰çš„ThisDemoç±»:"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// lambdaå®ç°</span>    <span class="token comment" spellcheck="true">// ä¸‹é¢ä¼šè‡ªåŠ¨ç”Ÿæˆlambda$1æ–¹æ³•,ç”±äºæ²¡æœ‰ä½¿ç”¨äº†this,æ‰€ä»¥æ˜¯staticæ–¹æ³•</span>    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿™é‡Œæ²¡æœ‰å¼•ç”¨this,ç”Ÿæˆçš„lambda1æ–¹æ³•æ˜¯staticçš„"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    ThisDemo demo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThisDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    demo<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p><img src="/images/java8-lambda-with-date-process/jdk1.8-javac-class-information.png" alt="ç¼–è¯‘åå­—èŠ‚ç è¯¦æƒ….png"><br>ä½¿ç”¨javap -s -p ç±»å,å¯ä»¥çœ‹å‡ºä¸€ä¸ªæ˜¯static,ä¸€ä¸ªæ˜¯éstaicçš„<br><img src="/images/java8-lambda-with-date-process/jdk1.8-javap-show-class-information.png" alt="javapåç¼–è¯‘è¯¦æƒ….png"><br>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆlambdaè¡¨è¾¾å¼é‡Œé¢çš„thisæŒ‡å‘å½“å‰ç±»çš„åº•å±‚æœºåˆ¶ï¼å› ä¸ºä»£ç å°±æ˜¯åœ¨æœ¬ç±»çš„ä¸€ä¸ªæ–¹æ³•é‡Œé¢æ‰§è¡Œçš„ã€‚<br>é¢å¤–è¯´ä¸€å¥ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„æ–¹æ³•æ˜¯å¦å¸¦å‚æ•°å–å†³äºlambdaæ˜¯å¦æœ‰å‚æ•°ï¼Œä¾‹å­ä¸­è¡¨è¾¾å¼æ²¡æœ‰å‚æ•°ï¼ˆç®­å¤´å·¦è¾¹æ˜¯ç©ºçš„ï¼‰ï¼Œæ‰€ä»¥è‡ªåŠ¨ç”Ÿæˆçš„ä¹Ÿæ²¡æœ‰ã€‚</p><h3 id="6-3è‡ªå®šä¹‰å®ç°lambdaè¡¨è¾¾å¼"><a href="#6-3è‡ªå®šä¹‰å®ç°lambdaè¡¨è¾¾å¼" class="headerlink" title="6.3è‡ªå®šä¹‰å®ç°lambdaè¡¨è¾¾å¼"></a>6.3è‡ªå®šä¹‰å®ç°lambdaè¡¨è¾¾å¼</h3><p>è‡ªå®šä¹‰å‡½æ•°æ¥å£å¾ˆå®¹æ˜“ï¼Œåªéœ€è¦ç¼–å†™ä¸€ä¸ªåªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£å³å¯ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//æ— å‚æ•°æ ·ä¾‹</span><span class="token annotation punctuation">@FunctionalInterface</span><span class="token keyword">interface</span> <span class="token class-name">MyInterface</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/** * @Author zyf * @Date 2019/12/10 5:01 PM * @Description æ— å‚æ•°function */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NotParamFunctionInterface</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printContent</span><span class="token punctuation">(</span>MyInterface myInterface<span class="token punctuation">)</span> <span class="token punctuation">{</span>        myInterface<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        NotParamFunctionInterface<span class="token punctuation">.</span><span class="token function">printContent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åƒé¥­æ–¹æ³•~~~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        MyInterface myInterface <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"é»˜è®¤å‡½æ•°æ¥å£å®ç°"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        myInterface<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//æœ‰å‚æ•°æ ·ä¾‹</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Arrays<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token annotation punctuation">@FunctionalInterface</span><span class="token keyword">interface</span> <span class="token class-name">ConsumerInterface</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">ParamterCustomInterface</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>T<span class="token operator">></span> list<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myForEach</span><span class="token punctuation">(</span>ConsumerInterface<span class="token operator">&lt;</span>T<span class="token operator">></span> consumer<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">// 1</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>T t <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>            consumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ParamterCustomInterface<span class="token operator">&lt;</span>String<span class="token operator">></span> stream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ParamterCustomInterface</span><span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        stream<span class="token punctuation">.</span>list <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        stream<span class="token punctuation">.</span><span class="token function">myForEach</span><span class="token punctuation">(</span>str <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°æ¥å£ä¹¦å†™Lambdaè¡¨è¾¾å¼</span>        ConsumerInterface consumerInterface <span class="token operator">=</span> str <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>        consumerInterface<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">"å‡½æ•°å¼è°ƒç”¨!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>consumerInterface<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSuperclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…¶å®å¾ˆå¤šjava 1.8ä¸­çš„lambdaè¡¨è¾¾å¼ä½¿ç”¨äº†ä»¥ä¸Šæ–¹å¼è¿›è¡Œå®ç°,æ¯”å¦‚:listâ€“&gt;forEach/Streamâ€”â€“&gt;peek<br><strong>çŸ¥è¯†ç‚¹:</strong><br>1.å¦‚æœä¸€ä¸ªæ¥å£åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•,é‚£ä¹ˆè¯¥æ¥å£å°±æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ã€‚<br>2. å¦‚æœæˆ‘ä»¬åœ¨æŸä¸ªæ¥å£ä¸Šå£°æ˜äº†@FunctionalInterfaceæ³¨è§£,é‚£ä¹ˆç¼–è¯‘å™¨å°±ä¼šæŒ‰ç…§å‡½æ•°å¼æ¥å£çš„å®šä¹‰æ¥è¦æ±‚è¯¥æ¥å£ã€‚<br>3. å¦‚æœæŸä¸ªæ¥å£åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•,ä½†æˆ‘ä»¬å¹¶æ²¡æœ‰ç»™æ¥å£å£°æ˜@FunctionalInterfaceæ³¨è§£,é‚£ä¹ˆç¼–è¯‘å™¨ä¾æ—§ä¼šå°†è¯¥æ¥å£çœ‹åšæ˜¯å‡½æ•°å¼æ¥å£ã€‚</p><h2 id="7-Optional-ç±»çš„å¼•å…¥"><a href="#7-Optional-ç±»çš„å¼•å…¥" class="headerlink" title="7:Optional ç±»çš„å¼•å…¥"></a>7:Optional ç±»çš„å¼•å…¥</h2><p>Optional ç±»æ˜¯ä¸€ä¸ªå¯ä»¥ä¸ºnullçš„å®¹å™¨å¯¹è±¡ã€‚å¦‚æœå€¼å­˜åœ¨åˆ™isPresent()æ–¹æ³•ä¼šè¿”å›trueï¼Œè°ƒç”¨get()æ–¹æ³•ä¼šè¿”å›è¯¥å¯¹è±¡ã€‚<br>Optional æ˜¯ä¸ªå®¹å™¨ï¼šå®ƒå¯ä»¥ä¿å­˜ç±»å‹Tçš„å€¼ï¼Œæˆ–è€…ä»…ä»…ä¿å­˜nullã€‚Optionalæä¾›å¾ˆå¤šæœ‰ç”¨çš„æ–¹æ³•ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨æ˜¾å¼è¿›è¡Œç©ºå€¼æ£€æµ‹ã€‚<br>Optional ç±»çš„å¼•å…¥å¾ˆå¥½çš„è§£å†³ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚<br>åœ¨æˆ‘ä»¬çš„å¼€å‘ä¸­ï¼ŒNullPointerExceptionå¯è°“æ˜¯éšæ—¶éšå¤„å¯è§ï¼Œä¸ºäº†é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦è¿›è¡Œä¸€äº›é˜²å¾¡å¼çš„æ£€æŸ¥ï¼Œæ‰€ä»¥åœ¨ä»£ç ä¸­å¸¸å¸¸å¯è§if(obj != null) è¿™æ ·çš„åˆ¤æ–­ã€‚å¹¸å¥½åœ¨JDK1.8ä¸­ï¼Œjavaä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªOptionalç±»ï¼ŒOptionalç±»èƒ½è®©æˆ‘ä»¬çœæ‰ç¹ççš„éç©ºçš„åˆ¤æ–­ã€‚ä¸‹é¢å…ˆè¯´ä¸€ä¸‹Optionalä¸­ä¸ºæˆ‘ä»¬æä¾›çš„æ–¹æ³•.<br><img src="/images/java8-lambda-with-date-process/jdk1.8-optional-method-detail-info.png" alt="Optionalç±»ç›¸å…³å¸¸ç”¨æ–¹æ³•.png"><br>ä¸‹é¢æˆ‘ä»¬å†™å‡ ä¸ªä¾‹å­æ¥å…·ä½“çœ‹ä¸€ä¸‹æ¯ä¸ªæ–¹æ³•çš„ä½œç”¨ï¼š<br>of</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//åˆ›å»ºä¸€ä¸ªå€¼ä¸ºå¼ ä¸‰çš„Stringç±»å‹çš„Optional</span>Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> ofOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å¦‚æœæˆ‘ä»¬ç”¨ofæ–¹æ³•åˆ›å»ºOptionalå¯¹è±¡æ—¶ï¼Œæ‰€ä¼ å…¥çš„å€¼ä¸ºnullï¼Œåˆ™æŠ›å‡ºNullPointerExceptionå¦‚ä¸‹å›¾æ‰€ç¤º</span>Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> nullOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="/images/java8-lambda-with-date-process/jdk1.8-optional-of-example.png" alt="option.off()è¿è¡Œç»“æœ"><br>ofNullable</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//ä¸ºæŒ‡å®šçš„å€¼åˆ›å»ºOptionalå¯¹è±¡ï¼Œä¸ç®¡æ‰€ä¼ å…¥çš„å€¼ä¸ºnullä¸ä¸ºnullï¼Œåˆ›å»ºçš„æ—¶å€™éƒ½ä¸ä¼šæŠ¥é”™</span>Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> nullOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> nullOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span><span class="token string">"lisi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>empty</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//åˆ›å»ºä¸€ä¸ªç©ºçš„Stringç±»å‹çš„Optionalå¯¹è±¡</span>Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> emptyOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>get<br>å¦‚æœæˆ‘ä»¬åˆ›å»ºçš„Optionalå¯¹è±¡ä¸­æœ‰å€¼å­˜åœ¨åˆ™è¿”å›æ­¤å€¼ï¼Œå¦‚æœæ²¡æœ‰å€¼å­˜åœ¨ï¼Œåˆ™ä¼šæŠ›å‡ºNoSuchElementExceptionå¼‚å¸¸ã€‚å°demoå¦‚ä¸‹ï¼š</p><pre class=" language-java"><code class="language-java">Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> stringOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringOptional<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="/images/java8-lambda-with-date-process/jdk1.8-optional-get-example.png" alt="option.get()è¿è¡Œç»“æœ"></p><pre class=" language-java"><code class="language-java">Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> emptyOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>emptyOptional<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="/images/java8-lambda-with-date-process/jdk1.8-optional-empty-example.png" alt="option.empty()è¿è¡Œç»“æœ"><br>orElse<br>å¦‚æœåˆ›å»ºçš„Optionalä¸­æœ‰å€¼å­˜åœ¨ï¼Œåˆ™è¿”å›æ­¤å€¼ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªé»˜è®¤å€¼</p><pre class=" language-java"><code class="language-java">Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> stringOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringOptional<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> emptyOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>emptyOptional<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">"æå››"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="/images/java8-lambda-with-date-process/jdk1.8-optional-orElse-example.png" alt="option.orElse()è¿è¡Œç»“æœ"><br>orElseGet<br>å¦‚æœåˆ›å»ºçš„Optionalä¸­æœ‰å€¼å­˜åœ¨ï¼Œåˆ™è¿”å›æ­¤å€¼ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªç”±Supplieræ¥å£ç”Ÿæˆçš„å€¼</p><pre class=" language-java"><code class="language-java">Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> stringOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringOptional<span class="token punctuation">.</span><span class="token function">orElseGet</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> emptyOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>emptyOptional<span class="token punctuation">.</span><span class="token function">orElseGet</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"orElseGet"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="/images/java8-lambda-with-date-process/jdk1.8-optional-orElseGet-example.png" alt="option.orElseGet()è¿è¡Œç»“æœ"><br>orElseThrow<br>å¦‚æœåˆ›å»ºçš„Optionalä¸­æœ‰å€¼å­˜åœ¨ï¼Œåˆ™è¿”å›æ­¤å€¼ï¼Œå¦åˆ™æŠ›å‡ºä¸€ä¸ªç”±æŒ‡å®šçš„Supplieræ¥å£ç”Ÿæˆçš„å¼‚å¸¸</p><pre class=" language-java"><code class="language-java">Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> stringOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringOptional<span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span>CustomException<span class="token operator">:</span><span class="token operator">:</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> emptyOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>emptyOptional<span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span>CustomException<span class="token operator">:</span><span class="token operator">:</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CustomException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span> <span class="token punctuation">{</span>   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token operator">-</span>4399699891687593264L<span class="token punctuation">;</span>   <span class="token keyword">public</span> <span class="token function">CustomException</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">"è‡ªå®šä¹‰å¼‚å¸¸"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span>   <span class="token keyword">public</span> <span class="token function">CustomException</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span>  <span class="token punctuation">}</span></code></pre><p><img src="/images/java8-lambda-with-date-process/jdk1.8-optional-orElseThrow-example.png" alt="option.orElseThrow()è¿è¡Œç»“æœ"><br>filter<br>å¦‚æœåˆ›å»ºçš„Optionalä¸­çš„å€¼æ»¡è¶³filterä¸­çš„æ¡ä»¶ï¼Œåˆ™è¿”å›åŒ…å«è¯¥å€¼çš„Optionalå¯¹è±¡ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªç©ºçš„Optionalå¯¹è±¡</p><pre class=" language-java"><code class="language-java">Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> stringOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringOptional<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>e <span class="token operator">-</span><span class="token operator">></span> e<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">"ç‹äº”"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>stringOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringOptional<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>e <span class="token operator">-</span><span class="token operator">></span> e<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">"lisi"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="/images/java8-lambda-with-date-process/jdk1.8-optional-filter-example.png" alt="option.filter()è¿è¡Œç»“æœ"><br>æ³¨æ„Optionalä¸­çš„filteræ–¹æ³•å’ŒStreamä¸­çš„filteræ–¹æ³•æ˜¯æœ‰ç‚¹ä¸ä¸€æ ·çš„ï¼ŒStreamä¸­çš„filteræ–¹æ³•æ˜¯å¯¹ä¸€å †å…ƒç´ è¿›<br>è¡Œè¿‡æ»¤ï¼Œè€ŒOptionalä¸­çš„filteræ–¹æ³•åªæ˜¯å¯¹ä¸€ä¸ªå…ƒç´ è¿›è¡Œè¿‡æ»¤ï¼Œå¯ä»¥æŠŠOptionalçœ‹æˆæ˜¯æœ€å¤šåªåŒ…å«ä¸€ä¸ªå…ƒç´ çš„Streamã€‚<br>map<br>å¦‚æœåˆ›å»ºçš„Optionalä¸­çš„å€¼å­˜åœ¨ï¼Œå¯¹è¯¥å€¼æ‰§è¡Œæä¾›çš„Functionå‡½æ•°è°ƒç”¨</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//mapæ–¹æ³•æ‰§è¡Œä¼ å…¥çš„lambdaè¡¨è¾¾å¼å‚æ•°å¯¹Optionalå®ä¾‹çš„å€¼è¿›è¡Œä¿®æ”¹,ä¿®æ”¹åçš„è¿”å›å€¼ä»ç„¶æ˜¯ä¸€ä¸ªOptionalå¯¹è±¡</span>Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> stringOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringOptional<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>e <span class="token operator">-</span><span class="token operator">></span> e<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">"å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>stringOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringOptional<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>e <span class="token operator">-</span><span class="token operator">></span> e<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">"å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="/images/java8-lambda-with-date-process/jdk1.8-optional-map-example.png" alt="option.map()è¿è¡Œç»“æœ"><br>flagMap<br>å¦‚æœåˆ›å»ºçš„Optionalä¸­çš„å€¼å­˜åœ¨ï¼Œå°±å¯¹è¯¥å€¼æ‰§è¡Œæä¾›çš„Functionå‡½æ•°è°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ªOptionalç±»å‹çš„å€¼ï¼Œå¦<br>åˆ™å°±è¿”å›ä¸€ä¸ªç©ºçš„Optionalå¯¹è±¡.flatMapä¸mapï¼ˆFuntionï¼‰æ–¹æ³•ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºflatMapä¸­çš„mapperè¿”å›<br>å€¼å¿…é¡»æ˜¯Optionalï¼Œmapæ–¹æ³•çš„mappingå‡½æ•°è¿”å›å€¼å¯ä»¥æ˜¯ä»»ä½•ç±»å‹Tã€‚è°ƒç”¨ç»“æŸæ—¶ï¼ŒflatMapä¸ä¼šå¯¹ç»“æœ<br>ç”¨Optionalå°è£…ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//mapæ–¹æ³•ä¸­çš„lambdaè¡¨è¾¾å¼è¿”å›å€¼å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œåœ¨mapå‡½æ•°è¿”å›ä¹‹å‰ä¼šåŒ…è£…ä¸ºOptionalã€‚ </span><span class="token comment" spellcheck="true">//ä½†flatMapæ–¹æ³•ä¸­çš„lambdaè¡¨è¾¾å¼è¿”å›å€¼å¿…é¡»æ˜¯Optionlå®ä¾‹</span>Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> stringOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringOptional<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>e <span class="token operator">-</span><span class="token operator">></span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"lisi"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">"å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>stringOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringOptional<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>e <span class="token operator">-</span><span class="token operator">></span> Optional<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">"å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="/images/java8-lambda-with-date-process/jdk1.8-optional-flatMap-example.png" alt="option.flagMap()è¿è¡Œç»“æœ"><br>ifPresent</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//ifPresentæ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªConsumerçš„å®ç°ç±»ï¼ŒConsumerç±»åŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œè¯¥æŠ½è±¡æ–¹æ³•å¯¹ä¼ å…¥çš„å€¼è¿›è¡Œå¤„ç†ï¼Œåªå¤„ç†æ²¡æœ‰è¿”å›å€¼ã€‚</span>Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> stringOptional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>stringOptional<span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>e<span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æˆ‘è¢«å¤„ç†äº†ã€‚ã€‚ã€‚"</span><span class="token operator">+</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="/images/java8-lambda-with-date-process/jdk1.8-optional-ifPresent-example.png" alt="option.ifPresent()è¿è¡Œç»“æœ"></p><h2 id="8-java8æ—¥æœŸå’Œæ—¶é—´"><a href="#8-java8æ—¥æœŸå’Œæ—¶é—´" class="headerlink" title="8:java8æ—¥æœŸå’Œæ—¶é—´"></a>8:java8æ—¥æœŸå’Œæ—¶é—´</h2><p>Java 8é€šè¿‡å‘å¸ƒæ–°çš„Date-Time API æ¥è¿›ä¸€æ­¥åŠ å¼ºå¯¹æ—¥æœŸä¸æ—¶é—´çš„å¤„ç†ã€‚<br>åœ¨æ—§ç‰ˆçš„ Java ä¸­ï¼Œæ—¥æœŸæ—¶é—´ API å­˜åœ¨è¯¸å¤šé—®é¢˜ï¼Œå…¶ä¸­æœ‰ï¼š<br>éçº¿ç¨‹å®‰å…¨ âˆ’ java.util.Date æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€æœ‰çš„æ—¥æœŸç±»éƒ½æ˜¯å¯å˜çš„ï¼Œè¿™æ˜¯Javaæ—¥æœŸç±»æœ€å¤§çš„é—®é¢˜ä¹‹ä¸€ã€‚<br>          ç”¨äºæ ¼å¼åŒ–æ—¥æœŸçš„ç±»DateFormatè¢«æ”¾åœ¨java.textåŒ…ä¸­,å®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ªSimpleDateFormatå¯¹è±¡æ¥å¤„ç†æ—¥æœŸæ ¼å¼åŒ–ï¼Œå¹¶ä¸”DateFormatä¹Ÿæ˜¯éçº¿ç¨‹å®‰å…¨ï¼Œè¿™æ„å‘³ç€å¦‚æœä½ åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­è°ƒç”¨åŒä¸€ä¸ªDateFormatå¯¹è±¡,ä¼šå¾—åˆ°æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚<br>è®¾è®¡å¾ˆå·® âˆ’ Javaçš„æ—¥æœŸ/æ—¶é—´ç±»çš„å®šä¹‰å¹¶ä¸ä¸€è‡´ï¼Œåœ¨java.utilå’Œjava.sqlçš„åŒ…ä¸­éƒ½æœ‰æ—¥æœŸç±»ï¼Œæ­¤å¤–ç”¨äºæ ¼å¼åŒ–å’Œè§£æçš„ç±»åœ¨java.textåŒ…ä¸­å®šä¹‰ã€‚java.util.DateåŒæ—¶åŒ…å«æ—¥æœŸå’Œæ—¶é—´ï¼Œè€Œjava.sql.Dateä»…åŒ…å«æ—¥æœŸï¼Œå°†å…¶çº³å…¥java.sqlåŒ…å¹¶ä¸åˆç†ã€‚å¦å¤–è¿™ä¸¤ä¸ªç±»éƒ½æœ‰ç›¸åŒçš„åå­—ï¼Œè¿™æœ¬èº«å°±æ˜¯ä¸€ä¸ªéå¸¸ç³Ÿç³•çš„è®¾è®¡ã€‚<br>æ—¶åŒºå¤„ç†éº»çƒ¦ âˆ’ æ—¥æœŸç±»å¹¶ä¸æä¾›å›½é™…åŒ–ï¼Œæ²¡æœ‰æ—¶åŒºæ”¯æŒï¼Œå› æ­¤Javaå¼•å…¥äº†java.util.Calendarå’Œjava.util.TimeZoneç±»ï¼Œä½†ä»–ä»¬åŒæ ·å­˜åœ¨ä¸Šè¿°æ‰€æœ‰çš„é—®é¢˜ã€‚<br>        å¯¹æ—¥æœŸçš„è®¡ç®—æ–¹å¼ç¹çï¼Œè€Œä¸”å®¹æ˜“å‡ºé”™ï¼Œå› ä¸ºæœˆä»½æ˜¯ä»0å¼€å§‹çš„ï¼Œä»Calendarä¸­è·å–çš„æœˆä»½éœ€è¦åŠ ä¸€æ‰èƒ½è¡¨ç¤ºå½“å‰æœˆä»½.<br>Java 8 åœ¨ java.time åŒ…ä¸‹æä¾›äº†å¾ˆå¤šæ–°çš„ APIã€‚ä»¥ä¸‹ä¸ºä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„ APIï¼š<br>Local(æœ¬åœ°) âˆ’ ç®€åŒ–äº†æ—¥æœŸæ—¶é—´çš„å¤„ç†ï¼Œæ²¡æœ‰æ—¶åŒºçš„é—®é¢˜ã€‚<br>Zoned(æ—¶åŒº) âˆ’ é€šè¿‡åˆ¶å®šçš„æ—¶åŒºå¤„ç†æ—¥æœŸæ—¶é—´ã€‚<br>æ–°çš„java.timeåŒ…æ¶µç›–äº†æ‰€æœ‰å¤„ç†æ—¥æœŸ,æ—¶é—´,æ—¥æœŸ/æ—¶é—´ï¼Œæ—¶åŒºï¼Œæ—¶åˆ»ï¼ˆinstantsï¼‰ï¼Œè¿‡ç¨‹ï¼ˆduringï¼‰ä¸æ—¶é’Ÿï¼ˆclockï¼‰çš„æ“ä½œã€‚</p><p>Java 8æ—¥æœŸ/æ—¶é—´ç±»<br>Java 8çš„æ—¥æœŸå’Œæ—¶é—´ç±»åŒ…å«LocalDateã€LocalTimeã€Instantã€Durationä»¥åŠPeriodï¼Œè¿™äº›ç±»éƒ½åŒ…å«åœ¨java.timeåŒ…ä¸­ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹çœ‹è¿™äº›ç±»çš„ç”¨æ³•ã€‚<br>LocalDateå’ŒLocalTime<br>LocalDateç±»è¡¨ç¤ºä¸€ä¸ªå…·ä½“çš„æ—¥æœŸï¼Œä½†ä¸åŒ…å«å…·ä½“æ—¶é—´ï¼Œä¹Ÿä¸åŒ…å«æ—¶åŒºä¿¡æ¯ã€‚å¯ä»¥é€šè¿‡LocalDateçš„é™æ€æ–¹æ³•of()åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼ŒLocalDateä¹ŸåŒ…å«ä¸€äº›æ–¹æ³•ç”¨æ¥è·å–å¹´ä»½ï¼Œæœˆä»½ï¼Œå¤©ï¼Œæ˜ŸæœŸå‡ </p><pre class=" language-java"><code class="language-java">LocalDate localDate <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// åˆå§‹åŒ–ä¸€ä¸ªæ—¥æœŸï¼š2017-01-04</span><span class="token keyword">int</span> year <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">getYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment" spellcheck="true">// å¹´ä»½ï¼š2017</span>Month month <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment" spellcheck="true">// æœˆä»½ï¼šJANUARY</span><span class="token keyword">int</span> dayOfMonth <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">getDayOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// æœˆä»½ä¸­çš„ç¬¬å‡ å¤©ï¼š4</span>DayOfWeek dayOfWeek <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">getDayOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// ä¸€å‘¨çš„ç¬¬å‡ å¤©ï¼šWEDNESDAY</span><span class="token keyword">int</span> length <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">lengthOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment" spellcheck="true">// æœˆä»½çš„å¤©æ•°ï¼š31</span><span class="token keyword">boolean</span> leapYear <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">isLeapYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// æ˜¯å¦ä¸ºé—°å¹´ï¼šfalse</span></code></pre><p>ä¹Ÿå¯ä»¥è°ƒç”¨é™æ€æ–¹æ³•now()æ¥è·å–å½“å‰æ—¥æœŸï¼š</p><pre class=" language-java"><code class="language-java">LocalDate now <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>LocalTimeå’ŒLocalDateç±»ä¼¼ï¼Œä»–ä»¬ä¹‹é—´çš„åŒºåˆ«åœ¨äºLocalDateä¸åŒ…å«å…·ä½“æ—¶é—´ï¼Œè€ŒLocalTimeåŒ…å«å…·ä½“æ—¶é—´ï¼Œä¾‹å¦‚ï¼š</p><pre class=" language-java"><code class="language-java">LocalTime localTime <span class="token operator">=</span> LocalTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// åˆå§‹åŒ–ä¸€ä¸ªæ—¶é—´ï¼š17:23:52</span><span class="token keyword">int</span> hour <span class="token operator">=</span> localTime<span class="token punctuation">.</span><span class="token function">getHour</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment" spellcheck="true">// æ—¶ï¼š17</span><span class="token keyword">int</span> minute <span class="token operator">=</span> localTime<span class="token punctuation">.</span><span class="token function">getMinute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment" spellcheck="true">// åˆ†ï¼š23</span><span class="token keyword">int</span> second <span class="token operator">=</span> localTime<span class="token punctuation">.</span><span class="token function">getSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment" spellcheck="true">// ç§’ï¼š52</span></code></pre><p>LocalDateTime<br>LocalDateTimeç±»æ˜¯LocalDateå’ŒLocalTimeçš„ç»“åˆä½“ï¼Œå¯ä»¥é€šè¿‡of()æ–¹æ³•ç›´æ¥åˆ›å»ºï¼Œä¹Ÿå¯ä»¥è°ƒç”¨LocalDateçš„atTime()æ–¹æ³•æˆ–LocalTimeçš„atDate()æ–¹æ³•å°†LocalDateæˆ–LocalTimeåˆå¹¶æˆä¸€ä¸ªLocalDateTimeï¼š</p><pre class=" language-java"><code class="language-java">LocalDateTime ldt1 <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> Month<span class="token punctuation">.</span>JANUARY<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">)</span><span class="token punctuation">;</span>LocalDate localDate <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> Month<span class="token punctuation">.</span>JANUARY<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>LocalTime localTime <span class="token operator">=</span> LocalTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">)</span><span class="token punctuation">;</span>LocalDateTime ldt2 <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">atTime</span><span class="token punctuation">(</span>localTime<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>LocalDateTimeä¹Ÿæä¾›ç”¨äºå‘LocalDateå’ŒLocalTimeçš„è½¬åŒ–ï¼š</p><pre class=" language-java"><code class="language-java">LocalDate date <span class="token operator">=</span> ldt1<span class="token punctuation">.</span><span class="token function">toLocalDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>LocalTime time <span class="token operator">=</span> ldt1<span class="token punctuation">.</span><span class="token function">toLocalTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Instant<br>Instantç”¨äºè¡¨ç¤ºä¸€ä¸ªæ—¶é—´æˆ³ï¼Œå®ƒä¸æˆ‘ä»¬å¸¸ä½¿ç”¨çš„System.currentTimeMillis()æœ‰äº›ç±»ä¼¼ï¼Œä¸è¿‡Instantå¯ä»¥ç²¾ç¡®åˆ°çº³ç§’ï¼ˆNano-Secondï¼‰ï¼ŒSystem.currentTimeMillis()æ–¹æ³•åªç²¾ç¡®åˆ°æ¯«ç§’ï¼ˆMilli-Secondï¼‰ã€‚å¦‚æœæŸ¥çœ‹Instantæºç ï¼Œå‘ç°å®ƒçš„å†…éƒ¨ä½¿ç”¨äº†ä¸¤ä¸ªå¸¸é‡ï¼Œsecondsè¡¨ç¤ºä»1970-01-01 00:00:00å¼€å§‹åˆ°ç°åœ¨çš„ç§’æ•°ï¼Œnanosè¡¨ç¤ºçº³ç§’éƒ¨åˆ†ï¼ˆnanosçš„å€¼ä¸ä¼šè¶…è¿‡999,999,999ï¼‰ã€‚Instanté™¤äº†ä½¿ç”¨now()æ–¹æ³•åˆ›å»ºå¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ofEpochSecondæ–¹æ³•åˆ›å»ºï¼š</p><pre class=" language-java"><code class="language-java">Instant instant <span class="token operator">=</span> Instant<span class="token punctuation">.</span><span class="token function">ofEpochSecond</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ofEpochSecond()æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç§’ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºçº³ç§’ï¼Œä¸Šé¢çš„ä»£ç è¡¨ç¤ºä»1970-01-01 00:00:00å¼€å§‹åä¸¤åˆ†é’Ÿçš„10ä¸‡çº³ç§’çš„æ—¶åˆ»ï¼Œæ§åˆ¶å°ä¸Šçš„è¾“å‡ºä¸ºï¼š</p><pre class=" language-java"><code class="language-java"><span class="token number">1970</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span>01T00<span class="token operator">:</span><span class="token number">02</span><span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">.</span>000100Z</code></pre><p>Duration<br>Durationçš„å†…éƒ¨å®ç°ä¸Instantç±»ä¼¼ï¼Œä¹Ÿæ˜¯åŒ…å«ä¸¤éƒ¨åˆ†ï¼šsecondsè¡¨ç¤ºç§’ï¼Œnanosè¡¨ç¤ºçº³ç§’ã€‚ä¸¤è€…çš„åŒºåˆ«æ˜¯Instantç”¨äºè¡¨ç¤ºä¸€ä¸ªæ—¶é—´æˆ³ï¼ˆæˆ–è€…è¯´æ˜¯ä¸€ä¸ªæ—¶é—´ç‚¹ï¼‰ï¼Œè€ŒDurationè¡¨ç¤ºä¸€ä¸ªæ—¶é—´æ®µï¼Œæ‰€ä»¥Durationç±»ä¸­ä¸åŒ…å«now()é™æ€æ–¹æ³•ã€‚å¯ä»¥é€šè¿‡Duration.between()æ–¹æ³•åˆ›å»ºDurationå¯¹è±¡ï¼š</p><pre class=" language-java"><code class="language-java">LocalDateTime from <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> Month<span class="token punctuation">.</span>JANUARY<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 2017-01-05 10:07:00</span>LocalDateTime to <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> Month<span class="token punctuation">.</span>FEBRUARY<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// 2017-02-05 10:07:00</span>Duration duration <span class="token operator">=</span> Duration<span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// è¡¨ç¤ºä» 2017-01-05 10:07:00 åˆ° 2017-02-05 10:07:00 è¿™æ®µæ—¶é—´</span><span class="token keyword">long</span> days <span class="token operator">=</span> duration<span class="token punctuation">.</span><span class="token function">toDays</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment" spellcheck="true">// è¿™æ®µæ—¶é—´çš„æ€»å¤©æ•°</span><span class="token keyword">long</span> hours <span class="token operator">=</span> duration<span class="token punctuation">.</span><span class="token function">toHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// è¿™æ®µæ—¶é—´çš„å°æ—¶æ•°</span><span class="token keyword">long</span> minutes <span class="token operator">=</span> duration<span class="token punctuation">.</span><span class="token function">toMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// è¿™æ®µæ—¶é—´çš„åˆ†é’Ÿæ•°</span><span class="token keyword">long</span> seconds <span class="token operator">=</span> duration<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">// è¿™æ®µæ—¶é—´çš„ç§’æ•°</span><span class="token keyword">long</span> milliSeconds <span class="token operator">=</span> duration<span class="token punctuation">.</span><span class="token function">toMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// è¿™æ®µæ—¶é—´çš„æ¯«ç§’æ•°</span><span class="token keyword">long</span> nanoSeconds <span class="token operator">=</span> duration<span class="token punctuation">.</span><span class="token function">toNanos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// è¿™æ®µæ—¶é—´çš„çº³ç§’æ•°</span></code></pre><p>Durationå¯¹è±¡è¿˜å¯ä»¥é€šè¿‡of()æ–¹æ³•åˆ›å»ºï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªæ—¶é—´æ®µé•¿åº¦ï¼Œå’Œä¸€ä¸ªæ—¶é—´å•ä½ä½œä¸ºå‚æ•°ï¼š</p><pre class=" language-java"><code class="language-java">Duration duration1 <span class="token operator">=</span> Duration<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> ChronoUnit<span class="token punctuation">.</span>DAYS<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">// 5å¤©</span>Duration duration2 <span class="token operator">=</span> Duration<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> ChronoUnit<span class="token punctuation">.</span>MILLIS<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 1000æ¯«ç§’</span></code></pre><p>Period<br>Periodåœ¨æ¦‚å¿µä¸Šå’ŒDurationç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºPeriodæ˜¯ä»¥å¹´æœˆæ—¥æ¥è¡¡é‡ä¸€ä¸ªæ—¶é—´æ®µï¼Œæ¯”å¦‚2å¹´3ä¸ªæœˆ6å¤©ï¼š</p><pre class=" language-java"><code class="language-java">Period period <span class="token operator">=</span> Period<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Periodå¯¹è±¡ä¹Ÿå¯ä»¥é€šè¿‡between()æ–¹æ³•åˆ›å»ºï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”±äºPeriodæ˜¯ä»¥å¹´æœˆæ—¥è¡¡é‡æ—¶é—´æ®µï¼Œæ‰€ä»¥between()æ–¹æ³•åªèƒ½æ¥æ”¶LocalDateç±»å‹çš„å‚æ•°ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 2017-01-05 åˆ° 2017-02-05 è¿™æ®µæ—¶é—´</span>Period period <span class="token operator">=</span> Period<span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span>                LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ—¥æœŸçš„æ“ä½œå’Œæ ¼å¼åŒ–<br>å¢åŠ å’Œå‡å°‘æ—¥æœŸ<br>Java 8ä¸­çš„æ—¥æœŸ/æ—¶é—´ç±»éƒ½æ˜¯ä¸å¯å˜çš„ï¼Œè¿™æ˜¯ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚å½“ç„¶ï¼Œæ–°çš„æ—¥æœŸ/æ—¶é—´ç±»ä¹Ÿæä¾›äº†æ–¹æ³•ç”¨äºåˆ›å»ºå¯¹è±¡çš„å¯å˜ç‰ˆæœ¬ï¼Œæ¯”å¦‚å¢åŠ ä¸€å¤©æˆ–è€…å‡å°‘ä¸€å¤©ï¼š</p><pre class=" language-java"><code class="language-java">LocalDate date <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// 2017-01-05</span>LocalDate date1 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">withYear</span><span class="token punctuation">(</span><span class="token number">2016</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment" spellcheck="true">// ä¿®æ”¹ä¸º 2016-01-05</span>LocalDate date2 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">withMonth</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// ä¿®æ”¹ä¸º 2017-02-05</span>LocalDate date3 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">withDayOfMonth</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment" spellcheck="true">// ä¿®æ”¹ä¸º 2017-01-01</span>LocalDate date4 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">plusYears</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// å¢åŠ ä¸€å¹´ 2018-01-05</span>LocalDate date5 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">minusMonths</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment" spellcheck="true">// å‡å°‘ä¸¤ä¸ªæœˆ 2016-11-05</span>LocalDate date6 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> ChronoUnit<span class="token punctuation">.</span>DAYS<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å¢åŠ 5å¤© 2017-01-10</span></code></pre><p>ä¸Šé¢ä¾‹å­ä¸­å¯¹äºæ—¥æœŸçš„æ“ä½œæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™æˆ‘ä»¬è¦é¢ä¸´æ›´å¤æ‚çš„æ—¶é—´æ“ä½œï¼Œæ¯”å¦‚å°†æ—¶é—´è°ƒåˆ°ä¸‹ä¸€ä¸ªå·¥ä½œæ—¥ï¼Œæˆ–è€…æ˜¯ä¸‹ä¸ªæœˆçš„æœ€åä¸€å¤©ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨with()æ–¹æ³•çš„å¦ä¸€ä¸ªé‡è½½æ–¹æ³•ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªTemporalAdjusterå‚æ•°ï¼Œå¯ä»¥ä½¿æˆ‘ä»¬æ›´åŠ çµæ´»çš„è°ƒæ•´æ—¥æœŸï¼š</p><pre class=" language-java"><code class="language-java">LocalDate date7 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token function">nextOrSame</span><span class="token punctuation">(</span>DayOfWeek<span class="token punctuation">.</span>SUNDAY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// è¿”å›ä¸‹ä¸€ä¸ªè·ç¦»å½“å‰æ—¶é—´æœ€è¿‘çš„æ˜ŸæœŸæ—¥</span>LocalDate date9 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token function">lastInMonth</span><span class="token punctuation">(</span>DayOfWeek<span class="token punctuation">.</span>SATURDAY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// è¿”å›æœ¬æœˆæœ€åä¸€ä¸ªæ˜ŸæœŸå…­</span></code></pre><p>è¦ä½¿ä¸Šé¢çš„ä»£ç æ­£ç¡®ç¼–è¯‘ï¼Œä½ éœ€è¦ä½¿ç”¨é™æ€å¯¼å…¥TemporalAdjusterså¯¹è±¡ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>temporal<span class="token punctuation">.</span>TemporalAdjusters<span class="token punctuation">.</span>*<span class="token punctuation">;</span></code></pre><p>TemporalAdjustersç±»ä¸­åŒ…å«äº†å¾ˆå¤šé™æ€æ–¹æ³•å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸‹é¢çš„è¡¨æ ¼åˆ—å‡ºäº†ä¸€äº›æ–¹æ³•ï¼š<br><img src="/images/java8-lambda-with-date-process/jdk1.8-TemporalAdjusters-method-example.png" alt="TemporalAdjustersç›¸å…³é™æ€æ–¹æ³•.png"><br>å¦‚æœä¸Šé¢è¡¨æ ¼ä¸­åˆ—å‡ºçš„æ–¹æ³•ä¸èƒ½æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œä½ è¿˜å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„TemporalAdjusteræ¥å£çš„å®ç°ï¼ŒTemporalAdjusterä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Lambdaè¡¨è¾¾å¼ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@FunctionalInterface</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TemporalAdjuster</span> <span class="token punctuation">{</span>    Temporal <span class="token function">adjustInto</span><span class="token punctuation">(</span>Temporal temporal<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>æ¯”å¦‚ç»™å®šä¸€ä¸ªæ—¥æœŸï¼Œè®¡ç®—è¯¥æ—¥æœŸçš„ä¸‹ä¸€ä¸ªå·¥ä½œæ—¥ï¼ˆä¸åŒ…æ‹¬æ˜ŸæœŸå…­å’Œæ˜ŸæœŸå¤©ï¼‰ï¼š</p><pre class=" language-java"><code class="language-java">LocalDate date <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>date<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>temporal <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// å½“å‰æ—¥æœŸ</span>    DayOfWeek dayOfWeek <span class="token operator">=</span> DayOfWeek<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>temporal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ChronoField<span class="token punctuation">.</span>DAY_OF_WEEK<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ¯æ¬¡å¢åŠ ä¸€å¤©</span>    <span class="token keyword">int</span> dayToAdd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯æ˜ŸæœŸäº”ï¼Œå¢åŠ ä¸‰å¤©</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>dayOfWeek <span class="token operator">==</span> DayOfWeek<span class="token punctuation">.</span>FRIDAY<span class="token punctuation">)</span> <span class="token punctuation">{</span>        dayToAdd <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯æ˜ŸæœŸå…­ï¼Œå¢åŠ ä¸¤å¤©</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>dayOfWeek <span class="token operator">==</span> DayOfWeek<span class="token punctuation">.</span>SATURDAY<span class="token punctuation">)</span> <span class="token punctuation">{</span>        dayToAdd <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> temporal<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span>dayToAdd<span class="token punctuation">,</span> ChronoUnit<span class="token punctuation">.</span>DAYS<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ ¼å¼åŒ–æ—¥æœŸ<br>æ–°çš„æ—¥æœŸAPIä¸­æä¾›äº†ä¸€ä¸ªDateTimeFormatterç±»ç”¨äºå¤„ç†æ—¥æœŸæ ¼å¼åŒ–æ“ä½œï¼Œå®ƒè¢«åŒ…å«åœ¨java.time.formatåŒ…ä¸­ï¼ŒJava 8çš„æ—¥æœŸç±»æœ‰ä¸€ä¸ªformat()æ–¹æ³•ç”¨äºå°†æ—¥æœŸæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªDateTimeFormatterç±»å‹å‚æ•°ï¼š</p><pre class=" language-java"><code class="language-java">LocalDateTime dateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>String strDate1 <span class="token operator">=</span> dateTime<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span>BASIC_ISO_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 20170105</span>String strDate2 <span class="token operator">=</span> dateTime<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span>ISO_LOCAL_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 2017-01-05</span>String strDate3 <span class="token operator">=</span> dateTime<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span>ISO_LOCAL_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 14:20:16.998</span>String strDate4 <span class="token operator">=</span> dateTime<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// 2017-01-05</span>String strDate5 <span class="token operator">=</span> dateTime<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"ä»Šå¤©æ˜¯ï¼šYYYYå¹´ MMMM DDæ—¥ E"</span><span class="token punctuation">,</span> Locale<span class="token punctuation">.</span>CHINESE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ä»Šå¤©æ˜¯ï¼š2017å¹´ ä¸€æœˆ 05æ—¥ æ˜ŸæœŸå››</span></code></pre><p>åŒæ ·ï¼Œæ—¥æœŸç±»ä¹Ÿæ”¯æŒå°†ä¸€ä¸ªå­—ç¬¦ä¸²è§£ææˆä¸€ä¸ªæ—¥æœŸå¯¹è±¡ï¼Œä¾‹å¦‚ï¼š</p><pre class=" language-java"><code class="language-java">String strDate6 <span class="token operator">=</span> <span class="token string">"2017-01-05"</span><span class="token punctuation">;</span>String strDate7 <span class="token operator">=</span> <span class="token string">"2017-01-05 12:30:05"</span><span class="token punctuation">;</span>LocalDate date <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>strDate6<span class="token punctuation">,</span> DateTimeFormatter<span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>LocalDateTime dateTime1 <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>strDate7<span class="token punctuation">,</span> DateTimeFormatter<span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ—¶åŒº<br>Java 8ä¸­çš„æ—¶åŒºæ“ä½œè¢«å¾ˆå¤§ç¨‹åº¦ä¸Šç®€åŒ–äº†ï¼Œæ–°çš„æ—¶åŒºç±»java.time.ZoneIdæ˜¯åŸæœ‰çš„java.util.TimeZoneç±»çš„æ›¿ä»£å“ã€‚ZoneIdå¯¹è±¡å¯ä»¥é€šè¿‡ZoneId.of()æ–¹æ³•åˆ›å»ºï¼Œä¹Ÿå¯ä»¥é€šè¿‡ZoneId.systemDefault()è·å–ç³»ç»Ÿé»˜è®¤æ—¶åŒºï¼š</p><pre class=" language-java"><code class="language-java">ZoneId shanghaiZoneId <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Asia/Shanghai"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ZoneId systemZoneId <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>of()æ–¹æ³•æ¥æ”¶ä¸€ä¸ªâ€œåŒºåŸŸ/åŸå¸‚â€çš„å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œä½ å¯ä»¥é€šè¿‡getAvailableZoneIds()æ–¹æ³•è·å–æ‰€æœ‰åˆæ³•çš„â€œåŒºåŸŸ/åŸå¸‚â€å­—ç¬¦ä¸²ï¼š</p><pre class=" language-java"><code class="language-java">Set<span class="token operator">&lt;</span>String<span class="token operator">></span> zoneIds <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">getAvailableZoneIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å¯¹äºè€çš„æ—¶åŒºç±»TimeZoneï¼ŒJava 8ä¹Ÿæä¾›äº†è½¬åŒ–æ–¹æ³•ï¼š</p><pre class=" language-java"><code class="language-java">ZoneId oldToNewZoneId <span class="token operator">=</span> TimeZone<span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toZoneId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æœ‰äº†ZoneIdï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†ä¸€ä¸ªLocalDateã€LocalTimeæˆ–LocalDateTimeå¯¹è±¡è½¬åŒ–ä¸ºZonedDateTimeå¯¹è±¡ï¼š</p><pre class=" language-java"><code class="language-java">LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ZonedDateTime zonedDateTime <span class="token operator">=</span> ZonedDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>localDateTime<span class="token punctuation">,</span> shanghaiZoneId<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å°†zonedDateTimeæ‰“å°åˆ°æ§åˆ¶å°ä¸ºï¼š</p><pre class=" language-java"><code class="language-java"><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span>26T16<span class="token operator">:</span><span class="token number">36</span><span class="token operator">:</span><span class="token number">41.971</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">[</span>Asia<span class="token operator">/</span>Shanghai<span class="token punctuation">]</span></code></pre><p>ZonedDateTimeå¯¹è±¡ç”±ä¸¤éƒ¨åˆ†æ„æˆï¼ŒLocalDateTimeå’ŒZoneIdï¼Œå…¶ä¸­2017-01-05T15:26:56.147éƒ¨åˆ†ä¸ºLocalDateTimeï¼Œ+08:00[Asia/Shanghai]éƒ¨åˆ†ä¸ºZoneIdã€‚<br>å¦ä¸€ç§è¡¨ç¤ºæ—¶åŒºçš„æ–¹å¼æ˜¯ä½¿ç”¨ZoneOffsetï¼Œå®ƒæ˜¯ä»¥å½“å‰æ—¶é—´å’Œä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼ˆUTCï¼‰/æ ¼æ—å¨æ²»æ—¶é—´ï¼ˆGMTï¼‰çš„åå·®æ¥è®¡ç®—ï¼Œä¾‹å¦‚ï¼š</p><pre class=" language-java"><code class="language-java">ZoneOffset zoneOffset <span class="token operator">=</span> ZoneOffset<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"+09:00"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>OffsetDateTime offsetDateTime <span class="token operator">=</span> OffsetDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>localDateTime<span class="token punctuation">,</span> zoneOffset<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å…¶ä»–å†æ³•<br>Javaä¸­ä½¿ç”¨çš„å†æ³•æ˜¯ISO 8601æ—¥å†ç³»ç»Ÿï¼Œå®ƒæ˜¯ä¸–ç•Œæ°‘ç”¨å†æ³•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å…¬å†ã€‚å¹³å¹´æœ‰365å¤©ï¼Œé—°å¹´æ˜¯366å¤©ã€‚é—°å¹´çš„å®šä¹‰æ˜¯ï¼šéä¸–çºªå¹´ï¼Œèƒ½è¢«4æ•´é™¤ï¼›ä¸–çºªå¹´èƒ½è¢«400æ•´é™¤ã€‚ä¸ºäº†è®¡ç®—çš„ä¸€è‡´æ€§ï¼Œå…¬å…ƒ1å¹´çš„å‰ä¸€å¹´è¢«å½“åšå…¬å…ƒ0å¹´ï¼Œä»¥æ­¤ç±»æ¨ã€‚<br>æ­¤å¤–Java 8è¿˜æä¾›äº†4å¥—å…¶ä»–å†æ³•ï¼ˆå¾ˆå¥‡æ€ªä¸ºä»€ä¹ˆæ²¡æœ‰æ±‰æ—äººä½¿ç”¨çš„å†œå†ï¼‰ï¼Œæ¯å¥—å†æ³•éƒ½åŒ…å«ä¸€ä¸ªæ—¥æœŸç±»ï¼Œåˆ†åˆ«æ˜¯ï¼š<br>ThaiBuddhistDateï¼šæ³°å›½ä½›æ•™å†<br>MinguoDateï¼šä¸­åæ°‘å›½å†<br>JapaneseDateï¼šæ—¥æœ¬å†<br>HijrahDateï¼šä¼Šæ–¯å…°å†<br>æ¯ä¸ªæ—¥æœŸç±»éƒ½ç»§æ‰¿ChronoLocalDateç±»ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä¸çŸ¥é“å…·ä½“å†æ³•çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥æ“ä½œã€‚ä¸è¿‡è¿™äº›å†æ³•ä¸€èˆ¬ä¸å¸¸ç”¨ï¼Œé™¤éæ˜¯æœ‰æŸäº›ç‰¹æ®Šéœ€æ±‚æƒ…å†µä¸‹æ‰ä¼šä½¿ç”¨ã€‚<br>è¿™äº›ä¸åŒçš„å†æ³•ä¹Ÿå¯ä»¥ç”¨äºå‘å…¬å†è½¬æ¢ï¼š</p><pre class=" language-java"><code class="language-java">LocalDate date <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>JapaneseDate jpDate <span class="token operator">=</span> JapaneseDate<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ç”±äºå®ƒä»¬éƒ½ç»§æ‰¿ChronoLocalDateç±»ï¼Œæ‰€ä»¥åœ¨ä¸çŸ¥é“å…·ä½“å†æ³•æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ChronoLocalDateç±»æ“ä½œæ—¥æœŸï¼š</p><pre class=" language-java"><code class="language-java">Chronology jpChronology <span class="token operator">=</span> Chronology<span class="token punctuation">.</span><span class="token function">ofLocale</span><span class="token punctuation">(</span>Locale<span class="token punctuation">.</span>JAPANESE<span class="token punctuation">)</span><span class="token punctuation">;</span>ChronoLocalDate jpChronoLocalDate <span class="token operator">=</span> jpChronology<span class="token punctuation">.</span><span class="token function">dateNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­åº”è¯¥å°½é‡é¿å…ä½¿ç”¨ChronoLocalDateï¼Œå°½é‡ç”¨ä¸å†æ³•æ— å…³çš„æ–¹å¼æ“ä½œæ—¶é—´ï¼Œå› ä¸ºä¸åŒçš„å†æ³•è®¡ç®—æ—¥æœŸçš„æ–¹å¼ä¸ä¸€æ ·ï¼Œæ¯”å¦‚å¼€å‘è€…ä¼šåœ¨ç¨‹åºä¸­åšä¸€äº›å‡è®¾ï¼Œå‡è®¾ä¸€å¹´ä¸­æœ‰12ä¸ªæœˆï¼Œå¦‚æœæ˜¯ä¸­å›½å†œå†ä¸­åŒ…å«äº†é—°æœˆï¼Œä¸€å¹´æœ‰å¯èƒ½æ˜¯13ä¸ªæœˆï¼Œä½†å¼€å‘è€…è®¤ä¸ºæ˜¯12ä¸ªæœˆï¼Œå¤šå‡ºæ¥çš„ä¸€ä¸ªæœˆå±äºæ˜å¹´çš„ã€‚å†æ¯”å¦‚å‡è®¾å¹´ä»½æ˜¯ç´¯åŠ çš„ï¼Œè¿‡äº†ä¸€å¹´å°±åœ¨åŸæ¥çš„å¹´ä»½ä¸ŠåŠ ä¸€ï¼Œä½†æ—¥æœ¬å¤©çš‡åœ¨æ¢ä»£ä¹‹åéœ€è¦é‡æ–°çºªå¹´ï¼Œæ‰€ä»¥è¿‡äº†ä¸€å¹´å¹´ä»½å¯èƒ½ä¼šä»1å¼€å§‹è®¡ç®—ã€‚<br>åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­å»ºè®®ä½¿ç”¨LocalDateï¼ŒåŒ…æ‹¬å­˜å‚¨ã€æ“ä½œã€ä¸šåŠ¡è§„åˆ™çš„è§£è¯»ï¼›é™¤ééœ€è¦å°†ç¨‹åºçš„è¾“å…¥æˆ–è€…è¾“å‡ºæœ¬åœ°åŒ–ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨ChronoLocalDateç±»ã€‚</p><p>æœ€åæ¨èä¸€ç¯‡éå¸¸ä¸é”™åˆ‡å®ç”¨æ€§å¾ˆå¥½çš„æ·±åº¦ç†è§£lambdaè¡¨è¾¾å¼åšå®¢,è¿™ä¸ªåšå®¢æ€»ç»“äº†å¥½å‡ ç¯‡ä¸é”™çš„labdaè¡¨è¾¾å¼ä¸Streamæµçš„å·¥ä½œä¸­å¸¸ç”¨åˆ°çš„æ¡ˆä¾‹èƒ½å¤Ÿæ›´å¥½çš„å¸®åŠ©åˆ°å¤§å®¶å»ç†è§£å’Œä½¿ç”¨lambdaè¡¨è¾¾å¼è¿™ä¸ªåˆ©å™¨å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿçš„åœ¨å·¥ä½œä¸­è¿›è¡Œè¿­ä»£å¼€å‘,é«˜æ•ˆæ’¸ç ~<a href="https://www.cnblogs.com/CarpenterLee/category/965121.html">æ·±å…¥ç†è§£Javaå‡½æ•°å¼ç¼–ç¨‹</a></p>]]></content>
      
      
      <categories>
          
          <category> SpringBoot Nacos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java8 lambda </tag>
            
            <tag> Stream Programming </tag>
            
            <tag> LocalDateã€LocalTimeã€Instantã€Duration </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é›¶åŸºç¡€æ·±å…¥å­¦ä¹ æºç¨‹Apolloé…ç½®ä¸­å¿ƒ</title>
      <link href="2021/10/09/apollo-config-trip/"/>
      <url>2021/10/09/apollo-config-trip/</url>
      
        <content type="html"><![CDATA[<h2 id="1-Apolloé…ç½®ä¸­å¿ƒç®€ä»‹"><a href="#1-Apolloé…ç½®ä¸­å¿ƒç®€ä»‹" class="headerlink" title="1:Apolloé…ç½®ä¸­å¿ƒç®€ä»‹"></a>1:Apolloé…ç½®ä¸­å¿ƒç®€ä»‹</h2><p>Apolloï¼ˆé˜¿æ³¢ç½—ï¼‰æ˜¯æºç¨‹æ¡†æ¶éƒ¨é—¨ç ”å‘çš„é…ç½®ç®¡ç†å¹³å°ï¼Œèƒ½å¤Ÿé›†ä¸­åŒ–ç®¡ç†åº”ç”¨ä¸åŒç¯å¢ƒã€ä¸åŒé›†ç¾¤çš„é…ç½®ï¼Œé…ç½®ä¿®æ”¹åèƒ½å¤Ÿå®æ—¶æ¨é€åˆ°åº”ç”¨ç«¯ï¼Œå¹¶ä¸”å…·å¤‡è§„èŒƒçš„æƒé™ã€æµç¨‹æ²»ç†ç­‰ç‰¹æ€§ã€‚æœåŠ¡ç«¯åŸºäºSpring Bootå’ŒSpring Cloudå¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–å®‰è£…Tomcatç­‰åº”ç”¨å®¹å™¨ã€‚<br>ä¸ºä»€ä¹ˆæˆ‘ä»¬ç”¨äº†ç™¾åº¦çš„disconfã€spring-cloud-configæºç¨‹è¿˜è¦å¦è¾Ÿè¹Šå¾„,ç ”ç©¶å‡ºä¸€å¥—ç‹¬æœ‰çš„Apolloå‘¢ï¼Ÿä¸‹é¢è®©æˆ‘ä»¬é€šè¿‡å¼€æºé…ç½®ä¸­å¿ƒå¯¹æ¯”çŸ©é˜µä¸€å¼ å›¾æ¥è¿›è¡Œè§£é‡Šè¿™ä¸ªé—®é¢˜:<br>![å¼€æºé…ç½®ä¸­å¿ƒå¯¹æ¯”çŸ©é˜µ.jpg] (/images/apollo-config-trip/open-source-configuration-performance-comparison-matrix.jpg)<br>ä»æ€§èƒ½å¯¹æ¯”å›¾ä¸­æˆ‘ä»¬ä¸éš¾çœ‹å‡º,ä»åŠŸèƒ½ç‰¹æ€§ã€æŠ€æœ¯è·¯çº¿ã€å¯ç”¨æ€§ã€æ˜“ç”¨æ€§æ¥è¯´æ¯”å…¶å®ƒå¼€æºé…ç½®ä¸­å¿ƒæ˜¯éå¸¸å‡ºè‰²çš„(å°¤å…¶æ˜¯é‡Œé¢çš„ç°åº¦è§„åˆ™ã€namespaceç©ºé—´ç®¡ç†éå¸¸ä¸é”™)ã€‚å¥½,åºŸè¯ä¸å¤šè¯´,æˆ‘ä»¬å…ˆä»æ­å»ºå¼€å§‹è®²èµ·ã€‚</p><h2 id="2-æ³¨å†Œä¸­å¿ƒé˜¿æ³¢ç½—Apolloæ­å»º"><a href="#2-æ³¨å†Œä¸­å¿ƒé˜¿æ³¢ç½—Apolloæ­å»º" class="headerlink" title="2:æ³¨å†Œä¸­å¿ƒé˜¿æ³¢ç½—Apolloæ­å»º"></a>2:æ³¨å†Œä¸­å¿ƒé˜¿æ³¢ç½—Apolloæ­å»º</h2><p><a href="https://github.com/ctripcorp/apollo">Apolloå¼€æºå®˜ç½‘</a><br><a href="https://github.com/ctripcorp/apollo/wiki">Wiki</a> â˜ ä¸€åˆ‡çš„é›†æˆæ–¹å¼å’Œä½¿ç”¨æ–¹æ³•éƒ½åœ¨è¿™é‡Œ<br><a href="https://github.com/ctripcorp/apollo/issues">Issues</a> â˜ å¦‚æœæœŸé—´æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·é€šè¿‡è¿™é‡ŒæŸ¥æ‰¾å¤§éƒ¨åˆ†è§£å†³æ–¹æ³•<br>è¯´æ˜ï¼šæˆ‘è¿™é‡Œæ­å»ºçš„æ˜¯1.3çš„æœåŠ¡ç‰ˆæœ¬,1.3.1åœ¨æ˜¯ç›®å‰æœ€æ–°çš„ç‰ˆæœ¬,ç›¸å¯¹äºä¹‹å‰çš„ç‰ˆæœ¬å¢åŠ äº†ymlã€yamlç­‰å¤šç§é…ç½®æ–‡ä»¶çš„æ”¯æŒã€‚<br><a href="https://github.com/ctripcorp/apollo/releases">ä¸‹è½½Releasesç‰ˆæœ¬</a><br>ä¸‹è½½ä¸‰ä¸ªå·²ç»æ‰“å¥½çš„å®‰è£…åŒ…:<br><a href="https://github.com/ctripcorp/apollo/releases/download/v1.3.0/apollo-adminservice-1.3.0-github.zip">apollo-adminservice-1.3.0-github.zip</a><br><a href="https://github.com/ctripcorp/apollo/releases/download/v1.3.0/apollo-configservice-1.3.0-github.zip">apollo-configservice-1.3.0-github.zip</a><br><a href="https://github.com/ctripcorp/apollo/releases/download/v1.3.0/apollo-portal-1.3.0-github.zip">apollo-portal-1.3.0-github.zip</a><br>2.1ã€åŸºç¡€ç¯å¢ƒï¼š<br>JDKï¼š1.8.0_161<br>Mavenï¼š3.5.2<br><a href="https://cloud.tencent.com/product/cdb">MySQL</a>ï¼š5.7.18<br>apolloï¼š1.3.1<br>2.2 å¯¼å…¥æ•°æ®åº“æ–‡ä»¶ ç™»å½•MySQLå‘½ä»¤è¡Œï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹ä¸¤ä¸ªsqlæ–‡ä»¶<br><a href="https://github.com/nobodyiam/apollo-build-scripts/blob/master/sql/apolloportaldb.sql">ç•Œé¢ç®¡ç†</a><br><a href="https://github.com/nobodyiam/apollo-build-scripts/blob/master/sql/apolloconfigdb.sql">é…ç½®ä¸­å¿ƒ</a><br>2.3ã€æ‰“åŒ…<br>åˆ†åˆ«å°†ä¸‰ä¸ªå®‰è£…åŒ…è¿›è¡Œè§£å‹</p><pre><code>unzip apollo-adminservice-1.3.0-github.zip -d ~/apollo/apollo-adminserviceunzip apollo-configservice-1.3.0-github.zip -d ~/apollo/apollo-configserviceunzip apollo-portal-1.3.0-github.zip -d ~/apollo/apollo-portal</code></pre><p>2.4ã€ä¿®æ”¹é…ç½®<br>åˆ†åˆ«è¿›å…¥apollo-adminserviceã€apollo-configserviceçš„configè¿›è¡Œé…ç½®application-github.properties æ•°æ®åº“é…ç½®,æŒ‡å‘ApolloPortalDBåº“<br>è¿›å…¥apollo-portalçš„configç›®å½•ç¼–è¾‘application-github.properties,å°†æ•°æ®åº“æŒ‡å‘ApolloPortalDB,å¹¶ä¸”ç¼–è¾‘apollo-env.properties å°†config meta serverè¿›è¡Œé…ç½®åœ¨é‡Œé¢<br>åˆ†åˆ«è¿›è¡Œadminserviceã€configserviceã€apollo-portalç­‰å®‰è£…åŒ…çš„scriptsç›®å½•,è¿›è¡Œä¿®æ”¹startup.shè„šæœ¬æ–‡ä»¶ã€‚<br>ä¸»è¦ä¿®æ”¹LOG_DIR(æœåŠ¡æ—¥å¿—å­˜å‚¨è·¯å¾„)ã€SERVER_PORT(æœåŠ¡å¯åŠ¨ç«¯å£,å¦‚æœéœ€è¦çš„è¯)ä»¥åŠjvmå¯åŠ¨å‚æ•°,<br>2.5ã€å¯åŠ¨Apollo<br>apollo-configserviceï¼šè¿›å…¥scriptsæ–‡ä»¶å¤¹<br>æ‰§è¡Œè„šæœ¬å¯åŠ¨æœåŠ¡<br>./startup.sh<br>apollo-adminserviceï¼šè¿›å…¥scriptsæ–‡ä»¶å¤¹<br>åˆ‡æ¢åˆ°ç›®å½• apollo-adminservice/scripts<br>æ‰§è¡Œè„šæœ¬å¯åŠ¨æœåŠ¡<br>./startup.sh<br>apollo-portalï¼šè¿›å…¥scriptsæ–‡ä»¶å¤¹<br>æ‰§è¡Œè„šæœ¬å¯åŠ¨æœåŠ¡<br>./startup.sh<br>2.6ã€è®¿é—®Apolloé…ç½®ä¸­å¿ƒé¡µé¢<br>++<a href="http://localhost:8070++">http://localhost:8070++</a> ï¼Œé»˜è®¤ç”¨æˆ·å/å¯†ç å‚è€ƒâ˜ <a href="https://github.com/ctripcorp/apollo/wiki/Portal-%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD">Portal å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½</a> ã€‚<br><img src="/images/apollo-config-trip/apollo-admin-console-page.png" alt="apollo-admin-console-page.png"></p><h2 id="3-Apolloå¤šç¯å¢ƒæ­å»º"><a href="#3-Apolloå¤šç¯å¢ƒæ­å»º" class="headerlink" title="3:Apolloå¤šç¯å¢ƒæ­å»º"></a>3:Apolloå¤šç¯å¢ƒæ­å»º</h2><p>åœ¨æ­å»ºå®ŒæˆApolloä¹‹åæˆ‘ä»¬å‘ç°,é»˜è®¤å°±å­˜åœ¨ä¸€ä¸ªç¯å¢ƒ(é»˜è®¤ä¸ºDEV),é‚£ä¹ˆæˆ‘ä»¬åœ¨å®é™…é¡¹ç›®ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šåŒæ—¶å­˜åœ¨å¤šç¯å¢ƒæƒ…å†µ.(å³:local/dev/test/prodâ€¦..)<br>é˜¿æ³¢ç½—å¤šæ³¨å†Œç¯å¢ƒé…ç½®æ­å»º<br>3.1ã€å¤šç¯å¢ƒå‘½åæ³¨æ„ç‚¹<br> apolloç›®å‰æ”¯æŒçš„ç¯å¢ƒåˆ—è¡¨åç§°æœ‰å“ªäº›(<font color="red">åˆ‡è®°ç¯å¢ƒåå­—ä¸èƒ½çå†™,å¦åˆ™ä¼šæ‰¾ä¸åˆ°çš„,å°å¼ å°±åœ¨è¿™é‡Œæ ½è·Ÿå¤´äº†,éšæ„å†™äº†TEST,ç»“æœportalå¯åŠ¨æŠ¥é”™</font>)ï¼Ÿ<br>è¯¦è§apolloæºç å¾—çŸ¥åœ¨:com.ctrip.framework.apollo.core.enums.Envæšä¸¾ç±»<br>public enum Env{<br>LOCAL, DEV, BETA, FWS, FAT, UAT, LPT, PRO, TOOLS, UNKNOWN;<br>â€¦<br>}<br>LOCAL - Local Development environment<br>DEV - Development environment<br>FWS - Feature Web Service Test environment<br>FAT - Feature Acceptance Test environment<br>LPT - Load and Performance Test environment<br>UAT - User Acceptance Test environment<br>PRO - Production environment<br><img src="/images/apollo-config-trip/apollo-multi-environment-naming.png" alt="apollo-Multi-environment-naming.png"><br>æ¯”å¦‚æˆ‘éœ€è¦å¢åŠ ä¸€ä¸ªFATç¯å¢ƒ,é‚£ä¹ˆéœ€è¦æ–°å¢ä¸€ä¸ªconfig serverã€admin serverã€ä»¥åŠæ–°çš„ApolloConfigDBåº“,å…¶ä¸­config serverã€admin serverçš„configä¸‹å¯¹åº”çš„æ•°æ®åº“é…ç½®éƒ½æŒ‡å‘æ–°çš„ApolloConfigDBã€‚<br>3.2ã€éœ€è¦ä¿®æ”¹çš„è¡¨å­—æ®µä¿¡æ¯å¦‚ä¸‹:<br>3.2.1ã€ApolloPortalDBåº“çš„ServerConfigè¡¨:<br><img src="/images/apollo-config-trip/apolloPortalDB-serviceConfig.png" alt="apolloPortalDB-serviceConfig.png"><br>é’ˆå¯¹ä¸åŒç¯å¢ƒçš„é…ç½®æ–‡ä»¶,åœ¨Apolloä¸­åˆ›å»ºä¸åŒçš„namespaceæ—¶å¯ä»¥æŒ‡å®šä¸åŒè§’è‰²çš„ç”¨æˆ·æ¥è¿›è¡Œç®¡ç†,æ–¹ä¾¿ä¸åŒè§’è‰²çš„ç”¨æˆ·è¿›è¡Œç»´æŠ¤ä¸åŒç¯å¢ƒçš„é…ç½®ã€‚</p><h2 id="4-Apolloé…ç½®ä¸­å¿ƒæ¶æ„è®¾è®¡"><a href="#4-Apolloé…ç½®ä¸­å¿ƒæ¶æ„è®¾è®¡" class="headerlink" title="4:Apolloé…ç½®ä¸­å¿ƒæ¶æ„è®¾è®¡"></a>4:Apolloé…ç½®ä¸­å¿ƒæ¶æ„è®¾è®¡</h2><p>æ­å»ºå®Œæˆä¹‹åæˆ‘ä»¬ä¸€èµ·æ¥ç†Ÿæ‚‰ä¸‹Apolloé…ç½®ä¸­å¿ƒçš„ä¸€ä¸ªæ¶æ„è®¾è®¡ã€‚<br>4.1ã€åŸºç¡€æ¨¡å‹<br>å¦‚ä¸‹å³æ˜¯Apolloçš„åŸºç¡€æ¨¡å‹ï¼š<br>ç”¨æˆ·åœ¨é…ç½®ä¸­å¿ƒå¯¹é…ç½®è¿›è¡Œä¿®æ”¹å¹¶å‘å¸ƒ<br>é…ç½®ä¸­å¿ƒé€šçŸ¥Apolloå®¢æˆ·ç«¯æœ‰é…ç½®æ›´æ–°<br>Apolloå®¢æˆ·ç«¯ä»é…ç½®ä¸­å¿ƒæ‹‰å–æœ€æ–°çš„é…ç½®ã€æ›´æ–°æœ¬åœ°é…ç½®å¹¶é€šçŸ¥åˆ°åº”ç”¨<br><img src="/images/apollo-config-trip/apollo-basic-architecture.png" alt="apollo-basic-architecture.png"><br>4.2ã€æ¶æ„æ¨¡å—<br><img src="/images/apollo-config-trip/apollo-overall-architecture.png" alt="apollo-overall-architecture.png"><br>ä¸Šå›¾ç®€è¦æè¿°äº†Apolloçš„æ€»ä½“è®¾è®¡ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸‹å¾€ä¸Šçœ‹ï¼š</p><ul><li>Config Serviceæä¾›é…ç½®çš„è¯»å–ã€æ¨é€ç­‰åŠŸèƒ½ï¼ŒæœåŠ¡å¯¹è±¡æ˜¯Apolloå®¢æˆ·ç«¯</li><li>Admin Serviceæä¾›é…ç½®çš„ä¿®æ”¹ã€å‘å¸ƒç­‰åŠŸèƒ½ï¼ŒæœåŠ¡å¯¹è±¡æ˜¯Apollo Portalï¼ˆç®¡ç†ç•Œé¢ï¼‰</li><li>Config Serviceå’ŒAdmin Serviceéƒ½æ˜¯å¤šå®ä¾‹ã€æ— çŠ¶æ€éƒ¨ç½²ï¼Œæ‰€ä»¥éœ€è¦å°†è‡ªå·±æ³¨å†Œåˆ°Eurekaä¸­å¹¶ä¿æŒå¿ƒè·³</li><li>åœ¨Eurekaä¹‹ä¸Šæˆ‘ä»¬æ¶äº†ä¸€å±‚Meta Serverç”¨äºå°è£…Eurekaçš„æœåŠ¡å‘ç°æ¥å£</li><li>Clienté€šè¿‡åŸŸåè®¿é—®Meta Serverè·å–Config ServiceæœåŠ¡åˆ—è¡¨ï¼ˆIP+Portï¼‰ï¼Œè€Œåç›´æ¥é€šè¿‡IP+Portè®¿é—®æœåŠ¡ï¼ŒåŒæ—¶åœ¨Clientä¾§ä¼šåšload balanceã€é”™è¯¯é‡è¯•</li><li>Portalé€šè¿‡åŸŸåè®¿é—®Meta Serverè·å–Admin ServiceæœåŠ¡åˆ—è¡¨ï¼ˆIP+Portï¼‰ï¼Œè€Œåç›´æ¥é€šè¿‡IP+Portè®¿é—®æœåŠ¡ï¼ŒåŒæ—¶åœ¨Portalä¾§ä¼šåšload balanceã€é”™è¯¯é‡è¯•</li><li>ä¸ºäº†ç®€åŒ–éƒ¨ç½²ï¼Œæˆ‘ä»¬å®é™…ä¸Šä¼šæŠŠConfig Serviceã€Eurekaå’ŒMeta Serverä¸‰ä¸ªé€»è¾‘è§’è‰²éƒ¨ç½²åœ¨åŒä¸€ä¸ªJVMè¿›ç¨‹ä¸­</li></ul><hr><p>4.3ã€Why Eureka<br>ä¸ºä»€ä¹ˆæˆ‘ä»¬é‡‡ç”¨Eurekaä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¼ ç»Ÿçš„zkã€etcdå‘¢ï¼Ÿå¤§è‡´æ€»ç»“äº†ä¸€ä¸‹ï¼Œæœ‰ä»¥ä¸‹å‡ æ–¹é¢çš„åŸå› ï¼š</p><ul><li>å®ƒæä¾›äº†å®Œæ•´çš„Service Registryå’ŒService Discoveryå®ç°<br> é¦–å…ˆæ˜¯æä¾›äº†å®Œæ•´çš„å®ç°ï¼Œå¹¶ä¸”ä¹Ÿç»å—ä½äº†Netflixè‡ªå·±çš„ç”Ÿäº§ç¯å¢ƒè€ƒéªŒï¼Œç›¸å¯¹ä½¿ç”¨èµ·æ¥ä¼šæ¯”è¾ƒçœå¿ƒã€‚</li><li>å’ŒSpring Cloudæ— ç¼é›†æˆ<br>æˆ‘ä»¬çš„é¡¹ç›®æœ¬èº«å°±ä½¿ç”¨äº†Spring Cloudå’ŒSpring Bootï¼ŒåŒæ—¶Spring Cloudè¿˜æœ‰ä¸€å¥—éå¸¸å®Œå–„çš„å¼€æºä»£ç æ¥æ•´åˆEurekaï¼Œæ‰€ä»¥ä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚<br>å¦å¤–ï¼ŒEurekaè¿˜æ”¯æŒåœ¨æˆ‘ä»¬åº”ç”¨è‡ªèº«çš„å®¹å™¨ä¸­å¯åŠ¨ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„åº”ç”¨å¯åŠ¨å®Œä¹‹åï¼Œæ—¢å……å½“äº†Eurekaçš„è§’è‰²ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æœåŠ¡çš„æä¾›è€…ã€‚è¿™æ ·å°±æå¤§çš„æé«˜äº†æœåŠ¡çš„å¯ç”¨æ€§ã€‚<br>è¿™ä¸€ç‚¹æ˜¯æˆ‘ä»¬é€‰æ‹©Eurekaè€Œä¸æ˜¯zkã€etcdç­‰çš„ä¸»è¦åŸå› ï¼Œä¸ºäº†æé«˜é…ç½®ä¸­å¿ƒçš„å¯ç”¨æ€§å’Œé™ä½éƒ¨ç½²å¤æ‚åº¦ï¼Œæˆ‘ä»¬éœ€è¦å°½å¯èƒ½åœ°å‡å°‘å¤–éƒ¨ä¾èµ–ã€‚</li><li>Open Source<br>æœ€åä¸€ç‚¹æ˜¯å¼€æºï¼Œç”±äºä»£ç æ˜¯å¼€æºçš„ï¼Œæ‰€ä»¥éå¸¸ä¾¿äºæˆ‘ä»¬äº†è§£å®ƒçš„å®ç°åŸç†å’Œæ’æŸ¥é—®é¢˜ã€‚</li></ul><p>4.4 å„æ¨¡å—æ¦‚è¦ä»‹ç»<br>4.4.1 Config Service</p><ul><li>æä¾›é…ç½®è·å–æ¥å£</li><li>æä¾›é…ç½®æ›´æ–°æ¨é€æ¥å£ï¼ˆåŸºäºHttp long pollingï¼‰<br>æœåŠ¡ç«¯ä½¿ç”¨<a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/context/request/async/DeferredResult.html">Spring DeferredResult</a>å®ç°å¼‚æ­¥åŒ–ï¼Œä»è€Œå¤§å¤§å¢åŠ é•¿è¿æ¥æ•°é‡<br>ç›®å‰ä½¿ç”¨çš„tomcat embedé»˜è®¤é…ç½®æ˜¯æœ€å¤š10000ä¸ªè¿æ¥ï¼ˆå¯ä»¥è°ƒæ•´ï¼‰ï¼Œä½¿ç”¨äº†4C8Gçš„è™šæ‹Ÿæœºå®æµ‹å¯ä»¥æ”¯æ’‘10000ä¸ªè¿æ¥ï¼Œæ‰€ä»¥æ»¡è¶³éœ€æ±‚ï¼ˆä¸€ä¸ªåº”ç”¨å®ä¾‹åªä¼šå‘èµ·ä¸€ä¸ªé•¿è¿æ¥ï¼‰ã€‚</li><li>æ¥å£æœåŠ¡å¯¹è±¡ä¸ºApolloå®¢æˆ·ç«¯</li></ul><p>4.4.2 Admin Service</p><ul><li>æä¾›é…ç½®ç®¡ç†æ¥å£</li><li>æä¾›é…ç½®ä¿®æ”¹ã€å‘å¸ƒç­‰æ¥å£</li><li>æ¥å£æœåŠ¡å¯¹è±¡ä¸ºPortal</li></ul><p>4.4.3 Meta Server</p><ul><li>Portalé€šè¿‡åŸŸåè®¿é—®Meta Serverè·å–Admin ServiceæœåŠ¡åˆ—è¡¨ï¼ˆIP+Portï¼‰</li><li>Clienté€šè¿‡åŸŸåè®¿é—®Meta Serverè·å–Config ServiceæœåŠ¡åˆ—è¡¨ï¼ˆIP+Portï¼‰</li><li>Meta Serverä»Eurekaè·å–Config Serviceå’ŒAdmin Serviceçš„æœåŠ¡ä¿¡æ¯ï¼Œç›¸å½“äºæ˜¯ä¸€ä¸ªEureka Client</li><li>å¢è®¾ä¸€ä¸ªMeta Serverçš„è§’è‰²ä¸»è¦æ˜¯ä¸ºäº†å°è£…æœåŠ¡å‘ç°çš„ç»†èŠ‚ï¼Œå¯¹Portalå’ŒClientè€Œè¨€ï¼Œæ°¸è¿œé€šè¿‡ä¸€ä¸ªHttpæ¥å£è·å–Admin Serviceå’ŒConfig Serviceçš„æœåŠ¡ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦å…³å¿ƒèƒŒåå®é™…çš„æœåŠ¡æ³¨å†Œå’Œå‘ç°ç»„ä»¶</li><li>Meta Serveråªæ˜¯ä¸€ä¸ªé€»è¾‘è§’è‰²ï¼Œåœ¨éƒ¨ç½²æ—¶å’ŒConfig Serviceæ˜¯åœ¨ä¸€ä¸ªJVMè¿›ç¨‹ä¸­çš„ï¼Œæ‰€ä»¥IPã€ç«¯å£å’ŒConfig Serviceä¸€è‡´</li></ul><p>4.4.4 Eureka</p><ul><li>åŸºäº<a href="https://github.com/Netflix/eureka">Eureka</a>å’Œ<a href="https://cloud.spring.io/spring-cloud-netflix/">Spring Cloud Netflix</a>æä¾›æœåŠ¡æ³¨å†Œå’Œå‘ç°</li><li>Config Serviceå’ŒAdmin Serviceä¼šå‘Eurekaæ³¨å†ŒæœåŠ¡ï¼Œå¹¶ä¿æŒå¿ƒè·³</li><li>ä¸ºäº†ç®€å•èµ·è§ï¼Œç›®å‰Eurekaåœ¨éƒ¨ç½²æ—¶å’ŒConfig Serviceæ˜¯åœ¨ä¸€ä¸ªJVMè¿›ç¨‹ä¸­çš„ï¼ˆé€šè¿‡Spring Cloud Netflixï¼‰</li></ul><p>4.4.5 Portal</p><ul><li>æä¾›Webç•Œé¢ä¾›ç”¨æˆ·ç®¡ç†é…ç½®</li><li>é€šè¿‡Meta Serverè·å–Admin ServiceæœåŠ¡åˆ—è¡¨ï¼ˆIP+Portï¼‰ï¼Œé€šè¿‡IP+Portè®¿é—®æœåŠ¡</li><li>åœ¨Portalä¾§åšload balanceã€é”™è¯¯é‡è¯•</li></ul><p>4.4.6 Client</p><ul><li>Apolloæä¾›çš„å®¢æˆ·ç«¯ç¨‹åºï¼Œä¸ºåº”ç”¨æä¾›é…ç½®è·å–ã€å®æ—¶æ›´æ–°ç­‰åŠŸèƒ½</li><li>é€šè¿‡Meta Serverè·å–Config ServiceæœåŠ¡åˆ—è¡¨ï¼ˆIP+Portï¼‰ï¼Œé€šè¿‡IP+Portè®¿é—®æœåŠ¡</li><li>åœ¨Clientä¾§åšload balanceã€é”™è¯¯é‡è¯•</li></ul><p>4.5 æœåŠ¡ç«¯è®¾è®¡<br>  4.5.1 å‘é€ReleaseMessageçš„å®ç°æ–¹å¼<br>Config Serviceæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šæ¯ç§’æ‰«æä¸€æ¬¡ReleaseMessageè¡¨,çœ‹çœ‹æ˜¯å¦æœ‰æ–°çš„æ¶ˆæ¯è®°å½•ï¼Œå‚è§<br><a href="https://github.com/ctripcorp/apollo/blob/master/apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/message/ReleaseMessageScanner.java">ReleaseMessageScanner</a><br>ç®€è¦æè¿°äº†NotificationControllerV2æ˜¯å¦‚ä½•å¾—çŸ¥æœ‰é…ç½®å‘å¸ƒçš„ï¼Œé‚£NotificationControllerV2åœ¨å¾—çŸ¥æœ‰é…ç½®å‘å¸ƒåæ˜¯å¦‚ä½•é€šçŸ¥åˆ°å®¢æˆ·ç«¯çš„å‘¢ï¼Ÿ<br>å®ç°æ–¹å¼å¦‚ä¸‹ï¼š</p><ul><li>å®¢æˆ·ç«¯ä¼šå‘èµ·ä¸€ä¸ªHttpè¯·æ±‚åˆ°Config Serviceçš„notifications/v2æ¥å£ï¼Œä¹Ÿå°±æ˜¯<a href="https://github.com/ctripcorp/apollo/blob/master/apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/controller/NotificationControllerV2.java">NotificationControllerV2</a>ï¼Œå‚è§<a href="https://github.com/ctripcorp/apollo/blob/master/apollo-client/src/main/java/com/ctrip/framework/apollo/internals/RemoteConfigLongPollService.java">RemoteConfigLongPollService</a></li><li>NotificationControllerV2ä¸ä¼šç«‹å³è¿”å›ç»“æœï¼Œè€Œæ˜¯é€šè¿‡<a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/context/request/async/DeferredResult.html">Spring DeferredResult</a>æŠŠè¯·æ±‚æŒ‚èµ·</li><li>å¦‚æœåœ¨60ç§’å†…æ²¡æœ‰è¯¥å®¢æˆ·ç«¯å…³å¿ƒçš„é…ç½®å‘å¸ƒï¼Œé‚£ä¹ˆä¼šè¿”å›HttpçŠ¶æ€ç 304ç»™å®¢æˆ·ç«¯</li><li>å¦‚æœæœ‰è¯¥å®¢æˆ·ç«¯å…³å¿ƒçš„é…ç½®å‘å¸ƒï¼ŒNotificationControllerV2ä¼šè°ƒç”¨DeferredResultçš„<a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/context/request/async/DeferredResult.html#setResult-T-">setResult</a>æ–¹æ³•ï¼Œä¼ å…¥æœ‰é…ç½®å˜åŒ–çš„namespaceä¿¡æ¯ï¼ŒåŒæ—¶è¯¥è¯·æ±‚ä¼šç«‹å³è¿”å›ã€‚å®¢æˆ·ç«¯ä»è¿”å›çš„ç»“æœä¸­è·å–åˆ°é…ç½®å˜åŒ–çš„namespaceåï¼Œä¼šç«‹å³è¯·æ±‚Config Serviceè·å–è¯¥namespaceçš„æœ€æ–°é…ç½®ã€‚<br><img src="/images/apollo-config-trip/apollo-client-architecture.png" alt="apollo-client-architecture.png"><br>ä¸Šå›¾ç®€è¦æè¿°äº†Apolloå®¢æˆ·ç«¯çš„å®ç°åŸç†ï¼š</li></ul><ol><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¿æŒäº†ä¸€ä¸ªé•¿è¿æ¥ï¼Œä»è€Œèƒ½ç¬¬ä¸€æ—¶é—´è·å¾—é…ç½®æ›´æ–°çš„æ¨é€ã€‚ï¼ˆé€šè¿‡Http Long Pollingå®ç°ï¼‰</li><li>å®¢æˆ·ç«¯è¿˜ä¼šå®šæ—¶ä»Apolloé…ç½®ä¸­å¿ƒæœåŠ¡ç«¯æ‹‰å–åº”ç”¨çš„æœ€æ–°é…ç½®ã€‚</li></ol><ul><li>è¿™æ˜¯ä¸€ä¸ªfallbackæœºåˆ¶ï¼Œä¸ºäº†é˜²æ­¢æ¨é€æœºåˆ¶å¤±æ•ˆå¯¼è‡´é…ç½®ä¸æ›´æ–°</li><li>å®¢æˆ·ç«¯å®šæ—¶æ‹‰å–ä¼šä¸ŠæŠ¥æœ¬åœ°ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹äºå®šæ—¶æ‹‰å–çš„æ“ä½œï¼ŒæœåŠ¡ç«¯éƒ½ä¼šè¿”å›304 - Not Modified</li><li>å®šæ—¶é¢‘ç‡é»˜è®¤ä¸ºæ¯5åˆ†é’Ÿæ‹‰å–ä¸€æ¬¡ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥é€šè¿‡åœ¨è¿è¡Œæ—¶æŒ‡å®šSystem Property: apollo.refreshIntervalæ¥è¦†ç›–ï¼Œå•ä½ä¸ºåˆ†é’Ÿã€‚</li></ul><ol start="3"><li>å®¢æˆ·ç«¯ä»Apolloé…ç½®ä¸­å¿ƒæœåŠ¡ç«¯è·å–åˆ°åº”ç”¨çš„æœ€æ–°é…ç½®åï¼Œä¼šä¿å­˜åœ¨å†…å­˜ä¸­</li><li>å®¢æˆ·ç«¯ä¼šæŠŠä»æœåŠ¡ç«¯è·å–åˆ°çš„é…ç½®åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ä¸€ä»½</li></ol><ul><li>åœ¨é‡åˆ°æœåŠ¡ä¸å¯ç”¨æˆ–ç½‘ç»œä¸é€šçš„æ—¶å€™ï¼Œä¾ç„¶èƒ½ä»æœ¬åœ°æ¢å¤é…ç½®</li></ul><ol start="5"><li>åº”ç”¨ç¨‹åºå¯ä»¥ä»Apolloå®¢æˆ·ç«¯è·å–æœ€æ–°çš„é…ç½®ã€è®¢é˜…é…ç½®æ›´æ–°é€šçŸ¥<br><a href="https://github.com/ctripcorp/apollo/wiki/Apollo%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E8%AE%BE%E8%AE%A1">æ›´è¯¦ç»†èµ„æ–™è¯¦è§</a><h2 id="5-å¾®æœåŠ¡ä¸­Apollo-javaå®¢æˆ·ç«¯çš„æ­å»ºä½¿ç”¨"><a href="#5-å¾®æœåŠ¡ä¸­Apollo-javaå®¢æˆ·ç«¯çš„æ­å»ºä½¿ç”¨" class="headerlink" title="5:å¾®æœåŠ¡ä¸­Apollo javaå®¢æˆ·ç«¯çš„æ­å»ºä½¿ç”¨"></a>5:å¾®æœåŠ¡ä¸­Apollo javaå®¢æˆ·ç«¯çš„æ­å»ºä½¿ç”¨</h2></li><li>1ã€é¦–å…ˆåœ¨å¾®æœåŠ¡mavençš„pomé¡¹ç›®ä¸­å¢åŠ apolloçš„client ä¾èµ–<pre class=" language-java"><code class="language-java"><span class="token operator">&lt;</span>dependency<span class="token operator">></span> <span class="token operator">&lt;</span>groupId<span class="token operator">></span>com<span class="token punctuation">.</span>ctrip<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>apollo<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span> <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>apollo<span class="token operator">-</span>client<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span> <span class="token operator">&lt;</span>version<span class="token operator">></span><span class="token number">1.1</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span></code></pre></li><li>2ã€åœ¨applicationå¯åŠ¨ç±»ä¸­æŒ‡å®š@EnableApolloConfigé…ç½®é¡¹</li><li>3ã€å¯åŠ¨åº”ç”¨ä¸­éœ€è¦æŒ‡å®š-Denv=devå‚æ•°</li><li>4ã€åœ¨ymlä¸­éœ€è¦å¢åŠ config serverçš„æœåŠ¡åœ°å€é…ç½®ä»¥åŠserviceidé…ç½®é¡¹<pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">app</span><span class="token punctuation">:</span><span class="token key atrule">id</span><span class="token punctuation">:</span> SampleApp<span class="token key atrule">apollo</span><span class="token punctuation">:</span><span class="token key atrule">meta</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//34.85.49.138<span class="token punctuation">:</span><span class="token number">8080</span><span class="token key atrule">bootstrap</span><span class="token punctuation">:</span>  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code></pre></li><li>5ã€æ³¨æ„äº‹é¡¹<br>åœ¨å¤šç½‘å¡æœºå™¨çš„ç¯å¢ƒä¸­,éœ€è¦æŒ‡å®šè¦æ³¨å†Œåˆ°configServerçš„ip,é¿å…å†…ç½‘ipæˆ–è€…å—é™åˆ¶çš„ç½‘ç»œipæ³¨å†Œåˆ°meta serverä¸­å»,å¯¼è‡´å®¢æˆ·ç«¯è·å–ä¸åˆ°å…ƒæ•°æ®ä¿¡æ¯<br>å¯ä»¥åœ¨apollo-configservice æˆ–è€…apollo-adminservice çš„startup.shä¸­æŒ‡å®šeureka å®ä¾‹åŒ–æ³¨å†Œçš„ipåœ°å€ã€‚å‚æ•°ä¿¡æ¯å¦‚: -Deureka.instance.ip-address=${æŒ‡å®šçš„IP} <a href="https://github.com/ctripcorp/apollo/wiki/%E5%88%86%E5%B8%83%E5%BC%8F%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97">è¯¦è§å®˜ç½‘èµ„æ–™</a></li><li>6ã€ä½¿ç”¨<font color="red">@ApolloConfigChangeListener</font>ç›‘å¬ç±»è¿›è¡Œç›‘å¬é…ç½®é¡¹çš„æ”¹å˜<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@ApolloConfigChangeListener</span><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">someOnChange</span><span class="token punctuation">(</span>ConfigChangeEvent changeEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//update injected value of batch if it is changed in Apollo</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>changeEvent<span class="token punctuation">.</span><span class="token function">isChanged</span><span class="token punctuation">(</span><span class="token string">"timeout"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getIntProperty</span><span class="token punctuation">(</span><span class="token string">"timeout"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre></li><li>7ã€ä½¿ç”¨ç®€å•æ ·ä¾‹<br>Java Configä½¿ç”¨æ–¹å¼</li><li>7.1ã€æ–°å»ºé…ç½®ç±»JavaConfigBeanå¦‚ä¸‹ï¼š</li></ol><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * Java Configæ–¹å¼ * * @author zyf * @create 2020-05-12 15:00 **/</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavaConfigBean</span> <span class="token punctuation">{</span>  <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${timeout:20}"</span><span class="token punctuation">)</span>  <span class="token keyword">private</span> <span class="token keyword">int</span> timeout<span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> timeout<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>5.7.2ã€æ–°å¢è®¿é—®ç«¯ç‚¹</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//1.Java Configæ–¹å¼</span> <span class="token annotation punctuation">@Autowired</span> JavaConfigBean javaConfigBean<span class="token punctuation">;</span> <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/index1"</span><span class="token punctuation">)</span> <span class="token keyword">public</span> String <span class="token function">hello1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token keyword">return</span> javaConfigBean<span class="token punctuation">.</span><span class="token function">getTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre><p>Spring Bootæä¾›äº†@ConfigurationPropertiesæŠŠé…ç½®æ³¨å…¥åˆ°beanå¯¹è±¡ä¸­ã€‚Apolloä¹Ÿæ”¯æŒè¿™ç§æ–¹å¼ï¼Œä¸‹é¢çš„ä¾‹å­ä¼šæŠŠredis.cache.expireSecondså’Œredis.cache.commandTimeoutåˆ†åˆ«æ³¨å…¥ åˆ°SampleRedisConfigçš„expireSecondså’ŒcommandTimeoutå­—æ®µä¸­ã€‚<br>5.8.1ã€æ–°å¢é…ç½®ç±»SampleRedisConfigå¦‚ä¸‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * ConfigurationPropertiesä½¿ç”¨æ–¹å¼ * * @author zyf * @create 2020-05-12 15:00 **/</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"redis.cache"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleRedisConfig</span> <span class="token punctuation">{</span>  <span class="token keyword">private</span> <span class="token keyword">int</span> expireSeconds<span class="token punctuation">;</span>  <span class="token keyword">private</span> <span class="token keyword">int</span> commandTimeout<span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setExpireSeconds</span><span class="token punctuation">(</span><span class="token keyword">int</span> expireSeconds<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>expireSeconds <span class="token operator">=</span> expireSeconds<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCommandTimeout</span><span class="token punctuation">(</span><span class="token keyword">int</span> commandTimeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>commandTimeout <span class="token operator">=</span> commandTimeout<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getExpireSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> expireSeconds<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCommandTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> commandTimeout<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java">æ–°å¢è®¿é—®ç«¯ç‚¹<span class="token comment" spellcheck="true">//2. ConfigurationPropertiesä½¿ç”¨æ–¹å¼</span>  <span class="token annotation punctuation">@Autowired</span>  SampleRedisConfig sampleRedisConfig<span class="token punctuation">;</span>  <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/index2"</span><span class="token punctuation">)</span>  <span class="token keyword">public</span> String <span class="token function">hello2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> sampleRedisConfig<span class="token punctuation">.</span><span class="token function">getCommandTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"--"</span><span class="token operator">+</span>sampleRedisConfig<span class="token punctuation">.</span><span class="token function">getExpireSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java">æ–°å¢ä»¥ä¸‹ä»£ç <span class="token annotation punctuation">@ApolloConfigChangeListener</span>  <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">someOnChange</span><span class="token punctuation">(</span>ConfigChangeEvent changeEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//update injected value of batch if it is changed in Apollo</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>changeEvent<span class="token punctuation">.</span><span class="token function">isChanged</span><span class="token punctuation">(</span><span class="token string">"timeout"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getIntProperty</span><span class="token punctuation">(</span><span class="token string">"timeout"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@ApolloJsonValue</span>çš„ä½¿ç”¨æ–°å¢Userå¦‚ä¸‹ï¼š<span class="token comment" spellcheck="true">/** * ç”¨æˆ· * * @author zyf * @create 2020-05-12 15:00 **/</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>  <span class="token keyword">private</span> String username<span class="token punctuation">;</span>  <span class="token keyword">private</span> String password<span class="token punctuation">;</span>  <span class="token keyword">public</span> String <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> username<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUsername</span><span class="token punctuation">(</span>String username<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">public</span> String <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> password<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPassword</span><span class="token punctuation">(</span>String password<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> password<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>æœåŠ¡ç«¯æ–°å¢é…ç½®jsonBeanProperty<span class="token operator">=</span><span class="token punctuation">[</span> <span class="token punctuation">{</span> <span class="token string">"username"</span><span class="token operator">:</span> <span class="token string">"john"</span><span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token operator">:</span> <span class="token string">"1234"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">"username"</span><span class="token operator">:</span> <span class="token string">"simon"</span><span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token operator">:</span> <span class="token string">"222132"</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>å®¢æˆ·ç«¯è·å–é…ç½®<span class="token comment" spellcheck="true">//4. @ApolloJsonValueä½¿ç”¨</span><span class="token annotation punctuation">@ApolloJsonValue</span><span class="token punctuation">(</span><span class="token string">"${jsonBeanProperty:[]}"</span><span class="token punctuation">)</span><span class="token keyword">private</span> List<span class="token operator">&lt;</span>User<span class="token operator">></span> anotherJsonBeans<span class="token punctuation">;</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/index4"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  anotherJsonBeans<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>    System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"--"</span><span class="token operator">+</span>item<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>5.8.2ã€å¤šé…ç½®æ–‡ä»¶</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xes<span class="token punctuation">.</span>chn<span class="token punctuation">.</span>apollo<span class="token punctuation">.</span>service<span class="token punctuation">.</span>apollo<span class="token punctuation">.</span>impl<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>ctrip<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>apollo<span class="token punctuation">.</span>Config<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>ctrip<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>apollo<span class="token punctuation">.</span>model<span class="token punctuation">.</span>ConfigChangeEvent<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>ctrip<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>apollo<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>ApolloConfig<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>ctrip<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>apollo<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>ApolloConfigChangeListener<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>ctrip<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>apollo<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>EnableApolloConfig<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Logger<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>LoggerFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Value<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>scheduling<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Scheduled<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Service<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>PostConstruct<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Set<span class="token punctuation">;</span><span class="token annotation punctuation">@Service</span><span class="token annotation punctuation">@EnableApolloConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"chn.application.properties"</span><span class="token punctuation">,</span> <span class="token string">"beibo.yml"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//@EnableApolloConfig("application.properties")</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoggerConfigurationImpl</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Logger logger <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>LoggerConfigurationImpl<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApolloConfig</span><span class="token punctuation">(</span><span class="token string">"chn.application.properties"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Config commonProperties<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApolloConfig</span><span class="token punctuation">(</span><span class="token string">"beibo.yml"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Config beiboYml<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${invokingServerPath.beibo.stuChangeUrl}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String stuChangeUrl<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//</span>    <span class="token annotation punctuation">@PostConstruct</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//        System.out.println(gateway);</span><span class="token comment" spellcheck="true">//        System.out.println(config.getPropertyNames());</span><span class="token comment" spellcheck="true">//        Config config = ConfigService.getConfig("chn-beibo.yml"); //config instance is singleton for each namespace and is never null</span><span class="token comment" spellcheck="true">//        String someKey = "chn-beibo";</span><span class="token comment" spellcheck="true">//        String someDefaultValue = "1234567a";</span><span class="token comment" spellcheck="true">//        String value = config.getProperty(someKey, someDefaultValue);</span><span class="token comment" spellcheck="true">//        System.out.println(gateway);</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@ApolloConfigChangeListener</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"chn.application.properties"</span><span class="token punctuation">,</span> <span class="token string">"beibo.yml"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">someOnChange</span><span class="token punctuation">(</span>ConfigChangeEvent changeEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//update injected value of batch if it is changed in Apollo</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>changeEvent<span class="token punctuation">.</span><span class="token function">isChanged</span><span class="token punctuation">(</span><span class="token string">"timeout"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//            System.out.println(config.getIntProperty("timeout", 0));</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token comment" spellcheck="true">//    @Scheduled(fixedRate = 1000)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reportCurrentTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stuChangeUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>        Set<span class="token operator">&lt;</span>String<span class="token operator">></span> propertyNames<span class="token operator">=</span>commonProperties<span class="token punctuation">.</span><span class="token function">getPropertyNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        String stuChangeUrL<span class="token operator">=</span>beiboYml<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"invokingServerPath.beibo.stuChangeUrl"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>String propertyName <span class="token operator">:</span> propertyNames<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>stuChangeUrL<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"stuChangeUrL:{}"</span><span class="token punctuation">,</span> stuChangeUrL<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"${"</span> <span class="token operator">+</span> propertyName <span class="token operator">+</span> <span class="token string">"}"</span><span class="token punctuation">,</span>commonProperties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="6-å¸¦ç¼“å­˜ä¸ä¸å¸¦ç¼“å­˜Httpæ¥å£ä»Apolloè¯»å–é…ç½®"><a href="#6-å¸¦ç¼“å­˜ä¸ä¸å¸¦ç¼“å­˜Httpæ¥å£ä»Apolloè¯»å–é…ç½®" class="headerlink" title="6:å¸¦ç¼“å­˜ä¸ä¸å¸¦ç¼“å­˜Httpæ¥å£ä»Apolloè¯»å–é…ç½®"></a>6:å¸¦ç¼“å­˜ä¸ä¸å¸¦ç¼“å­˜Httpæ¥å£ä»Apolloè¯»å–é…ç½®</h2><p>6.1 é€šè¿‡å¸¦ç¼“å­˜çš„Httpæ¥å£ä»Apolloè¯»å–é…ç½®<br>è¯¥æ¥å£ä¼šä»ç¼“å­˜ä¸­è·å–é…ç½®ï¼Œé€‚åˆé¢‘ç‡è¾ƒé«˜çš„é…ç½®æ‹‰å–è¯·æ±‚ï¼Œå¦‚ç®€å•çš„æ¯30ç§’è½®è¯¢ä¸€æ¬¡é…ç½®ã€‚</p><p>ç”±äºç¼“å­˜æœ€å¤šä¼šæœ‰ä¸€ç§’çš„å»¶æ—¶ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦é…åˆé…ç½®æ¨é€é€šçŸ¥å®ç°å®æ—¶æ›´æ–°é…ç½®çš„è¯ï¼Œè¯·å‚è€ƒ<a href="https://github.com/ctripcorp/apollo/wiki/%E5%85%B6%E5%AE%83%E8%AF%AD%E8%A8%80%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97#13-%E9%80%9A%E8%BF%87%E4%B8%8D%E5%B8%A6%E7%BC%93%E5%AD%98%E7%9A%84http%E6%8E%A5%E5%8F%A3%E4%BB%8Eapollo%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE">é€šè¿‡ä¸å¸¦ç¼“å­˜çš„Httpæ¥å£ä»Apolloè¯»å–é…ç½®</a>ã€‚<br>6.1.1 <a href="https://github.com/ctripcorp/apollo/wiki/%E5%85%B6%E5%AE%83%E8%AF%AD%E8%A8%80%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97#121-http%E6%8E%A5%E5%8F%A3%E8%AF%B4%E6%98%8E">Httpæ¥å£è¯´æ˜</a><br>URL: {config_server_url}/configfiles/json/{appId}/{clusterName}/{namespaceName}?ip={clientIp}<br>Method: GET<br>å‚æ•°è¯´æ˜:</p><table><thead><tr><th>å‚æ•°å</th><th>æ˜¯å¦å¿…é¡»</th><th>å‚æ•°å€¼</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>config_server_url</td><td>æ˜¯</td><td>Apolloé…ç½®æœåŠ¡çš„åœ°å€</td><td></td></tr><tr><td>appId</td><td>æ˜¯</td><td>åº”ç”¨çš„appId</td><td></td></tr><tr><td>namespaceName</td><td>æ˜¯</td><td>å¦‚æœæ²¡æœ‰æ–°å»ºè¿‡Namespaceçš„è¯ï¼Œä¼ å…¥applicationå³å¯ã€‚ å¦‚æœåˆ›å»ºäº†Namespaceï¼Œå¹¶ä¸”éœ€è¦ä½¿ç”¨è¯¥Namespaceçš„é…ç½®ï¼Œåˆ™ä¼ å…¥å¯¹åº”çš„Namespaceåå­—ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¯¹äºpropertiesç±»å‹çš„namespaceï¼Œåªéœ€è¦ä¼ å…¥namespaceçš„åå­—å³å¯ï¼Œå¦‚applicationã€‚å¯¹äºå…¶å®ƒç±»å‹çš„namespaceï¼Œéœ€è¦ä¼ å…¥namespaceçš„åå­—åŠ ä¸Šåç¼€åï¼Œå¦‚datasources.json</td><td></td></tr><tr><td>ip</td><td>å¦</td><td>åº”ç”¨éƒ¨ç½²çš„æœºå™¨ip</td><td>è¿™ä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œç”¨æ¥å®ç°ç°åº¦å‘å¸ƒã€‚ å¦‚æœä¸æƒ³ä¼ è¿™ä¸ªå‚æ•°ï¼Œè¯·æ³¨æ„URLä¸­ä»?å·å¼€å§‹çš„query parametersæ•´ä¸ªéƒ½ä¸è¦å‡ºç°ã€‚</td></tr></tbody></table><p>6.2 <a href="https://github.com/ctripcorp/apollo/wiki/%E5%85%B6%E5%AE%83%E8%AF%AD%E8%A8%80%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97#122-http%E6%8E%A5%E5%8F%A3%E8%BF%94%E5%9B%9E%E6%A0%BC%E5%BC%8F">Httpæ¥å£è¿”å›æ ¼å¼</a><br>è¯¥Httpæ¥å£è¿”å›çš„æ˜¯JSONæ ¼å¼ã€UTF-8ç¼–ç ï¼ŒåŒ…å«äº†å¯¹åº”namespaceä¸­æ‰€æœ‰çš„é…ç½®é¡¹ã€‚<br>è¿”å›å†…å®¹Sampleå¦‚ä¸‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token punctuation">{</span>    <span class="token string">"portal.elastic.document.type"</span><span class="token operator">:</span><span class="token string">"biz"</span><span class="token punctuation">,</span>    <span class="token string">"portal.elastic.cluster.name"</span><span class="token operator">:</span><span class="token string">"hermes-es-fws"</span><span class="token punctuation">}</span>é€šè¿‡<span class="token punctuation">{</span>config_server_url<span class="token punctuation">}</span><span class="token operator">/</span>configfiles<span class="token operator">/</span><span class="token punctuation">{</span>appId<span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">{</span>clusterName<span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">{</span>namespaceName<span class="token punctuation">}</span><span class="token operator">?</span>ip<span class="token operator">=</span><span class="token punctuation">{</span>clientIp<span class="token punctuation">}</span>å¯ä»¥è·å–åˆ°propertieså½¢å¼çš„é…ç½®</code></pre><p>6.3 <a href="https://github.com/ctripcorp/apollo/wiki/%E5%85%B6%E5%AE%83%E8%AF%AD%E8%A8%80%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97#123-%E6%B5%8B%E8%AF%95"> æµ‹è¯•</a><br>ç”±äºæ˜¯Httpæ¥å£ï¼Œæ‰€ä»¥åœ¨URLç»„è£…OKä¹‹åï¼Œç›´æ¥é€šè¿‡æµè§ˆå™¨ã€æˆ–è€…ç›¸å…³çš„httpæ¥å£æµ‹è¯•å·¥å…·è®¿é—®å³å¯ã€‚<br>6.4 <a href="https://github.com/ctripcorp/apollo/wiki/%E5%85%B6%E5%AE%83%E8%AF%AD%E8%A8%80%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97#13-%E9%80%9A%E8%BF%87%E4%B8%8D%E5%B8%A6%E7%BC%93%E5%AD%98%E7%9A%84http%E6%8E%A5%E5%8F%A3%E4%BB%8Eapollo%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE">é€šè¿‡ä¸å¸¦ç¼“å­˜çš„Httpæ¥å£ä»Apolloè¯»å–é…ç½®</a><br>è¯¥æ¥å£ä¼šç›´æ¥ä»æ•°æ®åº“ä¸­è·å–é…ç½®ï¼Œå¯ä»¥é…åˆé…ç½®æ¨é€é€šçŸ¥å®ç°å®æ—¶æ›´æ–°é…ç½®ã€‚<br>6.5 <a href="https://github.com/ctripcorp/apollo/wiki/%E5%85%B6%E5%AE%83%E8%AF%AD%E8%A8%80%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97#131-http%E6%8E%A5%E5%8F%A3%E8%AF%B4%E6%98%8E">Httpæ¥å£è¯´æ˜</a><br>URL: {config_server_url}/configs/{appId}/{clusterName}/{namespaceName}?releaseKey={releaseKey}&amp;ip={clientIp}<br>Method: GET<br>å‚æ•°è¯´æ˜ï¼š</p><table><thead><tr><th>å‚æ•°å</th><th>æ˜¯å¦å¿…é¡»</th><th>å‚æ•°å€¼</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>config_server_url</td><td>æ˜¯</td><td>Apolloé…ç½®æœåŠ¡çš„åœ°å€</td><td></td></tr><tr><td>appId</td><td>æ˜¯</td><td>åº”ç”¨çš„appId</td><td></td></tr><tr><td>clusterName</td><td>æ˜¯</td><td>é›†ç¾¤å</td><td>ä¸€èˆ¬æƒ…å†µä¸‹ä¼ å…¥ default å³å¯ã€‚ å¦‚æœå¸Œæœ›é…ç½®æŒ‰é›†ç¾¤åˆ’åˆ†ï¼Œå¯ä»¥å‚è€ƒ<a href="https://github.com/ctripcorp/apollo/wiki/%E5%BA%94%E7%94%A8%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97#%E4%B8%89%E9%9B%86%E7%BE%A4%E7%8B%AC%E7%AB%8B%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E">é›†ç¾¤ç‹¬ç«‹é…ç½®è¯´æ˜</a>åšç›¸å…³é…ç½®ï¼Œç„¶ååœ¨è¿™é‡Œå¡«å…¥å¯¹åº”çš„é›†ç¾¤åã€‚</td></tr><tr><td>namespaceName</td><td>æ˜¯</td><td>Namespaceçš„åå­—</td><td>å¦‚æœæ²¡æœ‰æ–°å»ºè¿‡Namespaceçš„è¯ï¼Œä¼ å…¥applicationå³å¯ã€‚ å¦‚æœåˆ›å»ºäº†Namespaceï¼Œå¹¶ä¸”éœ€è¦ä½¿ç”¨è¯¥Namespaceçš„é…ç½®ï¼Œåˆ™ä¼ å…¥å¯¹åº”çš„Namespaceåå­—ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¯¹äºpropertiesç±»å‹çš„namespaceï¼Œåªéœ€è¦ä¼ å…¥namespaceçš„åå­—å³å¯ï¼Œå¦‚applicationã€‚å¯¹äºå…¶å®ƒç±»å‹çš„namespaceï¼Œéœ€è¦ä¼ å…¥namespaceçš„åå­—åŠ ä¸Šåç¼€åï¼Œå¦‚datasources.json</td></tr><tr><td>releaseKey</td><td>å¦</td><td>ä¸Šä¸€æ¬¡çš„releaseKey</td><td>å°†ä¸Šä¸€æ¬¡è¿”å›å¯¹è±¡ä¸­çš„releaseKeyä¼ å…¥å³å¯ï¼Œç”¨æ¥ç»™æœåŠ¡ç«¯æ¯”è¾ƒç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬æ¯”ä¸‹æ¥æ²¡æœ‰å˜åŒ–ï¼Œåˆ™æœåŠ¡ç«¯ç›´æ¥è¿”å›304ä»¥èŠ‚çœæµé‡å’Œè¿ç®—</td></tr><tr><td>ip</td><td>å¦</td><td>åº”ç”¨éƒ¨ç½²çš„æœºå™¨ip</td><td>è¿™ä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œç”¨æ¥å®ç°ç°åº¦å‘å¸ƒã€‚</td></tr></tbody></table><p>6.5 <a href="https://github.com/ctripcorp/apollo/wiki/%E5%85%B6%E5%AE%83%E8%AF%AD%E8%A8%80%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97#132-http%E6%8E%A5%E5%8F%A3%E8%BF%94%E5%9B%9E%E6%A0%BC%E5%BC%8F">Httpæ¥å£è¿”å›æ ¼å¼</a><br>è¯¥Httpæ¥å£è¿”å›çš„æ˜¯JSONæ ¼å¼ã€UTF-8ç¼–ç ã€‚</p><p>å¦‚æœé…ç½®æ²¡æœ‰å˜åŒ–ï¼ˆä¼ å…¥çš„releaseKeyå’ŒæœåŠ¡ç«¯çš„ç›¸ç­‰ï¼‰ï¼Œåˆ™è¿”å›HttpStatus 304ï¼Œresponse bodyä¸ºç©ºã€‚<br>å¦‚æœé…ç½®æœ‰å˜åŒ–ï¼Œåˆ™ä¼šè¿”å›HttpStatus 200ï¼Œresponse bodyä¸ºå¯¹åº”namespaceçš„metaä¿¡æ¯ä»¥åŠå…¶ä¸­æ‰€æœ‰çš„é…ç½®é¡¹ã€‚<br>è¿”å›å†…å®¹Sampleå¦‚ä¸‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token punctuation">{</span>  <span class="token string">"appId"</span><span class="token operator">:</span> <span class="token string">"100004458"</span><span class="token punctuation">,</span>  <span class="token string">"cluster"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>  <span class="token string">"namespaceName"</span><span class="token operator">:</span> <span class="token string">"application"</span><span class="token punctuation">,</span>  <span class="token string">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token string">"portal.elastic.document.type"</span><span class="token operator">:</span><span class="token string">"biz"</span><span class="token punctuation">,</span>    <span class="token string">"portal.elastic.cluster.name"</span><span class="token operator">:</span><span class="token string">"hermes-es-fws"</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token string">"releaseKey"</span><span class="token operator">:</span> <span class="token string">"20170430092936-dee2d58e74515ff3"</span><span class="token punctuation">}</span></code></pre><p>6.6 <a href="https://github.com/ctripcorp/apollo/wiki/%E5%85%B6%E5%AE%83%E8%AF%AD%E8%A8%80%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97#133-%E6%B5%8B%E8%AF%95">æµ‹è¯•</a><br>ç”±äºæ˜¯Httpæ¥å£ï¼Œæ‰€ä»¥åœ¨URLç»„è£…OKä¹‹åï¼Œç›´æ¥é€šè¿‡æµè§ˆå™¨ã€æˆ–è€…ç›¸å…³çš„httpæ¥å£æµ‹è¯•å·¥å…·è®¿é—®å³å¯ã€‚<br>6.7 <a href="https://github.com/ctripcorp/apollo/wiki/%E5%85%B6%E5%AE%83%E8%AF%AD%E8%A8%80%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97#14-%E5%BA%94%E7%94%A8%E6%84%9F%E7%9F%A5%E9%85%8D%E7%BD%AE%E6%9B%B4%E6%96%B0">åº”ç”¨æ„ŸçŸ¥é…ç½®æ›´æ–°</a><br>Apolloæä¾›äº†åŸºäºHttp long pollingçš„é…ç½®æ›´æ–°æ¨é€é€šçŸ¥ï¼Œç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯å¯ä»¥çœ‹è‡ªå·±å®é™…çš„éœ€æ±‚å†³å®šæ˜¯å¦éœ€è¦ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ã€‚<br>å¦‚æœå¯¹é…ç½®æ›´æ–°æ—¶é—´ä¸æ˜¯é‚£ä¹ˆæ•æ„Ÿçš„è¯ï¼Œå¯ä»¥é€šè¿‡å®šæ—¶åˆ·æ–°æ¥æ„ŸçŸ¥é…ç½®æ›´æ–°ï¼Œåˆ·æ–°é¢‘ç‡å¯ä»¥è§†åº”ç”¨è‡ªèº«æƒ…å†µæ¥å®šï¼Œå»ºè®®åœ¨30ç§’ä»¥ä¸Šã€‚<br>å¦‚æœéœ€è¦åšåˆ°å®æ—¶æ„ŸçŸ¥é…ç½®æ›´æ–°ï¼ˆ1ç§’ï¼‰çš„è¯ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„æ–‡æ¡£å®ç°é…ç½®æ›´æ–°æ¨é€çš„åŠŸèƒ½ã€‚<br>6.8 <a href="https://github.com/ctripcorp/apollo/wiki/%E5%85%B6%E5%AE%83%E8%AF%AD%E8%A8%80%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97#141-%E9%85%8D%E7%BD%AE%E6%9B%B4%E6%96%B0%E6%8E%A8%E9%80%81%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"> é…ç½®æ›´æ–°æ¨é€å®ç°æ€è·¯</a><br>è¿™é‡Œå»ºè®®å¤§å®¶å¯ä»¥å‚è€ƒApolloçš„Javaå®ç°ï¼š<a href="https://github.com/ctripcorp/apollo/blob/master/apollo-client/src/main/java/com/ctrip/framework/apollo/internals/RemoteConfigLongPollService.java">RemoteConfigLongPollService.java</a>ï¼Œä»£ç é‡200å¤šè¡Œï¼Œæ€»ä½“ä¸Šè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚<br>6.8.1 <a href="https://github.com/ctripcorp/apollo/wiki/%E5%85%B6%E5%AE%83%E8%AF%AD%E8%A8%80%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97#1411-%E5%88%9D%E5%A7%8B%E5%8C%96">åˆå§‹åŒ–</a><br>é¦–å…ˆéœ€è¦ç¡®å®šå“ªäº›namespaceéœ€è¦é…ç½®æ›´æ–°æ¨é€ï¼ŒApolloçš„å®ç°æ–¹å¼æ˜¯ç¨‹åºç¬¬ä¸€æ¬¡è·å–æŸä¸ªnamespaceçš„é…ç½®æ—¶å°±ä¼šæ¥æ³¨å†Œä¸€ä¸‹ï¼Œæˆ‘ä»¬å°±çŸ¥é“æœ‰å“ªäº›namespaceéœ€è¦é…ç½®æ›´æ–°æ¨é€äº†ã€‚<br>åˆå§‹åŒ–åçš„ç»“æœå°±æ˜¯å¾—åˆ°ä¸€ä¸ªnotificationsçš„Mapï¼Œå†…å®¹æ˜¯namespaceName -&gt; notificationIdï¼ˆåˆå§‹å€¼ä¸º-1ï¼‰ã€‚<br>è¿è¡Œè¿‡ç¨‹ä¸­å¦‚æœå‘ç°æœ‰æ–°çš„namespaceéœ€è¦é…ç½®æ›´æ–°æ¨é€ï¼Œç›´æ¥å¡åˆ°notificationsè¿™ä¸ªMapé‡Œé¢å³å¯ã€‚<br>6.8.2 <a href="https://github.com/ctripcorp/apollo/wiki/%E5%85%B6%E5%AE%83%E8%AF%AD%E8%A8%80%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97#1412-%E8%AF%B7%E6%B1%82%E6%9C%8D%E5%8A%A1">è¯·æ±‚æœåŠ¡</a><br>æœ‰äº†notificationsè¿™ä¸ªMapä¹‹åï¼Œå°±å¯ä»¥è¯·æ±‚æœåŠ¡äº†ã€‚è¿™é‡Œå…ˆæè¿°ä¸€ä¸‹è¯·æ±‚æœåŠ¡çš„é€»è¾‘ï¼Œå…·ä½“çš„URLå‚æ•°å’Œè¯´æ˜è¯·å‚è§åé¢çš„æ¥å£è¯´æ˜ã€‚</p><ol><li>è¯·æ±‚è¿œç«¯æœåŠ¡ï¼Œå¸¦ä¸Šè‡ªå·±çš„åº”ç”¨ä¿¡æ¯ä»¥åŠnotificationsä¿¡æ¯</li><li>æœåŠ¡ç«¯é’ˆå¯¹ä¼ è¿‡æ¥çš„æ¯ä¸€ä¸ªnamespaceå’Œå¯¹åº”çš„notificationIdï¼Œæ£€æŸ¥notificationIdæ˜¯å¦æ˜¯æœ€æ–°çš„</li><li>å¦‚æœéƒ½æ˜¯æœ€æ–°çš„ï¼Œåˆ™ä¿æŒä½è¯·æ±‚60ç§’ï¼Œå¦‚æœ60ç§’å†…æ²¡æœ‰é…ç½®å˜åŒ–ï¼Œåˆ™è¿”å›HttpStatus 304ã€‚å¦‚æœ60ç§’å†…æœ‰é…ç½®å˜åŒ–ï¼Œåˆ™è¿”å›å¯¹åº”namespaceçš„æœ€æ–°notificationId, HttpStatus 200ã€‚</li><li>å¦‚æœä¼ è¿‡æ¥çš„notificationsä¿¡æ¯ä¸­å‘ç°æœ‰notificationIdæ¯”æœåŠ¡ç«¯è€ï¼Œåˆ™ç›´æ¥è¿”å›å¯¹åº”namespaceçš„æœ€æ–°notificationId, HttpStatus 200ã€‚</li><li>å®¢æˆ·ç«¯æ‹¿åˆ°æœåŠ¡ç«¯è¿”å›åï¼Œåˆ¤æ–­è¿”å›çš„HttpStatus</li><li>å¦‚æœè¿”å›çš„HttpStatusæ˜¯304ï¼Œè¯´æ˜é…ç½®æ²¡æœ‰å˜åŒ–ï¼Œé‡æ–°æ‰§è¡Œç¬¬1æ­¥</li><li>å¦‚æœè¿”å›çš„HttpStautsæ˜¯200ï¼Œè¯´æ˜é…ç½®æœ‰å˜åŒ–ï¼Œé’ˆå¯¹å˜åŒ–çš„namespaceé‡æ–°å»æœåŠ¡ç«¯æ‹‰å–é…ç½®ï¼Œå‚è§1.3 é€šè¿‡ä¸å¸¦ç¼“å­˜çš„Httpæ¥å£ä»Apolloè¯»å–é…ç½®ã€‚åŒæ—¶æ›´æ–°notifications mapä¸­çš„notificationIdã€‚é‡æ–°æ‰§è¡Œç¬¬1æ­¥ã€‚</li></ol><p>6.9 <a href="https://github.com/ctripcorp/apollo/wiki/%E5%85%B6%E5%AE%83%E8%AF%AD%E8%A8%80%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97#142-http%E6%8E%A5%E5%8F%A3%E8%AF%B4%E6%98%8E">Httpæ¥å£è¯´æ˜</a><br>URL: {config_server_url}/notifications/v2?appId={appId}&amp;cluster={clusterName}&amp;notifications={notifications}<br>Method: GET<br>å‚æ•°è¯´æ˜ï¼š</p><table><thead><tr><th>å‚æ•°å</th><th>æ˜¯å¦å¿…é¡»</th><th>å‚æ•°å€¼</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>notifications</td><td>æ˜¯</td><td>notificationsä¿¡æ¯</td><td>ä¼ å…¥æœ¬åœ°çš„notificationsä¿¡æ¯ï¼Œæ³¨æ„è¿™é‡Œéœ€è¦ä»¥arrayå½¢å¼è½¬ä¸ºjsonä¼ å…¥ï¼Œå¦‚ï¼š[{â€œnamespaceNameâ€: â€œapplicationâ€, â€œnotificationIdâ€: 100}, {â€œnamespaceNameâ€: â€œFX.apolloâ€, â€œnotificationIdâ€: 200}]ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¯¹äºpropertiesç±»å‹çš„namespaceï¼Œåªéœ€è¦ä¼ å…¥namespaceçš„åå­—å³å¯ï¼Œå¦‚applicationã€‚å¯¹äºå…¶å®ƒç±»å‹çš„namespaceï¼Œéœ€è¦ä¼ å…¥namespaceçš„åå­—åŠ ä¸Šåç¼€åï¼Œå¦‚datasources.json</td></tr><tr><td>config_server_url</td><td>æ˜¯</td><td>Apolloé…ç½®æœåŠ¡çš„åœ°å€</td><td></td></tr><tr><td>clusterName</td><td>æ˜¯</td><td>é›†ç¾¤å</td><td>ä¸€èˆ¬æƒ…å†µä¸‹ä¼ å…¥ default å³å¯ã€‚ å¦‚æœå¸Œæœ›é…ç½®æŒ‰é›†ç¾¤åˆ’åˆ†ï¼Œå¯ä»¥å‚è€ƒ<a href="https://github.com/ctripcorp/apollo/wiki/%E5%BA%94%E7%94%A8%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97#%E4%B8%89%E9%9B%86%E7%BE%A4%E7%8B%AC%E7%AB%8B%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E">é›†ç¾¤ç‹¬ç«‹é…ç½®è¯´æ˜</a>åšç›¸å…³é…ç½®ï¼Œç„¶ååœ¨è¿™é‡Œå¡«å…¥å¯¹åº”çš„é›†ç¾¤åã€‚</td></tr><tr><td>appId</td><td>æ˜¯</td><td>åº”ç”¨çš„appId</td><td></td></tr></tbody></table><p>æ³¨1ï¼šç”±äºæœåŠ¡ç«¯ä¼šholdä½è¯·æ±‚60ç§’ï¼Œæ‰€ä»¥è¯·ç¡®ä¿å®¢æˆ·ç«¯è®¿é—®æœåŠ¡ç«¯çš„è¶…æ—¶æ—¶é—´è¦å¤§äº60ç§’ã€‚<br>æ³¨2ï¼šåˆ«å¿˜äº†å¯¹å‚æ•°è¿›è¡Œ<a href="https://en.wikipedia.org/wiki/Percent-encoding">url encode</a><br>6.9.1 <a href="https://github.com/ctripcorp/apollo/wiki/%E5%85%B6%E5%AE%83%E8%AF%AD%E8%A8%80%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97#143-http%E6%8E%A5%E5%8F%A3%E8%BF%94%E5%9B%9E%E6%A0%BC%E5%BC%8F">Httpæ¥å£è¿”å›æ ¼å¼</a><br>è¯¥Httpæ¥å£è¿”å›çš„æ˜¯JSONæ ¼å¼ã€UTF-8ç¼–ç ï¼ŒåŒ…å«äº†æœ‰å˜åŒ–çš„namespaceå’Œæœ€æ–°çš„notificationIdã€‚<br>è¿”å›å†…å®¹Sampleå¦‚ä¸‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token punctuation">[</span>  <span class="token punctuation">{</span>    <span class="token string">"namespaceName"</span><span class="token operator">:</span> <span class="token string">"application"</span><span class="token punctuation">,</span>    <span class="token string">"notificationId"</span><span class="token operator">:</span> <span class="token number">101</span>  <span class="token punctuation">}</span><span class="token punctuation">]</span></code></pre><p>6.9.2 <a href="https://github.com/ctripcorp/apollo/wiki/%E5%85%B6%E5%AE%83%E8%AF%AD%E8%A8%80%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97#144-%E6%B5%8B%E8%AF%95">æµ‹è¯•</a><br>6.9.3 <a href="https://github.com/ctripcorp/apollo/wiki/%E5%85%B6%E5%AE%83%E8%AF%AD%E8%A8%80%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97#15-%E9%94%99%E8%AF%AF%E7%A0%81%E8%AF%B4%E6%98%8E">é”™è¯¯ç è¯´æ˜</a><br>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ¥å£è¿”å›çš„HttpçŠ¶æ€ç æ˜¯200ï¼Œä¸‹é¢åˆ—ä¸¾äº†Apolloä¼šè¿”å›çš„é200é”™è¯¯ç è¯´æ˜ã€‚</p><table><thead><tr><th>åºå·</th><th>é”™è¯¯çŠ¶æ€ç </th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>1</td><td>400 - Bad Request</td><td>å®¢æˆ·ç«¯ä¼ å…¥å‚æ•°çš„é”™è¯¯ï¼Œå¦‚å¿…é€‰å‚æ•°æ²¡æœ‰ä¼ å…¥ç­‰ï¼Œå®¢æˆ·ç«¯éœ€è¦æ ¹æ®æç¤ºä¿¡æ¯æ£€æŸ¥å¯¹åº”çš„å‚æ•°æ˜¯å¦æ­£ç¡®ã€‚</td></tr><tr><td>2</td><td>404 - Not Found</td><td>æ¥å£è¦è®¿é—®çš„èµ„æºä¸å­˜åœ¨ï¼Œä¸€èˆ¬æ˜¯URLæˆ–URLçš„å‚æ•°é”™è¯¯ï¼Œæˆ–è€…æ˜¯å¯¹åº”çš„namespaceè¿˜æ²¡æœ‰å‘å¸ƒè¿‡é…ç½®ã€‚</td></tr><tr><td>3</td><td>405 - Method Not Allowed</td><td>æ¥å£è®¿é—®çš„Methodä¸æ­£ç¡®ï¼Œæ¯”å¦‚åº”è¯¥ä½¿ç”¨GETçš„æ¥å£ä½¿ç”¨äº†POSTè®¿é—®ç­‰ï¼Œå®¢æˆ·ç«¯éœ€è¦æ£€æŸ¥æ¥å£è®¿é—®æ–¹å¼æ˜¯å¦æ­£ç¡®ã€‚</td></tr><tr><td>4</td><td>500 - Internal Server Error</td><td>å…¶å®ƒç±»å‹çš„é”™è¯¯é»˜è®¤éƒ½ä¼šè¿”å›500ï¼Œå¯¹è¿™ç±»é”™è¯¯å¦‚æœåº”ç”¨æ— æ³•æ ¹æ®æç¤ºä¿¡æ¯æ‰¾åˆ°åŸå› çš„è¯ï¼Œå¯ä»¥å°è¯•æŸ¥çœ‹æœåŠ¡ç«¯æ—¥å¿—æ¥æ’æŸ¥é—®é¢˜ã€‚</td></tr></tbody></table><p>7.1 ä»€ä¹ˆæ˜¯ymlå ä½ç¬¦ï¼Ÿä¸¾ä¸ªä¾‹å­å¦‚ä¸‹:<br>æˆ‘æœ‰2åˆ†é…ç½®æ–‡ä»¶,ä¸€ä»½application.yml,ä¸ºç§æœ‰é…ç½®æ–‡ä»¶<br>è¯¥é…ç½®æœ‰ä¸ªå±æ€§:<br>server:<br>  port: ${server.apollo-test-port}<br>å¦å¤–æœ‰ä¸ªå…¬æœ‰é…ç½®æ–‡ä»¶<br>apollo-test.yml,è¯¥é…ç½®æœ‰ä¸ªå±æ€§,<br>server:<br>  apollo-test-port: 10065</p><p>å…¶ä¸­ç§æœ‰é…ç½®æ–‡ä»¶,ä½¿ç”¨åˆ°äº†å ä½ç¬¦, è¯·é—®ä¸‹,è¿™ç§åœ¨é˜¿æ³¢ç½—æœ‰å®ç°å—?å¦‚æœæœ‰,éœ€è¦æ€ä¹ˆåš? è¯¦è§å‚è€ƒæˆ‘ä¹‹å‰åœ¨githubä¸­æäº¤çš„issues,å¾—åˆ°äº†ä½œè€…çš„ç­”å¤ <a href="https://github.com/ctripcorp/apollo/issues/1596">github issues</a><br>ç›®å‰épropertiesæ ¼å¼æ˜¯é€šè¿‡apiæ–¹å¼è·å–çš„ï¼ŒConfigService.getConfigFile,å…·ä½“ä½¿ç”¨ç¤ºä¾‹å‚ç…§<br><a href="https://github.com/ctripcorp/apollo/blob/master/apollo-demo/src/main/java/com/ctrip/framework/apollo/demo/api/ApolloConfigDemo.java#L52">githubépropertiesé…ç½®æ–‡ä»¶è¯»å–æ ·ä¾‹</a><br>å¥½äº†,åˆ°æ­¤å°±å…ˆæ€»ç»“è¿™ä¹ˆå¤š,åç»­è¿˜æœ‰æ›´æ–°çš„å·¥ä½œä¸­èººè¿‡çš„å‘æˆ–ä½¿ç”¨çš„é—®é¢˜æˆ‘ä¼šå®æ—¶æ›´æ–°åˆ°è¿™é‡Œæ¥,å½“ç„¶æœ€ä¸»è¦çš„è¿˜æ˜¯å¸Œæœ›åç»­Apolloæ³¨å†Œä¸­å¿ƒæœåŠ¡å‘æŒ¥å‡ºæ›´å‡ºè‰²çš„èƒ½åŠ›ä¸ºæˆ‘ä»¬çš„äº§å“å‘æŒ¥å‡ºæ›´å¤§çš„å¯åˆ©ç”¨ä»·å€¼ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java Apollo config </category>
          
      </categories>
      
      
        <tags>
            
            <tag> distributed config </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è‡ªå®šä¹‰nacos ribbonè´Ÿè½½å‡è¡¡</title>
      <link href="2021/06/04/nacos-ribbon-custom-loadbalancer-rule/"/>
      <url>2021/06/04/nacos-ribbon-custom-loadbalancer-rule/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€ribbonå…¥é—¨"><a href="#ä¸€ã€ribbonå…¥é—¨" class="headerlink" title="ä¸€ã€ribbonå…¥é—¨"></a>ä¸€ã€ribbonå…¥é—¨</h2><h3 id="1ã€ribbonåœ¨å¾®æœåŠ¡ä¸­æ˜¯ä»€ä¹ˆ-èµ·åˆ°äº†ä»€ä¹ˆä½œç”¨"><a href="#1ã€ribbonåœ¨å¾®æœåŠ¡ä¸­æ˜¯ä»€ä¹ˆ-èµ·åˆ°äº†ä»€ä¹ˆä½œç”¨" class="headerlink" title="1ã€ribbonåœ¨å¾®æœåŠ¡ä¸­æ˜¯ä»€ä¹ˆ?èµ·åˆ°äº†ä»€ä¹ˆä½œç”¨?"></a>1ã€ribbonåœ¨å¾®æœåŠ¡ä¸­æ˜¯ä»€ä¹ˆ?èµ·åˆ°äº†ä»€ä¹ˆä½œç”¨?</h3><p>   ribbonæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡,åŸæ¥æˆ‘ä»¬çš„httpè¯·æ±‚æ˜¯ <code>http://ip:port/****</code> ä½¿ç”¨ribbon: <code>productName</code>é‚£ä¹ˆä¹Ÿå°±æ˜¯æ ¹æ®é¡¹ç›®å,å¯»æ‰¾ä¸€å°æœåŠ¡, ç„¶åå°†é¡¹ç›®åå®šä½åˆ°ä¸€å°æœåŠ¡çš„è¿‡ç¨‹.<br>   <img src="/images/nacos-ribbon-custom-loadbalancer-rule/ribbon-principle.png" alt="ribbon-principle"></p><h3 id="2ã€é‡æ–°å®šä¹‰ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#2ã€é‡æ–°å®šä¹‰ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="2ã€é‡æ–°å®šä¹‰ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥"></a>2ã€é‡æ–°å®šä¹‰ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TheSameClusterPriorityRule</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractLoadBalancerRule</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initWithNiwsConfig</span><span class="token punctuation">(</span>IClientConfig iClientConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * ä¸»è¦å®ç°chooseæ–¹æ³•     *     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Server <span class="token function">choose</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span></code></pre><h3 id="3ã€feignä¹Ÿæ˜¯å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ä¸ribbonçš„åŒºåˆ«-Ribbon-VS-Feign"><a href="#3ã€feignä¹Ÿæ˜¯å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ä¸ribbonçš„åŒºåˆ«-Ribbon-VS-Feign" class="headerlink" title="3ã€feignä¹Ÿæ˜¯å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ä¸ribbonçš„åŒºåˆ«(Ribbon VS Feign)"></a>3ã€feignä¹Ÿæ˜¯å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ä¸ribbonçš„åŒºåˆ«(Ribbon VS Feign)</h3><p>feignå’Œribbonæ˜¯Spring Cloudçš„Netflixä¸­æä¾›çš„ä¸¤ä¸ªå®ç°è½¯è´Ÿè½½å‡è¡¡çš„ç»„ä»¶ï¼ŒRibbonå’ŒFeignéƒ½æ˜¯ç”¨äº<br>è°ƒç”¨å…¶ä»–æœåŠ¡çš„ï¼Œæ–¹å¼ä¸åŒã€‚Feignåˆ™æ˜¯åœ¨Ribbonçš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¸€æ¬¡æ”¹è¿›ï¼Œé‡‡ç”¨æ¥å£çš„æ–¹å¼ã€‚<br>å°†éœ€è¦è°ƒç”¨çš„å…¶ä»–æœåŠ¡çš„æ–¹æ³•å®šä¹‰æˆæŠ½è±¡æ–¹æ³•å³å¯ï¼Œä¸éœ€è¦è‡ªå·±æ„å»º http è¯·æ±‚.<br><img src="/images/nacos-ribbon-custom-loadbalancer-rule/ribbon-with-feign-difference.png" alt="ribbon-with-feign-difference"></p><h3 id="4ã€å¦‚ä½•è‡ªå®šä¹‰feignæ‹¦æˆªå™¨"><a href="#4ã€å¦‚ä½•è‡ªå®šä¹‰feignæ‹¦æˆªå™¨" class="headerlink" title="4ã€å¦‚ä½•è‡ªå®šä¹‰feignæ‹¦æˆªå™¨"></a>4ã€å¦‚ä½•è‡ªå®šä¹‰feignæ‹¦æˆªå™¨</h3><p><img src="/images/nacos-ribbon-custom-loadbalancer-rule/custom-feign-interceptor-.png" alt="custom-feign-interceptor"></p><h2 id="äºŒã€ribbonæŒ‰ç…§æƒé‡å®ç°è´Ÿè½½å‡è¡¡"><a href="#äºŒã€ribbonæŒ‰ç…§æƒé‡å®ç°è´Ÿè½½å‡è¡¡" class="headerlink" title="äºŒã€ribbonæŒ‰ç…§æƒé‡å®ç°è´Ÿè½½å‡è¡¡"></a>äºŒã€ribbonæŒ‰ç…§æƒé‡å®ç°è´Ÿè½½å‡è¡¡</h2><p><code>ribbon</code>æœ¬èº«æ˜¯æ²¡æœ‰æƒé‡çš„æ¦‚å¿µçš„, é‚£ä¹ˆå¦‚ä½•æ‰èƒ½å®ç°ä»£ç”¨æƒé‡çš„è´Ÿè½½å‡è¡¡å‘¢?<br>æˆ‘ä»¬åœ¨<code>nacos</code>ä¸­,æœåŠ¡é›†ç¾¤æœ‰ä¸€ä¸ªæƒé‡çš„æ¦‚å¿µ,å½“ç»™æœåŠ¡å™¨è®¾ç½®äº†æƒé‡,é‚£ä¹ˆæµé‡å°±å¯ä»¥æ ¹æ®æƒé‡æ¯”ä¾‹åˆ†é…åˆ°æœåŠ¡å™¨ä¸Š.</p><h3 id="1ã€å…ˆæ¥çœ‹çœ‹å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ªè´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#1ã€å…ˆæ¥çœ‹çœ‹å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ªè´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="1ã€å…ˆæ¥çœ‹çœ‹å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ªè´Ÿè½½å‡è¡¡ç­–ç•¥."></a>1ã€å…ˆæ¥çœ‹çœ‹å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ªè´Ÿè½½å‡è¡¡ç­–ç•¥.</h3><p>é¦–å…ˆæ˜¯ç»§æ‰¿è‡ª<code>AbstractLoadBalancerRule</code>. ä»ä¸‹é¢è¿™å¼ å›¾å¯ä»¥çœ‹å‡º,<code>ribbon</code>è‡ªå®šä¹‰çš„ç­–ç•¥,æœ€ç»ˆéƒ½ç»§æ‰¿è‡ªè¿™ä¸ªç±»,è¿™ä¸ªç±»å°è£…äº†è´Ÿè½½å‡è¡¡ç­–ç•¥çš„å…¬å…±æ–¹æ³•.<br><img src="/images/nacos-ribbon-custom-loadbalancer-rule/ribbon-abstractLoadBalancerRule-implement.png" alt="ribbon-abstractLoadBalancerRule-implement"><br>åœ¨nacosä¸­å¯ä»¥é…ç½®æœåŠ¡å™¨çš„æƒé‡<br>åœ¨nacosä¸­,æœ‰ä¸¤ä¸ªé‡è¦çš„ç±»,ä¸€ä¸ªæ˜¯NameService,ä¸€ä¸ªæ˜¯ConfigService  </p><ul><li>NameService: æ³¨å†Œä¸­å¿ƒ</li><li>ConfigService: é…ç½®ä¸­å¿ƒ</li></ul><h2 id="ä¸‰ã€å®ç°å¸¦æœ‰æƒé‡çš„è´Ÿè½½å‡è¡¡å™¨"><a href="#ä¸‰ã€å®ç°å¸¦æœ‰æƒé‡çš„è´Ÿè½½å‡è¡¡å™¨" class="headerlink" title="ä¸‰ã€å®ç°å¸¦æœ‰æƒé‡çš„è´Ÿè½½å‡è¡¡å™¨"></a>ä¸‰ã€å®ç°å¸¦æœ‰æƒé‡çš„è´Ÿè½½å‡è¡¡å™¨</h2><h3 id="ç¬¬ä¸€æ­¥-è‡ªå®šä¹‰ä¸€ä¸ªå¸¦æœ‰æƒé‡çš„è´Ÿè½½å‡è¡¡å™¨MyWeightRule"><a href="#ç¬¬ä¸€æ­¥-è‡ªå®šä¹‰ä¸€ä¸ªå¸¦æœ‰æƒé‡çš„è´Ÿè½½å‡è¡¡å™¨MyWeightRule" class="headerlink" title="ç¬¬ä¸€æ­¥:è‡ªå®šä¹‰ä¸€ä¸ªå¸¦æœ‰æƒé‡çš„è´Ÿè½½å‡è¡¡å™¨MyWeightRule"></a>ç¬¬ä¸€æ­¥:è‡ªå®šä¹‰ä¸€ä¸ªå¸¦æœ‰æƒé‡çš„è´Ÿè½½å‡è¡¡å™¨MyWeightRule</h3><p><img src="/images/nacos-ribbon-custom-loadbalancer-rule/nacos-myWeightRule.png" alt="nacos-myWeightRule"></p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>personal<span class="token punctuation">.</span>www<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>myrule<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>NacosDiscoveryProperties<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>ribbon<span class="token punctuation">.</span>NacosServer<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>api<span class="token punctuation">.</span>exception<span class="token punctuation">.</span>NacosException<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>api<span class="token punctuation">.</span>naming<span class="token punctuation">.</span>NamingService<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>api<span class="token punctuation">.</span>naming<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span>Instance<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>client<span class="token punctuation">.</span>config<span class="token punctuation">.</span>IClientConfig<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span>AbstractLoadBalancerRule<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span>BaseLoadBalancer<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span>ILoadBalancer<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span>Server<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * è‡ªå®šä¹‰ä¸€ä¸ªæƒé‡è´Ÿè½½å‡è¡¡ç­–ç•¥ */</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyWeightRule</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractLoadBalancerRule</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> NacosDiscoveryProperties discoveryProperties<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initWithNiwsConfig</span><span class="token punctuation">(</span>IClientConfig iClientConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è¯»å–é…ç½®æ–‡ä»¶, å¹¶ä¸”åˆå§‹åŒ–, ribbonå†…éƒ¨åŸºæœ¬ä¸Šç”¨ä¸ä¸Š</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * è¿™ä¸ªæ–¹æ³•æ˜¯å®ç°è´Ÿè½½å‡è¡¡ç­–ç•¥çš„æ–¹æ³•     *     * @param     * @return     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Server <span class="token function">choose</span><span class="token punctuation">(</span>Object key<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"key:{}"</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// è°ƒç”¨çˆ¶ç±»æ–¹æ³•, è·å–å½“å‰ä½¿ç”¨çš„è´Ÿè½½å‡è¡¡å™¨</span>            BaseLoadBalancer baseLoadBalancer <span class="token operator">=</span> <span class="token punctuation">(</span>BaseLoadBalancer<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// è·å–å½“å‰æœåŠ¡çš„åç§°</span>            String serviceName <span class="token operator">=</span> baseLoadBalancer<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">/**             * namingService: è·å–nacosçš„æœåŠ¡å‘ç°API             */</span>            NamingService namingService <span class="token operator">=</span> discoveryProperties<span class="token punctuation">.</span><span class="token function">namingServiceInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">/**             * æ ¹æ®åç§°è·å–æœåŠ¡å‘ç°å®ä¾‹             * åœ¨selectOneHealthyInstanceä¸­, nacoså®ç°äº†æƒé‡çš„è´Ÿè½½å‡è¡¡ç®—æ³•             */</span>            Instance instance <span class="token operator">=</span> namingService<span class="token punctuation">.</span><span class="token function">selectOneHealthyInstance</span><span class="token punctuation">(</span>serviceName<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">NacosServer</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NacosException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="ç¬¬äºŒæ­¥-å¯ç”¨è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡å™¨åº”ç”¨"><a href="#ç¬¬äºŒæ­¥-å¯ç”¨è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡å™¨åº”ç”¨" class="headerlink" title="ç¬¬äºŒæ­¥: å¯ç”¨è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡å™¨åº”ç”¨"></a>ç¬¬äºŒæ­¥: å¯ç”¨è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡å™¨åº”ç”¨</h3><p>ä¿®æ”¹è‡ªå®šä¹‰çš„ribbon config.</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>personal<span class="token punctuation">.</span>www<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>config<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>lxl<span class="token punctuation">.</span>www<span class="token punctuation">.</span>ribbonconfig<span class="token punctuation">.</span>GlobalRibbonConfig<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>ribbon<span class="token punctuation">.</span>RibbonClients<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token comment" spellcheck="true">/*@RibbonClients(value = {        @RibbonClient(name="product", configuration = ProductConfiguration.class),        @RibbonClient(name = "customer", configuration = CustomerConfiguration.class)})*/</span><span class="token comment" spellcheck="true">// ä½¿ç”¨å…¨å±€çš„é…ç½®</span><span class="token annotation punctuation">@RibbonClients</span><span class="token punctuation">(</span>defaultConfiguration <span class="token operator">=</span> GlobalRibbonConfig<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomeRibbonConfig</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>è®¾ç½®ä¸ºå…¨å±€é…ç½®<code>GlobalRibbonConfig.class</code><br>ç„¶ååœ¨å…¨å±€é…ç½®ä¸­,æˆ‘ä»¬æ‰§è¡Œå½“å‰ä½¿ç”¨çš„è´Ÿè½½å‡è¡¡ç­–ç•¥æ˜¯è‡ªå®šä¹‰çš„æƒé‡è´Ÿè½½å‡è¡¡ç­–ç•¥ </p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>personal<span class="token punctuation">.</span>www<span class="token punctuation">.</span>ribbonconfig<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>personal<span class="token punctuation">.</span>www<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>myrule<span class="token punctuation">.</span>MyWeightRule<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span>IRule<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalRibbonConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> IRule <span class="token function">getRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// å®ç°å¸¦æœ‰æƒé‡çš„è´Ÿè½½å‡è¡¡ç­–ç•¥</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyWeightRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="ç¬¬ä¸‰æ­¥-å¯åŠ¨æœåŠ¡-å¹¶è®¾ç½®nacosæƒé‡"><a href="#ç¬¬ä¸‰æ­¥-å¯åŠ¨æœåŠ¡-å¹¶è®¾ç½®nacosæƒé‡" class="headerlink" title="ç¬¬ä¸‰æ­¥:å¯åŠ¨æœåŠ¡,å¹¶è®¾ç½®nacosæƒé‡"></a>ç¬¬ä¸‰æ­¥:å¯åŠ¨æœåŠ¡,å¹¶è®¾ç½®nacosæƒé‡</h3><p><img src="/images/nacos-ribbon-custom-loadbalancer-rule/nacos-console-server-instance-list.png" alt="nacos-console-server-instance-list"><br>æˆ‘ä»¬çœ‹åˆ°å¯åŠ¨äº†ä¸¤å°<code>product</code>,ä¸€å°<code>order</code>. æ¥ä¸‹æ¥è®¾ç½®<code>product</code>ä¸¤å°å®ä¾‹çš„æƒé‡<br><img src="/images/nacos-ribbon-custom-loadbalancer-rule/nacos-console-server-instance-detail.png" alt="nacos-console-server-instance-detail"><br>æˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªè®¾ç½®ä¸º<code>0.1</code>,å¦ä¸€ä¸ªæ˜¯<code>0.9</code>, ä¹Ÿå°±æ˜¯è¯´å¦‚æœæœ‰<code>10</code>æ¬¡è¯·æ±‚, åŸºæœ¬ä¸Šéƒ½æ˜¯ä¼šæ‰“åˆ°<code>8083</code>ç«¯å£ä¸Šçš„. </p><h3 id="ç¬¬å››æ­¥-æµè§ˆå™¨è®¿é—®è¿æ¥-æµ‹è¯•ç»“æœ"><a href="#ç¬¬å››æ­¥-æµè§ˆå™¨è®¿é—®è¿æ¥-æµ‹è¯•ç»“æœ" class="headerlink" title="ç¬¬å››æ­¥: æµè§ˆå™¨è®¿é—®è¿æ¥,æµ‹è¯•ç»“æœ"></a>ç¬¬å››æ­¥: æµè§ˆå™¨è®¿é—®è¿æ¥,æµ‹è¯•ç»“æœ</h3><pre class=" language-text"><code class="language-text">http://localhost:8080/get/product</code></pre><p>è§¦å‘äº†10æ¬¡è¯·æ±‚,åŸºæœ¬ä¸Šéƒ½æ‰“åˆ°äº†8083æœåŠ¡å™¨ä¸Š.</p><h2 id="å››ã€å®ç°åŒé›†ç¾¤ä¼˜å…ˆè°ƒç”¨åŸåˆ™çš„è´Ÿè½½å‡è¡¡å™¨"><a href="#å››ã€å®ç°åŒé›†ç¾¤ä¼˜å…ˆè°ƒç”¨åŸåˆ™çš„è´Ÿè½½å‡è¡¡å™¨" class="headerlink" title="å››ã€å®ç°åŒé›†ç¾¤ä¼˜å…ˆè°ƒç”¨åŸåˆ™çš„è´Ÿè½½å‡è¡¡å™¨"></a>å››ã€å®ç°åŒé›†ç¾¤ä¼˜å…ˆè°ƒç”¨åŸåˆ™çš„è´Ÿè½½å‡è¡¡å™¨</h2><p>å°½é‡é¿å…è·¨é›†ç¾¤è°ƒç”¨<br>æ¯”å¦‚,å—äº¬é›†ç¾¤çš„<code>product</code>ä¼˜å…ˆè°ƒç”¨å—äº¬é›†ç¾¤çš„<code>order</code>.åŒ—äº¬é›†ç¾¤çš„<code>product</code>ä¼˜å…ˆè°ƒç”¨åŒ—äº¬é›†ç¾¤çš„<code>order</code>.<br><img src="/images/nacos-ribbon-custom-loadbalancer-rule/nacos-area-cluster-ribbon-rule.png" alt="nacos-area-cluster-ribbon-rule"><br>å®ç°å¦‚ä¸Šå›¾æ‰€ç¤ºçš„åŠŸèƒ½<br>æˆ‘ä»¬æœ‰<code>product</code>æœåŠ¡å’Œ<code>order</code>æœåŠ¡, å‡è®¾å„æœ‰10å°. <code>product</code>å’Œ<code>order</code>æœ‰5å°éƒ¨ç½²åœ¨åŒ—äº¬é›†ç¾¤ä¸Š, å¦å¤–5å°éƒ¨ç½²åœ¨å—äº¬é›†ç¾¤ä¸Š.<br>é‚£ä¹ˆå½“æœ‰è¯·æ±‚æ‰“åˆ°å—äº¬çš„<code>product</code>çš„æ—¶å€™, é‚£ä¹ˆä»–è°ƒç”¨<code>order</code>è¦ä¼˜å…ˆè°ƒç”¨å—äº¬é›†ç¾¤çš„,å—äº¬é›†ç¾¤æ²¡æœ‰äº†,åœ¨è°ƒç”¨åŒ—äº¬é›†ç¾¤çš„.<br>å½“æœ‰è¯·æ±‚æ‰“åˆ°åŒ—äº¬çš„<code>product</code>çš„æ˜¯å¶,ä¼˜å…ˆè°ƒç”¨åŒ—äº¬é›†ç¾¤çš„<code>order</code>,åŒ—äº¬æ²¡æœ‰æ‰¾åˆ°,å†å»è°ƒç”¨å—äº¬çš„<code>order</code>.</p><h3 id="ç¬¬ä¸€æ­¥-è‡ªå®šä¹‰ä¸€ä¸ªåŒé›†ç¾¤ä¼˜å…ˆç­–ç•¥çš„è´Ÿè½½å‡è¡¡å™¨"><a href="#ç¬¬ä¸€æ­¥-è‡ªå®šä¹‰ä¸€ä¸ªåŒé›†ç¾¤ä¼˜å…ˆç­–ç•¥çš„è´Ÿè½½å‡è¡¡å™¨" class="headerlink" title="ç¬¬ä¸€æ­¥: è‡ªå®šä¹‰ä¸€ä¸ªåŒé›†ç¾¤ä¼˜å…ˆç­–ç•¥çš„è´Ÿè½½å‡è¡¡å™¨"></a>ç¬¬ä¸€æ­¥: è‡ªå®šä¹‰ä¸€ä¸ªåŒé›†ç¾¤ä¼˜å…ˆç­–ç•¥çš„è´Ÿè½½å‡è¡¡å™¨</h3><p><img src="/images/nacos-ribbon-custom-loadbalancer-rule/the-same-cluster-priority-rule.png" alt="the-same-cluster-priority-rule"></p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>personal<span class="token punctuation">.</span>www<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>myrule<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>NacosDiscoveryProperties<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>ribbon<span class="token punctuation">.</span>NacosServer<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>api<span class="token punctuation">.</span>exception<span class="token punctuation">.</span>NacosException<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>api<span class="token punctuation">.</span>naming<span class="token punctuation">.</span>NamingService<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>api<span class="token punctuation">.</span>naming<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span>Instance<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>client<span class="token punctuation">.</span>config<span class="token punctuation">.</span>IClientConfig<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span>AbstractLoadBalancerRule<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span>BaseLoadBalancer<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span>Server<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>StringUtils<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>omg<span class="token punctuation">.</span>PortableInterceptor<span class="token punctuation">.</span>INACTIVE<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Component<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>ArrayList<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * åŒé›†ç¾¤ä¼˜å…ˆè°ƒç”¨--è´Ÿè½½å‡è¡¡ç­–ç•¥ */</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TheSameClusterPriorityRule</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractLoadBalancerRule</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> NacosDiscoveryProperties discoveryProperties<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initWithNiwsConfig</span><span class="token punctuation">(</span>IClientConfig iClientConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * ä¸»è¦å®ç°chooseæ–¹æ³•     *     * @param o     * @return     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Server <span class="token function">choose</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// ç¬¬ä¸€æ­¥: è·å–æœåŠ¡æ‰€åœ¨çš„é›†ç¾¤åç§°</span>            String clusterName <span class="token operator">=</span> discoveryProperties<span class="token punctuation">.</span><span class="token function">getClusterName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// ç¬¬äºŒæ­¥: è·å–å½“å‰è´Ÿè½½å‡è¡¡å™¨</span>            BaseLoadBalancer loadBalancer <span class="token operator">=</span> <span class="token punctuation">(</span>BaseLoadBalancer<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// ç¬¬ä¸‰æ­¥: è·å–å½“å‰æœåŠ¡çš„å®ä¾‹åç§°</span>            String serviceName <span class="token operator">=</span> loadBalancer<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// ç¬¬å››æ­¥: è·å–nacos clientæœåŠ¡æ³¨å†Œå‘ç°api</span>            NamingService namingService <span class="token operator">=</span> discoveryProperties<span class="token punctuation">.</span><span class="token function">namingServiceInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// ç¬¬äº”æ­¥: é€šè¿‡namingServiceè·å–å½“å‰æ³¨å†Œçš„æ‰€æœ‰æœåŠ¡å®ä¾‹</span>            List<span class="token operator">&lt;</span>Instance<span class="token operator">></span> allInstances <span class="token operator">=</span> namingService<span class="token punctuation">.</span><span class="token function">getAllInstances</span><span class="token punctuation">(</span>serviceName<span class="token punctuation">)</span><span class="token punctuation">;</span>            List<span class="token operator">&lt;</span>Instance<span class="token operator">></span> instanceList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// ç¬¬å…­æ­¥: è¿‡æ»¤ç­›é€‰åŒé›†ç¾¤ä¸‹çš„æœåŠ¡å®ä¾‹</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>Instance instance<span class="token operator">:</span> allInstances<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">endsWithIgnoreCase</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token function">getClusterName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> clusterName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    instanceList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            Instance toBeChooseInstance<span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// ç¬¬ä¸ƒæ­¥: é€‰æ‹©åˆé€‚çš„æœåŠ¡å®ä¾‹</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>instanceList <span class="token operator">==</span> null <span class="token operator">||</span> instanceList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// ä»å…¶ä»–é›†ç¾¤ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹</span>                toBeChooseInstance <span class="token operator">=</span> WeightedBalancer<span class="token punctuation">.</span><span class="token function">chooseInstanceByRandomWeight</span><span class="token punctuation">(</span>allInstances<span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è·¨é›†ç¾¤è°ƒç”¨---{}"</span><span class="token punctuation">,</span> toBeChooseInstance<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// ä»æœ¬é›†ç¾¤ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹</span>                toBeChooseInstance <span class="token operator">=</span> WeightedBalancer<span class="token punctuation">.</span><span class="token function">chooseInstanceByRandomWeight</span><span class="token punctuation">(</span>instanceList<span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"åŒé›†ç¾¤è°ƒç”¨---{}"</span><span class="token punctuation">,</span> toBeChooseInstance<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">NacosServer</span><span class="token punctuation">(</span>toBeChooseInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NacosException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p><img src="/images/nacos-ribbon-custom-loadbalancer-rule/nacos-weightedBalancer.png" alt="nacos-weightedBalancer"></p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>lxl<span class="token punctuation">.</span>www<span class="token punctuation">.</span>ribbon<span class="token punctuation">.</span>myrule<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>api<span class="token punctuation">.</span>naming<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span>Instance<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>client<span class="token punctuation">.</span>naming<span class="token punctuation">.</span>core<span class="token punctuation">.</span>Balancer<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * æ ¹æ®æƒé‡éšæœºé€‰æ‹©ä¸€ä¸ªå®ä¾‹ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeightedBalancer</span> <span class="token keyword">extends</span> <span class="token class-name">Balancer</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * æ ¹æ®éšæœºæƒé‡ç­–ç•¥, ä»ä¸€ç¾¤æœåŠ¡å™¨ä¸­é€‰æ‹©ä¸€ä¸ª     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> Instance <span class="token function">chooseInstanceByRandomWeight</span> <span class="token punctuation">(</span>List<span class="token operator">&lt;</span>Instance<span class="token operator">></span> instanceList<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è¿™æ˜¯çˆ¶ç±»Balancerè‡ªå¸¦çš„æ ¹æ®éšæœºæƒé‡è·å–æœåŠ¡çš„æ–¹æ³•.</span>        <span class="token keyword">return</span> <span class="token function">getHostByRandomWeight</span><span class="token punctuation">(</span>instanceList<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="ç¬¬äºŒæ­¥-è®¾ç½®å½“å‰çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ä¸ºåŒé›†ç¾¤ä¼˜å…ˆç­–ç•¥"><a href="#ç¬¬äºŒæ­¥-è®¾ç½®å½“å‰çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ä¸ºåŒé›†ç¾¤ä¼˜å…ˆç­–ç•¥" class="headerlink" title="ç¬¬äºŒæ­¥: è®¾ç½®å½“å‰çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ä¸ºåŒé›†ç¾¤ä¼˜å…ˆç­–ç•¥"></a>ç¬¬äºŒæ­¥: è®¾ç½®å½“å‰çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ä¸ºåŒé›†ç¾¤ä¼˜å…ˆç­–ç•¥</h3><pre class=" language-java"><code class="language-java"> <span class="token annotation punctuation">@Configuration</span> <span class="token comment" spellcheck="true">/*@RibbonClients(value = {         @RibbonClient(name="product", configuration = ProductConfiguration.class),         @RibbonClient(name = "customer", configuration = CustomerConfiguration.class) })*/</span> <span class="token comment" spellcheck="true">// ä½¿ç”¨å…¨å±€çš„é…ç½®</span> <span class="token annotation punctuation">@RibbonClients</span><span class="token punctuation">(</span>defaultConfiguration <span class="token operator">=</span> GlobalRibbonConfig<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomeRibbonConfig</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalRibbonConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> IRule <span class="token function">getRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// å®ç°å¸¦æœ‰æƒé‡çš„è´Ÿè½½å‡è¡¡ç­–ç•¥</span>        <span class="token comment" spellcheck="true">//return new MyWeightRule();</span>        <span class="token comment" spellcheck="true">// å®ç°åŒé›†ç¾¤ä¼˜å…ˆçš„æœåŠ¡å®ä¾‹</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TheSameClusterPriorityRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="ç¬¬ä¸‰æ­¥-å¯åŠ¨æœåŠ¡"><a href="#ç¬¬ä¸‰æ­¥-å¯åŠ¨æœåŠ¡" class="headerlink" title="ç¬¬ä¸‰æ­¥: å¯åŠ¨æœåŠ¡"></a>ç¬¬ä¸‰æ­¥: å¯åŠ¨æœåŠ¡</h3><p><img src="/images/nacos-ribbon-custom-loadbalancer-rule/the-same-cluster-priority-rule-instance-console.png" alt="the-same-cluster-priority-rule-instance-console"><br>å¯ä»¥çœ‹åˆ°<code>order</code>æœåŠ¡å®ä¾‹æœ‰<code>1</code>å°, æ‰€å±é›†ç¾¤æ˜¯<code>BJ-CLUSTER</code>, <code>product</code>æœåŠ¡æœ‰<code>4</code>å°. <code>BJ-CLUSTER</code>å’Œ<code>NJ-CLUSTER</code>å„ä¸¤å°<br><img src="/images/nacos-ribbon-custom-loadbalancer-rule/nacos-bj-nj-cluster-detail.png" alt="nacos-bj-nj-cluster-detail"></p><h3 id="ç¬¬å››æ­¥-è®¿é—®è¯·æ±‚"><a href="#ç¬¬å››æ­¥-è®¿é—®è¯·æ±‚" class="headerlink" title="ç¬¬å››æ­¥: è®¿é—®è¯·æ±‚"></a>ç¬¬å››æ­¥: è®¿é—®è¯·æ±‚</h3><pre class=" language-text"><code class="language-text">http://localhost:8080/get/product</code></pre><p>ç”±äºorderæœåŠ¡æ˜¯<code>BJ-CLUSTER</code>,æ‰€ä»¥,æˆ‘ä»¬çœ‹åˆ°æµé‡æ˜¯éšæœºæ‰“åˆ°äº†<code>ORDER</code>çš„<code>BJ-CLUSTER</code>é›†ç¾¤ä¸Š.<br>åœæ­¢<code>BJ-CLUSTER</code>é›†ç¾¤çš„ä¸¤å°å®ä¾‹, ç°åœ¨<code>BJ-CLUSTER</code>é›†ç¾¤ä¸Šæ²¡æœ‰<code>product</code>çš„æœåŠ¡å®ä¾‹äº†,è¿™æ—¶åœ¨è¯·æ±‚,æµé‡å°±ä¼šè¾¾åˆ°<code>NJ-CLUSTER</code>ä¸Š.</p><h2 id="äº”ã€é‡‘ä¸é›€å‘å¸ƒâ€“å®ç°åŒç‰ˆæœ¬åŒé›†ç¾¤ä¼˜å…ˆè´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#äº”ã€é‡‘ä¸é›€å‘å¸ƒâ€“å®ç°åŒç‰ˆæœ¬åŒé›†ç¾¤ä¼˜å…ˆè´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="äº”ã€é‡‘ä¸é›€å‘å¸ƒâ€“å®ç°åŒç‰ˆæœ¬åŒé›†ç¾¤ä¼˜å…ˆè´Ÿè½½å‡è¡¡ç­–ç•¥"></a>äº”ã€é‡‘ä¸é›€å‘å¸ƒâ€“å®ç°åŒç‰ˆæœ¬åŒé›†ç¾¤ä¼˜å…ˆè´Ÿè½½å‡è¡¡ç­–ç•¥</h2><p><img src="/images/nacos-ribbon-custom-loadbalancer-rule/canary-example-show.png" alt="canary-example-show"></p><blockquote><p>é‡‘ä¸é›€å‘å¸ƒä¸€èˆ¬å…ˆå‘1å°ï¼Œæˆ–è€…ä¸€ä¸ªå°æ¯”ä¾‹ï¼Œä¾‹å¦‚ 2% çš„æœåŠ¡å™¨ï¼Œä¸»è¦åšæµé‡éªŒè¯ç”¨ï¼Œä¹Ÿç§°ä¸ºé‡‘ä¸é›€ (Canary) æµ‹è¯•ï¼ˆå›½å†…å¸¸ç§°ç°åº¦æµ‹è¯•ï¼‰ã€‚ä»¥å‰æ—·å·¥å¼€çŸ¿ä¸‹çŸ¿æ´å‰ï¼Œå…ˆä¼šæ”¾ä¸€åªé‡‘ä¸é›€è¿›å»æ¢æ˜¯å¦æœ‰æœ‰æ¯’æ°”ä½“ï¼Œçœ‹é‡‘ä¸é›€èƒ½å¦æ´»ä¸‹æ¥ï¼Œ<br>é‡‘ä¸é›€å‘å¸ƒç”±æ­¤å¾—åã€‚ç®€å•çš„é‡‘ä¸é›€æµ‹è¯•ä¸€èˆ¬é€šè¿‡æ‰‹å·¥æµ‹è¯•éªŒè¯ï¼Œå¤æ‚çš„é‡‘ä¸é›€æµ‹è¯•éœ€è¦æ¯”è¾ƒå®Œå–„çš„ç›‘æ§åŸºç¡€è®¾æ–½é…åˆï¼Œé€šè¿‡ç›‘æ§æŒ‡æ ‡åé¦ˆï¼Œè§‚å¯Ÿé‡‘ä¸é›€çš„å¥åº·çŠ¶å†µï¼Œä½œä¸ºåç»­å‘å¸ƒæˆ–å›é€€çš„ä¾æ®ã€‚å¦‚æœé‡‘ä¸æµ‹è¯•é€šè¿‡ï¼Œ<br>åˆ™æŠŠå‰©ä½™çš„ V1 ç‰ˆæœ¬å…¨éƒ¨å‡çº§ä¸º V2 ç‰ˆæœ¬ã€‚å¦‚æœé‡‘ä¸é›€æµ‹è¯•å¤±è´¥ï¼Œåˆ™ç›´æ¥å›é€€é‡‘ä¸é›€ï¼Œå‘å¸ƒå¤±è´¥ã€‚</p><p>ä¼˜åŠ¿å’Œé€‚ç”¨åœºåˆ</p><p>ä¼˜åŠ¿ï¼š<br>ç”¨æˆ·ä½“éªŒå½±å“å°ï¼Œé‡‘ä¸é›€å‘å¸ƒè¿‡ç¨‹å‡ºç°é—®é¢˜åªå½±å“å°‘é‡ç”¨æˆ·<br>é€‚ç”¨åœºåˆï¼š</p><ul><li>å¯¹æ–°ç‰ˆæœ¬åŠŸèƒ½æˆ–æ€§èƒ½ç¼ºä¹è¶³å¤Ÿä¿¡å¿ƒ</li><li>ç”¨æˆ·ä½“éªŒè¦æ±‚è¾ƒé«˜çš„ç½‘ç«™ä¸šåŠ¡åœºæ™¯</li><li>ç¼ºä¹è¶³å¤Ÿçš„è‡ªåŠ¨åŒ–å‘å¸ƒå·¥å…·ç ”å‘èƒ½åŠ›</li></ul></blockquote><p>é‡‘ä¸é›€å‘å¸ƒ, ä¹Ÿç§°ä¸ºç°åº¦å‘å¸ƒ, æ˜¯ä»€ä¹ˆæ„æ€å‘¢?<br>é¦–å…ˆ, æˆ‘ä»¬çš„productæœåŠ¡å®ä¾‹æœ‰100å°, orderæœåŠ¡å®ä¾‹æœ‰100å°. ç°åœ¨éƒ½æ˜¯åœ¨v1 ç‰ˆæœ¬ä¸Š<br>ç„¶åæ–°å¼€å‘äº†ä¸€ä¸ªå˜åŒ–å¾ˆå¤§çš„åŠŸèƒ½, ä¸ºäº†ä¿è¯æ•ˆæœ, è¦è¿›è¡Œç°åº¦æµ‹è¯•<br>åœ¨<code>product-center</code>ä¸Šå‘å¸ƒäº†5å°, åœ¨<code>order-center</code>ä¸Šå‘å¸ƒäº†<code>5</code>å°<br>é‚£ä¹ˆç°åœ¨ç”¨æˆ·çš„æµé‡è¿‡æ¥äº†, æˆ‘ä»¬è¦è®¾å®šä¸€éƒ¨åˆ†ç”¨æˆ·, è¯·æ±‚çš„æ˜¯v1ç‰ˆæœ¬çš„æµé‡, è€Œä¸”å…¨éƒ¨éƒ½èµ°<code>v1</code>ç‰ˆæœ¬, <code>product-center</code>, <code>order-center</code>éƒ½æ˜¯<code>v1</code>ç‰ˆæœ¬<br>å¦‚æœè¿‡æ¥çš„ç”¨æˆ·, è¯·æ±‚çš„v2ç‰ˆæœ¬çš„æµé‡, é‚£ä¹ˆ<code>product</code>å’Œ<code>order</code>éƒ½èµ°<code>v2</code>ç‰ˆæœ¬.</p><p>ä¸‹é¢æˆ‘ä»¬è¦å®ç°çš„åŠŸèƒ½æè¿°å¦‚ä¸‹:<br><img src="/images/nacos-ribbon-custom-loadbalancer-rule/canary-example-process.png" alt="canary-example-process"></p><ol><li>åŒé›†ç¾¤,åŒç‰ˆæœ¬ä¼˜å…ˆè°ƒç”¨, </li><li>æ²¡æœ‰åŒé›†ç¾¤çš„æœåŠ¡æä¾›è€…, è¿›è¡Œè·¨é›†ç¾¤,åŒç‰ˆæœ¬è°ƒç”¨</li><li>ä¸å¯ä»¥è¿›è¡Œä¸åŒç‰ˆæœ¬é—´çš„è°ƒç”¨<br>ä¹Ÿå°±æ˜¯è¯´: å—äº¬é›†ç¾¤V1ç‰ˆæœ¬çš„<code>product</code>ä¼˜å…ˆè°ƒç”¨å—äº¬é›†ç¾¤<code>V1</code>ç‰ˆæœ¬çš„<code>order</code>, å¦‚æœæ²¡æœ‰å—äº¬é›†ç¾¤<code>V1</code>ç‰ˆæœ¬çš„<code>order</code>, é‚£ä¹ˆå°±è°ƒç”¨åŒ—äº¬é›†ç¾¤<code>V1</code>ç‰ˆæœ¬çš„<code>order</code>, é‚£ä¹ˆèƒ½è°ƒç”¨<code>v2</code>ç‰ˆæœ¬çš„ä¹ˆ? <code>å½“ç„¶ä¸è¡Œ</code>.<br>ä¸‹é¢æ¥å…·ä½“å®ç°ä¸€ä¸‹</li></ol><h3 id="ç¬¬ä¸€æ­¥-å®ç°å¸¦æœ‰ç‰ˆæœ¬çš„é›†ç¾¤ä¼˜å…ˆç­–ç•¥çš„è´Ÿè½½å‡è¡¡ç®—æ³•"><a href="#ç¬¬ä¸€æ­¥-å®ç°å¸¦æœ‰ç‰ˆæœ¬çš„é›†ç¾¤ä¼˜å…ˆç­–ç•¥çš„è´Ÿè½½å‡è¡¡ç®—æ³•" class="headerlink" title="ç¬¬ä¸€æ­¥: å®ç°å¸¦æœ‰ç‰ˆæœ¬çš„é›†ç¾¤ä¼˜å…ˆç­–ç•¥çš„è´Ÿè½½å‡è¡¡ç®—æ³•"></a>ç¬¬ä¸€æ­¥: å®ç°å¸¦æœ‰ç‰ˆæœ¬çš„é›†ç¾¤ä¼˜å…ˆç­–ç•¥çš„è´Ÿè½½å‡è¡¡ç®—æ³•</h3><p><img src="/images/nacos-ribbon-custom-loadbalancer-rule/nacos-custom-ribbon-rule-canary-cluster-version.png" alt="nacos-custom-ribbon-rule-canary-cluster-version"></p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>personal<span class="token punctuation">.</span>www<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>myrule<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>NacosDiscoveryProperties<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>ribbon<span class="token punctuation">.</span>NacosServer<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>api<span class="token punctuation">.</span>exception<span class="token punctuation">.</span>NacosException<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>api<span class="token punctuation">.</span>naming<span class="token punctuation">.</span>NamingService<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>api<span class="token punctuation">.</span>naming<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span>Instance<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>client<span class="token punctuation">.</span>config<span class="token punctuation">.</span>IClientConfig<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span>AbstractLoadBalancerRule<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span>BaseLoadBalancer<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span>Server<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>ArrayList<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * åŒé›†ç¾¤ä¼˜å…ˆå¸¦ç‰ˆæœ¬çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ */</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TheSameClusterPriorityWithVersionRule</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractLoadBalancerRule</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> NacosDiscoveryProperties discoveryProperties<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initWithNiwsConfig</span><span class="token punctuation">(</span>IClientConfig iClientConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Server <span class="token function">choose</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// ç¬¬ä¸€æ­¥: è·å–å½“å‰æœåŠ¡çš„é›†ç¾¤åç§° å’Œ æœåŠ¡çš„ç‰ˆæœ¬å·</span>            String clusterName <span class="token operator">=</span> discoveryProperties<span class="token punctuation">.</span><span class="token function">getClusterName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            String version <span class="token operator">=</span> discoveryProperties<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"version"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// ç¬¬äºŒæ­¥: è·å–å½“å‰æœåŠ¡çš„è´Ÿè½½å‡è¡¡å™¨</span>            BaseLoadBalancer loadBalancer <span class="token operator">=</span> <span class="token punctuation">(</span>BaseLoadBalancer<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// ç¬¬ä¸‰æ­¥: è·å–ç›®æ ‡æœåŠ¡çš„æœåŠ¡å</span>            String serviceName <span class="token operator">=</span> loadBalancer<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// ç¬¬å››æ­¥: è·å–nacosæä¾›çš„æœåŠ¡æ³¨å†Œapi</span>            NamingService namingService <span class="token operator">=</span> discoveryProperties<span class="token punctuation">.</span><span class="token function">namingServiceInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// ç¬¬äº”æ­¥: è·å–æ‰€æœ‰æœåŠ¡åä¸ºserviceNameçš„æœåŠ¡å®ä¾‹</span>            List<span class="token operator">&lt;</span>Instance<span class="token operator">></span> allInstances <span class="token operator">=</span> namingService<span class="token punctuation">.</span><span class="token function">getAllInstances</span><span class="token punctuation">(</span>serviceName<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// ç¬¬å…­æ­¥: è¿‡æ»¤ç›¸åŒç‰ˆæœ¬çš„æœåŠ¡å®ä¾‹</span>            List<span class="token operator">&lt;</span>Instance<span class="token operator">></span> sameVersionInstance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>Instance instance <span class="token operator">:</span> allInstances<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"version"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>version<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    sameVersionInstance<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// ç¬¬ä¸ƒæ­¥: è¿‡æ»¤æœ‰ç›¸åŒé›†ç¾¤çš„æœåŠ¡å®ä¾‹</span>            List<span class="token operator">&lt;</span>Instance<span class="token operator">></span> sameClusterInstance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>Instance instance<span class="token operator">:</span> sameVersionInstance<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token function">getClusterName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>clusterName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    sameClusterInstance<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// ç¬¬å…«æ­¥: é€‰æ‹©åˆé€‚çš„æœåŠ¡å®ä¾‹</span>            Instance toBeChooseInstanc<span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>sameClusterInstance <span class="token operator">==</span> null <span class="token operator">||</span> sameClusterInstance<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                toBeChooseInstanc <span class="token operator">=</span> WeightedBalancer<span class="token punctuation">.</span><span class="token function">chooseInstanceByRandomWeight</span><span class="token punctuation">(</span>sameVersionInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"åŒç‰ˆæœ¬ä¸åŒé›†ç¾¤çš„æœåŠ¡å®ä¾‹--{}"</span><span class="token punctuation">,</span> toBeChooseInstanc<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                toBeChooseInstanc <span class="token operator">=</span> WeightedBalancer<span class="token punctuation">.</span><span class="token function">chooseInstanceByRandomWeight</span><span class="token punctuation">(</span>sameClusterInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"åŒç‰ˆæœ¬åŒé›†ç¾¤æœåŠ¡å®ä¾‹--{}"</span><span class="token punctuation">,</span> toBeChooseInstanc<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">NacosServer</span><span class="token punctuation">(</span>toBeChooseInstanc<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NacosException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="ç¬¬äºŒæ­¥-å¯ç”¨è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#ç¬¬äºŒæ­¥-å¯ç”¨è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="ç¬¬äºŒæ­¥: å¯ç”¨è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>ç¬¬äºŒæ­¥: å¯ç”¨è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥</h3><p><img src="/images/nacos-ribbon-custom-loadbalancer-rule/same-cluster-priority-with-version-ribbon-config.png" alt="same-cluster-priority-with-version-ribbon-config"><br><img src="/images/nacos-ribbon-custom-loadbalancer-rule/same-cluster-priority-with-version-ribbon-globalconfig.png" alt="same-cluster-priority-with-version-ribbon-globalconfig"></p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token comment" spellcheck="true">/*@RibbonClients(value = {        @RibbonClient(name="product", configuration = ProductConfiguration.class),        @RibbonClient(name = "customer", configuration = CustomerConfiguration.class)})*/</span><span class="token comment" spellcheck="true">// ä½¿ç”¨å…¨å±€çš„é…ç½®</span><span class="token annotation punctuation">@RibbonClients</span><span class="token punctuation">(</span>defaultConfiguration <span class="token operator">=</span> GlobalRibbonConfig<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomeRibbonConfig</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalRibbonConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> IRule <span class="token function">getRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// å®ç°å¸¦æœ‰æƒé‡çš„è´Ÿè½½å‡è¡¡ç­–ç•¥</span>        <span class="token comment" spellcheck="true">//return new MyWeightRule();</span>        <span class="token comment" spellcheck="true">// å®ç°åŒé›†ç¾¤ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡ç­–ç•¥</span>        <span class="token comment" spellcheck="true">// return new TheSameClusterPriorityRule();</span>        <span class="token comment" spellcheck="true">// å®ç°åŒç‰ˆæœ¬é›†ç¾¤ä¼˜å…ˆçš„æœåŠ¡è´Ÿè½½å‡è¡¡ç­–ç•¥</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TheSameClusterPriorityWithVersionRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="ç¬¬ä¸‰æ­¥-å¯åŠ¨æœåŠ¡-1"><a href="#ç¬¬ä¸‰æ­¥-å¯åŠ¨æœåŠ¡-1" class="headerlink" title="ç¬¬ä¸‰æ­¥:å¯åŠ¨æœåŠ¡"></a>ç¬¬ä¸‰æ­¥:å¯åŠ¨æœåŠ¡</h3><p><img src="/images/nacos-ribbon-custom-loadbalancer-rule/same-cluster-priority-with-version-rule-console.png" alt="same-cluster-priority-with-version-rule-console"><br>å¦‚å›¾,æˆ‘ä»¬å¯åŠ¨äº†ä¸¤ä¸ªæœåŠ¡, ä¸€ä¸ª<code>order</code>, ä¸€ä¸ª<code>product</code>, å…¶ä¸­<code>order</code>å¯åŠ¨äº†<code>1</code>ä¸ªå®ä¾‹, <code>product</code>å¯åŠ¨äº†<code>4</code>ä¸ªå®ä¾‹.</p><p>ä¸‹é¢æ¥çœ‹çœ‹orderå®ä¾‹çš„è¯¦æƒ…<br><img src="/images/nacos-ribbon-custom-loadbalancer-rule/same-cluster-priority-with-version-rule-bjcluster.png" alt="same-cluster-priority-with-version-rule-bjcluster"><br>å±äºåŒ—äº¬é›†ç¾¤,ç‰ˆæœ¬å·æ˜¯<code>v1</code>ç‰ˆæœ¬</p><p>å†æ¥çœ‹çœ‹<code>product</code>é›†ç¾¤çš„è¯¦æƒ…<br><img src="/images/nacos-ribbon-custom-loadbalancer-rule/same-cluster-priority-version-rule-productserver-cluster.png" alt="same-cluster-priority-version-rule-productserver-cluster"><br>åŒ—äº¬é›†ç¾¤æœ‰ä¸¤å°å®ä¾‹, ä¸€ä¸ªç‰ˆæœ¬å·æ˜¯<code>v1</code>,å¦ä¸€ä¸ªæ˜¯<code>v2</code><br>å—äº¬é›†ç¾¤æœ‰ä¸¤å°å®ä¾‹, ä¸€ä¸ªæ˜¯<code>v1</code>, å¦ä¸€ä¸ªä¹Ÿæ˜¯<code>v2</code></p><h3 id="ç¬¬å››æ­¥-ç°åœ¨å‘èµ·è¯·æ±‚"><a href="#ç¬¬å››æ­¥-ç°åœ¨å‘èµ·è¯·æ±‚" class="headerlink" title="ç¬¬å››æ­¥: ç°åœ¨å‘èµ·è¯·æ±‚"></a>ç¬¬å››æ­¥: ç°åœ¨å‘èµ·è¯·æ±‚</h3><pre class=" language-text"><code class="language-text">http://localhost:8080/get/product</code></pre><p>orderé›†ç¾¤æ˜¯åŒ—äº¬, ç‰ˆæœ¬æ˜¯<code>version1</code>. é‚£ä¹ˆæœåŠ¡åº”è¯¥è¾¾åˆ°å“ªå°æœåŠ¡å™¨å‘¢? åº”è¯¥æ‰“åˆ°åŒ—äº¬é›†ç¾¤çš„<code>v1</code>ç‰ˆæœ¬æœåŠ¡,ç«¯å£å·æ˜¯<code>8081</code>çš„æœåŠ¡å™¨.<br><img src="/images/nacos-ribbon-custom-loadbalancer-rule/same-cluster-priority-version-bj-server-process.png" alt="same-cluster-priority-version-bj-server-process"><br>æœç„¶,è¯·æ±‚è¾¾åˆ°äº†8081æœåŠ¡ä¸Š, åŠ å…¥è¿™æ—¶å€™, åŒ—äº¬é›†ç¾¤çš„<code>8081</code>å®•æœºäº†, æµé‡åº”è¯¥è¾¾åˆ°å—äº¬é›†ç¾¤çš„v1ç‰ˆæœ¬çš„é›†ç¾¤ä¸Š, ç«¯å£å·æ˜¯<code>8083</code><br><img src="/images/nacos-ribbon-custom-loadbalancer-rule/same-cluster-priority-version-nj-server-process.png" alt="same-cluster-priority-version-nj-server-process"><br> æœç„¶æ˜¯<code>8083</code>. é‚£ä¹ˆå¦‚æœ<code>8083</code>ä¹Ÿå®•æœºäº†, æµé‡ä¼šæ‰“åˆ°<code>v2</code>æœåŠ¡å™¨ä¸Šä¹ˆ? æ²¡é”™,ä¸ä¼šçš„, æŠ¥é”™äº†, æ²¡æœ‰æœåŠ¡<br><img src="/images/nacos-ribbon-custom-loadbalancer-rule/same-cluster-priority-version-error-page.png" alt="same-cluster-priority-version-error-page"></p>]]></content>
      
      
      <categories>
          
          <category> SpringBoot Nacos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> nacos </tag>
            
            <tag> custom nacos ribbon rule </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redisTemplateå¸¸è§„Jackson2Json Serializerä»‹ç»åŠä½¿ç”¨åŒºåˆ«</title>
      <link href="2021/02/07/spring-boot-redis-serializer-problems/"/>
      <url>2021/02/07/spring-boot-redis-serializer-problems/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€ä½¿ç”¨Jackson2JsonRedisSerializeråºåˆ—åŒ–ååºåˆ—åŒ–å¸¦æ³›å‹çš„Listæ•°æ®"><a href="#ä¸€ã€ä½¿ç”¨Jackson2JsonRedisSerializeråºåˆ—åŒ–ååºåˆ—åŒ–å¸¦æ³›å‹çš„Listæ•°æ®" class="headerlink" title="ä¸€ã€ä½¿ç”¨Jackson2JsonRedisSerializeråºåˆ—åŒ–ååºåˆ—åŒ–å¸¦æ³›å‹çš„Listæ•°æ®"></a>ä¸€ã€ä½¿ç”¨Jackson2JsonRedisSerializeråºåˆ—åŒ–ååºåˆ—åŒ–å¸¦æ³›å‹çš„Listæ•°æ®</h2><h3 id="1ã€ä½¿ç”¨Jackson2JsonRedisSerializeråºåˆ—åŒ–valueçš„ä»£ç ï¼š"><a href="#1ã€ä½¿ç”¨Jackson2JsonRedisSerializeråºåˆ—åŒ–valueçš„ä»£ç ï¼š" class="headerlink" title="1ã€ä½¿ç”¨Jackson2JsonRedisSerializeråºåˆ—åŒ–valueçš„ä»£ç ï¼š"></a>1ã€ä½¿ç”¨Jackson2JsonRedisSerializeråºåˆ—åŒ–valueçš„ä»£ç ï¼š</h3><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//redis configåŸºç¡€è®¾ç½®</span>RedisTemplate<span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> Object<span class="token operator">></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token operator">&lt;</span>Object<span class="token punctuation">,</span>Object<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//åºåˆ—åŒ–åˆ°redis db</span>UserToken userToken <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>userToken<span class="token punctuation">.</span><span class="token function">setMobile</span><span class="token punctuation">(</span><span class="token string">"176****6708"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>List<span class="token operator">&lt;</span>UserToken<span class="token operator">></span> list <span class="token operator">=</span> Lists<span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span>userToken<span class="token punctuation">)</span><span class="token punctuation">;</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span>list<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span>TimeUnit<span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2ã€ä½¿ç”¨Jackson2JsonRedisSerializeråºåˆ—åŒ–åçš„æ•°æ®å½¢å¼ï¼š"><a href="#2ã€ä½¿ç”¨Jackson2JsonRedisSerializeråºåˆ—åŒ–åçš„æ•°æ®å½¢å¼ï¼š" class="headerlink" title="2ã€ä½¿ç”¨Jackson2JsonRedisSerializeråºåˆ—åŒ–åçš„æ•°æ®å½¢å¼ï¼š"></a>2ã€ä½¿ç”¨Jackson2JsonRedisSerializeråºåˆ—åŒ–åçš„æ•°æ®å½¢å¼ï¼š</h3><pre class=" language-json"><code class="language-json"><span class="token punctuation">[</span>  <span class="token punctuation">{</span>    <span class="token property">"userId"</span><span class="token operator">:</span><span class="token null">null</span><span class="token punctuation">,</span>    <span class="token property">"mobile"</span><span class="token operator">:</span><span class="token string">"176****6708"</span><span class="token punctuation">,</span>    <span class="token property">"token"</span><span class="token operator">:</span><span class="token null">null</span><span class="token punctuation">,</span>    <span class="token property">"platform"</span><span class="token operator">:</span><span class="token null">null</span>  <span class="token punctuation">}</span><span class="token punctuation">]</span></code></pre><h3 id="3ã€ä½¿ç”¨Jackson2JsonRedisSerializerååºåˆ—åŒ–æ—¶æŠ¥é”™"><a href="#3ã€ä½¿ç”¨Jackson2JsonRedisSerializerååºåˆ—åŒ–æ—¶æŠ¥é”™" class="headerlink" title="3ã€ä½¿ç”¨Jackson2JsonRedisSerializerååºåˆ—åŒ–æ—¶æŠ¥é”™"></a>3ã€ä½¿ç”¨Jackson2JsonRedisSerializerååºåˆ—åŒ–æ—¶æŠ¥é”™</h3><pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>UserToken<span class="token operator">></span> list2 <span class="token operator">=</span> <span class="token punctuation">(</span>List<span class="token operator">&lt;</span>UserToken<span class="token operator">></span><span class="token punctuation">)</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>list2<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>userToken1 <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userToken1<span class="token punctuation">.</span><span class="token function">getMobile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class=" language-verilog"><code class="language-verilog">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ClassCastException<span class="token punctuation">:</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>LinkedHashMap cannot be cast to com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>model<span class="token punctuation">.</span>UserToken</code></pre><p>åŸå› ï¼šåºåˆ—åŒ–å¸¦æ³›å‹çš„æ•°æ®æ—¶ï¼Œä¼šä»¥mapçš„ç»“æ„è¿›è¡Œå­˜å‚¨ï¼Œååºåˆ—åŒ–æ˜¯ä¸èƒ½å°†mapè§£ææˆå¯¹è±¡ã€‚</p><h3 id="4ã€è§£å†³æ–¹æ¡ˆï¼šåºåˆ—åŒ–å­˜å‚¨æ—¶ï¼Œè½¬æˆJSONå­—ç¬¦ä¸²"><a href="#4ã€è§£å†³æ–¹æ¡ˆï¼šåºåˆ—åŒ–å­˜å‚¨æ—¶ï¼Œè½¬æˆJSONå­—ç¬¦ä¸²" class="headerlink" title="4ã€è§£å†³æ–¹æ¡ˆï¼šåºåˆ—åŒ–å­˜å‚¨æ—¶ï¼Œè½¬æˆJSONå­—ç¬¦ä¸²"></a>4ã€è§£å†³æ–¹æ¡ˆï¼šåºåˆ—åŒ–å­˜å‚¨æ—¶ï¼Œè½¬æˆJSONå­—ç¬¦ä¸²</h3><pre class=" language-java"><code class="language-java">UserToken userToken <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>userToken<span class="token punctuation">.</span><span class="token function">setMobile</span><span class="token punctuation">(</span><span class="token string">"176****6708"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>List<span class="token operator">&lt;</span>UserToken<span class="token operator">></span> list <span class="token operator">=</span> Lists<span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span>userToken<span class="token punctuation">)</span><span class="token punctuation">;</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"test3"</span><span class="token punctuation">,</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>userToken<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span>TimeUnit<span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>String list2 <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"test3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>JSON<span class="token punctuation">.</span><span class="token function">parseArray</span><span class="token punctuation">(</span>list2<span class="token punctuation">,</span>UserToken<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>userToken1 <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userToken1<span class="token punctuation">.</span><span class="token function">getMobile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="äºŒã€ä½¿ç”¨GenericJackson2JsonRedisSerializeråºåˆ—åŒ–ååºåˆ—åŒ–å¸¦æ³›å‹çš„Listæ•°æ®"><a href="#äºŒã€ä½¿ç”¨GenericJackson2JsonRedisSerializeråºåˆ—åŒ–ååºåˆ—åŒ–å¸¦æ³›å‹çš„Listæ•°æ®" class="headerlink" title="äºŒã€ä½¿ç”¨GenericJackson2JsonRedisSerializeråºåˆ—åŒ–ååºåˆ—åŒ–å¸¦æ³›å‹çš„Listæ•°æ®"></a>äºŒã€ä½¿ç”¨GenericJackson2JsonRedisSerializeråºåˆ—åŒ–ååºåˆ—åŒ–å¸¦æ³›å‹çš„Listæ•°æ®</h2><h3 id="1ã€ä½¿ç”¨GenericJackson2JsonRedisSerializeråºåˆ—åŒ–valueçš„ä»£ç ï¼š"><a href="#1ã€ä½¿ç”¨GenericJackson2JsonRedisSerializeråºåˆ—åŒ–valueçš„ä»£ç ï¼š" class="headerlink" title="1ã€ä½¿ç”¨GenericJackson2JsonRedisSerializeråºåˆ—åŒ–valueçš„ä»£ç ï¼š"></a>1ã€ä½¿ç”¨GenericJackson2JsonRedisSerializeråºåˆ—åŒ–valueçš„ä»£ç ï¼š</h3><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//redis core serializer</span>RedisTemplate<span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> Object<span class="token operator">></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token operator">&lt;</span>Object<span class="token punctuation">,</span>Object<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//redis option</span>UserToken userToken <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>userToken<span class="token punctuation">.</span><span class="token function">setMobile</span><span class="token punctuation">(</span><span class="token string">"176****6708"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>List<span class="token operator">&lt;</span>UserToken<span class="token operator">></span> list <span class="token operator">=</span> Lists<span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span>userToken<span class="token punctuation">)</span><span class="token punctuation">;</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"test2"</span><span class="token punctuation">,</span>list<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span>TimeUnit<span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2ã€ä½¿ç”¨GenericJackson2JsonRedisSerializeråºåˆ—åŒ–åçš„æ•°æ®å½¢å¼ï¼š"><a href="#2ã€ä½¿ç”¨GenericJackson2JsonRedisSerializeråºåˆ—åŒ–åçš„æ•°æ®å½¢å¼ï¼š" class="headerlink" title="2ã€ä½¿ç”¨GenericJackson2JsonRedisSerializeråºåˆ—åŒ–åçš„æ•°æ®å½¢å¼ï¼š"></a>2ã€ä½¿ç”¨GenericJackson2JsonRedisSerializeråºåˆ—åŒ–åçš„æ•°æ®å½¢å¼ï¼š</h3><pre class=" language-json"><code class="language-json"><span class="token punctuation">[</span> <span class="token string">"java.util.ArrayList"</span><span class="token punctuation">,</span>  <span class="token punctuation">[</span>     <span class="token punctuation">{</span>       <span class="token property">"@class"</span><span class="token operator">:</span> <span class="token string">"com.xiaozhangge.model.UserToken"</span><span class="token punctuation">,</span>       <span class="token property">"userId"</span><span class="token operator">:</span> <span class="token null">null</span><span class="token punctuation">,</span>       <span class="token property">"mobile"</span><span class="token operator">:</span> <span class="token string">"176****6708"</span><span class="token punctuation">,</span>       <span class="token property">"token"</span><span class="token operator">:</span> <span class="token null">null</span><span class="token punctuation">,</span>       <span class="token property">"platform"</span><span class="token operator">:</span> <span class="token null">null</span>     <span class="token punctuation">}</span>  <span class="token punctuation">]</span><span class="token punctuation">]</span></code></pre><h3 id="3ã€ä½¿ç”¨GenericJackson2JsonRedisSerializerå¯ä»¥æ­£å¸¸ååºåˆ—åŒ–"><a href="#3ã€ä½¿ç”¨GenericJackson2JsonRedisSerializerå¯ä»¥æ­£å¸¸ååºåˆ—åŒ–" class="headerlink" title="3ã€ä½¿ç”¨GenericJackson2JsonRedisSerializerå¯ä»¥æ­£å¸¸ååºåˆ—åŒ–"></a>3ã€ä½¿ç”¨GenericJackson2JsonRedisSerializerå¯ä»¥æ­£å¸¸ååºåˆ—åŒ–</h3><pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>UserToken<span class="token operator">></span> list2 <span class="token operator">=</span> <span class="token punctuation">(</span>List<span class="token operator">&lt;</span>UserToken<span class="token operator">></span><span class="token punctuation">)</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"test2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>list2<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>userToken1 <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userToken1<span class="token punctuation">.</span><span class="token function">getMobile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="4ã€åŸå› ï¼š"><a href="#4ã€åŸå› ï¼š" class="headerlink" title="4ã€åŸå› ï¼š"></a>4ã€åŸå› ï¼š</h3><p>ä½¿ç”¨GenericJackson2JsonRedisSerializeråºåˆ—åŒ–æ—¶ï¼Œä¼šä¿å­˜åºåˆ—åŒ–çš„å¯¹è±¡çš„åŒ…åå’Œç±»åï¼Œååºåˆ—åŒ–æ—¶ä»¥è¿™ä¸ªä½œä¸ºæ ‡ç¤ºå°±å¯ä»¥ååºåˆ—åŒ–æˆæŒ‡å®šçš„å¯¹è±¡ã€‚</p><h3 id="5ã€ä¹Ÿå¯ä»¥ä»¥JSONå­—ç¬¦ä¸²ä¿å­˜ï¼š"><a href="#5ã€ä¹Ÿå¯ä»¥ä»¥JSONå­—ç¬¦ä¸²ä¿å­˜ï¼š" class="headerlink" title="5ã€ä¹Ÿå¯ä»¥ä»¥JSONå­—ç¬¦ä¸²ä¿å­˜ï¼š"></a>5ã€ä¹Ÿå¯ä»¥ä»¥JSONå­—ç¬¦ä¸²ä¿å­˜ï¼š</h3><pre class=" language-java"><code class="language-java">UserToken userToken <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>userToken<span class="token punctuation">.</span><span class="token function">setMobile</span><span class="token punctuation">(</span><span class="token string">"176****6708"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>List<span class="token operator">&lt;</span>UserToken<span class="token operator">></span> list <span class="token operator">=</span> Lists<span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span>userToken<span class="token punctuation">)</span><span class="token punctuation">;</span>    redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"test4"</span><span class="token punctuation">,</span>JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>userToken<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span>TimeUnit<span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>String list2 <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"test4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>JSON<span class="token punctuation">.</span><span class="token function">parseArray</span><span class="token punctuation">(</span>list2<span class="token punctuation">,</span>UserToken<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>userToken1 <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userToken1<span class="token punctuation">.</span><span class="token function">getMobile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="ä¸‰ã€ä½¿ç”¨GenericJackson2JsonRedisSerializerå’ŒJackson2JsonRedisSerializerdoéƒ½å¯ä»¥æ­£å¸¸åºåˆ—åŒ–ååºåˆ—åŒ–éæ³›å‹æ•°ç»„å¯¹è±¡ã€‚"><a href="#ä¸‰ã€ä½¿ç”¨GenericJackson2JsonRedisSerializerå’ŒJackson2JsonRedisSerializerdoéƒ½å¯ä»¥æ­£å¸¸åºåˆ—åŒ–ååºåˆ—åŒ–éæ³›å‹æ•°ç»„å¯¹è±¡ã€‚" class="headerlink" title="ä¸‰ã€ä½¿ç”¨GenericJackson2JsonRedisSerializerå’ŒJackson2JsonRedisSerializerdoéƒ½å¯ä»¥æ­£å¸¸åºåˆ—åŒ–ååºåˆ—åŒ–éæ³›å‹æ•°ç»„å¯¹è±¡ã€‚"></a>ä¸‰ã€ä½¿ç”¨GenericJackson2JsonRedisSerializerå’ŒJackson2JsonRedisSerializerdoéƒ½å¯ä»¥æ­£å¸¸åºåˆ—åŒ–ååºåˆ—åŒ–éæ³›å‹æ•°ç»„å¯¹è±¡ã€‚</h2><h2 id="å››ã€GenericJackson2JsonRedisSerializerå’ŒJackson2JsonRedisSerializerdoæ•ˆç‡ï¼š"><a href="#å››ã€GenericJackson2JsonRedisSerializerå’ŒJackson2JsonRedisSerializerdoæ•ˆç‡ï¼š" class="headerlink" title="å››ã€GenericJackson2JsonRedisSerializerå’ŒJackson2JsonRedisSerializerdoæ•ˆç‡ï¼š"></a>å››ã€GenericJackson2JsonRedisSerializerå’ŒJackson2JsonRedisSerializerdoæ•ˆç‡ï¼š</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">long</span> start  <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>UserToken userToken <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>userToken<span class="token punctuation">.</span><span class="token function">setMobile</span><span class="token punctuation">(</span><span class="token string">"176****6708"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>List<span class="token operator">&lt;</span>UserToken<span class="token operator">></span> list <span class="token operator">=</span> Lists<span class="token punctuation">.</span><span class="token function">newArrayListWithCapacity</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>userToken<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span>JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span>TimeUnit<span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>String data <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>List<span class="token operator">&lt;</span>UserToken<span class="token operator">></span> list2 <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseArray</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> UserToken<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">long</span> end <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">long</span> time <span class="token operator">=</span> end <span class="token operator">-</span> start<span class="token punctuation">;</span></code></pre><p>æµ‹è¯•åï¼š<br>ä½¿ç”¨<code>GenericJacksonRedisSerializer</code>åºåˆ—åŒ–ååºåˆ—åŒ–è€—æ—¶ï¼š<code>1467</code><br>ä½¿ç”¨<code>Jackson2JsonRedisSerializer</code>åºåˆ—åŒ–ååºåˆ—åŒ–è€—æ—¶ï¼š<code>914</code></p><h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><p>1ã€ä½¿ç”¨Jackson2JsonRedisSerializeréœ€è¦æŒ‡æ˜åºåˆ—åŒ–çš„ç±»Classï¼Œå¯ä»¥ä½¿ç”¨Obejct.class<br>2ã€ä½¿ç”¨GenericJacksonRedisSerializeræ¯”Jackson2JsonRedisSerializeræ•ˆç‡ä½ï¼Œå ç”¨å†…å­˜é«˜ã€‚<br>3ã€GenericJacksonRedisSerializerååºåˆ—åŒ–å¸¦æ³›å‹çš„æ•°ç»„ç±»ä¼šæŠ¥è½¬æ¢å¼‚å¸¸ï¼Œè§£å†³åŠæ³•å­˜å‚¨ä»¥JSONå­—ç¬¦ä¸²å­˜å‚¨ã€‚<br>4ã€GenericJacksonRedisSerializerå’ŒJackson2JsonRedisSerializeréƒ½æ˜¯ä»¥JSONæ ¼å¼å»å­˜å‚¨æ•°æ®ï¼Œéƒ½å¯ä»¥ä½œä¸ºRedisçš„åºåˆ—åŒ–æ–¹å¼ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> RedisTemplate Serializer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo Matery å¸¸è§é—®é¢˜åŠè§£å†³</title>
      <link href="2021/02/07/hexo-matery-problems/"/>
      <url>2021/02/07/hexo-matery-problems/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡ç« é Hexo + Matery Theme æ•™ç¨‹ï¼Œè¯¦ç»†æ•™ç¨‹è§<a href="https://github.com/blinkfox/hexo-theme-matery/blob/develop/README_CN.md"><code>blinkfox hexo-theme-matery</code></a>ï¼Œä¸»è¦è®°å½•ä¸€äº›ä½¿ç”¨ä¸­çš„é—®é¢˜ï¼Œå¸Œæœ›èƒ½å¸®åˆ°è¿›æ¥çš„åŒå­¦ï¼Œé¿å…è¸©å‘ã€‚</p><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><h4 id="1blogæ£€ç´¢ä¸ç”Ÿæ•ˆ"><a href="#1blogæ£€ç´¢ä¸ç”Ÿæ•ˆ" class="headerlink" title="1blogæ£€ç´¢ä¸ç”Ÿæ•ˆ"></a>1blogæ£€ç´¢ä¸ç”Ÿæ•ˆ</h4><p>æˆ‘æœ¬åœ°çš„æƒ…å†µæ˜¯è¿™æ ·çš„,åœ¨ä¸»é¡µé¢é€šè¿‡æ£€ç´¢è¾“å…¥æ¡†æœç´¢æ–‡ç« æ£€ç´¢æ˜¯å¥½ç”¨çš„,ä½†æ˜¯ç‚¹å‡»è¿›å…¥è‡ªå·±æœç´¢çš„æŒ‡å®šæ–‡ç« ä¹‹å,åœ¨æ­¤ç‚¹å‡»æœç´¢æ¡†è¿›è¡Œæ£€ç´¢,å‘ç°æœç´¢åˆ°çš„æ–‡ç« è·¯åŠ²åé¢å¤šåŠ äº†ä¸€å±‚è·¯å¾„ä¿¡æ¯,æ¯”å¦‚<br>æˆ‘çš„è¿™ç¯‡æ–‡ç«  <a href="https://xiaomozhang.github.io/2021/02/07/spring-boot-lettuce-multi-instance/"><code>SpringBoot2.Xä½¿ç”¨Lettuceè®¾ç½®å¤šä¸ªRedisTemplateå®ä¾‹</code></a>, ç‚¹å‡»æ£€ç´¢è¿æ¥è·³è½¬åˆ°<br>æ–°çš„tabåœ°å€æ å‘ç°åœ¨åœ°å€æ åé¢å¤šæ‹¼æ¥äº†ä¸€å±‚è¿æ¥ä¿¡æ¯ <code>/2021/02/07/spring-boot-lettuce-multi-instance/</code> å‡ºç°è¿™æ ·çš„æƒ…å†µæˆ‘çš„è§£å†³åŠæ³•æ˜¯è¿™æ ·çš„</p><h4 id="step1-è¿è¡Œä¸‹é¢å‘½ä»¤å®‰è£…-searchdb"><a href="#step1-è¿è¡Œä¸‹é¢å‘½ä»¤å®‰è£…-searchdb" class="headerlink" title="step1:è¿è¡Œä¸‹é¢å‘½ä»¤å®‰è£… searchdb"></a>step1:è¿è¡Œä¸‹é¢å‘½ä»¤å®‰è£… <code>searchdb</code></h4><pre class=" language-shell"><code class="language-shell">cnpm install hexo-generator-search â€“-savecnpm install hexo-generator-searchdb --save</code></pre><p>è¿™ä¸¤ä¸ªéƒ½éœ€è¦å®‰è£…,åªå®‰è£…ç¬¬ä¸€ä¸ªä¸èƒ½å…¨æ–‡æœç´¢ã€‚<br>ä½†æ˜¯æˆ‘åœ¨ <a href="https://github.com/blinkfox/hexo-theme-matery/blob/develop/README_CN.md"><code>Mastery githubæºç æ•™ç¨‹</code></a> åªçœ‹åˆ°äº†å®‰è£…<code>hexo-generator-search</code>å³å¯,<br>ä½†å®é™…çš„æƒ…å†µæ˜¯è¿™æ ·installå¹¶é…ç½®å®Œæˆä¹‹ååªå¯¹ä¸»é¡µçš„æœç´¢æ£€ç´¢æ˜¯ç”Ÿæ•ˆçš„,è¿›å…¥å…·ä½“çš„blogä¸­æ˜¯ä¸ç”Ÿæ•ˆçš„ã€‚çœ‹æ¥å®è·µè¿˜æ˜¯æ£€éªŒçœŸç†çš„å”¯ä¸€æ ‡å‡†å•Š<br><img src="/images/hexo-matery-problems/hexo-generator-search.jpg" alt="hexo-generator-search"></p><h4 id="step2-åœ¨themes-hexo-theme-matery-config-ymlä¸­æ·»åŠ ä¸‹é¢é…ç½®"><a href="#step2-åœ¨themes-hexo-theme-matery-config-ymlä¸­æ·»åŠ ä¸‹é¢é…ç½®" class="headerlink" title="step2: åœ¨themes/hexo-theme-matery/_config.ymlä¸­æ·»åŠ ä¸‹é¢é…ç½®"></a>step2: åœ¨<code>themes/hexo-theme-matery/_config.yml</code>ä¸­æ·»åŠ ä¸‹é¢é…ç½®</h4><pre class=" language-yaml"><code class="language-yaml"><span class="token comment" spellcheck="true"># Local search</span><span class="token key atrule">local_search</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">trigger</span><span class="token punctuation">:</span> auto  <span class="token key atrule">top_n_per_article</span><span class="token punctuation">:</span> <span class="token number">1</span>  <span class="token key atrule">unescape</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></code></pre><h4 id="step3-åœ¨é¡¹ç›®çš„æ ¹ç›®å½•-config-ymlä¸­æ·»åŠ ä¸‹é¢é…ç½®"><a href="#step3-åœ¨é¡¹ç›®çš„æ ¹ç›®å½•-config-ymlä¸­æ·»åŠ ä¸‹é¢é…ç½®" class="headerlink" title="step3: åœ¨é¡¹ç›®çš„æ ¹ç›®å½•_config.ymlä¸­æ·»åŠ ä¸‹é¢é…ç½®"></a>step3: åœ¨é¡¹ç›®çš„æ ¹ç›®å½•<code>_config.yml</code>ä¸­æ·»åŠ ä¸‹é¢é…ç½®</h4><pre class=" language-yaml"><code class="language-yaml"><span class="token comment" spellcheck="true">#æœç´¢æ’ä»¶</span><span class="token key atrule">search</span><span class="token punctuation">:</span>  <span class="token key atrule">path</span><span class="token punctuation">:</span> search.xml  <span class="token key atrule">field</span><span class="token punctuation">:</span> post  <span class="token key atrule">content</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code></pre><p><img src="/images/hexo-matery-problems/hexo-search-config.png" alt="hexo-search-config"></p>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Matery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot2.Xä½¿ç”¨Lettuceè®¾ç½®å¤šä¸ªRedisTemplateå®ä¾‹</title>
      <link href="2021/02/07/spring-boot-lettuce-multi-instance/"/>
      <url>2021/02/07/spring-boot-lettuce-multi-instance/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘å…¬å¸äº§å“éœ€æ±‚,éœ€è¦ä½¿ç”¨åŒä¸€ä¸ªredisæ•°æ®åº“æœåŠ¡ä½¿ç”¨ä¸åŒçš„åºåˆ—åŒ–æ–¹å¼çš„redisTemplateå¯¹ç¼“å­˜æ•°æ®åº“è¿›è¡Œè¯»å†™æ“ä½œ,<br>ç›®å‰å¤§éƒ¨åˆ†ç½‘ä¸Šçš„æ–‡ç« åœ¨å®ä½œRedisåˆ†æµæ—¶ï¼Œéƒ½æ˜¯ä»¥Jedisä¸ºæ ·ä¾‹ï¼Œä½†SpringBootåœ¨2.xç‰ˆæœ¬ä¹‹åå·²ç»å°†Redisåº“æ›¿æ¢æˆLettuceäº†<br>ä¹‹å‰æˆ‘å†™è¿‡ä¸€ç¯‡æ–‡ç« å°±æ˜¯ <a href="https://xiaomozhang.github.io/2020/01/10/spring-boot-redis-multi-instance/"><code>SpringBoot2.x Rediså¤šæ•°æ®æºé…ç½®(Vavrå‡½æ•°å¼ç¼–ç¨‹æ–¹å¼å®ç°)</code></a><br>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘ä½¿ç”¨<code>Vavrå‡½æ•°å¼ç¼–ç¨‹æ–¹å¼å®ç°</code>è¿›è¡Œå®ç°çš„,æ¥ä¸‹æ¥æˆ‘å°†ä½¿ç”¨ä¸€ç§æ›´ç®€å•çš„æ–¹å¼è¿›è¡Œæ“ä½œ<br>å½“ç„¶åœ¨è¿›è¡Œå®ç°æ¡ˆä¾‹ä¹‹å‰æˆ‘ä»¬è¿˜æ˜¯è¦åŸºäºspringbootåŸºç¡€çš„redisåº“åŒ…è¿˜æ˜¯è¦å¼•å…¥è¿›æ¥çš„</p><h2 id="é¡¹ç›®pomé…ç½®"><a href="#é¡¹ç›®pomé…ç½®" class="headerlink" title="é¡¹ç›®pomé…ç½®"></a>é¡¹ç›®pomé…ç½®</h2><p>ä½¿ç”¨Spring Booté›†æˆRedisï¼Œåªéœ€è¦å°†<code>spring-boot-starter-data-redis</code>å’Œ<code>commons-pool2</code>åŠ åˆ°ä¾èµ–å³å¯</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>commons-pool2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p><code>spring.redis</code>å¼€å¤´çš„éƒ½æ˜¯Spring Bootè‡ªåŠ¨æ³¨å…¥éœ€è¦åŠ è½½çš„é…ç½®</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">redis</span><span class="token punctuation">:</span>    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>    <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>    <span class="token key atrule">password</span><span class="token punctuation">:</span>    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">60000</span>    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>      <span class="token key atrule">pool</span><span class="token punctuation">:</span>        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">8 </span><span class="token comment" spellcheck="true"># è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ é»˜è®¤ 8</span>        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">-1 </span><span class="token comment" spellcheck="true"># è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ é»˜è®¤ -1</span>        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">8 </span><span class="token comment" spellcheck="true"># è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥ é»˜è®¤ 8</span>        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0 </span><span class="token comment" spellcheck="true"># è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ é»˜è®¤ 0</span>  <span class="token key atrule">redis-db-2</span><span class="token punctuation">:</span>    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">2</span>    <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>    <span class="token key atrule">password</span><span class="token punctuation">:</span>    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">60000</span>    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>      <span class="token key atrule">pool</span><span class="token punctuation">:</span>        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">8</span>        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">8</span>        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">8</span>        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span></code></pre><h3 id="RedisConfigure"><a href="#RedisConfigure" class="headerlink" title="RedisConfigure"></a>RedisConfigure</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>configure<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>JsonAutoDetect<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>PropertyAccessor<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span>ObjectMapper<span class="token punctuation">;</span><span class="token keyword">import</span> io<span class="token punctuation">.</span>vavr<span class="token punctuation">.</span>Tuple<span class="token punctuation">;</span><span class="token keyword">import</span> io<span class="token punctuation">.</span>vavr<span class="token punctuation">.</span>Tuple6<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span>StringUtils<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>pool2<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>GenericObjectPoolConfig<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Value<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>EnableCaching<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>RedisConnectionFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>RedisPassword<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>RedisStandaloneConfiguration<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span>JedisClientConfiguration<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span>JedisConnectionFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>lettuce<span class="token punctuation">.</span>LettuceConnectionFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>lettuce<span class="token punctuation">.</span>LettucePoolingClientConfiguration<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span>RedisTemplate<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span>StringRedisTemplate<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span>Jackson2JsonRedisSerializer<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span>StringRedisSerializer<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>Duration<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020-01-10. * * @Value("${spring.redis-db-2.database}") int database, * @Value("${spring.redis-db-2.host}") String host, * @Value("${spring.redis-db-2.port}") int port, * @Value("${spring.redis-db-2.password}") String password, * @Value("${spring.redis-db-2.timeout}") long timeout, * @Value("${spring.redis-db-2.lettuce.pool.max-active}") int maxActive, * @Value("${spring.redis-db-2.lettuce.pool.max-wait}") int maxWait, * @Value("${spring.redis-db-2.lettuce.pool.max-idle}") int maxIdle, * @Value("${spring.redis-db-2.lettuce.pool.min-idle}") int minIdle */</span><span class="token annotation punctuation">@EnableCaching</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfigure</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">/**       * string redis Templateåˆ›å»ºæ“ä½œ       *       * @param database  Redisæ•°æ®åº“ç´¢å¼•       * @param timeout   è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰       * @param maxActive è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²’æœ‰é™åˆ¶ï¼‰       * @param maxWait   è¿æ¥æ± æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²’æœ‰é™åˆ¶ï¼‰       * @param maxIdle   è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥       * @param minIdle   è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥       * @param host      RedisæœåŠ¡åœ°å€       * @param password  RedisæœåŠ¡å¯†ç        * @param port      RedisæœåŠ¡å™¨è¿æ¥ç«¯å£       */</span>      <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"stringRedisTemplate"</span><span class="token punctuation">)</span>      <span class="token keyword">public</span> StringRedisTemplate <span class="token function">stringRedisTemplate</span><span class="token punctuation">(</span>              <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-db-2.database}"</span><span class="token punctuation">)</span>                      <span class="token keyword">int</span> database<span class="token punctuation">,</span>              <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-db-2.timeout:5}"</span><span class="token punctuation">)</span>                      <span class="token keyword">long</span> timeout<span class="token punctuation">,</span>              <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-db-2.lettuce.pool.max-active}"</span><span class="token punctuation">)</span>                      <span class="token keyword">int</span> maxActive<span class="token punctuation">,</span>              <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-db-2.lettuce.pool.max-wait}"</span><span class="token punctuation">)</span>                      <span class="token keyword">int</span> maxWait<span class="token punctuation">,</span>              <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-db-2.lettuce.pool.max-idle}"</span><span class="token punctuation">)</span>                      <span class="token keyword">int</span> maxIdle<span class="token punctuation">,</span>              <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-db-2.lettuce.pool.min-idle}"</span><span class="token punctuation">)</span>                      <span class="token keyword">int</span> minIdle<span class="token punctuation">,</span>              <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-db-2.host}"</span><span class="token punctuation">)</span>                      String host<span class="token punctuation">,</span>              <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-db-2.password}"</span><span class="token punctuation">)</span>                      String password<span class="token punctuation">,</span>              <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-db-2.port}"</span><span class="token punctuation">)</span>                      <span class="token keyword">int</span> port      <span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment" spellcheck="true">// connection config</span>          RedisStandaloneConfiguration configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisStandaloneConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          configuration<span class="token punctuation">.</span><span class="token function">setHostName</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>          configuration<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>          configuration<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>RedisPassword<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          configuration<span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span>database<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// pool config</span>          GenericObjectPoolConfig genericObjectPoolConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericObjectPoolConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          genericObjectPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxTotal</span><span class="token punctuation">(</span>maxActive<span class="token punctuation">)</span><span class="token punctuation">;</span>          genericObjectPoolConfig<span class="token punctuation">.</span><span class="token function">setMinIdle</span><span class="token punctuation">(</span>minIdle<span class="token punctuation">)</span><span class="token punctuation">;</span>          genericObjectPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxIdle</span><span class="token punctuation">(</span>maxIdle<span class="token punctuation">)</span><span class="token punctuation">;</span>          genericObjectPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxWaitMillis</span><span class="token punctuation">(</span>maxWait<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// create connection factory</span>          LettucePoolingClientConfiguration<span class="token punctuation">.</span>LettucePoolingClientConfigurationBuilder builder <span class="token operator">=</span> LettucePoolingClientConfiguration<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          builder<span class="token punctuation">.</span><span class="token function">poolConfig</span><span class="token punctuation">(</span>genericObjectPoolConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>          builder<span class="token punctuation">.</span><span class="token function">commandTimeout</span><span class="token punctuation">(</span>Duration<span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          LettuceConnectionFactory connectionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LettuceConnectionFactory</span><span class="token punctuation">(</span>                  configuration<span class="token punctuation">,</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token punctuation">)</span><span class="token punctuation">;</span>          connectionFactory<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// create redis template</span>          <span class="token keyword">return</span> <span class="token function">createStringRedisTemplate</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token comment" spellcheck="true">/**       * å»ºç«‹StringRedisTemplate       * æ­¤functionä¸èƒ½åŠ  @Bean å¦åˆ™onnectionFactory å°†ä¼šä¸€å¾‹é‡‡ç”¨é¢„è®¾å€¼       */</span>      <span class="token keyword">private</span> StringRedisTemplate <span class="token function">createStringRedisTemplate</span><span class="token punctuation">(</span>              RedisConnectionFactory redisConnectionFactory      <span class="token punctuation">)</span> <span class="token punctuation">{</span>          StringRedisTemplate redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>          redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          redisTemplate<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å…·ä½“é»˜è®¤çš„é…ç½®å¤§å®¶å¯ä»¥å‚è€ƒå¼€ç¯‡è®²è§£çš„ä¸Šä¸€ç¯‡æ–‡ç« ,æˆ‘è¿™é‡Œä»…ä»…ä»‹ç»äº†è‡ªå®šä¹‰é¢å¤–çš„è¿æ¥ä¿¡æ¯ã€‚</p><p>é¦–å…ˆæ˜¯ç¬¬ä¸€ä¸ªè¿æ¥é…ç½®ä¿¡æ¯,è¿™ä¸ªåç§°æ˜¯firstï¼Œä»£è¡¨ç¬¬ä¸€ç»„Redisè¿æ¥æ± é…ç½®ä¿¡æ¯ï¼ŒåŠŸèƒ½åç§°ä¼šå½±å“åˆ°åç»­åœ¨ä½¿ç”¨ä¸Šçš„æ“ä½œï¼Œå¦‚æœæƒ³è¦å¦å¤–å–åçš„è¯å¯ä»¥å°†beanåŠ ä¸Šåç§°@Bean(name=â€æ‚¨çš„åå­—â€â€ï¼‰<br>åœ¨è¿™ä¸ªå‡½æ•°ä¸­æ¥æ”¶åˆ°æ¡†æ¶åŸå‹å»ºç«‹çš„RedisConnectionFactoryä¸ºå‚æ•°ï¼Œå°†è¯¥è¯¥å·¥å‚ä¼ åˆ°æœ€åº•ä¸‹çš„createRedisTemplate()æ¥å»ºç«‹StringRedisTemplateï¼Œæ‰€ä»¥å¦‚æœå¸Œæœ›å»ºç«‹çš„æ˜¯å…¶ä»–RedisTemplateè¿æ¥æ¨¡æ¿çš„è¯å°±å¯ä»¥ä¿®æ”¹createRedisTemplate()<br>Redisè¿æ¥æ± ,å¦‚æ­¤ä¸€æ¥è¦æˆ‘ä»¬å¼€å‘è¿‡ç¨‹ä¸­æ“ä½œæ—¶å¿˜äº†æ ‡æ³¨è¦ä½¿ç”¨Redisçš„è¯ï¼Œä¾¿ä¼šé‡‡ç”¨è¿™é»˜è®¤çš„è¿æ¥æ± ,<br>æ¥ç€æ¥çœ‹ç¬¬äºŒä¸ªåŠŸèƒ½ï¼Œåœ¨è¿™ä¸ªåŠŸèƒ½ä¸­å¯ä»¥çœ‹åˆ°è®¾å®šæ¡£ä¸­ç¬¬äºŒæ¡è¿æ¥æ± çš„å‚æ•°ï¼Œå‰é¢æåˆ°æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹è¿æ¥æ± çš„åœ°å€ä¿¡æ¯ï¼Œæ‰€ä»¥å…³äºpoolç­‰ç›¸å…³è®¾å®šè¿˜æ˜¯æŠ“ç¬¬ä¸€æ¡è¿æ¥æ± çš„ï¼Œè¿™è¾¹å°±çœ‹å¤§å®¶æœ‰æ²¡æœ‰éœ€è¦è‡ªè¡Œä¿®æ”¹ã€œ<br>è®¾ç½®å®Œæ¯•ç¬¬äºŒæ¡è¿æ¥æ± çš„è®¾ç½®åï¼Œè¿›è¡Œçš„äº‹æƒ…å®é™…ä¸Šå°±æ˜¯è‡ªå·±å»ºç«‹è¿æ¥å·¥å‚ï¼Œå…ˆè®¾ç½®å¥½Configç›¸å…³å¯¹è±¡ï¼Œç„¶ååˆ›å»ºLettuceConnectionFactoryå¯¹è±¡ï¼Œæœ€åå’Œç¬¬ä¸€ä¸ªåŠŸèƒ½ç›¸åŒï¼Œå°†å·¥å‚å¼•å…¥createRedisTemplate()æ¥ç”ŸæˆRedisTemplateè¿æ¥æ± <br>æ‰€ä»¥å®é™…ä¸Šæˆ‘ä»¬è¦åšçš„äº‹æƒ…å°±æ˜¯ï¼Œè®¾ç½®å®šä¹‰çš„è¿æ¥æ± å°±è‡ªå®šä¹‰çš„factoryå»ºç«‹RedisTemplateç‰©ä»¶æ¥æ“ä½œï¼Œé¢å¤–çš„è¿çº¿å°±è¿›å…¥è®¾å®šæ¡£åï¼Œè‡ªå·±æ·»åŠ factoryæ¥ç”ŸæˆRedisTemplateè¿æ¥æ¨¡æ¿ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ã€œ<br>è¿æ¥æ± å»ºç«‹å¥½åå°±æ˜¯å®é™…çš„æ“ä½œå•¦ï¼Œæ“ä½œæ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œå°±ç”¨@Autowiredå°±å¥½ï¼Œåªæ˜¯è¦å¸¦åç§°è®©Spring BootçŸ¥é“ä½ è¦ä½¿ç”¨çš„æ˜¯å…¶ä¸­RedisTemplateå“ªä¸ªè¿æ¥æ± å³å¯</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"first"</span><span class="token punctuation">)</span>StringRedisTemplate firstRedisTemplate<span class="token punctuation">;</span><span class="token annotation punctuation">@Autowired</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"stringRedisTemplate"</span><span class="token punctuation">)</span>StringRedisTemplate secondRedisTemplate<span class="token punctuation">;</span></code></pre><p>ç¤ºä¾‹ä»£ç ï¼š<a href="https://github.com/xiaomozhang/personal-life-example/tree/master/example-redis">https://github.com/xiaomozhang/personal-life-example/tree/master/example-redis</a></p>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> SpringBoot </tag>
            
            <tag> Lettuce </tag>
            
            <tag> multiple RedisTemplate </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Boot 2.xä½¿ç”¨mybatis</title>
      <link href="2021/02/01/spring-boot-mybatis/"/>
      <url>2021/02/01/spring-boot-mybatis/</url>
      
        <content type="html"><![CDATA[<p>ormæ¡†æ¶çš„æœ¬è´¨æ˜¯ç®€åŒ–ç¼–ç¨‹ä¸­æ“ä½œæ•°æ®åº“çš„ç¼–ç ï¼Œå‘å±•åˆ°ç°åœ¨åŸºæœ¬ä¸Šå°±å‰©ä¸¤å®¶äº†ï¼Œä¸€ä¸ªæ˜¯å®£ç§°å¯ä»¥ä¸ç”¨å†™ä¸€å¥SQLçš„hibernateï¼Œä¸€ä¸ªæ˜¯å¯ä»¥çµæ´»è°ƒè¯•åŠ¨æ€sqlçš„mybatis,ä¸¤è€…å„æœ‰ç‰¹ç‚¹ï¼Œåœ¨ä¼ä¸šçº§ç³»ç»Ÿå¼€å‘ä¸­å¯ä»¥æ ¹æ®éœ€æ±‚çµæ´»ä½¿ç”¨ã€‚</p><h1 id="ä½¿ç”¨æ³¨è§£ç‰ˆ"><a href="#ä½¿ç”¨æ³¨è§£ç‰ˆ" class="headerlink" title="ä½¿ç”¨æ³¨è§£ç‰ˆ"></a>ä½¿ç”¨æ³¨è§£ç‰ˆ</h1><h2 id="pomä¾èµ–"><a href="#pomä¾èµ–" class="headerlink" title="pomä¾èµ–"></a>pomä¾èµ–</h2><p>è¿™é‡Œä½¿ç”¨æœ€æ–°ç‰ˆspring bootã€2.0.4.RELEASEã€‘</p><pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">></span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.zz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-sample-mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modules</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">></span></span>mybatis-xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">></span></span>mybatis-annotation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modules</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">></span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>spring-boot-sample-mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">></span></span>spring-boot-sample-mybatis project for Spring Boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.0.4.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/></span></span> <span class="token comment" spellcheck="true">&lt;!-- lookup parent from repository --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.reporting.outputEncoding</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.reporting.outputEncoding</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mybatis-spring.version</span><span class="token punctuation">></span></span>1.3.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mybatis-spring.version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logback.version</span><span class="token punctuation">></span></span>1.2.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logback.version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- webç»„ä»¶ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- mybatis-spring-boot-starter --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>${mybatis-spring.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- MySQL é©±åŠ¨--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">></span></span></code></pre><h2 id="application-ymlæ–‡ä»¶"><a href="#application-ymlæ–‡ä»¶" class="headerlink" title="application.ymlæ–‡ä»¶"></a>application.ymlæ–‡ä»¶</h2><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> life<span class="token punctuation">-</span>spring<span class="token punctuation">-</span>sample<span class="token punctuation">-</span>mybatis  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>10100/life<span class="token punctuation">-</span>mybatis<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding</span>=utf<span class="token punctuation">-</span>8<span class="token important">&amp;useSSL</span>=false    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver    <span class="token key atrule">username</span><span class="token punctuation">:</span> root    <span class="token key atrule">password</span><span class="token punctuation">:</span> root<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>  <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> com.zz.entity<span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span></code></pre><h2 id="å®ä½“å¯¹è±¡"><a href="#å®ä½“å¯¹è±¡" class="headerlink" title="å®ä½“å¯¹è±¡"></a>å®ä½“å¯¹è±¡</h2><p>è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œä½¿ç”¨äº†<a href="https://projectlombok.org/">lombok</a>ï¼Œä¸äº†è§£çš„åŒå­¦å¯ä»¥è‡ªå·±Googleçœ‹ä¸€ä¸‹</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">long</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>    <span class="token keyword">private</span> Date birthday<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> deptId<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="mapper"><a href="#mapper" class="headerlink" title="mapper"></a>mapper</h2><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Repository</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EmployeeMapper</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * ä½¿ç”¨@Resultsæ³¨è§£åšå­—æ®µæ˜ å°„     *     * @return     */</span>    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from employee"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Results</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">"deptId"</span><span class="token punctuation">,</span> column <span class="token operator">=</span> <span class="token string">"dept_id"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    List<span class="token operator">&lt;</span>Employee<span class="token operator">></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from employee where id=#{id}"</span><span class="token punctuation">)</span>    Employee <span class="token function">findById</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">"update employee set name=#{name},birthday=#{birthday},age=#{age},dept_id=#{deptId} where id=#{id}"</span><span class="token punctuation">)</span>    <span class="token keyword">int</span> <span class="token function">updateById</span><span class="token punctuation">(</span>Employee employee<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Delete</span><span class="token punctuation">(</span><span class="token string">"delete from employee where id=#{id}"</span><span class="token punctuation">)</span>    <span class="token keyword">int</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">"insert into employee(name,birthday,age,dept_id) values(#{name},#{birthday},#{age},#{deptId})"</span><span class="token punctuation">)</span>    <span class="token keyword">int</span> <span class="token function">save</span><span class="token punctuation">(</span>Employee employee<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="controlleré€šè¿‡å‰ç«¯å®Œæˆå¢åˆ æ”¹æŸ¥"><a href="#controlleré€šè¿‡å‰ç«¯å®Œæˆå¢åˆ æ”¹æŸ¥" class="headerlink" title="controlleré€šè¿‡å‰ç«¯å®Œæˆå¢åˆ æ”¹æŸ¥"></a>controlleré€šè¿‡å‰ç«¯å®Œæˆå¢åˆ æ”¹æŸ¥</h2><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/api/emp"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmployeeController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> EmployeeMapper employeeMapper<span class="token punctuation">;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> List<span class="token operator">&lt;</span>Employee<span class="token operator">></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        List<span class="token operator">&lt;</span>Employee<span class="token operator">></span> list <span class="token operator">=</span> employeeMapper<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">-</span><span class="token operator">></span> log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"emp:{}"</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> list<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/{id}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> Employee <span class="token function">findById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Employee employee <span class="token operator">=</span> employeeMapper<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"emp:{}"</span><span class="token punctuation">,</span> employee<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> employee<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> RequestMethod<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> Employee employee<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> employeeMapper<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>employee<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/{id}"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> RequestMethod<span class="token punctuation">.</span>DELETE<span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> employeeMapper<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/{id}"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> RequestMethod<span class="token punctuation">.</span>PUT<span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">updateById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token keyword">long</span> id<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestBody</span> Employee employee<span class="token punctuation">)</span> <span class="token punctuation">{</span>        employee<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> employeeMapper<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>employee<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¿è¡Œé¡¹ç›®ä»¥åå°±å¯ä»¥ä½¿ç”¨postmanå·¥å…·è¿›è¡Œæ¥å£è¯·æ±‚æµ‹è¯•ï¼Œå¯¹åº”çš„ä½¿ç”¨postã€getã€putç­‰è¯·æ±‚ï¼Œå¯ä»¥è‡ªè¡Œæµ‹è¯•</p><pre class=" language-http"><code class="language-http"><span class="token header-name keyword">localhost:</span>8080/api/emp/</code></pre><p>response</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">[</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"äºŒä¸«"</span><span class="token punctuation">,</span>        <span class="token property">"age"</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span>        <span class="token property">"birthday"</span><span class="token operator">:</span> <span class="token string">"2000-01-01T00:00:00.000+0000"</span><span class="token punctuation">,</span>        <span class="token property">"deptId"</span><span class="token operator">:</span> <span class="token number">1</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"å°å¼º "</span><span class="token punctuation">,</span>        <span class="token property">"age"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token property">"birthday"</span><span class="token operator">:</span> <span class="token string">"2018-06-01T08:33:52.000+0000"</span><span class="token punctuation">,</span>        <span class="token property">"deptId"</span><span class="token operator">:</span> <span class="token number">2</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"å²å¡”å…‹ "</span><span class="token punctuation">,</span>        <span class="token property">"age"</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>        <span class="token property">"birthday"</span><span class="token operator">:</span> <span class="token string">"2018-06-01T08:33:52.000+0000"</span><span class="token punctuation">,</span>        <span class="token property">"deptId"</span><span class="token operator">:</span> <span class="token number">3</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"å›ä¸´åŸ "</span><span class="token punctuation">,</span>        <span class="token property">"age"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>        <span class="token property">"birthday"</span><span class="token operator">:</span> <span class="token string">"2018-06-01T08:33:52.000+0000"</span><span class="token punctuation">,</span>        <span class="token property">"deptId"</span><span class="token operator">:</span> <span class="token number">4</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ä¹Œé¸¦ "</span><span class="token punctuation">,</span>        <span class="token property">"age"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>        <span class="token property">"birthday"</span><span class="token operator">:</span> <span class="token string">"2018-06-01T08:33:52.000+0000"</span><span class="token punctuation">,</span>        <span class="token property">"deptId"</span><span class="token operator">:</span> <span class="token number">1</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"é¾™æ¯ "</span><span class="token punctuation">,</span>        <span class="token property">"age"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>        <span class="token property">"birthday"</span><span class="token operator">:</span> <span class="token string">"2018-06-01T08:33:52.000+0000"</span><span class="token punctuation">,</span>        <span class="token property">"deptId"</span><span class="token operator">:</span> <span class="token number">4</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"æåˆ©æ˜‚ "</span><span class="token punctuation">,</span>        <span class="token property">"age"</span><span class="token operator">:</span> <span class="token number">21</span><span class="token punctuation">,</span>        <span class="token property">"birthday"</span><span class="token operator">:</span> <span class="token string">"2018-06-01T08:33:52.000+0000"</span><span class="token punctuation">,</span>        <span class="token property">"deptId"</span><span class="token operator">:</span> <span class="token number">5</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"å°èŠ±"</span><span class="token punctuation">,</span>        <span class="token property">"age"</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>        <span class="token property">"birthday"</span><span class="token operator">:</span> <span class="token string">"2000-01-01T00:00:00.000+0000"</span><span class="token punctuation">,</span>        <span class="token property">"deptId"</span><span class="token operator">:</span> <span class="token number">0</span>    <span class="token punctuation">}</span><span class="token punctuation">]</span></code></pre><h1 id="ä½¿ç”¨xmlç‰ˆ"><a href="#ä½¿ç”¨xmlç‰ˆ" class="headerlink" title="ä½¿ç”¨xmlç‰ˆ"></a>ä½¿ç”¨xmlç‰ˆ</h1><p>å‰é¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨æ³¨è§£ç‰ˆçš„mybatiså¯ä»¥ä¸€è¡Œxmlæ–‡ä»¶éƒ½ä¸å†™ï¼Œä½†æ˜¯è¿™ä¸ªæ‰€æœ‰çš„sqléƒ½ç¡¬ç¼–ç åœ¨mapperæ–‡ä»¶ä¸­ï¼Œå¯¹åæœŸçš„ç»´æŠ¤å’Œå¤ç”¨ä¸æ˜¯ç‰¹åˆ«æ–¹ä¾¿ï¼Œæ‰€æœ‰æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ä½¿ç”¨xmlå®Œæˆå¢åˆ æ”¹æŸ¥</p><h2 id="application-ymlæ–‡ä»¶-1"><a href="#application-ymlæ–‡ä»¶-1" class="headerlink" title="application.ymlæ–‡ä»¶"></a>application.ymlæ–‡ä»¶</h2><p>è¿™é‡Œå’Œä½¿ç”¨æ³¨è§£çš„åŒºåˆ«å°±æ˜¯éœ€è¦æŒ‡å®šmapperæ–‡ä»¶çš„ä½ç½®ï¼Œä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬è¿˜æœ‰ä¸€å¼ deptè¡¨ï¼Œè¿™æ¬¡ä½¿ç”¨deptè¡¨æ¥è¿›è¡Œæ¼”ç¤º</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> life<span class="token punctuation">-</span>spring<span class="token punctuation">-</span>sample<span class="token punctuation">-</span>mybatis  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>10100/life<span class="token punctuation">-</span>mybatis<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding</span>=utf<span class="token punctuation">-</span>8<span class="token important">&amp;useSSL</span>=false    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver    <span class="token key atrule">username</span><span class="token punctuation">:</span> root    <span class="token key atrule">password</span><span class="token punctuation">:</span> root<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># è®¾ç½®å®ä½“å¯¹è±¡çš„ä½ç½®</span>  <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> com.zz.entity  <span class="token comment" spellcheck="true"># è®¾ç½®mapperæ–‡ä»¶å­˜æ”¾çš„ä½ç½®ï¼Œè¿™é‡Œåœ¨classpathç›®å½•ä¸‹çš„mybatisæ–‡ä»¶å¤¹ä¸­</span>  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mybatis/*.xml<span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8082</span></code></pre><h2 id="deptå®ä½“å¯¹è±¡"><a href="#deptå®ä½“å¯¹è±¡" class="headerlink" title="deptå®ä½“å¯¹è±¡"></a>deptå®ä½“å¯¹è±¡</h2><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dept</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">long</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="deptMapperå¯¹è±¡"><a href="#deptMapperå¯¹è±¡" class="headerlink" title="deptMapperå¯¹è±¡"></a>deptMapperå¯¹è±¡</h2><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è¿™é‡Œåªæœ‰mapperæ¥å£ä¸­çš„æ–¹æ³•å£°æ˜ï¼Œæ²¡æœ‰åœ¨ä¸Šé¢è¿›è¡Œæ³¨è§£æ“ä½œï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦ç¼–å†™mapper.xmlæ–‡ä»¶è¿›è¡Œæ•°æ®åº“æ“ä½œï¼Œåœ¨resources/mybatisæ–‡ä»¶å¤¹ä¸‹æ–°å»ºDeptMapper.xmlæ–‡ä»¶</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Repository</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DeptMapper</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> <span class="token function">save</span><span class="token punctuation">(</span>Dept dept<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">updateById</span><span class="token punctuation">(</span>Dept dept<span class="token punctuation">)</span><span class="token punctuation">;</span>    List<span class="token operator">&lt;</span>Dept<span class="token operator">></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Dept <span class="token function">findById</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="mapper-xmlæ–‡ä»¶"><a href="#mapper-xmlæ–‡ä»¶" class="headerlink" title="mapper.xmlæ–‡ä»¶"></a>mapper.xmlæ–‡ä»¶</h2><pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" ></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.zz.mapper.DeptMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sql</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>base_column<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sql</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>save<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        insert into dept(name) values (#name)    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>updateById<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        update dept set name=#{name} where id=#{id}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deleteById<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        delete from dept where id=#{id}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delete</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>findAll<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.zz.entity.Dept<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select * from dept    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>findById<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.zz.entity.Dept<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select * from dept where id=#{id}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span></code></pre><h2 id="æ§åˆ¶å™¨å¯¹è±¡"><a href="#æ§åˆ¶å™¨å¯¹è±¡" class="headerlink" title="æ§åˆ¶å™¨å¯¹è±¡"></a>æ§åˆ¶å™¨å¯¹è±¡</h2><p>è¿™é‡Œåªæ˜¯ä¸ºäº†æ¼”ç¤ºä½¿ç”¨xmlæ“ä½œï¼Œcontrollerä¸­å°±ä¸ä¸€ä¸€å†™å‡ºæ‰€æœ‰çš„æ¥å£ï¼Œå…¶å®å’Œä½¿ç”¨æ³¨è§£å®Œå…¨æ˜¯ä¸€æ ·çš„</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/api/dept"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeptController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> DeptMapper deptMapper<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> List<span class="token operator">&lt;</span>Dept<span class="token operator">></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> deptMapper<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¿™é‡Œä½¿ç”¨postmanå·¥å…·è¿›è¡Œç®€å•çš„æµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„éƒ¨é—¨æ•°æ®å…¨éƒ¨è¢«æŸ¥å‡ºæ¥äº†</p><pre class=" language-http"><code class="language-http"><span class="token header-name keyword">localhost:</span>8082/api/dept/</code></pre><p>response</p><pre class=" language-java"><code class="language-java"><span class="token punctuation">[</span>    <span class="token punctuation">{</span>        <span class="token string">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"ä¿¡æ¯æŠ€æœ¯éƒ¨"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token string">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>        <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"äººäº‹éƒ¨"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token string">"id"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>        <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"PCBäº‹ä¸šéƒ¨"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token string">"id"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>        <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"æ— çº¿ç»ˆç«¯éƒ¨"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token string">"id"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>        <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"æµ‹è¯•éƒ¨"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token string">"id"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>        <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"åå‹¤ä¿éšœéƒ¨"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token string">"id"</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>        <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"é¸¡çŠ¬ä¸å®éƒ¨"</span>    <span class="token punctuation">}</span><span class="token punctuation">]</span></code></pre><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ul><li>å…¶å®ä½¿ç”¨spring boot-1.xç‰ˆæœ¬å’Œ2.xç‰ˆæœ¬æ“ä½œåŸºæœ¬æ˜¯ä¸€è‡´çš„</li><li>æ³¨è§£æ–¹ä¾¿å•è¡¨çš„æ“ä½œï¼Œxmlé€‚ç”¨äºå¤æ‚çš„æ“ä½œï¼Œå„æœ‰ä¼˜ç‚¹ï¼Œæ²¡æœ‰æœ€å¥½çš„ï¼Œåªæœ‰æœ€åˆé€‚çš„</li></ul><p>å®Œæ•´ä»£ç é“¾æ¥<a href="https://github.com/TyCoding/spring-boot.git">github</a></p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="http://www.mybatis.org/mybatis-3/zh/index.html">mybatis</a></p>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>logstashæ—¥æœŸæ’ä»¶æ”¯æŒçº³ç§’</title>
      <link href="2020/12/18/logstash-filter-date-compile/"/>
      <url>2020/12/18/logstash-filter-date-compile/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘é¡¹ç›®ä¸Šé‡åˆ°æ—¶é—´ä¸ºçº³ç§’çš„æƒ…å†µï¼Œç”¨åˆ°logstashè§£ææ—¶æ˜¯ä¸æ”¯æŒçº³ç§’çš„ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªæ€è·¯å°±æ˜¯è‡ªå·±ä¿®æ”¹logstashçš„æ—¥æœŸæ’ä»¶ï¼Œè®©ä»–æ”¯æŒçº³ç§’ï¼Œå…·ä½“æ¶‰åŠçš„æ’ä»¶æ˜¯<a href="https://github.com/logstash-plugins/logstash-filter-date">logstash-filter-date</a></p><h2 id="å‰æœŸå‡†å¤‡"><a href="#å‰æœŸå‡†å¤‡" class="headerlink" title="å‰æœŸå‡†å¤‡"></a>å‰æœŸå‡†å¤‡</h2><ul><li>ä¸‹è½½æºä»£ç </li><li>ä¸‹è½½logstash</li><li>å®‰è£…å¿…è¦ç¼–è¯‘ç»„ä»¶</li><li>ä¿®æ”¹æºä»£ç </li><li>æ‰“åŒ…ç¼–è¯‘</li><li>æ›¿æ¢é»˜è®¤çš„<code>logstash-filter-date-${version}.jar</code></li><li>æµ‹è¯•çº³ç§’è§£æ</li></ul><h2 id="ä¸‹è½½æºç "><a href="#ä¸‹è½½æºç " class="headerlink" title="ä¸‹è½½æºç "></a>ä¸‹è½½æºç </h2><pre class=" language-shell"><code class="language-shell">cd ~/share/tmp# å¦‚æœä¸‹è½½å¤ªæ…¢,å¯ä»¥ç›´æ¥å°†ä»£ç åŒ…downloadä¸‹è½½å¯¼å…¥å¼€å‘å·¥å…·æˆ–åœ¨ideaä¸­ä½¿ç”¨tokenç™»é™†githubè´¦æˆ·,ç„¶ååœ¨ä½¿ç”¨ideaå·¥å…·cloneä»£ç ä¼šè·Ÿå¿«ä¸€äº›,# æ•™ç¨‹åœ°å€: https://blog.csdn.net/SR02020/article/details/106882205git clone https://github.com/logstash-plugins/logstash-filter-date.git# åˆ‡æ¢åˆ°æœ€æ–°çš„tagåˆ†æ”¯ï¼Œç›®å‰æ˜¯v3.1.9git checkout -b v3.1.9 v3.1.9</code></pre><h2 id="ä¸‹è½½logstash"><a href="#ä¸‹è½½logstash" class="headerlink" title="ä¸‹è½½logstash"></a>ä¸‹è½½logstash</h2><p>å› ä¸ºæˆ‘ç”¨åˆ°çš„logstashç‰ˆæœ¬ä¸º<code>7.9.3</code>ï¼Œæ‰€ä»¥ä¸‹è½½çš„logstashä¹Ÿæ˜¯<code>7.9.3</code>ï¼Œç†è®ºä¸Šç¼–è¯‘å‡ºæ¥çš„<code>logstash-filter-date</code>æ˜¯é€šç”¨çš„</p><pre class=" language-shell"><code class="language-shell">cd ~/share/tmpwget https://artifacts.elastic.co/downloads/logstash/logstash-7.9.3.tar.gz</code></pre><h2 id="å®‰è£…ç¼–è¯‘ç»„ä»¶"><a href="#å®‰è£…ç¼–è¯‘ç»„ä»¶" class="headerlink" title="å®‰è£…ç¼–è¯‘ç»„ä»¶"></a>å®‰è£…ç¼–è¯‘ç»„ä»¶</h2><ul><li><p>å®‰è£…jruby</p><pre class=" language-shell"><code class="language-shell">https://www.ruby-lang.org/zh_cn/downloads/</code></pre></li><li><p>å®‰è£…rvm</p><pre class=" language-shell"><code class="language-shell">https://rvm.io/</code></pre></li><li><p>å®‰è£…rbenv</p><pre class=" language-shell"><code class="language-shell">https://ruby-china.org/wiki/rbenv-guide</code></pre></li></ul><h2 id="ä¿®æ”¹æºä»£ç "><a href="#ä¿®æ”¹æºä»£ç " class="headerlink" title="ä¿®æ”¹æºä»£ç "></a>ä¿®æ”¹æºä»£ç </h2><h3 id="å°†æºä»£ç å¯¼å…¥idea"><a href="#å°†æºä»£ç å¯¼å…¥idea" class="headerlink" title="å°†æºä»£ç å¯¼å…¥idea"></a>å°†æºä»£ç å¯¼å…¥idea</h3><p>æºç å¯¼å…¥ideaä¼šä¸‹è½½gradleç»„ä»¶å’Œå¯¹åº”çš„ä¾èµ–ï¼Œè¿™é‡Œéœ€è¦ä¿è¯ç½‘ç»œç•…é€šã€‚</p><h3 id="æ·»åŠ çº³ç§’è§£æ"><a href="#æ·»åŠ çº³ç§’è§£æ" class="headerlink" title="æ·»åŠ çº³ç§’è§£æ"></a>æ·»åŠ çº³ç§’è§£æ</h3><p>æ‰¾åˆ°<code>src/main/java/org/logstash/filters/parser</code>åŒ…ä½ç½®ï¼Œæ–°å»ºä¸€ä¸ªçº³ç§’è§£æç±»</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/* * Licensed to Elasticsearch under one or more contributor * license agreements. See the NOTICE file distributed with * this work for additional information regarding copyright * ownership. Elasticsearch licenses this file to you under * the Apache License, Version 2.0 (the "License"); you may * not use this file except in compliance with the License. * You may obtain a copy of the License at * *    http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, * software distributed under the License is distributed on an * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY * KIND, either express or implied.  See the License for the * specific language governing permissions and limitations * under the License. */</span><span class="token keyword">package</span> org<span class="token punctuation">.</span>logstash<span class="token punctuation">.</span>filters<span class="token punctuation">.</span>parser<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>joda<span class="token punctuation">.</span>time<span class="token punctuation">.</span>Instant<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>math<span class="token punctuation">.</span>BigDecimal<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020/12/12. */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnixNanosecondParser</span> <span class="token keyword">implements</span> <span class="token class-name">TimestampParser</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">long</span> MAX_EPOCH_NANOSECOND <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> Integer<span class="token punctuation">.</span>MAX_VALUE <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Instant <span class="token function">parse</span><span class="token punctuation">(</span>String value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">parse</span><span class="token punctuation">(</span>Long<span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Instant <span class="token function">parse</span><span class="token punctuation">(</span>Long value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Instant</span><span class="token punctuation">(</span>value <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Instant <span class="token function">parse</span><span class="token punctuation">(</span>Double value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// XXX: Should we accept a double?</span>        <span class="token keyword">return</span> <span class="token function">parse</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Instant <span class="token function">parseWithTimeZone</span><span class="token punctuation">(</span>String value<span class="token punctuation">,</span> String timezone<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">parse</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Instant <span class="token function">parse</span><span class="token punctuation">(</span>BigDecimal value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">long</span> lv <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>lv <span class="token operator">></span> MAX_EPOCH_NANOSECOND<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Cannot parse date for value larger than UNIX NS maximum seconds"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Instant</span><span class="token punctuation">(</span>lv <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h5 id="åœ¨è§£æå·¥å‚ç±»æ·»åŠ çº³ç§’è§£æ"><a href="#åœ¨è§£æå·¥å‚ç±»æ·»åŠ çº³ç§’è§£æ" class="headerlink" title="åœ¨è§£æå·¥å‚ç±»æ·»åŠ çº³ç§’è§£æ"></a>åœ¨è§£æå·¥å‚ç±»æ·»åŠ çº³ç§’è§£æ</h5><p><code>org.logstash.filters.parser.TimestampParserFactory</code></p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/* * Licensed to Elasticsearch under one or more contributor * license agreements. See the NOTICE file distributed with * this work for additional information regarding copyright * ownership. Elasticsearch licenses this file to you under * the Apache License, Version 2.0 (the "License"); you may * not use this file except in compliance with the License. * You may obtain a copy of the License at * *    http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, * software distributed under the License is distributed on an * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY * KIND, either express or implied.  See the License for the * specific language governing permissions and limitations * under the License. */</span><span class="token keyword">package</span> org<span class="token punctuation">.</span>logstash<span class="token punctuation">.</span>filters<span class="token punctuation">.</span>parser<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>joda<span class="token punctuation">.</span>time<span class="token punctuation">.</span>DateTimeZone<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Locale<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TimestampParserFactory</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> DateTimeZone timezone<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String ISO8601 <span class="token operator">=</span> <span class="token string">"ISO8601"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String UNIX <span class="token operator">=</span> <span class="token string">"UNIX"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String UNIX_MS <span class="token operator">=</span> <span class="token string">"UNIX_MS"</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * æ–°å¢çº³ç§’     */</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String UNIX_NS <span class="token operator">=</span> <span class="token string">"UNIX_NS"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String TAI64N <span class="token operator">=</span> <span class="token string">"TAI64N"</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/*     * zone is a String because it can be dynamic and come from the event while we parse it.     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> TimestampParser <span class="token function">makeParser</span><span class="token punctuation">(</span>String pattern<span class="token punctuation">,</span> Locale locale<span class="token punctuation">,</span> String zone<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>locale <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            locale <span class="token operator">=</span> Locale<span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        String tz <span class="token operator">=</span> zone<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>tz <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            tz <span class="token operator">=</span> DateTimeZone<span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>zone<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"%{"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            tz <span class="token operator">=</span> null<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>pattern<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> ISO8601<span class="token operator">:</span> <span class="token comment" spellcheck="true">// Short-hand for a few ISO8601-ish formats</span>                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CasualISO8601Parser</span><span class="token punctuation">(</span>tz<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> UNIX<span class="token operator">:</span> <span class="token comment" spellcheck="true">// Unix epoch in seconds</span>                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UnixEpochParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> TAI64N<span class="token operator">:</span> <span class="token comment" spellcheck="true">// TAI64N format</span>                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TAI64NParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> UNIX_MS<span class="token operator">:</span> <span class="token comment" spellcheck="true">// Unix epoch in milliseconds</span>                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UnixMillisEpochParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> UNIX_NS<span class="token operator">:</span> <span class="token comment" spellcheck="true">// Unix epoch in nanoseconds</span>                <span class="token comment" spellcheck="true">// çº³ç§’è§£æç±»</span>                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UnixNanosecondParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">default</span><span class="token operator">:</span>                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JodaParser</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> locale<span class="token punctuation">,</span> tz<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> TimestampParser <span class="token function">makeParser</span><span class="token punctuation">(</span>String pattern<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">makeParser</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> <span class="token punctuation">(</span>Locale<span class="token punctuation">)</span> null<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> TimestampParser <span class="token function">makeParser</span><span class="token punctuation">(</span>String pattern<span class="token punctuation">,</span> String locale<span class="token punctuation">,</span> String zone<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">makeParser</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> locale <span class="token operator">==</span> null <span class="token operator">?</span> null <span class="token operator">:</span> Locale<span class="token punctuation">.</span><span class="token function">forLanguageTag</span><span class="token punctuation">(</span>locale<span class="token punctuation">)</span><span class="token punctuation">,</span> zone<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="æ³¨é‡Šä¸€ä¸ªå•å…ƒæµ‹è¯•"><a href="#æ³¨é‡Šä¸€ä¸ªå•å…ƒæµ‹è¯•" class="headerlink" title="æ³¨é‡Šä¸€ä¸ªå•å…ƒæµ‹è¯•"></a>æ³¨é‡Šä¸€ä¸ªå•å…ƒæµ‹è¯•</h3><p>å› ä¸ºè¯¥ç±»ä¼šå› ä¸ºæ‰¾ä¸åˆ°æ–¹æ³•è€Œå¯¼è‡´ç¼–è¯‘æŠ¥é”™ï¼Œå¯ä»¥æ³¨é‡Šå¿½ç•¥<code>org.logstash.filters.DateFilterTest#commonAssertions</code></p><pre class=" language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">commonAssertions</span><span class="token punctuation">(</span>Event event<span class="token punctuation">,</span> ParseExecutionResult code<span class="token punctuation">,</span> String expected<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">/*Assert.assertSame(ParseExecutionResult.SUCCESS, code);        String actual = ((Timestamp) event.getField("[result_ts]")).toIso8601();        Assert.assertTrue(String.format("Unequal - expected: %s, actual: %s", expected, actual), expected.equals(actual));*/</span><span class="token punctuation">}</span></code></pre><h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><h4 id="build-gradle"><a href="#build-gradle" class="headerlink" title="build.gradle"></a>build.gradle</h4><p>ä¿®æ”¹build.gradleæ–‡ä»¶ä¸­63ã€66ä¸¤è¡Œçš„logstash-coreé…ç½®ï¼Œæ”¹ä¸ºä¸‹è½½çš„æ ‡å‡†<code>logstash/logstash-core</code>ç›®å½•</p><pre class=" language-groovy"><code class="language-groovy"><span class="token comment" spellcheck="true">// é»˜è®¤é…ç½®</span>testCompile <span class="token function">fileTree</span><span class="token punctuation">(</span>dir<span class="token punctuation">:</span> logstashCoreGemPath<span class="token punctuation">,</span> include<span class="token punctuation">:</span> <span class="token string">'**/*.jar'</span><span class="token punctuation">)</span>compileOnly <span class="token function">fileTree</span><span class="token punctuation">(</span>dir<span class="token punctuation">:</span> logstashCoreGemPath<span class="token punctuation">,</span> include<span class="token punctuation">:</span> <span class="token string">'**/*.jar'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// ä¿®æ”¹ä¸ºä¸‹è½½çš„logstash/logstash-coreçš„ç»å¯¹è·¯å¾„</span>testCompile <span class="token function">fileTree</span><span class="token punctuation">(</span>dir<span class="token punctuation">:</span> <span class="token string">'/Users/xiaozhangge/share/software/logstash-7.9.3/logstash-core'</span><span class="token punctuation">,</span> include<span class="token punctuation">:</span> <span class="token string">'**/*.jar'</span><span class="token punctuation">)</span>compileOnly <span class="token function">fileTree</span><span class="token punctuation">(</span>dir<span class="token punctuation">:</span> <span class="token string">'/Users/xiaozhangge/share/software/logstash-7.9.3/logstash-core'</span><span class="token punctuation">,</span> include<span class="token punctuation">:</span> <span class="token string">'**/*.jar'</span><span class="token punctuation">)</span></code></pre><h4 id="Rakefile"><a href="#Rakefile" class="headerlink" title="Rakefile"></a>Rakefile</h4><p>ä¿®æ”¹Rakefileæ–‡ä»¶çš„lsc_pathé…ç½®ä¸º<code>logstash/logstash-core</code>ç›®å½•</p><pre class=" language-groovy"><code class="language-groovy"><span class="token comment" spellcheck="true">// é»˜è®¤é…ç½®</span>lsc_path <span class="token operator">=</span> `bundle show logstash<span class="token operator">-</span>core`<span class="token comment" spellcheck="true">// ä¿®æ”¹ä¸ºä¸‹è½½çš„logstash/logstash-coreçš„ç»å¯¹è·¯å¾„</span>lsc_path <span class="token operator">=</span> `<span class="token string">/Users/</span>xiaozhangge<span class="token string">/share/</span>software<span class="token string">/logstash-7.9.3/</span>logstash<span class="token operator">-</span>core`</code></pre><h2 id="æ‰“åŒ…ç¼–è¯‘"><a href="#æ‰“åŒ…ç¼–è¯‘" class="headerlink" title="æ‰“åŒ…ç¼–è¯‘"></a>æ‰“åŒ…ç¼–è¯‘</h2><p>æ‰§è¡Œgradleçš„buildä»»åŠ¡ï¼Œç”Ÿæˆæ–°çš„<code>logstash-date-filter-{version}.jar</code>ï¼Œæ–°ç”Ÿæˆæ–‡ä»¶ç›®å½•å¦‚ä¸‹ï¼š</p><pre class=" language-shell"><code class="language-shell"># æœ‰ä¸ªå¥½å¥‡çš„æ˜¯æ˜æ˜æ˜¯3.1.9çš„tagåŒ…ï¼Œä½†æ˜¯åœ¨æºç é‡Œé¢ç¡®å®3.1.6çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥æ‰“åŒ…å‡ºæ¥ä¹Ÿæ˜¯3.1.6çš„ç‰ˆæœ¬å·ï¼Œè§£å‹logstashå‘ç°ä¹Ÿæ˜¯è¯¥ç‰ˆæœ¬å·ï¼Œæ‰€ä»¥ä¸ç”¨åœ¨æ„ç‰ˆæœ¬å·build/libs/logstash-filter-date-3.1.6.jar</code></pre><pre class=" language-shell"><code class="language-shell">19:38:39: Executing task 'build'...:buildSrc:compileJava UP-TO-DATE:buildSrc:compileGroovy UP-TO-DATE:buildSrc:processResources UP-TO-DATE:buildSrc:classes UP-TO-DATE:buildSrc:jar UP-TO-DATE:buildSrc:assemble UP-TO-DATE:buildSrc:compileTestJava UP-TO-DATE:buildSrc:compileTestGroovy UP-TO-DATE:buildSrc:processTestResources UP-TO-DATE:buildSrc:testClasses UP-TO-DATE:buildSrc:test UP-TO-DATE:buildSrc:check UP-TO-DATE:buildSrc:build UP-TO-DATE:distTar UP-TO-DATE:distZip UP-TO-DATE:compileJava:processResources UP-TO-DATE:classes:jar:assemble:compileTestJava:processTestResources UP-TO-DATE:testClasses:test:check:buildBUILD SUCCESSFULTotal time: 7.276 secs19:38:47: Task execution finished 'build'.</code></pre><h2 id="æ›¿æ¢logstashä¸­é»˜è®¤çš„jar"><a href="#æ›¿æ¢logstashä¸­é»˜è®¤çš„jar" class="headerlink" title="æ›¿æ¢logstashä¸­é»˜è®¤çš„jar"></a>æ›¿æ¢logstashä¸­é»˜è®¤çš„jar</h2><h3 id="è§£å‹logstash-7-9-3-tar-gz"><a href="#è§£å‹logstash-7-9-3-tar-gz" class="headerlink" title="è§£å‹logstash-7.9.3.tar.gz"></a>è§£å‹logstash-7.9.3.tar.gz</h3><pre class=" language-shell"><code class="language-shell">cd ~/share/tmp# è§£å‹tar -zxvf logstash-7.9.3.tar.gz</code></pre><h3 id="æŸ¥æ‰¾logstash-filter-date-3-1-6-jar"><a href="#æŸ¥æ‰¾logstash-filter-date-3-1-6-jar" class="headerlink" title="æŸ¥æ‰¾logstash-filter-date-3.1.6.jar"></a>æŸ¥æ‰¾logstash-filter-date-3.1.6.jar</h3><pre class=" language-shell"><code class="language-shell">cd logstash-7.9.3 && find . -name 'logstash-filter-date*'# æ—¥å¿—âœ  logstash-7.9.3 find . -name 'logstash-filter-date*'./vendor/bundle/jruby/2.5.0/specifications/logstash-filter-date-3.1.9.gemspec./vendor/bundle/jruby/2.5.0/gems/logstash-filter-date-3.1.9./vendor/bundle/jruby/2.5.0/gems/logstash-filter-date-3.1.9/logstash-filter-date.gemspec./vendor/bundle/jruby/2.5.0/gems/logstash-filter-date-3.1.9/lib/logstash-filter-date_jars.rb./vendor/bundle/jruby/2.5.0/gems/logstash-filter-date-3.1.9/vendor/jar-dependencies/org/logstash/filters/logstash-filter-date./vendor/bundle/jruby/2.5.0/gems/logstash-filter-date-3.1.9/vendor/jar-dependencies/org/logstash/filters/logstash-filter-date/3.1.6/logstash-filter-date-3.1.6.jar</code></pre><p>å¯ä»¥çœ‹åˆ°åŸå…ˆçš„jaråœ¨<code>./vendor/bundle/jruby/2.5.0/gems/logstash-filter-date-3.1.9/vendor/jar-dependencies/org/logstash/filters/logstash-filter-date/3.1.6/</code>è¿™ä¸ªç›®å½•ä¸‹é¢ï¼Œæˆ‘ä»¬åªéœ€è¦ç”¨ä¿®æ”¹è¿‡çš„jaræ›¿æ¢æ‰å°±å¯ä»¥äº†ã€‚</p><h2 id="æµ‹è¯•çº³ç§’è§£æ"><a href="#æµ‹è¯•çº³ç§’è§£æ" class="headerlink" title="æµ‹è¯•çº³ç§’è§£æ"></a>æµ‹è¯•çº³ç§’è§£æ</h2><p>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬å°†<a href="https://xiaomozhang.github.io/2020/12/09/lsboot/">ä¸Šä¸€ç¯‡æ–‡ç« </a>çš„å¯åŠ¨è„šæœ¬å¤åˆ¶è¿‡æ¥ï¼Œå¹¶ä¸”æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶<code>conf/test.conf</code></p><pre class=" language-shell"><code class="language-shell">âœ  logstash-7.9.3 lltotal 1280-rw-r--r--   1 xiaozhangge  staff   2.2K 10 16 20:23 CONTRIBUTORS-rw-r--r--   1 xiaozhangge  staff   3.9K 10 16 20:24 Gemfile-rw-r--r--   1 xiaozhangge  staff    22K 10 16 20:25 Gemfile.lock-rw-r--r--   1 xiaozhangge  staff    13K 10 16 20:23 LICENSE.txt-rw-r--r--   1 xiaozhangge  staff   587K 10 16 20:23 NOTICE.TXTdrwxr-xr-x  22 xiaozhangge  staff   704B 10 16 21:35 bindrwxr-xr-x   3 xiaozhangge  staff    96B 12 18 20:00 confdrwxr-xr-x   8 xiaozhangge  staff   256B 10 16 21:35 configdrwxr-xr-x   2 xiaozhangge  staff    64B 10 16 20:23 datadrwxr-xr-x   6 xiaozhangge  staff   192B 10 16 21:35 libdrwxr-xr-x   6 xiaozhangge  staff   192B 10 16 21:35 logstash-coredrwxr-xr-x   5 xiaozhangge  staff   160B 10 16 21:35 logstash-core-plugin-api-rwxr-xr-x@  1 xiaozhangge  staff   1.3K 12 18 20:00 lsbootdrwxr-xr-x   5 xiaozhangge  staff   160B 10 16 21:35 modulesdrwxr-xr-x   3 xiaozhangge  staff    96B 10 16 21:35 toolsdrwxr-xr-x   4 xiaozhangge  staff   128B 10 16 21:35 vendordrwxr-xr-x  14 xiaozhangge  staff   448B 10 16 21:35 x-pack</code></pre><h3 id="ç¼–å†™æµ‹è¯•é…ç½®conf-test-conf"><a href="#ç¼–å†™æµ‹è¯•é…ç½®conf-test-conf" class="headerlink" title="ç¼–å†™æµ‹è¯•é…ç½®conf/test.conf"></a>ç¼–å†™æµ‹è¯•é…ç½®conf/test.conf</h3><pre class=" language-shell"><code class="language-shell">input {     stdin {          codec => "json"     } }filter {    mutate {        add_field => { "name" => "å“ˆå“ˆå“ˆ" }    }    # https://zerlong.com/886.html    ruby { code => 'event.set("unix_ts",(event.get("@timestamp").to_f.round(3)*1000).to_i)' }    date {            # æ³¨æ„è¿™é‡Œçš„UNIX_NSå°±æ˜¯æˆ‘ä»¬åœ¨TimestampParserFactoryæ–°å»ºçš„çº³ç§’è§£æå™¨ï¼Œå®˜æ–¹ç‰ˆæœ¬æ˜¯ä¸æ”¯æŒçš„        match => ["unix_ns", "UNIX_NS"]        target => "date_ns"    }}output {     stdout {} }</code></pre><h3 id="æµ‹è¯•æ•°æ®"><a href="#æµ‹è¯•æ•°æ®" class="headerlink" title="æµ‹è¯•æ•°æ®"></a>æµ‹è¯•æ•°æ®</h3><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span> <span class="token property">"unix_ns"</span><span class="token operator">:</span> <span class="token number">1607206093000000</span><span class="token punctuation">,</span> <span class="token property">"tags"</span><span class="token operator">:</span> <span class="token string">"test"</span> <span class="token punctuation">}</span></code></pre><h3 id="å¯åŠ¨æµ‹è¯•"><a href="#å¯åŠ¨æµ‹è¯•" class="headerlink" title="å¯åŠ¨æµ‹è¯•"></a>å¯åŠ¨æµ‹è¯•</h3><pre class=" language-shell"><code class="language-shell">âœ  logstash-7.9.3 ./lsboot conf/test.conf testbin/logstash -f conf/test.conf -l logs/test --path.data data/test -n testSending Logstash logs to logs/test which is now configured via log4j2.properties[2020-12-18T20:13:19,801][INFO ][logstash.runner          ] Starting Logstash {"logstash.version"=>"7.9.3", "jruby.version"=>"jruby 9.2.13.0 (2.5.7) 2020-08-03 9a89c94bcc Java HotSpot(TM) 64-Bit Server VM 25.201-b09 on 1.8.0_201-b09 +indy +jit [darwin-x86_64]"}[2020-12-18T20:13:19,932][INFO ][logstash.setting.writabledirectory] Creating directory {:setting=>"path.queue", :path=>"data/test/queue"}[2020-12-18T20:13:19,935][INFO ][logstash.setting.writabledirectory] Creating directory {:setting=>"path.dead_letter_queue", :path=>"data/test/dead_letter_queue"}[2020-12-18T20:13:20,029][WARN ][logstash.config.source.multilocal] Ignoring the 'pipelines.yml' file because modules or command line options are specified[2020-12-18T20:13:20,061][INFO ][logstash.agent           ] No persistent UUID file found. Generating new UUID {:uuid=>"e4188c10-0621-4967-a957-8aa14f1a2945", :path=>"data/test/uuid"}[2020-12-18T20:13:21,802][INFO ][org.reflections.Reflections] Reflections took 33 ms to scan 1 urls, producing 22 keys and 45 values[2020-12-18T20:13:23,160][INFO ][logstash.javapipeline    ][main] Starting pipeline {:pipeline_id=>"main", "pipeline.workers"=>8, "pipeline.batch.size"=>125, "pipeline.batch.delay"=>50, "pipeline.max_inflight"=>1000, "pipeline.sources"=>["/Users/xiaozhangge/share/tmp/logstash-7.9.3/conf/test.conf"], :thread=>"#<Thread:0x49b901aa run>"}[2020-12-18T20:13:23,871][INFO ][logstash.javapipeline    ][main] Pipeline Java execution initialization time {"seconds"=>0.7}[2020-12-18T20:13:23,922][INFO ][logstash.inputs.stdin    ][main] Automatically switching from json to json_lines codec {:plugin=>"stdin"}[2020-12-18T20:13:23,962][INFO ][logstash.javapipeline    ][main] Pipeline started {"pipeline.id"=>"main"}The stdin plugin is now waiting for input:[2020-12-18T20:13:24,041][INFO ][logstash.agent           ] Pipelines running {:count=>1, :running_pipelines=>[:main], :non_running_pipelines=>[]}[2020-12-18T20:13:24,244][INFO ][logstash.agent           ] Successfully started Logstash API endpoint {:port=>9600}{ "unix_ns": 1607206093000000, "tags": "test" }{       "unix_ts" => 1608293606313,       "date_ns" => 2020-12-05T22:08:13.000Z,    "@timestamp" => 2020-12-18T12:13:26.313Z,          "tags" => "test",       "unix_ns" => 1607206093000000,          "host" => "TaoZeng.MBP",      "@version" => "1",          "name" => "å“ˆå“ˆå“ˆ"}</code></pre><p>ä»¥ä¸Šï¼Œ<code>1607206093000000</code>çº³ç§’æ—¶é—´æˆ³å·²ç»æ”¯æŒè½¬æ¢æˆ<code>date</code>ç±»å‹çš„æ•°æ®ï¼Œä½†æ˜¯è½¬æ¢çš„ç»“æœå´è¿˜æœ‰æ—¶åŒºæ˜¾ç¤ºçš„é—®é¢˜ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªæ–¹æ¡ˆ</p><ul><li>ç¬¬ä¸€æ˜¯åœ¨targetçš„æ—¶å€™æŒ‡å®šæ—¶åŒºï¼›</li><li>ç¬¬äºŒæ˜¯ä¿®æ”¹logstashæºç ï¼ŒæŠŠæ—¶åŒºé»˜è®¤ä¿®æ”¹ä¸ºä¸œå…«åŒºï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸‹ä¸€æ¬¡è¯´æ€ä¹ˆä¿®æ”¹ã€‚</li></ul><p><a href="https://www.zybuluo.com/StrGlee/note/1179723">logstash æ—¶é—´æˆ³æ—¶åŒºé—®é¢˜</a></p><p>ä»¥ä¸Šï¼Œå°±æ˜¯logstash-filter-dateæ’ä»¶æ·»åŠ çº³ç§’æ”¯æŒå¹¶ä¸”æ›¿æ¢ï¼Œç¼–è¯‘å¥½çš„<a href="https://gitee.com/iogogogo/iogogogo/raw/master/files/logstash-filter-date-3.1.6.jar">logstash-filter-date-3.1.6.jar</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> logstash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>logstash å¯åŠ¨è„šæœ¬</title>
      <link href="2020/12/09/lsboot/"/>
      <url>2020/12/09/lsboot/</url>
      
        <content type="html"><![CDATA[<ul><li>logstash é€šç”¨å¯åŠ¨è„šæœ¬</li></ul><pre class=" language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment" spellcheck="true"># FileName: lsboot</span><span class="token comment" spellcheck="true"># Description: å¯åŠ¨logstashå®ä¾‹</span><span class="token comment" spellcheck="true"># Dispatcher:</span><span class="token comment" spellcheck="true"># Description: Usage: lsboot xxx.conf</span><span class="token comment" spellcheck="true"># CreateDate: 2020-12-06</span><span class="token keyword">if</span> <span class="token punctuation">[</span> $<span class="token comment" spellcheck="true"># -lt 1 ];then</span>    <span class="token keyword">echo</span> -e <span class="token string">"  \e[033m Usage: <span class="token variable">$0</span> [FileName: e.g.: xxx.conf OR path/xxx.conf] \e[0m"</span>    <span class="token keyword">exit</span> 1<span class="token keyword">fi</span><span class="token comment" spellcheck="true">#config file OR path</span>conFile<span class="token operator">=</span><span class="token variable">$1</span>conFilePath<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cd</span> `dirname $conFile`<span class="token punctuation">;</span><span class="token function">pwd</span><span class="token variable">)</span></span>appName<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> $<span class="token punctuation">{</span>conFile<span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token function">sed</span> s/.conf.*//<span class="token variable">)</span></span>currPath<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cd</span> `dirname $0`<span class="token punctuation">;</span><span class="token function">pwd</span><span class="token variable">)</span></span>LS_HOME<span class="token operator">=</span><span class="token variable">${LS_HOME:-$currPath}</span><span class="token function">cd</span> <span class="token variable">$LS_HOME</span>check_pid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  pids<span class="token operator">=</span>`ps -ef <span class="token operator">|</span> <span class="token function">grep</span> -v <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">grep</span> -w <span class="token string">"\-f <span class="token variable">${conFile}</span>"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print <span class="token variable">$2</span>}'</span>`  <span class="token comment" spellcheck="true">#echo "PID : ${pids}"</span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$2</span> <span class="token operator">==</span> <span class="token string">"test"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> appName<span class="token operator">=</span>test <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> -rf data/test <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> -rf logs/test<span class="token comment" spellcheck="true">#./stop.sh</span><span class="token comment" spellcheck="true">#sleep 1</span>check_pidcmd<span class="token operator">=</span><span class="token string">"bin/logstash -f <span class="token variable">${conFile}</span> -l logs/<span class="token variable">${appName}</span> --path.data data/<span class="token variable">${appName}</span> -n <span class="token variable">${appName}</span>"</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$pids</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>  <span class="token keyword">echo</span> <span class="token string">" APP <span class="token variable">$appName</span> was running on :"</span>  <span class="token keyword">echo</span> -e <span class="token string">"    \e[032m ã€ <span class="token variable"><span class="token variable">`</span>pwdx $pids<span class="token variable">`</span></span> ã€‘\e[0m"</span>  <span class="token keyword">echo</span> <span class="token string">" If restart, kill <span class="token variable">$pids</span> first."</span>  <span class="token keyword">exit</span> 0<span class="token keyword">else</span>  <span class="token function">cd</span> <span class="token variable">$LS_HOME</span>  <span class="token keyword">echo</span> <span class="token string">"<span class="token variable">$cmd</span>"</span>  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">${appName}</span> <span class="token operator">==</span> <span class="token string">"test"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>    <span class="token variable">$cmd</span>  <span class="token keyword">else</span>    <span class="token function">eval</span> <span class="token variable">$cmd</span> <span class="token operator">&amp;</span>    <span class="token function">sleep</span> 1    check_pid    <span class="token punctuation">[</span><span class="token punctuation">[</span> -n <span class="token string">"<span class="token variable">${pids}</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">echo</span> -e <span class="token string">"\e[032m success \e[0m: <span class="token variable">$appName</span> boot on: <span class="token variable">$pids</span>"</span> <span class="token operator">||</span> <span class="token keyword">echo</span> -e <span class="token string">"  \e[31m [ <span class="token variable">$appName</span> : <span class="token variable">$conFile</span> ] Boot Failed. \e[0m "</span>  <span class="token keyword">fi</span><span class="token keyword">fi</span><span class="token comment" spellcheck="true">#sleep 1</span><span class="token comment" spellcheck="true">#ps -ef | grep -v grep | grep -w "${conFile}" | awk '{print $2"\t"$NF}' </span><span class="token keyword">exit</span> 0</code></pre><ul><li>logstashå°†æ—¶é—´è½¬æ¢æˆunixæ—¶é—´æˆ³</li></ul><pre class=" language-ruby"><code class="language-ruby"><span class="token comment" spellcheck="true"># https://zerlong.com/886.html</span>ruby <span class="token punctuation">{</span> code <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'event.set("unix_ts",(event.get("@timestamp").to_f.round(3)*1000).to_i)'</span> <span class="token punctuation">}</span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Logstash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS å‡çº§å®‰è£…æœ€æ–°ç‰ˆgit</title>
      <link href="2020/09/01/soft-install-git/"/>
      <url>2020/09/01/soft-install-git/</url>
      
        <content type="html"><![CDATA[<h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><p>å®‰è£…å¿…è¦ä¾èµ–</p><pre class=" language-shell"><code class="language-shell">yum install -y curl-devel expat-devel gettext-devel openssl-devel zlib-devel asciidocyum install -y gcc perl-ExtUtils-MakeMaker</code></pre><h2 id="å¸è½½æ—§ç‰ˆæœ¬Git"><a href="#å¸è½½æ—§ç‰ˆæœ¬Git" class="headerlink" title="å¸è½½æ—§ç‰ˆæœ¬Git"></a>å¸è½½æ—§ç‰ˆæœ¬Git</h2><p>å¦‚æœæ—§ç‰ˆæœ¬ä¸å­˜åœ¨ï¼Œæ­¤æ­¥å¯å¿½ç•¥</p><pre class=" language-shell"><code class="language-shell">yum remove -y git</code></pre><h2 id="ä¸‹è½½æœ€æ–°ç‰ˆGit"><a href="#ä¸‹è½½æœ€æ–°ç‰ˆGit" class="headerlink" title="ä¸‹è½½æœ€æ–°ç‰ˆGit"></a>ä¸‹è½½æœ€æ–°ç‰ˆGit</h2><ul><li>åˆ‡æ¢ç›®å½•</li></ul><pre class=" language-shell"><code class="language-shell">cd /usr/local/src</code></pre><ul><li>git releaseç‰ˆæœ¬åœ°å€</li></ul><pre class=" language-shell"><code class="language-shell">https://mirrors.edge.kernel.org/pub/software/scm/git/</code></pre><ul><li>ä¸‹è½½å¹¶è§£å‹</li></ul><pre class=" language-shell"><code class="language-shell">wget https://mirrors.edge.kernel.org/pub/software/scm/git/git-2.9.5.tar.gztar -xvf git-2.9.5.tar.gzcd /usr/local/src/git-2.9.5</code></pre><h2 id="ç¼–è¯‘å®‰è£…Git"><a href="#ç¼–è¯‘å®‰è£…Git" class="headerlink" title="ç¼–è¯‘å®‰è£…Git"></a>ç¼–è¯‘å®‰è£…Git</h2><pre class=" language-shell"><code class="language-shell">make prefix=/usr/local/git allmake prefix=/usr/local/git install</code></pre><h2 id="é…ç½®ç¯å¢ƒå˜é‡"><a href="#é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®ç¯å¢ƒå˜é‡"></a>é…ç½®ç¯å¢ƒå˜é‡</h2><pre class=" language-shell"><code class="language-shell">echo "export PATH=$PATH:/usr/local/git/bin" >> /etc/profile source /etc/profile</code></pre>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>maven.test.skipå’ŒskipTestsçš„åŒºåˆ«</title>
      <link href="2020/08/20/maven-skip-test/"/>
      <url>2020/08/20/maven-skip-test/</url>
      
        <content type="html"><![CDATA[<h2 id="DskipTests"><a href="#DskipTests" class="headerlink" title="-DskipTests"></a>-DskipTests</h2><p>ä¸æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œä½†ç¼–è¯‘æµ‹è¯•ç”¨ä¾‹ç±»ç”Ÿæˆç›¸åº”çš„classæ–‡ä»¶è‡³target/test-classesä¸‹ã€‚</p><ul><li><code>pom</code>ä¸­é…ç½®è·³è¿‡</li></ul><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven-surefire-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>skipTests</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>skipTests</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span> </code></pre><h2 id="Dmaven-test-skip-true"><a href="#Dmaven-test-skip-true" class="headerlink" title="-Dmaven.test.skip=true"></a>-Dmaven.test.skip=true</h2><p>ä¸æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œä¹Ÿä¸ç¼–è¯‘æµ‹è¯•ç”¨ä¾‹ç±»ï¼Œä¸ä½†è·³è¿‡å•å…ƒæµ‹è¯•çš„è¿è¡Œï¼Œä¹Ÿè·³è¿‡æµ‹è¯•ä»£ç çš„ç¼–è¯‘ã€‚</p><ul><li><code>pom</code>ä¸­é…ç½®è·³è¿‡</li></ul><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.maven.plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>skip</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>skip</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven-surefire-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>skip</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>skip</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span> </code></pre>]]></content>
      
      
      <categories>
          
          <category> Maven </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€è½¬ã€‘Spring Kafka ç¬”è®°</title>
      <link href="2020/08/17/spring-kafka-note/"/>
      <url>2020/08/17/spring-kafka-note/</url>
      
        <content type="html"><![CDATA[<p><a href="http://blog.seasedge.cn/archives/8.html">Spring Kafkaï¼ˆä¸€ï¼‰Kafkaï¼Œä½ å¥½</a></p><p><a href="http://blog.seasedge.cn/archives/9.html">Spring Kafkaï¼ˆäºŒï¼‰å¿«é€Ÿå…¥é—¨ï¼Œåªéœ€ä¸‰ç§’</a></p><p><a href="http://blog.seasedge.cn/archives/13.html">Spring Kafkaï¼ˆä¸‰ï¼‰æ“ä½œTopicä»¥åŠKafka Tool 2çš„ä½¿ç”¨</a></p><p><a href="http://blog.seasedge.cn/archives/15.html">Spring Kafkaï¼ˆå››ï¼‰KafkaTemplateå‘é€æ¶ˆæ¯åŠç»“æœå›è°ƒ</a></p><p><a href="http://blog.seasedge.cn/archives/44.html">Spring Kafkaï¼ˆäº”ï¼‰ä½¿ç”¨Kafkaäº‹åŠ¡çš„ä¸¤ç§æ–¹å¼</a></p><p><a href="http://blog.seasedge.cn/archives/46.html">Spring Kafkaï¼ˆå…­ï¼‰@KafkaListenerçš„èŠ±å¼æ“ä½œ</a></p><p><a href="http://blog.seasedge.cn/archives/47.html">Spring Kafkaï¼ˆä¸ƒï¼‰ å®ç°æ¶ˆæ¯è½¬å‘ä»¥åŠReplyTemplate</a></p><p><a href="http://blog.seasedge.cn/archives/49.html">Spring Kafkaï¼ˆå…«ï¼‰KafkaListenerå®šæ—¶å¯åŠ¨ï¼ˆç¦æ­¢è‡ªå¯åŠ¨ï¼‰</a></p><p><a href="http://blog.seasedge.cn/archives/50.html">Spring Kafkaï¼ˆä¹ï¼‰é…ç½®æ¶ˆæ¯è¿‡æ»¤å™¨</a></p><p><a href="http://blog.seasedge.cn/archives/51.html">Spring Kafkaï¼ˆåï¼‰ConsumerAwareErrorHandlerå¼‚å¸¸å¤„ç†å™¨</a></p>]]></content>
      
      
      <categories>
          
          <category> Kafka </category>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hadoopå¸¸ç”¨è¿ç»´å‘½ä»¤</title>
      <link href="2020/08/03/hadoop-ops-command/"/>
      <url>2020/08/03/hadoop-ops-command/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€HADOOPé›†ç¾¤å¯åŠ¨"><a href="#ä¸€ã€HADOOPé›†ç¾¤å¯åŠ¨" class="headerlink" title="ä¸€ã€HADOOPé›†ç¾¤å¯åŠ¨"></a>ä¸€ã€HADOOPé›†ç¾¤å¯åŠ¨</h2><h3 id="1-æ ¼å¼åŒ–zk"><a href="#1-æ ¼å¼åŒ–zk" class="headerlink" title="1. æ ¼å¼åŒ–zk"></a>1. æ ¼å¼åŒ–zk</h3><p>åœ¨zkçš„leaderèŠ‚ç‚¹æœåŠ¡å™¨ä¸Šï¼ŒHadoopçš„binç›®å½•ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š<br>æ”¹ä¸ºåœ¨ nnçš„activeèŠ‚ç‚¹ä¸Š</p><pre><code>sh hdfs zkfc -formatZK</code></pre><h3 id="2-å¯åŠ¨journalnodeé›†ç¾¤"><a href="#2-å¯åŠ¨journalnodeé›†ç¾¤" class="headerlink" title="2. å¯åŠ¨journalnodeé›†ç¾¤"></a>2. å¯åŠ¨journalnodeé›†ç¾¤</h3><p>hadoopä»»æ„èŠ‚ç‚¹æœåŠ¡å™¨æ‰§è¡Œ</p><pre><code>hadoop-daemons.sh start journalnode</code></pre><h3 id="3-æ ¼å¼åŒ–namenode"><a href="#3-æ ¼å¼åŒ–namenode" class="headerlink" title="3. æ ¼å¼åŒ–namenode"></a>3. æ ¼å¼åŒ–namenode</h3><p>åœ¨nnèŠ‚ç‚¹æ‰§è¡Œ</p><pre><code>hadoop namenode -format</code></pre><h3 id="4-å¯åŠ¨NameNode"><a href="#4-å¯åŠ¨NameNode" class="headerlink" title="4. å¯åŠ¨NameNode"></a>4. å¯åŠ¨NameNode</h3><p>åœ¨hdaoop01èŠ‚ç‚¹ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¯åŠ¨NameNodeèŠ‚ç‚¹ï¼š</p><pre><code>hadoop-daemon.sh start namenode</code></pre><p>é¦–å…ˆæŠŠhdaoop02æœåŠ¡å™¨çš„ namenodeèŠ‚ç‚¹å˜ä¸ºstandby namenodeèŠ‚ç‚¹ã€‚<br>æ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>hdfs namenode -bootstrapStandby</code></pre><p>å¯åŠ¨hadoop02æœåŠ¡å™¨çš„namenodeèŠ‚ç‚¹ï¼Œæ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>hadoop-daemon.sh start namenode</code></pre><h3 id="5-å¯åŠ¨DataNode"><a href="#5-å¯åŠ¨DataNode" class="headerlink" title="5. å¯åŠ¨DataNode"></a>5. å¯åŠ¨DataNode</h3><p>åœ¨hadoop01,hadoop02,hadoop03æœåŠ¡å™¨ä¸Šåˆ†åˆ«å¯åŠ¨datanodeèŠ‚ç‚¹ï¼Œåœ¨è¿™ä¸‰å°æœåŠ¡å™¨ä¸Šåˆ†åˆ«æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><pre><code>hadoop-daemon.sh start datanode</code></pre><h3 id="6-å¯åŠ¨zkfc"><a href="#6-å¯åŠ¨zkfc" class="headerlink" title="6. å¯åŠ¨zkfc"></a>6. å¯åŠ¨zkfc</h3><p>FalioverControllerActiveæ˜¯å¤±è´¥æ¢å¤çº¿ç¨‹ã€‚è¿™ä¸ªçº¿ç¨‹éœ€è¦åœ¨NameNodeèŠ‚ç‚¹æ‰€åœ¨çš„æœåŠ¡å™¨ä¸Šå¯åŠ¨ï¼Œåœ¨hadoop01,hadoop02æœåŠ¡å™¨ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><pre><code>hadoop-daemon.sh start zkfc</code></pre><h3 id="7-å¯åŠ¨Resourcemanager"><a href="#7-å¯åŠ¨Resourcemanager" class="headerlink" title="7. å¯åŠ¨Resourcemanager"></a>7. å¯åŠ¨Resourcemanager</h3><p>åœ¨<strong>hdaoop01</strong>æœåŠ¡å™¨ä¸Šå¯åŠ¨ä¸»ResourcemanagerèŠ‚ç‚¹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š<br>å¯åŠ¨æˆåŠŸåï¼Œhadoop01,hadoop02,hadoop03æœåŠ¡å™¨ä¸Šçš„nodemanager ä¹Ÿä¼šè·Ÿéšå¯åŠ¨</p><pre><code>start-yarn.sh</code></pre><p>åœ¨<strong>hadoop02</strong>æœåŠ¡å™¨ä¸Šå¯åŠ¨å‰¯ ResoucemanagerèŠ‚ç‚¹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><pre><code>yarn-daemon.sh start resourcemanager</code></pre><h2 id="äºŒã€YARNè¿ç»´å‘½ä»¤"><a href="#äºŒã€YARNè¿ç»´å‘½ä»¤" class="headerlink" title="äºŒã€YARNè¿ç»´å‘½ä»¤"></a>äºŒã€YARNè¿ç»´å‘½ä»¤</h2><h3 id="1-yarn-application"><a href="#1-yarn-application" class="headerlink" title="1. yarn application"></a>1. yarn application</h3><p>1ã€-list åˆ—å‡ºæ‰€æœ‰ application ä¿¡æ¯</p><pre><code>yarn application -list</code></pre><p>2ã€-appStates <states>è·Ÿ-listä¸€èµ·ä½¿ç”¨ï¼Œç”¨æ¥ç­›é€‰ä¸åŒçŠ¶æ€çš„applicationï¼Œå¤šä¸ªç”¨â€,â€åˆ†éš”ï¼›æ‰€æœ‰çŠ¶æ€ALL,NEW,NEW_SAVING,SUBMITTED,ACCEPTED,RUNNING,FINISHED,FAILED,KILLED</states></p><pre><code>yarn application -list -appStates RUNNING</code></pre><p>3ã€-appTypes <types>è·Ÿ-listä¸€èµ·ä½¿ç”¨ï¼Œç”¨æ¥ç­›é€‰ä¸åŒç±»å‹çš„applicationï¼Œå¤šä¸ªç”¨â€,â€åˆ†éš”ï¼›å¦‚ MAPREDUCE</types></p><pre><code>yarn application -list -appTypes MAPREDUCE</code></pre><p>4ã€-kill <application id="">æ€æ­»ä¸€ä¸ªapplicationï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªApplication ID</application></p><pre><code>yarn  application -kill application_1526100291229_206393</code></pre><p>5ã€-status <application id="">åˆ—å‡º æŸä¸ªapplication çš„çŠ¶æ€</application></p><pre><code>yarn application -status application_1526100291229_206393</code></pre><p>6ã€-movetoqueue <applicationid>ç§»åŠ¨applicationåˆ°å…¶ä»–çš„queueï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨<br>7ã€-queue <queue name=""> ä¸ movetoqueueå‘½ä»¤ä¸€èµ·ä½¿ç”¨ï¼ŒæŒ‡å®šç§»åŠ¨åˆ°å“ªä¸ªqueue</queue></applicationid></p><pre><code>yarn application -movetoqueue application_1526100291229_206393 -queue other</code></pre><h3 id="2-yarn-node"><a href="#2-yarn-node" class="headerlink" title="2. yarn node"></a>2. yarn node</h3><p>æŸ¥çœ‹å„ä¸ªnodeä¸Šçš„ä»»åŠ¡æ•°</p><pre><code>yarn  node --list</code></pre><h3 id="3-yarn-logs"><a href="#3-yarn-logs" class="headerlink" title="3. yarn logs"></a>3. yarn logs</h3><pre><code>yarn logs -applicationId application_1583405966138_0013</code></pre>]]></content>
      
      
      <categories>
          
          <category> Hadoop </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hadoop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RedisæŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ä»¥åŠkeyåˆ†å¸ƒéslot</title>
      <link href="2020/07/29/redis-cluster-info/"/>
      <url>2020/07/29/redis-cluster-info/</url>
      
        <content type="html"><![CDATA[<h2 id="è¿›å…¥redisé›†ç¾¤"><a href="#è¿›å…¥redisé›†ç¾¤" class="headerlink" title="è¿›å…¥redisé›†ç¾¤"></a>è¿›å…¥redisé›†ç¾¤</h2><pre class=" language-shell"><code class="language-shell">redis-cli -h ip -p port -c</code></pre><h2 id="æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹"><a href="#æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹" class="headerlink" title="æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹"></a>æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹</h2><pre class=" language-shell"><code class="language-shell">cluster nodes</code></pre><h2 id="æŸ¥çœ‹keyå¯¹åº”çš„slot"><a href="#æŸ¥çœ‹keyå¯¹åº”çš„slot" class="headerlink" title="æŸ¥çœ‹keyå¯¹åº”çš„slot"></a>æŸ¥çœ‹keyå¯¹åº”çš„slot</h2><pre class=" language-shell"><code class="language-shell">cluster keyslot key</code></pre><h2 id="æŸ¥çœ‹slotå’ŒèŠ‚ç‚¹çš„å¯¹åº”å…³ç³»"><a href="#æŸ¥çœ‹slotå’ŒèŠ‚ç‚¹çš„å¯¹åº”å…³ç³»" class="headerlink" title="æŸ¥çœ‹slotå’ŒèŠ‚ç‚¹çš„å¯¹åº”å…³ç³»"></a>æŸ¥çœ‹slotå’ŒèŠ‚ç‚¹çš„å¯¹åº”å…³ç³»</h2><pre class=" language-shell"><code class="language-shell">cluster slots</code></pre>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Guavaä¸­çš„CaseFormat</title>
      <link href="2020/07/25/guava-case-format/"/>
      <url>2020/07/25/guava-case-format/</url>
      
        <content type="html"><![CDATA[<p>åœ¨æ•°æ®åº“ä¸­ï¼ŒæŒ‰ç…§é˜¿é‡Œå·´å·´javaå¼€å‘æ‰‹å†Œï¼Œæ•°æ®åº“å­—æ®µå…¨éƒ¨å°å†™å¹¶ä¸”æŒ‰ç…§<code>_</code>è¿›è¡Œå•è¯ä¹‹é—´çš„åˆ†å‰²ï¼Œä½†æ˜¯æˆ‘ä»¬<code>Java</code>ä¸­çš„å‘½åé£æ ¼åˆæ˜¯æŒ‰ç…§é©¼å³°æ–¹å¼ï¼Œä¸€èˆ¬è¿”å›ç»™å‰ç«¯çš„<code>DTO</code>å¯¹è±¡ä¹ŸæŒ‰ç…§é©¼å³°æ–¹å¼ï¼Œå‰ç«¯åŒå­¦åœ¨å¯¹æ‰€æœ‰åˆ—è¿›è¡Œæ’åºæ—¶ï¼Œä¼šæŒ‰ç…§æˆ‘ä»¬è¿”å›ç»™ä»–çš„<code>props</code>å‘é€ç»™åç«¯ï¼Œè¿™æ—¶å€™åç«¯æ”¶åˆ°çš„å°±æ˜¯é©¼å³°æ–¹å¼çš„<code>props</code>ï¼Œä½†æ˜¯æ‹¿åˆ°æ•°æ®åº“æŸ¥è¯¢è¿™è‚¯å®šæ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„å­—æ®µï¼Œé‚£ä¹ˆæœ‰ä»€ä¹ˆå¥½çš„æ–¹å¼å»è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p><p>è¿™æ—¶å€™å‘ç°äº†<code>guava</code>ä¸­çš„<code>CaseFormat</code>å·¥å…·ç±»ã€‚</p><p> com.google.common.base.CaseFormatæ˜¯ä¸€ç§å®ç”¨å·¥å…·ç±»ï¼Œä»¥æä¾›ä¸åŒçš„ASCIIå­—ç¬¦æ ¼å¼ä¹‹é—´çš„è½¬æ¢ã€‚</p><h2 id="ç±»å£°æ˜"><a href="#ç±»å£°æ˜" class="headerlink" title="ç±»å£°æ˜"></a>ç±»å£°æ˜</h2><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@GwtCompatible</span><span class="token keyword">public</span> <span class="token keyword">enum</span> CaseFormat   <span class="token keyword">extends</span> <span class="token class-name">Enum</span><span class="token operator">&lt;</span>CaseFormat<span class="token operator">></span></code></pre><h2 id="æšä¸¾å¸¸é‡"><a href="#æšä¸¾å¸¸é‡" class="headerlink" title="æšä¸¾å¸¸é‡"></a>æšä¸¾å¸¸é‡</h2><table><thead><tr><th>æšä¸¾å¸¸é‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>LOWER_CAMEL</td><td>Javaå˜é‡çš„å‘½åè§„åˆ™ï¼Œå¦‚ <code>lowerCamel</code></td></tr><tr><td>LOWER_HYPHEN</td><td>è¿å­—ç¬¦è¿æ¥å˜é‡çš„å‘½åè§„åˆ™ï¼Œå¦‚ <code>lower-hyphen</code></td></tr><tr><td>LOWER_UNDERSCORE</td><td>C ++å˜é‡å‘½åè§„åˆ™ï¼Œå¦‚ <code>lower_underscore</code></td></tr><tr><td>UPPER_CAMEL</td><td>Javaå’ŒC++ç±»çš„å‘½åè§„åˆ™ï¼Œå¦‚ <code>UpperCamel</code></td></tr><tr><td>UPPER_UNDERSCORE</td><td>Javaå’ŒC++å¸¸é‡çš„å‘½åè§„åˆ™ï¼Œå¦‚ <code>UPPER_UNDERSCORE</code></td></tr></tbody></table><h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Converter&lt;String,String&gt; converterTo(CaseFormat targetFormat)</td><td>è¿”å›ä¸€ä¸ªè½¬æ¢ï¼Œä»è¿™ä¸ªæ ¼å¼è½¬æ¢targetFormatå­—ç¬¦ä¸²ã€‚</td></tr><tr><td>String to(CaseFormat format, String str)</td><td>ä»è¿™ä¸€æ ¼å¼æŒ‡å®šæ ¼å¼çš„æŒ‡å®šå­—ç¬¦ä¸² str è½¬æ¢ã€‚</td></tr><tr><td>static CaseFormat valueOf(String name)</td><td>è¿”å›æ­¤ç±»å‹å…·æœ‰æŒ‡å®šåç§°çš„æšä¸¾å¸¸é‡ã€‚</td></tr><tr><td>static CaseFormat[] values()</td><td>è¿”å›ä¸€ä¸ªåŒ…å«è¯¥æšä¸¾ç±»å‹çš„å¸¸é‡æ•°ç»„ä¸­çš„é¡ºåºè¢«å£°æ˜ã€‚</td></tr></tbody></table><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    String appCiNum <span class="token operator">=</span> CaseFormat<span class="token punctuation">.</span>LOWER_CAMEL<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>CaseFormat<span class="token punctuation">.</span>LOWER_UNDERSCORE<span class="token punctuation">,</span> <span class="token string">"appCiNum"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>appCiNum<span class="token punctuation">)</span><span class="token punctuation">;</span>    Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>appCiNum<span class="token punctuation">,</span> <span class="token string">"app_ci_num"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    appCiNum <span class="token operator">=</span> CaseFormat<span class="token punctuation">.</span>LOWER_UNDERSCORE<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>CaseFormat<span class="token punctuation">.</span>LOWER_CAMEL<span class="token punctuation">,</span> <span class="token string">"app_ci_num"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>appCiNum<span class="token punctuation">)</span><span class="token punctuation">;</span>    Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>appCiNum<span class="token punctuation">,</span> <span class="token string">"appCiNum"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>åªè¦æˆ‘ä»¬è‡ªå·±å®šçš„<code>DTO</code>æ˜¯æ ‡å‡†çš„ï¼Œé‚£ä¹ˆæ’åºæ˜¯å‰ç«¯åŒå­¦å°±æŒ‰ç…§æˆ‘ä»¬è¿”å›ç»™ä»–çš„å­—æ®µåœ¨ä¼ å›æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦ç”¨<code>CaseFormat</code>è¿›è¡Œè½¬æ¢å³å¯ï¼Œä¸ç„¶è¿˜å¾—ä¾æ¬¡è¿›è¡ŒmatchåŒ¹é…</p>]]></content>
      
      
      <categories>
          
          <category> Guava </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Guava </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mapå¯¹keyæˆ–è€…valueè¿›è¡Œæ’åº</title>
      <link href="2020/07/25/map-sort/"/>
      <url>2020/07/25/map-sort/</url>
      
        <content type="html"><![CDATA[<p>å¼€å‘ä¸­å¶å°”ä¼šé‡åˆ°ä¸€äº›æ¯”è¾ƒç‰¹æ®Šçš„éœ€æ±‚ï¼Œæ¯”å¦‚å¯¹ä¸€ä¸ªmapè¿›è¡Œæ’åºï¼Œå¹¶ä¸”æ˜¯å¯¹keyæˆ–è€…valueè¿›è¡Œæ’åºï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨Java8ä¸­æä¾›çš„<code>stream</code>æ¥è¿›è¡Œå®ç°</p><h2 id="æ’åºå·¥å…·ç±»"><a href="#æ’åºå·¥å…·ç±»" class="headerlink" title="æ’åºå·¥å…·ç±»"></a>æ’åºå·¥å…·ç±»</h2><p>å°è£…æ’åºå·¥å…·ç±»</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>common<span class="token punctuation">.</span>util<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>collect<span class="token punctuation">.</span>Lists<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>collect<span class="token punctuation">.</span>Maps<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Field<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Iterator<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>LinkedList<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020/5/25. */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapSortUtils</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * Sort by key map.     *     * @param &lt;K> the type parameter     * @param &lt;V> the type parameter     * @param map the map     * @return the map     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>K <span class="token keyword">extends</span> <span class="token class-name">Comparable</span><span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> K<span class="token operator">></span><span class="token punctuation">,</span> V<span class="token operator">></span> Map<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">></span> <span class="token function">sortByKey</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è¿™é‡Œä½¿ç”¨äº†guavaç®€åŒ–äº†mapå¯¹è±¡çš„åˆ›å»ºï¼Œæ²¡æœ‰guavaç›´æ¥ä½¿ç”¨ new LinkedHashMap&lt;>();</span>        Map<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">></span> result <span class="token operator">=</span> Maps<span class="token punctuation">.</span><span class="token function">newLinkedHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span>Map<span class="token punctuation">.</span>Entry<span class="token punctuation">.</span><span class="token function">comparingByKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEachOrdered</span><span class="token punctuation">(</span>e <span class="token operator">-</span><span class="token operator">></span> result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Sort reversed by key map.     *     * @param &lt;K> the type parameter     * @param &lt;V> the type parameter     * @param map the map     * @return the map     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>K <span class="token keyword">extends</span> <span class="token class-name">Comparable</span><span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> K<span class="token operator">></span><span class="token punctuation">,</span> V<span class="token operator">></span> Map<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">></span> <span class="token function">sortReversedByKey</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Map<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">></span> result <span class="token operator">=</span> Maps<span class="token punctuation">.</span><span class="token function">newLinkedHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span>Map<span class="token punctuation">.</span>Entry<span class="token punctuation">.</span>&lt;K<span class="token punctuation">,</span> V<span class="token operator">></span><span class="token function">comparingByKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">reversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEachOrdered</span><span class="token punctuation">(</span>e <span class="token operator">-</span><span class="token operator">></span> result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Sort by value map.     *     * @param &lt;K> the type parameter     * @param &lt;V> the type parameter     * @param map the map     * @return the map     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V <span class="token keyword">extends</span> <span class="token class-name">Comparable</span><span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> V<span class="token operator">>></span> Map<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">></span> <span class="token function">sortByValue</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Map<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">></span> result <span class="token operator">=</span> Maps<span class="token punctuation">.</span><span class="token function">newLinkedHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span>Map<span class="token punctuation">.</span>Entry<span class="token punctuation">.</span><span class="token function">comparingByValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEachOrdered</span><span class="token punctuation">(</span>e <span class="token operator">-</span><span class="token operator">></span> result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Sort reversed by value map.     *     * @param &lt;K> the type parameter     * @param &lt;V> the type parameter     * @param map the map     * @return the map     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V <span class="token keyword">extends</span> <span class="token class-name">Comparable</span><span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> V<span class="token operator">>></span> Map<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">></span> <span class="token function">sortReversedByValue</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Map<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">></span> result <span class="token operator">=</span> Maps<span class="token punctuation">.</span><span class="token function">newLinkedHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span>Map<span class="token punctuation">.</span>Entry<span class="token punctuation">.</span>&lt;K<span class="token punctuation">,</span> V<span class="token operator">></span><span class="token function">comparingByValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">reversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEachOrdered</span><span class="token punctuation">(</span>e <span class="token operator">-</span><span class="token operator">></span> result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Gets first key.     *     * @param &lt;K> the type parameter     * @param map the map     * @return the first key     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>K<span class="token operator">></span> K <span class="token function">getFirstKey</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> <span class="token operator">?</span><span class="token operator">></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Gets last key.     *     * @param &lt;K> the type parameter     * @param map the map     * @return the last key     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>K<span class="token operator">></span> K <span class="token function">getLastKey</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> <span class="token operator">?</span><span class="token operator">></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Iterator<span class="token operator">&lt;</span>K<span class="token operator">></span> iterator <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        LinkedList<span class="token operator">&lt;</span>K<span class="token operator">></span> list <span class="token operator">=</span> Lists<span class="token punctuation">.</span><span class="token function">newLinkedList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> list<span class="token punctuation">.</span><span class="token function">getLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Gets first.     *     * @param &lt;K> the type parameter     * @param &lt;V> the type parameter     * @param map the map     * @return the first     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">></span> Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">></span> <span class="token function">getFirst</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Gets last.     * &lt;p>     * é€šè¿‡åå°„è·å–LinkedHashMapä¸­çš„æœ«å°¾å…ƒç´ ï¼š     * &lt;p>     * æ—¶é—´å¤æ‚åº¦O(1)ï¼Œè®¿é—®tailå±æ€§     *     * @param &lt;K> the type parameter     * @param &lt;V> the type parameter     * @param map the map     * @return the last     * @throws IllegalAccessException the illegal access exception     * @throws NoSuchFieldException   the no such field exception     */</span>    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">></span> Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">></span> <span class="token function">getLast</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">></span> map<span class="token punctuation">)</span> <span class="token keyword">throws</span> IllegalAccessException<span class="token punctuation">,</span> NoSuchFieldException <span class="token punctuation">{</span>        Field tail <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"tail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        tail<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">></span><span class="token punctuation">)</span> tail<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>common<span class="token punctuation">.</span>tests<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>common<span class="token punctuation">.</span>util<span class="token punctuation">.</span>MapSortUtils<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>collect<span class="token punctuation">.</span>Maps<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Assert<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Before<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020/7/25. */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapSortTest</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Integer<span class="token operator">></span> DEF_DATA <span class="token operator">=</span> Maps<span class="token punctuation">.</span><span class="token function">newHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Before</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        DEF_DATA<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        DEF_DATA<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        DEF_DATA<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"z"</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        DEF_DATA<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testKeySort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// æŒ‰ç…§keyè¿›è¡Œæ­£åºæ’åº</span>        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Integer<span class="token operator">></span> sortByKey <span class="token operator">=</span> MapSortUtils<span class="token punctuation">.</span><span class="token function">sortByKey</span><span class="token punctuation">(</span>DEF_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// è·å–mapä¸­çš„ç¬¬ä¸€ä¸ªkey</span>        String firstKey <span class="token operator">=</span> MapSortUtils<span class="token punctuation">.</span><span class="token function">getFirstKey</span><span class="token punctuation">(</span>sortByKey<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// è·å–mapä¸­çš„æœ€åä¸€ä¸ªkey</span>        String lastKey <span class="token operator">=</span> MapSortUtils<span class="token punctuation">.</span><span class="token function">getLastKey</span><span class="token punctuation">(</span>sortByKey<span class="token punctuation">)</span><span class="token punctuation">;</span>        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>firstKey<span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>lastKey<span class="token punctuation">,</span> <span class="token string">"z"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// æŒ‰ç…§keyå¯¹mapè¿›è¡Œå€’åºæ’åº</span>        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Integer<span class="token operator">></span> reversedByKey <span class="token operator">=</span> MapSortUtils<span class="token punctuation">.</span><span class="token function">sortReversedByKey</span><span class="token punctuation">(</span>DEF_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>        firstKey <span class="token operator">=</span> MapSortUtils<span class="token punctuation">.</span><span class="token function">getFirstKey</span><span class="token punctuation">(</span>reversedByKey<span class="token punctuation">)</span><span class="token punctuation">;</span>        lastKey <span class="token operator">=</span> MapSortUtils<span class="token punctuation">.</span><span class="token function">getLastKey</span><span class="token punctuation">(</span>reversedByKey<span class="token punctuation">)</span><span class="token punctuation">;</span>        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>firstKey<span class="token punctuation">,</span> <span class="token string">"z"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>lastKey<span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchFieldException<span class="token punctuation">,</span> IllegalAccessException <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// æŒ‰ç…§valueè¿›è¡Œæ­£åºæ’åº</span>        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Integer<span class="token operator">></span> sortByValue <span class="token operator">=</span> MapSortUtils<span class="token punctuation">.</span><span class="token function">sortByValue</span><span class="token punctuation">(</span>DEF_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>        Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Integer<span class="token operator">></span> first <span class="token operator">=</span> MapSortUtils<span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span>sortByValue<span class="token punctuation">)</span><span class="token punctuation">;</span>        Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Integer<span class="token operator">></span> last <span class="token operator">=</span> MapSortUtils<span class="token punctuation">.</span><span class="token function">getLast</span><span class="token punctuation">(</span>sortByValue<span class="token punctuation">)</span><span class="token punctuation">;</span>        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>first<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> first<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>last<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> last<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// æŒ‰ç…§valueè¿›è¡Œå€’åºæ’åº</span>        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Integer<span class="token operator">></span> reversedByValue <span class="token operator">=</span> MapSortUtils<span class="token punctuation">.</span><span class="token function">sortReversedByValue</span><span class="token punctuation">(</span>DEF_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// è·å–æ’åºä»¥åçš„ç¬¬ä¸€ä¸ªä¸ªæœ€åä¸€ä¸ªå…ƒç´ </span>        first <span class="token operator">=</span> MapSortUtils<span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span>reversedByValue<span class="token punctuation">)</span><span class="token punctuation">;</span>        last <span class="token operator">=</span> MapSortUtils<span class="token punctuation">.</span><span class="token function">getLast</span><span class="token punctuation">(</span>reversedByValue<span class="token punctuation">)</span><span class="token punctuation">;</span>        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>first<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> first<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>last<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> last<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> map </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatiså¯¹è±¡ä¸­å±æ€§ åŒ…å«List&lt;String&gt;ä¸€å¯¹å¤šæ˜ å°„å¤„ç†æ–¹å¼</title>
      <link href="2020/07/19/mybatis-one-collection-basic-type/"/>
      <url>2020/07/19/mybatis-one-collection-basic-type/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨MyBatisæŸ¥è¯¢æ•°æ®åº“æ—¶ï¼Œç»å¸¸ä¼šæœ‰ä¸€å¯¹å¤šçš„æƒ…å†µï¼Œé‚£ä¹ˆåœ¨ä¸€å¯¹å¤šçš„æƒ…å†µæ—¶ï¼Œå¦‚æœæ˜¯ä¸€ä¸ª<code>Collection&lt;String&gt;</code>æˆ–è€…<code>Collection&lt;Integer&gt;</code>  ç±»å‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„<code>ResultMap</code>è¯¥å¦‚ä½•å®šä¹‰ï¼Ÿ</p><p>æ–¹æ³•å¾ˆç®€å•ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨åˆ°æ„é€ å‡½æ•°æ³¨å…¥äº†ï¼Œé€šè¿‡Integerå’ŒStringçš„æ„é€ å‡½æ•°æ³¨å…¥ï¼Œå…·ä½“çš„å­—æ®µåç§°è‡ªå·±å¯¹å¥½å…¥åº§å³å¯ã€‚</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>user_map<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span> <span class="token comment" spellcheck="true">&lt;!-- å¯¹å·å…¥åº§æ•°æ®åº“columnåç§°å³å¯ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>authorities<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java.lang.String<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>permission<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token comment" spellcheck="true">&lt;!-- å¯¹å·å…¥åº§æ•°æ®åº“columnåç§°å³å¯ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> MyBatis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MyBatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLæŸ¥çœ‹æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯ip</title>
      <link href="2020/06/29/mysql-show-client-connection/"/>
      <url>2020/06/29/mysql-show-client-connection/</url>
      
        <content type="html"><![CDATA[<p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æŸ¥çœ‹å½“å‰çš„mysqlæ•°æ®åº“ä¸­ï¼Œ æœ‰å“ªäº›å®¢æˆ·ç«¯ä¿æŒäº†è¿æ¥ï¼Œ æ¯ä¸ªå®¢æˆ·ç«¯åˆ†åˆ«ä¿æŒäº†å¤šå°‘è¿æ¥ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è¯­å¥æŸ¥è¯¢ç»“æœï¼Œå¯ä»¥ç›´è§‚çš„çœ‹åˆ°è¿æ¥æ•°ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> substring_index<span class="token punctuation">(</span>host<span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> hostname<span class="token punctuation">,</span>state<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>processlist <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> state<span class="token punctuation">,</span>hostname<span class="token punctuation">;</span></code></pre><p>è¾“å‡ºç»“æœï¼š</p><pre class=" language-shell"><code class="language-shell">mysql> SELECT substring_index(host, ':',1) AS hostname,state,count(*) FROM information_schema.processlist GROUP BY state,hostname;+----------------+-----------------------+----------+| hostname       | state                 | count(*) |+----------------+-----------------------+----------+| 10.2.1.12      |                       |        2 || 192.168.21.125 |                       |        2 || vm21122        |                       |       52 || localhost      | executing             |        1 || 192.168.21.125 | Receiving from client |        1 |+----------------+-----------------------+----------+5 rows in set (0.00 sec)mysql></code></pre><p>ä¼šåˆ—å‡ºæ¯ä¸ªipå½“å‰çš„çŠ¶æ€ï¼Œä»¥åŠå½“å‰çš„è¿æ¥æ•° ã€‚è¿™ä¸ªåœ¨å¤„ç†ç±»ä¼¼ç¢°åˆ°æ•°æ®åº“ Too Many Connections ç­‰çš„é”™è¯¯çš„æ—¶å€™æ¯”è¾ƒæœ‰ç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€è½¬ã€‘How can I prevent gson from converting integers to doubles</title>
      <link href="2020/06/28/gson-how-can-i-prevent-gson-from-converting-integers-to-doubles/"/>
      <url>2020/06/28/gson-how-can-i-prevent-gson-from-converting-integers-to-doubles/</url>
      
        <content type="html"><![CDATA[<p>å¤„ç†Gsonä¸­ï¼Œjsonè½¬æ¢mapé€ æˆçš„intå˜doubleçš„é—®é¢˜ã€‚</p><p><a href="https://stackoverflow.com/questions/36508323/how-can-i-prevent-gson-from-converting-integers-to-doubles">åŸæ–‡é“¾æ¥</a></p><p>MapDeserializerDoubleAsIntFix.java</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/***æœ€è¿‘åœ¨ç ”ç©¶ç½‘ç»œè¯·æ±‚æ•°æ®è§£æçš„é—®é¢˜ï¼Œå‘ç°jsonæ•°æ®è¢«å¼ºåˆ¶è½¬æ¢ä¸ºmapç»“æ„çš„æ—¶å€™ï¼Œä¼šå‡ºç°intå˜æˆdoubleçš„é—®é¢˜*åœ¨stackoverflowä¸Šçœ‹åˆ°äº†ä¸€ä¸ªè¿™ä¸ªHow can I prevent gson from converting integers to doubles çš„é—®é¢˜ï¼Œé‡‡ç”¨äº†è¿™ä¸ªç­”æ¡ˆ*https://stackoverflow.com/a/36529534/5279354ç­”æ¡ˆ*/</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span>JsonArray<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span>JsonDeserializationContext<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span>JsonDeserializer<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span>JsonElement<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span>JsonObject<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span>JsonParseException<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span>JsonPrimitive<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>LinkedTreeMap<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Type<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>ArrayList<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Set<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapDeserializerDoubleAsIntFix</span> <span class="token keyword">implements</span> <span class="token class-name">JsonDeserializer</span><span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">>></span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">deserialize</span><span class="token punctuation">(</span>JsonElement jsonElement<span class="token punctuation">,</span> Type type<span class="token punctuation">,</span> JsonDeserializationContext jsonDeserializationContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> JsonParseException <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span><span class="token punctuation">)</span> <span class="token function">read</span><span class="token punctuation">(</span>jsonElement<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> Object <span class="token function">read</span><span class="token punctuation">(</span>JsonElement in<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>in<span class="token punctuation">.</span><span class="token function">isJsonArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            List<span class="token operator">&lt;</span>Object<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            JsonArray arr <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">getAsJsonArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>JsonElement anArr <span class="token operator">:</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>anArr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> list<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>in<span class="token punctuation">.</span><span class="token function">isJsonObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedTreeMap</span><span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            JsonObject obj <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">getAsJsonObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            Set<span class="token operator">&lt;</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> JsonElement<span class="token operator">>></span> entitySet <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> JsonElement<span class="token operator">></span> entry<span class="token operator">:</span> entitySet<span class="token punctuation">)</span><span class="token punctuation">{</span>                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">read</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> map<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> in<span class="token punctuation">.</span><span class="token function">isJsonPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            JsonPrimitive prim <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">getAsJsonPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>prim<span class="token punctuation">.</span><span class="token function">isBoolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">return</span> prim<span class="token punctuation">.</span><span class="token function">getAsBoolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>prim<span class="token punctuation">.</span><span class="token function">isString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">return</span> prim<span class="token punctuation">.</span><span class="token function">getAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>prim<span class="token punctuation">.</span><span class="token function">isNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                Number num <span class="token operator">=</span> prim<span class="token punctuation">.</span><span class="token function">getAsNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// here you can handle double int/long values</span>                <span class="token comment" spellcheck="true">// and return any type you want</span>                <span class="token comment" spellcheck="true">// this solution will transform 3.0 float to long values</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token operator">==</span> num<span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token keyword">return</span> num<span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">else</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> num<span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        String json <span class="token operator">=</span> <span class="token string">"{\"data\":[{\"id\":1,\"quantity\":2,\"name\":\"apple\"}, {\"id\":3,\"quantity\":4,\"name\":\"orange\"}]}"</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"json == "</span> <span class="token operator">+</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//        Map&lt;String, Object> map = new LinkedTreeMap&lt;>();</span><span class="token comment" spellcheck="true">//        map = new Gson().fromJson(json, map.getClass());</span><span class="token comment" spellcheck="true">//        System.out.println(map);</span>        GsonBuilder gsonBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GsonBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gsonBuilder<span class="token punctuation">.</span><span class="token function">registerTypeAdapter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeToken</span><span class="token operator">&lt;</span>Map <span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token keyword">new</span> <span class="token class-name">MapDeserializerDoubleAsIntFix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Gson gson <span class="token operator">=</span> gsonBuilder<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TypeToken</span><span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å‚è€ƒæ–‡ç« </p><p><a href="https://gist.github.com/xingstarx/5ddc14ff6ca68ba4097815c90d1c47cc">https://gist.github.com/xingstarx/5ddc14ff6ca68ba4097815c90d1c47cc</a></p><p><a href="https://blog.csdn.net/ligeforrent/article/details/93759524">https://blog.csdn.net/ligeforrent/article/details/93759524</a></p>]]></content>
      
      
      <categories>
          
          <category> Gson </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gson </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å½“Gsoné‡ä¸ŠJava8ä¸­çš„æ—¥æœŸAPI</title>
      <link href="2020/06/23/gson-java8-datetime/"/>
      <url>2020/06/23/gson-java8-datetime/</url>
      
        <content type="html"><![CDATA[<p>â€ƒJava8å¼€å§‹ï¼ŒJDKä¸­æä¾›äº†ä¸€ç»„æ–°çš„æ—¥æœŸ<code>API</code>ï¼Œå½“æˆ‘ä»¬éœ€è¦åºåˆ—åŒ–æ•°æ®æˆjsonæ—¶ï¼Œç»å¸¸ä¼šç”¨åˆ°<code>Gson</code>ã€‚å½“<code>Java8</code>ä¸­çš„æ—¥æœŸ<code>API</code>é‡ä¸Š<code>Gson</code>æ—¶ï¼Œèƒ½å¦æŒ‰ç…§é¢„æœŸçš„æƒ³æ³•æ­£å¸¸çš„å¤„ç†æˆ‘ä»¬çš„æ•°æ®å‘¢ï¼Ÿ</p><h2 id="ä½¿ç”¨Gsonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–"><a href="#ä½¿ç”¨Gsonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–" class="headerlink" title="ä½¿ç”¨Gsonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–"></a>ä½¿ç”¨Gsonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h2><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  LocalDateTime dateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  LocalDate date <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Gson gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  String json <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">)</span><span class="token punctuation">;</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"dateTime Serialization:{}"</span><span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"dateTime Deserialization:{}"</span><span class="token punctuation">,</span> gson<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> LocalDateTime<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  json <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"date Serialization:{}"</span><span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"date Deserialization:{}"</span><span class="token punctuation">,</span> gson<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> LocalDate<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="LocalDateTime"><a href="#LocalDateTime" class="headerlink" title="LocalDateTime"></a>LocalDateTime</h3><ul><li>åºåˆ—åŒ–çš„ç»“æœ</li></ul><pre class=" language-verilog"><code class="language-verilog">dateTime Serialization<span class="token punctuation">:</span><span class="token operator">{</span><span class="token string">"date"</span><span class="token punctuation">:</span><span class="token operator">{</span><span class="token string">"year"</span><span class="token punctuation">:</span><span class="token number">2020</span><span class="token punctuation">,</span><span class="token string">"month"</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">"day"</span><span class="token punctuation">:</span><span class="token number">23</span><span class="token operator">}</span><span class="token punctuation">,</span><span class="token string">"time"</span><span class="token punctuation">:</span><span class="token operator">{</span><span class="token string">"hour"</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token string">"minute"</span><span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">,</span><span class="token string">"second"</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string">"nano"</span><span class="token punctuation">:</span><span class="token number">987000000</span><span class="token operator">}}</span></code></pre><ul><li>ååºåˆ—åŒ–ç»“æœ</li></ul><pre class=" language-verilog"><code class="language-verilog">dateTime Deserialization<span class="token punctuation">:</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">23</span>T21<span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">:</span><span class="token number">20.987</span></code></pre><h3 id="LocalDate"><a href="#LocalDate" class="headerlink" title="LocalDate"></a>LocalDate</h3><ul><li>åºåˆ—åŒ–çš„ç»“æœ</li></ul><pre class=" language-verilog"><code class="language-verilog">date Serialization<span class="token punctuation">:</span><span class="token operator">{</span><span class="token string">"year"</span><span class="token punctuation">:</span><span class="token number">2020</span><span class="token punctuation">,</span><span class="token string">"month"</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">"day"</span><span class="token punctuation">:</span><span class="token number">23</span><span class="token operator">}</span></code></pre><ul><li>ååºåˆ—åŒ–ç»“æœ</li></ul><pre class=" language-verilog"><code class="language-verilog">date Deserialization<span class="token punctuation">:</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">23</span></code></pre><p>æˆ‘ä»¬ä¼šå‘ç°ï¼Œåºåˆ—åŒ–çš„ç»“æœä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæ­£å¸¸åº”è¯¥æ˜¯ä¸€ä¸ª<code>ISO</code>æ ¼å¼çš„æ—¶é—´æ‰å¯¹ï¼Œä½†æ˜¯å´æˆäº†ä¸€ä¸ª<code>JsonObject</code>ã€‚å¾ˆæ˜¾ç„¶è¿™æ˜¯ä¸æ»¡è¶³æˆ‘ä»¬éœ€æ±‚çš„ã€‚</p><h2 id="åˆ†æåºåˆ—åŒ–ç»“æœä¸æ˜¯ISOæ ¼å¼çš„åŸå› "><a href="#åˆ†æåºåˆ—åŒ–ç»“æœä¸æ˜¯ISOæ ¼å¼çš„åŸå› " class="headerlink" title="åˆ†æåºåˆ—åŒ–ç»“æœä¸æ˜¯ISOæ ¼å¼çš„åŸå› "></a>åˆ†æåºåˆ—åŒ–ç»“æœä¸æ˜¯<code>ISO</code>æ ¼å¼çš„åŸå› </h2><p>é€šè¿‡æºç åˆ†æï¼Œ<code>LocalDateTime</code>ä¸­å¼•ç”¨äº†<code>LocalDate</code></p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/*** The date part.*/</span><span class="token keyword">private</span> <span class="token keyword">final</span> LocalDate date<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*** The time part.*/</span><span class="token keyword">private</span> <span class="token keyword">final</span> LocalTime time<span class="token punctuation">;</span></code></pre><p>å…¶ä¸­<code>LocalDate</code>å’Œ<code>LocalTime</code>çš„éƒ¨åˆ†æºç å¦‚ä¸‹</p><ul><li>LocalDate</li></ul><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/*** The year.*/</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> year<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*** The month-of-year.*/</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">short</span> month<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*** The day-of-month.*/</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">short</span> day<span class="token punctuation">;</span></code></pre><ul><li>LocalTime</li></ul><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/*** The hour.*/</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">byte</span> hour<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*** The minute.*/</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">byte</span> minute<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*** The second.*/</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">byte</span> second<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*** The nanosecond.*/</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> nano<span class="token punctuation">;</span></code></pre><p>â€ƒå¯ä»¥çœ‹åˆ°ï¼Œ<code>LocalDate</code>å’Œ<code>LocalTime</code>ï¼Œæˆ‘ä»¬åºåˆ—åŒ–<code>Java8</code>ä¸­çš„æ—¥æœŸ<code>API</code>ï¼Œå®é™…ä¸Šæ˜¯æŠŠæˆå‘˜å˜é‡åºåˆ—åŒ–ï¼Œæ˜¯æ­£å¸¸çš„ä¸€ä¸ªåºåˆ—åŒ–å¯¹è±¡çš„é€»è¾‘ã€‚ä½†æ˜¯æˆ‘ä»¬è‚¯å®šæ˜¯ä¸å¸Œæœ›è¿™æ ·çš„ç»“æœï¼Œå¯¹æˆ‘ä»¬æ¥è¯´å¹¶ä¸æ˜¯ç‰¹åˆ«å‹å¥½ã€‚é‚£ä¹ˆæ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p><h2 id="è‡ªå®šä¹‰Gsonçš„Adapterè§£å†³è¯¥é—®é¢˜"><a href="#è‡ªå®šä¹‰Gsonçš„Adapterè§£å†³è¯¥é—®é¢˜" class="headerlink" title="è‡ªå®šä¹‰Gsonçš„Adapterè§£å†³è¯¥é—®é¢˜"></a>è‡ªå®šä¹‰<code>Gson</code>çš„<code>Adapter</code>è§£å†³è¯¥é—®é¢˜</h2><p><code>Gson</code>æœ¬èº«ç»™æˆ‘ä»¬æä¾›äº†å„ç§å„æ ·çš„é…ç½®ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå°±æ˜¯å¯ä»¥è‡ªå®šä¹‰åºåˆ—åŒ–æˆ–è€…ååºåˆ—åŒ–çš„<code>Adapter</code>ï¼Œé‚£ä¹ˆæ—¢ç„¶ç°åœ¨æˆ‘ä»¬åºåˆ—åŒ–ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œå°±å¯ä»¥é€šè¿‡è‡ªå®šä¹‰<code>Adapter</code>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒåºŸè¯ä¸è¯´ï¼Œç›´æ¥ä¸Šä»£ç æ¼”ç¤ºã€‚</p><h3 id="è‡ªå®šä¹‰LocalDateAdapter"><a href="#è‡ªå®šä¹‰LocalDateAdapter" class="headerlink" title="è‡ªå®šä¹‰LocalDateAdapter"></a>è‡ªå®šä¹‰LocalDateAdapter</h3><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/*** Created by xiaozhangge on 2020/6/23.* &lt;p>* å¤„ç†LocalDateçš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–*/</span><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">LocalDateAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">JsonSerializer</span><span class="token operator">&lt;</span>LocalDate<span class="token operator">></span><span class="token punctuation">,</span> JsonDeserializer<span class="token operator">&lt;</span>LocalDate<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> JsonElement <span class="token function">serialize</span><span class="token punctuation">(</span>LocalDate date<span class="token punctuation">,</span> Type typeOfSrc<span class="token punctuation">,</span> JsonSerializationContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JsonPrimitive</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span>ISO_LOCAL_DATE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> LocalDate <span class="token function">deserialize</span><span class="token punctuation">(</span>JsonElement element<span class="token punctuation">,</span> Type type<span class="token punctuation">,</span> JsonDeserializationContext context<span class="token punctuation">)</span> <span class="token keyword">throws</span> JsonParseException <span class="token punctuation">{</span>        String timestamp <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">getAsJsonPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> LocalDate<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">,</span> DateTimeFormatter<span class="token punctuation">.</span>ISO_LOCAL_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="è‡ªå®šä¹‰LocalDateTimeAdapter"><a href="#è‡ªå®šä¹‰LocalDateTimeAdapter" class="headerlink" title="è‡ªå®šä¹‰LocalDateTimeAdapter"></a>è‡ªå®šä¹‰LocalDateTimeAdapter</h3><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/*** Created by xiaozhangge on 2020/6/23.* &lt;p>* å¤„ç†LocalDateTimeåºåˆ—åŒ–ä¸ååºåˆ—åŒ–*/</span><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">LocalDateTimeAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">JsonSerializer</span><span class="token operator">&lt;</span>LocalDateTime<span class="token operator">></span><span class="token punctuation">,</span> JsonDeserializer<span class="token operator">&lt;</span>LocalDateTime<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> JsonElement <span class="token function">serialize</span><span class="token punctuation">(</span>LocalDateTime date<span class="token punctuation">,</span> Type typeOfSrc<span class="token punctuation">,</span> JsonSerializationContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JsonPrimitive</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span>ISO_LOCAL_DATE_TIME<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> LocalDateTime <span class="token function">deserialize</span><span class="token punctuation">(</span>JsonElement element<span class="token punctuation">,</span> Type type<span class="token punctuation">,</span> JsonDeserializationContext context<span class="token punctuation">)</span> <span class="token keyword">throws</span> JsonParseException <span class="token punctuation">{</span>        String timestamp <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">getAsJsonPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">,</span> DateTimeFormatter<span class="token punctuation">.</span>ISO_LOCAL_DATE_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="ä½¿ç”¨è‡ªå®šä¹‰Adapter"><a href="#ä½¿ç”¨è‡ªå®šä¹‰Adapter" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰Adapter"></a>ä½¿ç”¨è‡ªå®šä¹‰Adapter</h3><p>æ—¢ç„¶æˆ‘ä»¬ç°åœ¨è‡ªå®šä¹‰äº†<code>Adapter</code>ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨æ—¶å°±éœ€è¦å°†å®ƒæ³¨å†Œåˆ°<code>gson</code>å¯¹è±¡ä¸­å»ã€‚åœ¨åˆ›å»º<code>gson</code>å¯¹è±¡æ—¶å°±ä¸èƒ½ç›´æ¥ä½¿ç”¨<code>Gson gson = new Gson()</code>ï¼Œè€Œæ˜¯è¦ä½¿ç”¨<code>GsonBuilder</code>å»è¿›è¡Œæ„å»ºã€‚</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// å®ä¾‹åŒ–gsonå¯¹è±¡æ—¶æ³¨å†ŒAdapter</span>Gson gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GsonBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">registerTypeAdapter</span><span class="token punctuation">(</span>LocalDate<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">JsonParse<span class="token punctuation">.</span>LocalDateAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">registerTypeAdapter</span><span class="token punctuation">(</span>LocalDateTime<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">JsonParse<span class="token punctuation">.</span>LocalDateTimeAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä¸Šé¢æˆ‘ä»¬çš„ä»£ç åºåˆ—åŒ–ä¸ååºåˆ—æ—¶å°±ä½¿ç”¨æ³¨å†Œäº†Adapterçš„gsonå¯¹è±¡å³å¯</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  LocalDateTime dateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  LocalDate date <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Gson gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GsonBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">registerTypeAdapter</span><span class="token punctuation">(</span>LocalDate<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> JsonParse<span class="token punctuation">.</span>LocalDateAdapter<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">registerTypeAdapter</span><span class="token punctuation">(</span>LocalDateTime<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> JsonParse<span class="token punctuation">.</span>LocalDateTimeAdapter<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  String json <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">)</span><span class="token punctuation">;</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"dateTime Serialization:{}"</span><span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"dateTime Deserialization:{}"</span><span class="token punctuation">,</span> gson<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> LocalDateTime<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  json <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"date Serialization:{}"</span><span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"date Deserialization:{}"</span><span class="token punctuation">,</span> gson<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> LocalDate<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h4 id="LocalDateTime-1"><a href="#LocalDateTime-1" class="headerlink" title="LocalDateTime"></a>LocalDateTime</h4><pre class=" language-verilog"><code class="language-verilog">dateTime Serialization<span class="token punctuation">:</span><span class="token string">"2020-06-23T22:22:10.816"</span>dateTime Deserialization<span class="token punctuation">:</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">23</span>T22<span class="token punctuation">:</span><span class="token number">22</span><span class="token punctuation">:</span><span class="token number">10.816</span></code></pre><h4 id="LocalDate-1"><a href="#LocalDate-1" class="headerlink" title="LocalDate"></a>LocalDate</h4><pre class=" language-verilog"><code class="language-verilog">date Serialization<span class="token punctuation">:</span><span class="token string">"2020-06-23"</span>date Deserialization<span class="token punctuation">:</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">23</span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è‡ªå®šä¹‰Adapterä»¥åï¼Œåºåˆ—åŒ–çš„ç»“æœå°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„<code>ISO</code>ç±»å‹ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å°†æ—¥æœŸæ ¼å¼åºåˆ—è¯æˆè‡ªå·±æƒ³è¦çš„ä»»æ„æ ¼å¼ã€‚</p><h2 id="Jsonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–å·¥å…·ç±»"><a href="#Jsonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–å·¥å…·ç±»" class="headerlink" title="Jsonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–å·¥å…·ç±»"></a>Jsonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–å·¥å…·ç±»</h2><p>åˆ†äº«ä¸€ä¸ªæ—¥å¸¸ä½¿ç”¨å·¥å…·ç±»ï¼Œé™¤äº†ä¸Šæ–‡è¯´åˆ°çš„å…³äºæ—¥æœŸå¤„ç†çš„è§£å†³æ–¹æ¡ˆï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚è¿™ä¸ªç•™ç€ä¸‹ä¸€ç¯‡æ–‡ç« è®²ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>util<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span>*<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>LinkedTreeMap<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>TypeToken<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Type<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span>StandardCharsets<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalDate<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalDateTime<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>format<span class="token punctuation">.</span>DateTimeFormatter<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>ArrayList<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Set<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020/6/23. */</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JsonParse</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> Type MAP_STR_OBJ_TYPE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypeToken</span><span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> Gson GSON <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GsonBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">registerTypeAdapter</span><span class="token punctuation">(</span>MAP_STR_OBJ_TYPE<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MapDeserializerDoubleAsIntFix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">registerTypeAdapter</span><span class="token punctuation">(</span>LocalDate<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LocalDateAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">registerTypeAdapter</span><span class="token punctuation">(</span>LocalDateTime<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LocalDateTimeAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * To json string.     *     * @param bean the bean     * @return the string     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">toJson</span><span class="token punctuation">(</span>Object bean<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> GSON<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>bean<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * To json string.     *     * @param builder the builder     * @param bean    the bean     * @return the string     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">toJson</span><span class="token punctuation">(</span>GsonBuilder builder<span class="token punctuation">,</span> Object bean<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>bean<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Parse t.     *     * @param &lt;T>  the type parameter     * @param json the json     * @param clz  the clz     * @return the t     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> T <span class="token function">parse</span><span class="token punctuation">(</span>String json<span class="token punctuation">,</span> Class<span class="token operator">&lt;</span>T<span class="token operator">></span> clz<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> GSON<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> clz<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Parse t.     *     * @param &lt;T>     the type parameter     * @param builder the builder     * @param json    the json     * @param clz     the clz     * @return the t     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> T <span class="token function">parse</span><span class="token punctuation">(</span>GsonBuilder builder<span class="token punctuation">,</span> String json<span class="token punctuation">,</span> Class<span class="token operator">&lt;</span>T<span class="token operator">></span> clz<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> clz<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Parse t.     *     * @param &lt;T>  the type parameter     * @param json the json     * @param type the type     * @return the t     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> T <span class="token function">parse</span><span class="token punctuation">(</span>String json<span class="token punctuation">,</span> Type type<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> GSON<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Parse t.     *     * @param &lt;T>     the type parameter     * @param builder the builder     * @param json    the json     * @param type    the type     * @return the t     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> T <span class="token function">parse</span><span class="token punctuation">(</span>GsonBuilder builder<span class="token punctuation">,</span> String json<span class="token punctuation">,</span> Type type<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * To json bytes byte [ ].     *     * @param value the value     * @return the byte [ ]     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">toJsonBytes</span><span class="token punctuation">(</span>Object value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">toJson</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>StandardCharsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Created by xiaozhangge on 2020/6/4.     * &lt;p>     * å¤„ç†LocalDateçš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–     */</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">LocalDateAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">JsonSerializer</span><span class="token operator">&lt;</span>LocalDate<span class="token operator">></span><span class="token punctuation">,</span> JsonDeserializer<span class="token operator">&lt;</span>LocalDate<span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> JsonElement <span class="token function">serialize</span><span class="token punctuation">(</span>LocalDate date<span class="token punctuation">,</span> Type typeOfSrc<span class="token punctuation">,</span> JsonSerializationContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JsonPrimitive</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span>ISO_LOCAL_DATE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> LocalDate <span class="token function">deserialize</span><span class="token punctuation">(</span>JsonElement element<span class="token punctuation">,</span> Type type<span class="token punctuation">,</span> JsonDeserializationContext context<span class="token punctuation">)</span> <span class="token keyword">throws</span> JsonParseException <span class="token punctuation">{</span>            String timestamp <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">getAsJsonPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> LocalDate<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">,</span> DateTimeFormatter<span class="token punctuation">.</span>ISO_LOCAL_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Created by xiaozhangge on 2020/6/4.     * &lt;p>     * å¤„ç†LocalDateTimeåºåˆ—åŒ–ä¸ååºåˆ—åŒ–     */</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">LocalDateTimeAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">JsonSerializer</span><span class="token operator">&lt;</span>LocalDateTime<span class="token operator">></span><span class="token punctuation">,</span> JsonDeserializer<span class="token operator">&lt;</span>LocalDateTime<span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> JsonElement <span class="token function">serialize</span><span class="token punctuation">(</span>LocalDateTime date<span class="token punctuation">,</span> Type typeOfSrc<span class="token punctuation">,</span> JsonSerializationContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JsonPrimitive</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span>ISO_LOCAL_DATE_TIME<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> LocalDateTime <span class="token function">deserialize</span><span class="token punctuation">(</span>JsonElement element<span class="token punctuation">,</span> Type type<span class="token punctuation">,</span> JsonDeserializationContext context<span class="token punctuation">)</span> <span class="token keyword">throws</span> JsonParseException <span class="token punctuation">{</span>            String timestamp <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">getAsJsonPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">,</span> DateTimeFormatter<span class="token punctuation">.</span>ISO_LOCAL_DATE_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Created by xiaozhangge on 2020/6/4.     * &lt;p>     * https://gist.github.com/xingstarx/5ddc14ff6ca68ba4097815c90d1c47cc     * &lt;p>     * https://stackoverflow.com/questions/36508323/how-can-i-prevent-gson-from-converting-integers-to-doubles/36529534#36529534     * &lt;p>     * &lt;p>     * è§£å†³jsonæ•°æ®è½¬æ¢ä¸ºmapç»“æ„çš„æ—¶å€™ï¼Œä¼šå‡ºç°intå˜æˆdoubleçš„é—®é¢˜     */</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MapDeserializerDoubleAsIntFix</span> <span class="token keyword">implements</span> <span class="token class-name">JsonDeserializer</span><span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">>></span> <span class="token punctuation">{</span>        <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">deserialize</span><span class="token punctuation">(</span>JsonElement element<span class="token punctuation">,</span> Type type<span class="token punctuation">,</span> JsonDeserializationContext context<span class="token punctuation">)</span> <span class="token keyword">throws</span> JsonParseException <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span><span class="token punctuation">)</span> <span class="token function">read</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">private</span> Object <span class="token function">read</span><span class="token punctuation">(</span>JsonElement in<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>in<span class="token punctuation">.</span><span class="token function">isJsonArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                List<span class="token operator">&lt;</span>Object<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                JsonArray arr <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">getAsJsonArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span>JsonElement anArr <span class="token operator">:</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>anArr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">return</span> list<span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>in<span class="token punctuation">.</span><span class="token function">isJsonObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedTreeMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                JsonObject obj <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">getAsJsonObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                Set<span class="token operator">&lt;</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> JsonElement<span class="token operator">>></span> entitySet <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> JsonElement<span class="token operator">></span> entry <span class="token operator">:</span> entitySet<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">read</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">return</span> map<span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>in<span class="token punctuation">.</span><span class="token function">isJsonPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                JsonPrimitive prim <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">getAsJsonPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>prim<span class="token punctuation">.</span><span class="token function">isBoolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">return</span> prim<span class="token punctuation">.</span><span class="token function">getAsBoolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>prim<span class="token punctuation">.</span><span class="token function">isString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">return</span> prim<span class="token punctuation">.</span><span class="token function">getAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>prim<span class="token punctuation">.</span><span class="token function">isNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    Number num <span class="token operator">=</span> prim<span class="token punctuation">.</span><span class="token function">getAsNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment" spellcheck="true">// here you can handle double int/long values</span>                    <span class="token comment" spellcheck="true">// and return any type you want</span>                    <span class="token comment" spellcheck="true">// this solution will transform 3.0 float to long values</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> num<span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                        <span class="token keyword">return</span> num<span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">else</span> <span class="token punctuation">{</span>                        <span class="token keyword">return</span> num<span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> null<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Gson </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gson </tag>
            
            <tag> Java8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxå¼€å¯gzipå‹ç¼©</title>
      <link href="2020/06/18/nginx-enable-gzip/"/>
      <url>2020/06/18/nginx-enable-gzip/</url>
      
        <content type="html"><![CDATA[<p>åœ¨serverèŠ‚ç‚¹ä¸‹æ–°å¢å¦‚ä¸‹å†…å®¹ï¼Œå¼€å¯gzipå‹ç¼©ã€‚æ³¨æ„åç«¯éœ€è¦ä¿è¯è¿”å›çš„ <strong>Content-Type: application/json;charset=UTF-8</strong></p><pre class=" language-shell"><code class="language-shell">gzip  on;gzip_min_length  1k;gzip_comp_level  6;gzip_proxied     expired no-cache no-store private auth;gzip_types       text/plain application/x-javascript text/css application/xml application/javascript application/json;</code></pre><p><img src="/images/nginx-gzip/nginx-gzip-configure.jpg" alt="é…ç½®"></p><p>æˆåŠŸä»¥åå¯ä»¥çœ‹åˆ°</p><p><strong>Content-Encoding: gzip</strong></p><p><img src="/images/nginx-gzip/nginx-gzip-result.jpg" alt="ç»“æœ"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­£åˆ™è¡¨è¾¾å¼</title>
      <link href="2020/03/18/tools-regex/"/>
      <url>2020/03/18/tools-regex/</url>
      
        <content type="html"><![CDATA[<h2 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h2><h3 id="å…ƒå­—ç¬¦"><a href="#å…ƒå­—ç¬¦" class="headerlink" title="å…ƒå­—ç¬¦"></a>å…ƒå­—ç¬¦</h3><table><thead><tr><th align="center">å…ƒå­—ç¬¦</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">.</td><td align="center">åŒ¹é…é™¤äº†æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å­—ç¬¦</td></tr><tr><td align="center">*</td><td align="center">æŒ‡å®š*å‰è¾¹çš„å†…å®¹å¯ä»¥è¿ç»­é‡å¤ä½¿ç”¨ä»»æ„æ¬¡ä»¥ä½¿æ•´ä¸ªè¡¨è¾¾å¼å¾—åˆ°åŒ¹é…</td></tr><tr><td align="center">.*</td><td align="center">ä»»æ„æ•°é‡çš„ä¸åŒ…å«æ¢è¡Œçš„å­—ç¬¦</td></tr><tr><td align="center">\b</td><td align="center">å•è¯çš„å¼€å¤´æˆ–ç»“å°¾ï¼Œä¹Ÿå°±æ˜¯å•è¯çš„åˆ†ç•Œå¤„</td></tr><tr><td align="center">\w</td><td align="center">åŒ¹é…å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€æ±‰å­—</td></tr><tr><td align="center">\s</td><td align="center">åŒ¹é…ä»»æ„ç©ºç™½å­—ç¬¦</td></tr><tr><td align="center">\d</td><td align="center">åŒ¹é…æ•°å­—</td></tr><tr><td align="center">^</td><td align="center">åŒ¹é…å­—ç¬¦ä¸²å¼€å§‹</td></tr><tr><td align="center">$</td><td align="center">åŒ¹é…å­—ç¬¦ä¸²ç»“æŸ</td></tr></tbody></table><p>åä¹‰</p><table><thead><tr><th align="center">å…ƒå­—ç¬¦</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">\W</td><td align="center">åŒ¹é…éå­—æ¯ã€ä¸‹åˆ’çº¿ã€æ•°å­—ã€æ±‰å­—</td></tr><tr><td align="center">\S</td><td align="center">åŒ¹é…ä¸æ˜¯ç©ºç™½å­—ç¬¦ä¸²</td></tr><tr><td align="center">\D</td><td align="center">åŒ¹é…ä»»æ„éæ•°å­—çš„å­—ç¬¦</td></tr><tr><td align="center">\B</td><td align="center">åŒ¹é…ä¸æ˜¯å•è¯å¼€å§‹æˆ–è€…ç»“æŸçš„ä½ç½®</td></tr><tr><td align="center">[^x]</td><td align="center">åŒ¹é…é™¤äº†<code>x</code>ä»¥å¤–çš„ä»»æ„å­—ç¬¦</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> æ­£åˆ™è¡¨è¾¾å¼ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>verticaå¼€å¯ROS</title>
      <link href="2020/03/12/vertica-enable-ros/"/>
      <url>2020/03/12/vertica-enable-ros/</url>
      
        <content type="html"><![CDATA[<p>verticaé»˜è®¤æ‰¹é‡æ’å…¥æ˜¯å…³é—­çš„ï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½®<code>DataSourceProperties</code>å¼€å¯ï¼Œè¯¦ç»†å‚è€ƒ<code>JDBC Connection Properties</code>ï¼Œæ–‡æ¡£ä¸­è¯¥å‚æ•°ä»‹ç»å¦‚ä¸‹ï¼š</p><ul><li>DirectBatchInsert</li></ul><blockquote><p>Determines whether a batch insert stored data directly into <a href="../../Glossary/ROSReadOptimizedStore.htm">ROS</a> (true) or using <a href="javascript:void(0);">AUTO</a> mode (false).</p><p>When you load data using AUTO mode, Vertica inserts the data first into the <a href="../../Glossary/WOSWriteOptimizedStore.htm">WOS</a>. If the WOS is full, Vertica inserts the data directly into <a href="../../Glossary/ROSReadOptimizedStore.htm">ROS</a>. For details about load options, see <a href="../../AdministratorsGuide/BulkLoadCOPY/ChoosingALoadMethod.htm">Choosing a Load Method</a>.</p><p><strong>Set After Connection:</strong><code> VerticaConnection.setProperty()</code></p><p><strong>Default Value:</strong> false</p></blockquote><p>åœ¨jdbcæ–¹å¼å’Œspringä¸­é›†æˆæ•°æ®æºæ–¹å¼ç•¥æœ‰ä¸åŒï¼Œä¸‹é¢åˆ†å¼€ä»‹ç»</p><h3 id="JDBCæ–¹å¼"><a href="#JDBCæ–¹å¼" class="headerlink" title="JDBCæ–¹å¼"></a><code>JDBC</code>æ–¹å¼</h3><p>jdbcæ–¹å¼é…ç½®æ¯”è¾ƒçµæ´»ï¼Œå¯ä»¥åœ¨<code>DriverManager.getConnection</code>è·å–è¿æ¥è®¾ç½®å±æ€§</p><p>ä¹Ÿå¯ä»¥è·å–åˆ°<code>connection</code>ä»¥åè®¾ç½®</p><ul><li>è·å–è¿æ¥æ—¶</li></ul><pre class=" language-java"><code class="language-java">Properties myProp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>myProp<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"ExampleUser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>myProp<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span> <span class="token string">"password123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Enable directBatchInsert for this connection</span>myProp<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"DirectBatchInsert"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Connection conn<span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">{</span>    conn <span class="token operator">=</span> DriverManager<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>         <span class="token string">"jdbc:vertica://VerticaHost:5433/ExampleDB"</span><span class="token punctuation">,</span> myProp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span></code></pre><ul><li>è·å–è¿æ¥å</li></ul><pre class=" language-java"><code class="language-java"><span class="token punctuation">(</span><span class="token punctuation">(</span>VerticaConnection<span class="token punctuation">)</span>conn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"DirectBatchInsert"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="ä½¿ç”¨HikariDataSourceè¿æ¥æ± "><a href="#ä½¿ç”¨HikariDataSourceè¿æ¥æ± " class="headerlink" title="ä½¿ç”¨HikariDataSourceè¿æ¥æ± "></a>ä½¿ç”¨<code>HikariDataSource</code>è¿æ¥æ± </h3><p>å½“æˆ‘ä»¬ä½¿ç”¨springæ¡†æ¶å¼€å‘æ—¶ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨æ•°æ®åº“è¿æ¥æ± å¯¹è±¡ï¼Œspring bootä¸­é»˜è®¤çš„è¿æ¥æ± æ˜¯<code>HikariCP</code>ï¼Œä¸‹é¢ä»‹ç»``HikariCP`å¦‚ä½•é…ç½®è¯¥å‚æ•°ï¼Œæ€è·¯å¯ä»¥å‚è€ƒä½¿ç”¨jdbcæ—¶è·å–è¿æ¥ä»¥åçš„æ–¹å¼ã€‚</p><p>ä½†æ˜¯åˆå› ä¸ºspringä¸­çš„beanæ˜¯åŸºäºproxyè¿›è¡Œåˆ›å»ºçš„ï¼Œæ‰€æœ‰æˆ‘ä»¬è·å–åˆ°çš„è¿æ¥å¯¹è±¡ä¸å†æ˜¯<code>VerticaConnection</code>ï¼Œè€Œæ˜¯<code>HikariProxyConnection</code>ï¼Œä½†æ˜¯è¯¥å¯¹è±¡å¹¶æ²¡æœ‰<code>setProperty()</code>æ–¹æ³•ï¼Œæ‰€ä»¥<strong>ä¸èƒ½ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢å¹¶ä¸”è®¾ç½®è¯¥å±æ€§</strong>ã€‚</p><pre class=" language-java"><code class="language-java">Connection connection <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">boolean</span> flag1 <span class="token operator">=</span> connection <span class="token keyword">instanceof</span> <span class="token class-name">com<span class="token punctuation">.</span>vertica<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>VerticaConnection</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// false</span><span class="token keyword">boolean</span> flag2 <span class="token operator">=</span> connection <span class="token keyword">instanceof</span> <span class="token class-name">com<span class="token punctuation">.</span>zaxxer<span class="token punctuation">.</span>hikari<span class="token punctuation">.</span>pool<span class="token punctuation">.</span>HikariProxyConnection</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//true</span></code></pre><p><strong>æ­£ç¡®åšæ³•å¦‚ä¸‹ï¼š</strong></p><p>è·å–åˆ°å½“å‰è¿æ¥çš„<code>HikariDataSource</code>å¯¹è±¡ï¼Œç„¶åç»™è¯¥å¯¹è±¡è®¾ç½®<code>DataSourceProperties</code>å³å¯å¼€å¯<code>ROS</code>ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨è¿æ¥æ± ç®¡ç†<code>jdbc</code>è¿æ¥</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> DataSource <span class="token function">config</span><span class="token punctuation">(</span>DataSource dataSource<span class="token punctuation">,</span> HikariConfig config<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isVertica<span class="token punctuation">)</span> <span class="token punctuation">{</span>  HikariDataSource hikariDataSource <span class="token operator">=</span> null<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>dataSource <span class="token keyword">instanceof</span> <span class="token class-name">HikariDataSource</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// è¿æ¥æ± é…ç½®</span>    hikariDataSource <span class="token operator">=</span> <span class="token punctuation">(</span>HikariDataSource<span class="token punctuation">)</span> dataSource<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>isVertica<span class="token punctuation">)</span> <span class="token punctuation">{</span>      Properties properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// Loading Batches Directly into ROS Enable directBatchInsert for this connection</span>      properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"DirectBatchInsert"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      hikariDataSource<span class="token punctuation">.</span><span class="token function">setDataSourceProperties</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    hikariDataSource<span class="token punctuation">.</span><span class="token function">setPoolName</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getPoolName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    hikariDataSource<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">isAutoCommit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    hikariDataSource<span class="token punctuation">.</span><span class="token function">setConnectionTestQuery</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getConnectionTestQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    hikariDataSource<span class="token punctuation">.</span><span class="token function">setIdleTimeout</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getIdleTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    hikariDataSource<span class="token punctuation">.</span><span class="token function">setConnectionTimeout</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getConnectionTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    hikariDataSource<span class="token punctuation">.</span><span class="token function">setMaximumPoolSize</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getMaximumPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    hikariDataSource<span class="token punctuation">.</span><span class="token function">setMaxLifetime</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getMaxLifetime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    hikariDataSource<span class="token punctuation">.</span><span class="token function">setMinimumIdle</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getMinimumIdle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> hikariDataSource <span class="token operator">==</span> null <span class="token operator">?</span> dataSource <span class="token operator">:</span> hikariDataSource<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Vertica </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vertica </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MavenåŠ è½½æœ¬åœ°jaræ–‡ä»¶</title>
      <link href="2020/02/28/maven-install-local-jar/"/>
      <url>2020/02/28/maven-install-local-jar/</url>
      
        <content type="html"><![CDATA[<p>æ—¥å¸¸å¼€å‘ä¸­éƒ½æ˜¯mavenåŠ è½½åœ¨è¿œç¨‹ä»“åº“çš„jaræ–‡ä»¶ï¼Œå¦‚æœè¿œç¨‹ä»“åº“æ²¡æœ‰ç›¸åº”çš„jaræ–‡ä»¶ï¼Œä¸€èˆ¬åšæ³•å°±æ˜¯è‡ªå·±ä¼ åˆ°ä¸€ä¸ªç‰¹å®šçš„nexusæœåŠ¡å™¨ä¸Šï¼Œä½†æ˜¯æœ¬åœ°å¼€å‘æµ‹è¯•çš„æ—¶å€™å¯èƒ½nexusæœåŠ¡å™¨ä¸å¤ªæ–¹ä¾¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨mavenåŠ è½½æœ¬åœ°çš„jaræ–‡ä»¶</p><pre class=" language-shell"><code class="language-shell">mvn install:install-file -Dfile=vertica-jdbc-9.2.0.jar -DgroupId=com.vertica -DartifactId=vertica-jdbc -Dversion=9.2.0 -Dpackaging=jar</code></pre><h3 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h3><ul><li>-Dfile</li></ul><p>æŒ‡å®šæœ¬åœ°jaræ–‡ä»¶çš„è·¯å¾„</p><ul><li>-DgroupId</li></ul><p>æŒ‡å®šæœ¬åœ°jarçš„groupId</p><ul><li><p>-DartifactId</p><p>æŒ‡å®šæœ¬åœ°jarçš„artifactId</p></li><li><p>-Dversion</p></li></ul><p>æŒ‡å®šæœ¬åœ°jarçš„version</p><ul><li>-Dpackaging</li></ul><p>æŒ‡å®šæœ¬åœ°jarçš„packagingï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯<code>jar</code>ï¼Œè¡¨ç¤ºæ˜¯ä¸€ä¸ªjaræ–‡ä»¶</p><h3 id="pomä¸­ä½¿ç”¨"><a href="#pomä¸­ä½¿ç”¨" class="headerlink" title="pomä¸­ä½¿ç”¨"></a>pomä¸­ä½¿ç”¨</h3><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.vertica<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>vertica-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>9.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> maven </category>
          
      </categories>
      
      
        <tags>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IntelliJ IDEA 2019 åˆ›å»ºmaven webé¡¹ç›®</title>
      <link href="2020/02/26/idea-web-project/"/>
      <url>2020/02/26/idea-web-project/</url>
      
        <content type="html"><![CDATA[<h2 id="IntelliJ-IDEA-2019-åˆ›å»ºmaven-webé¡¹ç›®"><a href="#IntelliJ-IDEA-2019-åˆ›å»ºmaven-webé¡¹ç›®" class="headerlink" title="IntelliJ IDEA 2019 åˆ›å»ºmaven webé¡¹ç›®"></a>IntelliJ IDEA 2019 åˆ›å»ºmaven webé¡¹ç›®</h2><p>æœ¬æ–‡ä»‹ç»ä½¿ç”¨IDEAåˆ›å»ºä¸ä½¿ç”¨æ¨¡æ¿çš„webé¡¹ç›®ã€‚</p><h3 id="æ–°å»ºé¡¹ç›®"><a href="#æ–°å»ºé¡¹ç›®" class="headerlink" title="æ–°å»ºé¡¹ç›®"></a>æ–°å»ºé¡¹ç›®</h3><p><img src="/images/idea/image-20200226210315550.png" alt="image-20200226210315550"></p><p><img src="/images/idea/image-20200226210458711.png" alt="image-20200226210458711"></p><h3 id="é…ç½®é¡¹ç›®"><a href="#é…ç½®é¡¹ç›®" class="headerlink" title="é…ç½®é¡¹ç›®"></a>é…ç½®é¡¹ç›®</h3><h4 id="ä¿®æ”¹é¡¹ç›®ç»“æ„è®¾ç½®"><a href="#ä¿®æ”¹é¡¹ç›®ç»“æ„è®¾ç½®" class="headerlink" title="ä¿®æ”¹é¡¹ç›®ç»“æ„è®¾ç½®"></a>ä¿®æ”¹é¡¹ç›®ç»“æ„è®¾ç½®</h4><p><img src="/images/idea/image-20200226212549419.png" alt="image-20200226212549419"></p><h4 id="æ·»åŠ web-module"><a href="#æ·»åŠ web-module" class="headerlink" title="æ·»åŠ web module"></a>æ·»åŠ web module</h4><p><code>Project</code>é‚£è¾¹æ²¡æœ‰ä»€ä¹ˆéœ€è¦ä¿®æ”¹é…ç½®çš„åœ°æ–¹ï¼Œä¸è¿‡éœ€è¦çš„è¯å¯ä»¥ä¿®æ”¹<code>Project compiler output</code>ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨é»˜è®¤å°±å¯ä»¥äº†ã€‚</p><p>æ­¤é¡¹ç›®æ— ä»»ä½•é€‚é…æœåŠ¡ç»„ä»¶ï¼ˆå› ä¸ºæ˜¯æ‰‹å·¥åˆ›å»ºMavenï¼Œæ²¡æœ‰é€‰æ‹©ä»»ä½•Mavenæ¨¡æ¿ï¼‰ï¼Œå› æ­¤éœ€è¦æˆ‘ä»¬è¿›è¡Œæ·»åŠ ã€‚</p><p>è¿™é‡Œé€‰æ‹©ä¸€ä¸ª<code>Web</code>ç»„ä»¶å°±è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª<code>web project</code>äº†</p><p><img src="/images/idea/image-20200226212710033.png" alt="image-20200226212710033"></p><h4 id="é…ç½®Web-Resource-Directories"><a href="#é…ç½®Web-Resource-Directories" class="headerlink" title="é…ç½®Web Resource Directories"></a>é…ç½®Web Resource Directories</h4><p>è¿™é‡Œè¦é€‰æ‹©<code>scr/main</code>ç›®å½•ï¼Œå¹¶ä¸”åœ¨åé¢æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ª<code>webapp</code>ç›®å½•ã€‚</p><p>ç‚¹OKï¼ŒWebçš„èµ„æºç›®å½•ä¾¿è®¾ç½®å¥½äº†ã€‚</p><p><img src="/images/idea/image-20200226213027305.png" alt="image-20200226213027305"></p><h4 id="é…ç½®Deployment-Description"><a href="#é…ç½®Deployment-Description" class="headerlink" title="é…ç½®Deployment Description"></a>é…ç½®Deployment Description</h4><p>è¿™ä¸€æ­¥æ˜¯é…ç½®<code>web.xml</code>æ–‡ä»¶çš„ä½ç½®ï¼Œæˆ‘ä»¬éœ€è¦æ”¾åœ¨ä¸Šä¸€æ­¥<code>webapp</code>ä¸‹é¢å»ã€‚</p><p><img src="/images/idea/image-20200226213229541.png" alt="image-20200226213229541"></p><h4 id="ä¿®æ”¹å®Œæˆçš„ç»“æœ"><a href="#ä¿®æ”¹å®Œæˆçš„ç»“æœ" class="headerlink" title="ä¿®æ”¹å®Œæˆçš„ç»“æœ"></a>ä¿®æ”¹å®Œæˆçš„ç»“æœ</h4><p><img src="/images/idea/image-20200226213254439.png" alt="image-20200226213254439"></p><p>åˆ°è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åº•éƒ¨æœ‰ä¸€ä¸ªè­¦å‘Šï¼Œæ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰å¼•å…¥<code>aftifact</code>ï¼Œæ¥ä¸‹æ¥é…ç½®<code>Aftifacts</code>ã€‚</p><h3 id="Aftifactsé…ç½®"><a href="#Aftifactsé…ç½®" class="headerlink" title="Aftifactsé…ç½®"></a>Aftifactsé…ç½®</h3><p>è¿™ä¸ªAftifactsæè¿°äº†å½“å‰é¡¹ç›®å‘å¸ƒçš„ä¿¡æ¯ã€‚ç°åœ¨è¿›è¡Œæ·»åŠ ï¼Œä»Modelesä¸­é€‰æ‹©ã€‚</p><h4 id="é€‰æ‹©Modules"><a href="#é€‰æ‹©Modules" class="headerlink" title="é€‰æ‹©Modules"></a>é€‰æ‹©Modules</h4><p><img src="/images/idea/image-20200226214750810.png" alt="image-20200226214750810"></p><p>å¼¹å‡ºçª—ç›´æ¥é€‰æ‹©æˆ‘ä»¬çš„è¿™ä¸ªmoduleï¼Œç„¶åç‚¹å‡»okå°±å¯ä»¥äº†</p><p><img src="/images/idea/image-20200226214919063.png" alt="image-20200226214919063"></p><h4 id="é…ç½®å®Œæˆä»¥åçš„ç»“æœ"><a href="#é…ç½®å®Œæˆä»¥åçš„ç»“æœ" class="headerlink" title="é…ç½®å®Œæˆä»¥åçš„ç»“æœ"></a>é…ç½®å®Œæˆä»¥åçš„ç»“æœ</h4><p><img src="/images/idea/image-20200226215113669.png" alt="image-20200226215113669"></p><p>å†å›è¿‡å¤´å»çœ‹<code>Modules</code>èœå•ä¸‹çš„è­¦å‘Šä¹Ÿæ²¡æœ‰äº†ã€‚</p><h4 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h4><p>è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬<code>web</code>é¡¹ç›®å¿…é¡»è¦æœ‰çš„<code>web.xml</code>æ–‡ä»¶ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨é‡Œé¢æ·»åŠ äº†ä¸€ä¸ª<code>welcome-file</code>ï¼Œå½“é¡¹ç›®å¯åŠ¨æ—¶æ‰“å¼€æˆ‘æˆ‘ä»¬çš„<code>index.html</code>æ–‡ä»¶ã€‚</p><p><img src="/images/idea/image-20200226215406335.png" alt="image-20200226215406335"></p><h3 id="é…ç½®Tomcat"><a href="#é…ç½®Tomcat" class="headerlink" title="é…ç½®Tomcat"></a>é…ç½®Tomcat</h3><h4 id="ä¸‹è½½Tomcat"><a href="#ä¸‹è½½Tomcat" class="headerlink" title="ä¸‹è½½Tomcat"></a>ä¸‹è½½Tomcat</h4><p>é¦–å…ˆè¿›å…¥<a href="http://tomcat.apache.org/">Tomcat</a>å®˜ç½‘ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©äº†ä¸€ä¸ª<a href="http://mirrors.tuna.tsinghua.edu.cn/apache/tomcat/tomcat-9/v9.0.31/bin/apache-tomcat-9.0.31.tar.gz">Tomcat-9.0.3</a>çš„ç‰ˆæœ¬è¿›è¡Œä¸‹è½½ã€‚</p><h4 id="é…ç½®Tomcat-Server"><a href="#é…ç½®Tomcat-Server" class="headerlink" title="é…ç½®Tomcat Server"></a>é…ç½®Tomcat Server</h4><p><img src="/images/idea/image-20200226215940914.png" alt="image-20200226215940914"></p><p><img src="/images/idea/image-20200226220025940.png" alt="image-20200226220025940"></p><h5 id="é…ç½®Deployment"><a href="#é…ç½®Deployment" class="headerlink" title="é…ç½®Deployment"></a>é…ç½®Deployment</h5><p><img src="/images/idea/image-20200226220205638.png" alt="image-20200226220205638"></p><p><img src="/images/idea/image-20200226220459166.png" alt="image-20200226220459166"></p><h5 id="é…ç½®Server"><a href="#é…ç½®Server" class="headerlink" title="é…ç½®Server"></a>é…ç½®Server</h5><p><img src="/images/idea/image-20200226220823555.png" alt="image-20200226220823555"></p><h3 id="è¿è¡Œwebé¡¹ç›®"><a href="#è¿è¡Œwebé¡¹ç›®" class="headerlink" title="è¿è¡Œwebé¡¹ç›®"></a>è¿è¡Œwebé¡¹ç›®</h3><p>åœ¨webappç›®å½•ä¸‹é¢æ–°å»º<code>index.html</code>æ–‡ä»¶ï¼Œé¡¹ç›®ç»“æ„å¦‚ä¸‹ã€‚</p><p><img src="/images/idea/image-20200226221200309.png" alt="image-20200226221200309"></p><p>æ¥ä¸‹æ¥å¯åŠ¨é¡¹ç›®</p><p><img src="/images/idea/image-20200226221359622.png" alt="image-20200226221359622"></p><p>ç„¶åæˆ‘ä»¬è®¿é—®<a href="http://localhost:8080/%EF%BC%8C%E5%B0%B1%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E6%98%BE%E7%A4%BA%E4%BA%86%E6%88%91%E4%BB%AC%60index.html%60%E7%9A%84%E5%86%85%E5%AE%B9%E4%BA%86%E3%80%82">http://localhost:8080/ï¼Œå°±å¯ä»¥çœ‹åˆ°æ˜¾ç¤ºäº†æˆ‘ä»¬`index.html`çš„å†…å®¹äº†ã€‚</a></p><h3 id="æ–°å»ºServlet"><a href="#æ–°å»ºServlet" class="headerlink" title="æ–°å»ºServlet"></a>æ–°å»ºServlet</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>servlet<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>ServletException<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>WebServlet<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServlet<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServletRequest<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServletResponse<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span>StandardCharsets<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020/2/26. */</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/index"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">)</span> <span class="token keyword">throws</span> ServletException<span class="token punctuation">,</span> IOException <span class="token punctuation">{</span>        <span class="token function">doPost</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">)</span> <span class="token keyword">throws</span> ServletException<span class="token punctuation">,</span> IOException <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è§£å†³ä¹±ç </span>        request<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span>StandardCharsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">.</span><span class="token function">displayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span>StandardCharsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        String name <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ç„¶åé‡å¯é¡¹ç›®æˆ‘ä»¬åœ¨åœ°å€æ è¾“å…¥<code>http://localhost:8080/index?name=å“ˆå“ˆå“ˆ</code>å°±å¯ä»¥çœ‹åˆ°é¡µé¢è¾“å‡ºäº†<code>å“ˆå“ˆå“ˆ</code></p><h3 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h3><ul><li><p>æ— æ³•ä½¿ç”¨<code>servlet</code>åŒ…ä¸‹é¢çš„ç±»</p><p>è§£å†³æ–¹æ¡ˆï¼šåœ¨ModulesåŠ å…¥Tomcatä¾èµ–</p></li></ul><p><img src="/images/idea/image-20200226223033946.png" alt="image-20200226223033946"></p><p><img src="/images/idea/image-20200226223106321.png" alt="image-20200226223106321"></p><p><img src="/images/idea/image-20200226223154510.png" alt="image-20200226223154510"></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…·ä½¿ç”¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Maven </tag>
            
            <tag> IDEA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springäº‹åŠ¡ç®¡ç†</title>
      <link href="2020/02/16/spring-transaction/"/>
      <url>2020/02/16/spring-transaction/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯äº‹åŠ¡"><a href="#ä»€ä¹ˆæ˜¯äº‹åŠ¡" class="headerlink" title="ä»€ä¹ˆæ˜¯äº‹åŠ¡"></a>ä»€ä¹ˆæ˜¯äº‹åŠ¡</h2><p>äº‹åŠ¡æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚</p><h3 id="åŸå­æ€§"><a href="#åŸå­æ€§" class="headerlink" title="åŸå­æ€§"></a>åŸå­æ€§</h3><blockquote><p>äº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ï¼›</p></blockquote><h3 id="ä¸€è‡´æ€§"><a href="#ä¸€è‡´æ€§" class="headerlink" title="ä¸€è‡´æ€§"></a>ä¸€è‡´æ€§</h3><blockquote><p>æ‰§è¡Œäº‹åŠ¡å‰åï¼Œæ•°æ®ä¿æŒä¸€è‡´ï¼›</p></blockquote><h3 id="æŒä¹…æ€§"><a href="#æŒä¹…æ€§" class="headerlink" title="æŒä¹…æ€§"></a>æŒä¹…æ€§</h3><blockquote><p>ä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚</p></blockquote><h3 id="éš”ç¦»æ€§"><a href="#éš”ç¦»æ€§" class="headerlink" title="éš”ç¦»æ€§"></a>éš”ç¦»æ€§</h3><blockquote><p>å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹ç‰©ä¸è¢«å…¶ä»–äº‹ç‰©æ‰€å¹²æ‰°ï¼Œå„å¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®åº“æ˜¯ç‹¬ç«‹çš„ï¼›</p></blockquote><h2 id="Spring-äº‹åŠ¡æ¥å£ä»‹ç»"><a href="#Spring-äº‹åŠ¡æ¥å£ä»‹ç»" class="headerlink" title="Spring äº‹åŠ¡æ¥å£ä»‹ç»"></a>Spring äº‹åŠ¡æ¥å£ä»‹ç»</h2><ul><li>PlatformTransactionManager äº‹åŠ¡ç®¡ç†å™¨</li><li>TransactionDefinition äº‹åŠ¡å®šä¹‰å½¢è±¡ï¼ˆéš”ç¦»ã€ä¼ æ’­ã€è¶…æ—¶ã€åªè¯»ï¼‰</li><li>TransactionStatus äº‹åŠ¡å…·ä½“çš„è¿è¡ŒçŠ¶æ€</li></ul><h3 id="PlatformTransactionManager"><a href="#PlatformTransactionManager" class="headerlink" title="PlatformTransactionManager"></a>PlatformTransactionManager</h3><p><strong>Springå¹¶ä¸ç›´æ¥ç®¡ç†äº‹åŠ¡ï¼Œè€Œæ˜¯æä¾›äº†å¤šç§äº‹åŠ¡ç®¡ç†å™¨</strong> ï¼Œä»–ä»¬å°†äº‹åŠ¡ç®¡ç†çš„èŒè´£å§”æ‰˜ç»™Hibernateæˆ–è€…JTAç­‰æŒä¹…åŒ–æœºåˆ¶æ‰€æä¾›çš„ç›¸å…³å¹³å°æ¡†æ¶çš„äº‹åŠ¡æ¥å®ç°ã€‚ Springäº‹åŠ¡ç®¡ç†å™¨çš„æ¥å£æ˜¯ï¼š <strong>org.springframework.transaction.PlatformTransactionManager</strong> ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£ï¼ŒSpringä¸ºå„ä¸ªå¹³å°å¦‚JDBCã€Hibernateç­‰éƒ½æä¾›äº†å¯¹åº”çš„äº‹åŠ¡ç®¡ç†å™¨ï¼Œä½†æ˜¯å…·ä½“çš„å®ç°å°±æ˜¯å„ä¸ªå¹³å°è‡ªå·±çš„äº‹æƒ…äº†ã€‚</p><p><img src="/images/spring/spring-platformTransactionManager.png" alt="PlatformTransactionManager"></p><table><thead><tr><th>äº‹åŠ¡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>org.springframework.jdbc.datasource.DataSourceTransactionManager</td><td>ä½¿ç”¨Spring Jdbcæˆ–è€…MyBatisè¿›è¡ŒæŒä¹…åŒ–æ•°æ®æ—¶ä½¿ç”¨</td></tr><tr><td>org.springframework.orm.hibernate5.HibernateTransactionManager</td><td>ä½¿ç”¨Hibernate5.0ç‰ˆæœ¬è¿›è¡ŒæŒä¹…åŒ–æ•°æ®ä½¿ç”¨</td></tr><tr><td>org.springframework.orm.jpa.JpaTransactionManager</td><td>ä½¿ç”¨JpaæŒä¹…åŒ–ä½¿ç”¨</td></tr><tr><td>org.springframework.kafka.transaction.KafkaTransactionManager</td><td>ä½¿ç”¨Kafkaäº‹åŠ¡æ—¶ä½¿ç”¨</td></tr></tbody></table><h3 id="TransactionDefinition"><a href="#TransactionDefinition" class="headerlink" title="TransactionDefinition"></a>TransactionDefinition</h3><p>äº‹åŠ¡ç®¡ç†å™¨æ¥å£ <strong>PlatformTransactionManager</strong> é€šè¿‡ <strong>getTransaction(TransactionDefinition definition)</strong> æ–¹æ³•æ¥å¾—åˆ°ä¸€ä¸ªäº‹åŠ¡ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œé¢çš„å‚æ•°æ˜¯ <strong>TransactionDefinitionç±»</strong> ï¼Œè¿™ä¸ªç±»å°±å®šä¹‰äº†ä¸€äº›åŸºæœ¬çš„äº‹åŠ¡å±æ€§ã€‚</p><p><img src="/images/spring/spring-transactionDefinition.jpeg" alt="TransactionDefinition"></p><h4 id="éš”ç¦»çº§åˆ«"><a href="#éš”ç¦»çº§åˆ«" class="headerlink" title="éš”ç¦»çº§åˆ«"></a>éš”ç¦»çº§åˆ«</h4><p>åœ¨ä¸è€ƒè™‘éš”ç¦»æ€§çš„æƒ…å†µä¸‹ï¼Œä¼šå¼•å‘å¦‚ä¸‹é—®é¢˜</p><ul><li>è„åº¦ </li></ul><blockquote><p>ä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªäº‹åŠ¡æ”¹å†™ä½†ä¸ºæäº¤çš„æ•°æ®ï¼Œå¦‚æœè¿™äº›æ•°æ®è¢«å›æ»šï¼Œåˆ™ç‹¬åˆ°çš„æ•°æ®æ—¶æ— æ•ˆçš„</p></blockquote><ul><li>ä¸å¯é‡å¤åº¦</li></ul><blockquote><p>åœ¨åŒä¸€äº‹åŠ¡ä¸­ï¼Œå¤šæ¬¡è¯»å–åŒä¸€æ•°æ®è¿”å›çš„ç»“æœä¸ä¸€è‡´</p></blockquote><ul><li>å¹»è¯»</li></ul><blockquote><p>ä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å‡ è¡Œè®°å½•åï¼Œå¦ä¸€ä¸ªäº‹åŠ¡æ’å…¥ä¸€äº›è®°å½•ï¼Œå¹»è¯»å°±å‘ç”Ÿäº†</p><p>åœ¨åæ¥çš„æŸ¥è¯¢ä¸­ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡å°±ä¼šå‘ç°æœ‰äº›åŸæ¥æ²¡æœ‰çš„è®°å½•</p></blockquote><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>å¯¼è‡´çš„é—®é¢˜</th></tr></thead><tbody><tr><td><strong>ISOLATION_DEFAULT</strong></td><td>ä½¿ç”¨æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼ˆspringé»˜è®¤ï¼‰</td></tr><tr><td>ISOLATION_READ_UNCOMMITTED</td><td>å…è®¸è¯»å–è¿˜æœªæäº¤çš„æ”¹å˜äº†çš„æ•°æ®ï¼Œå¯èƒ½å¯¼è‡´è„ã€å¹»ã€ä¸å¯é‡å¤è¯»</td></tr><tr><td>ISOLATION_READ_COMMITTED</td><td>å…è®¸åœ¨å¹¶å‘äº‹åŠ¡å·²ç»æäº¤åè¯»å–ã€‚å¯é˜²æ­¢è„è¯»ï¼Œä½†å¹»ã€ä¸å¯é‡å¤è¯»ä»»å¯å‘ç”Ÿ</td></tr><tr><td>ISOLATION_REPEATABLE_READ</td><td>å¯¹ç›¸åŒå­—æ®µçš„å¤šæ¬¡è¯»å–æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®è¢«äº‹åŠ¡æœ¬èº«æ”¹å˜ã€‚å¯é˜²æ­¢è„ã€ä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»å¯èƒ½å‘ç”Ÿ</td></tr><tr><td>ISOLATION_SERIALIZABLE</td><td>å®Œå…¨æœä»ACIDçš„éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡åªèƒ½ä¸€ä¸ªä¸€ä¸ªæ‰§è¡Œï¼Œé¿å…äº†è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ã€‚æ‰§è¡Œæ•ˆç‡æ…¢ï¼Œä½¿ç”¨æ—¶æ…é‡</td></tr></tbody></table><p>æ³¨ï¼šMySQLä½¿ç”¨çš„æ˜¯<code>REPEATABLE_READ</code>ï¼›Oracleä½¿ç”¨çš„æ˜¯<code>READ_COMMITTED</code></p><h4 id="ä¼ æ’­è¡Œä¸º"><a href="#ä¼ æ’­è¡Œä¸º" class="headerlink" title="ä¼ æ’­è¡Œä¸º"></a>ä¼ æ’­è¡Œä¸º</h4><p>è§£å†³ä¸šåŠ¡å±‚æ–¹æ³•ä¹‹é—´çš„ç›¸äº’è°ƒç”¨çš„é—®é¢˜ï¼Œäº‹åŠ¡ä¼ é€’æ–¹å¼ã€‚</p><table><thead><tr><th>å¸¸é‡åç§°</th><th>å¸¸é‡è§£é‡Š</th></tr></thead><tbody><tr><td><strong>PROPAGATION_REQUIRED</strong></td><td>æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æ–°å»ºä¸€ä¸ªäº‹åŠ¡ã€‚è¿™æ˜¯æœ€å¸¸è§çš„é€‰æ‹©ï¼Œä¹Ÿæ˜¯ Spring é»˜è®¤çš„äº‹åŠ¡çš„ä¼ æ’­ã€‚</td></tr><tr><td>PROPAGATION_SUPPORTS</td><td>æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œã€‚</td></tr><tr><td>PROPAGATION_MANDATORY</td><td>æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚</td></tr><tr><td><strong>PROPAGATION_REQUIRES_NEW</strong></td><td>å¦‚æœäº‹åŠ¡å­˜åœ¨ï¼ŒæŒ‚èµ·å½“å‰äº‹åŠ¡ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡</td></tr><tr><td>PROPAGATION_NOT_SUPPORTED</td><td>ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</td></tr><tr><td>PROPAGATION_NEVER</td><td>ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</td></tr><tr><td><strong>PROPAGATION_NESTED</strong></td><td>å¦‚æœä¸€ä¸ªæ´»åŠ¨çš„äº‹åŠ¡å­˜åœ¨ï¼Œåˆ™è¿è¡Œåœ¨ä¸€ä¸ªåµŒå¥—çš„äº‹åŠ¡ä¸­ã€‚å¦‚æœæ²¡æœ‰æ´»åŠ¨äº‹åŠ¡ï¼Œåˆ™æŒ‰REQUIREDå±æ€§æ‰§è¡Œã€‚å®ƒä½¿ç”¨äº†ä¸€ä¸ªå•ç‹¬çš„äº‹åŠ¡ï¼Œè¿™ä¸ªäº‹åŠ¡æ‹¥æœ‰å¤šä¸ªå¯ä»¥å›æ»šçš„ä¿å­˜ç‚¹ã€‚å†…éƒ¨äº‹åŠ¡çš„å›æ»šä¸ä¼šå¯¹å¤–éƒ¨äº‹åŠ¡é€ æˆå½±å“ã€‚å®ƒåªå¯¹DataSourceTransactionManageräº‹åŠ¡ç®¡ç†å™¨èµ·æ•ˆã€‚</td></tr></tbody></table><h3 id="TransactionStatus"><a href="#TransactionStatus" class="headerlink" title="TransactionStatus"></a>TransactionStatus</h3><p><code>TransactionStatus</code>æ¥å£ç”¨æ¥è®°å½•äº‹åŠ¡çš„çŠ¶æ€ è¯¥æ¥å£å®šä¹‰äº†ä¸€ç»„æ–¹æ³•,ç”¨æ¥è·å–æˆ–åˆ¤æ–­äº‹åŠ¡çš„ç›¸åº”çŠ¶æ€ä¿¡æ¯.</p><p><code>PlatformTransactionManager.getTransaction(â€¦) </code>æ–¹æ³•è¿”å›ä¸€ä¸ª <code>TransactionStatus</code> å¯¹è±¡ã€‚è¿”å›çš„<code>TransactionStatus</code> å¯¹è±¡å¯èƒ½ä»£è¡¨ä¸€ä¸ªæ–°çš„æˆ–å·²ç»å­˜åœ¨çš„äº‹åŠ¡ï¼ˆå¦‚æœåœ¨å½“å‰è°ƒç”¨å †æ ˆæœ‰ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„äº‹åŠ¡ï¼‰ã€‚</p><p><img src="/images/spring/spring-transactionStatus-diagram.jpeg" alt="TransactionStatus-diagram"></p><p><img src="/images/spring/spring-transactionStatus.jpeg" alt="TransactionStatus"></p><p><img src="/images/spring/spring-transactionExecution.jpeg" alt="TransactionExecution"></p><h2 id="Springä¸­çš„äº‹åŠ¡ç®¡ç†"><a href="#Springä¸­çš„äº‹åŠ¡ç®¡ç†" class="headerlink" title="Springä¸­çš„äº‹åŠ¡ç®¡ç†"></a>Springä¸­çš„äº‹åŠ¡ç®¡ç†</h2><h3 id="ç¼–ç¨‹å¼çš„äº‹åŠ¡ç®¡ç†"><a href="#ç¼–ç¨‹å¼çš„äº‹åŠ¡ç®¡ç†" class="headerlink" title="ç¼–ç¨‹å¼çš„äº‹åŠ¡ç®¡ç†"></a>ç¼–ç¨‹å¼çš„äº‹åŠ¡ç®¡ç†</h3><p>ä½¿ç”¨<code>TransactionTemplate</code>æ‰‹åŠ¨ç®¡ç†äº‹åŠ¡ï¼Œéœ€è¦ä¿®æ”¹ä»£ç ï¼Œä¾µå…¥æ€§ç›¸å¯¹è¾ƒå¤§ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨</p><h3 id="å£°æ˜å¼çš„äº‹åŠ¡ç®¡ç†"><a href="#å£°æ˜å¼çš„äº‹åŠ¡ç®¡ç†" class="headerlink" title="å£°æ˜å¼çš„äº‹åŠ¡ç®¡ç†"></a>å£°æ˜å¼çš„äº‹åŠ¡ç®¡ç†</h3><h4 id="TransactionProxyFactoryBean"><a href="#TransactionProxyFactoryBean" class="headerlink" title="TransactionProxyFactoryBean"></a>TransactionProxyFactoryBean</h4><p>éœ€è¦ä¸ºæ¯ä¸ªè¿›è¡Œäº‹åŠ¡ç®¡ç†çš„ç±»ï¼Œé…ç½®ä¸€ä¸ª<code>TransactionProxyFactoryBean</code>è¿›è¡Œå¢å¼ºå¤„ç†</p><h4 id="åŸºäºAspectJçš„AOPæ–¹å¼ï¼ˆxmlï¼‰"><a href="#åŸºäºAspectJçš„AOPæ–¹å¼ï¼ˆxmlï¼‰" class="headerlink" title="åŸºäºAspectJçš„AOPæ–¹å¼ï¼ˆxmlï¼‰"></a>åŸºäºAspectJçš„AOPæ–¹å¼ï¼ˆxmlï¼‰</h4><p>æ—©æœŸçº¯ç²¹çš„<code>spring mvc</code>é…ç½®å½¢å¼ï¼Œä¸€æ—¦é…ç½®å¥½ä»¥åä¸éœ€è¦ä¿®æ”¹ä»»ä½•ä»£ç </p><h4 id="åŸºäº-Transactionalæ³¨è§£æ–¹å¼"><a href="#åŸºäº-Transactionalæ³¨è§£æ–¹å¼" class="headerlink" title="åŸºäº@Transactionalæ³¨è§£æ–¹å¼"></a>åŸºäº<code>@Transactional</code>æ³¨è§£æ–¹å¼</h4><p>ç°åœ¨<code>spring boot</code>å¸¸ç”¨æ–¹å¼ï¼Œåªéœ€è¦åœ¨éœ€è¦äº‹åŠ¡å¤„ç†çš„ç±»æˆ–è€…æ–¹æ³•æ·»åŠ <code>@Transactional</code>ã€‚ä¸‹é¢ä½¿ç”¨æ³¨è§£æ–¹å¼ç®€å•åšä¸€ä¸ªè½¬è´¦çš„äº‹åŠ¡æ¨¡æ‹Ÿã€‚</p><h2 id="ä½¿ç”¨è½¬è´¦æ¨¡æ‹Ÿäº‹åŠ¡ç®¡ç†"><a href="#ä½¿ç”¨è½¬è´¦æ¨¡æ‹Ÿäº‹åŠ¡ç®¡ç†" class="headerlink" title="ä½¿ç”¨è½¬è´¦æ¨¡æ‹Ÿäº‹åŠ¡ç®¡ç†"></a>ä½¿ç”¨è½¬è´¦æ¨¡æ‹Ÿäº‹åŠ¡ç®¡ç†</h2><p>ä½¿ç”¨è½¬è´¦æ¨¡æ‹Ÿä¸€ä¸‹äº‹åŠ¡å¤„ç†ï¼Œè¿™é‡Œæ¼”ç¤ºä¸¤ç§æ“ä½œæ•°æ®åº“çš„æ–¹å¼ï¼Œç”¨äºå¯¹æ¯”æŸ¥çœ‹</p><h3 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h3><pre class=" language-shell"><code class="language-shell">âœ  example-transaction git:(master) âœ— tree.â”œâ”€â”€ example-transaction.imlâ”œâ”€â”€ pom.xmlâ””â”€â”€ src    â”œâ”€â”€ main    â”‚&nbsp;&nbsp; â”œâ”€â”€ java    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp; â””â”€â”€ com    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â””â”€â”€ xiaozhangge    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;         â””â”€â”€ transfer    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;             â”œâ”€â”€ TransferApplication.java    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;             â”œâ”€â”€ entity    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;             â”‚&nbsp;&nbsp; â””â”€â”€ TransferAccount.java    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;             â”œâ”€â”€ jpa    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;             â”‚&nbsp;&nbsp; â””â”€â”€ TransferRepository.java    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;             â”œâ”€â”€ mapper    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;             â”‚&nbsp;&nbsp; â””â”€â”€ TransferMapper.java    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;             â””â”€â”€ service    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;                 â”œâ”€â”€ TransferService.java    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;                 â””â”€â”€ impl    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;                     â””â”€â”€ TransferServiceImpl.java    â”‚&nbsp;&nbsp; â””â”€â”€ resources    â”‚&nbsp;&nbsp;     â”œâ”€â”€ application.yml    â”‚&nbsp;&nbsp;     â””â”€â”€ transfer.sql    â””â”€â”€ test        â””â”€â”€ java            â””â”€â”€ com                â””â”€â”€ xiaozhangge                    â””â”€â”€ transfer                        â””â”€â”€ TransferApplicationTests.java</code></pre><h3 id="æ–°å»ºæ•°æ®åº“è¡¨"><a href="#æ–°å»ºæ•°æ®åº“è¡¨" class="headerlink" title="æ–°å»ºæ•°æ®åº“è¡¨"></a>æ–°å»ºæ•°æ®åº“è¡¨</h3><pre class=" language-sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> transfer_account<span class="token punctuation">;</span><span class="token keyword">create</span> <span class="token keyword">table</span> transfer_account<span class="token punctuation">(</span>    id    <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>    name  <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">unique</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>    money <span class="token keyword">float</span> <span class="token keyword">default</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> transfer_account <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> money<span class="token punctuation">)</span><span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'jack.zhang'</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> transfer_account <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> money<span class="token punctuation">)</span><span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'kevin.yu'</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token operator">*</span><span class="token keyword">from</span> transfer_account<span class="token punctuation">;</span></code></pre><h3 id="pomé…ç½®"><a href="#pomé…ç½®" class="headerlink" title="pomé…ç½®"></a>pomé…ç½®</h3><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-jpa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.3.1.tmp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span></code></pre><h3 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h3><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8084</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/transfer<span class="token punctuation">?</span>characterEncoding=utf8<span class="token important">&amp;useSSL</span>=false<span class="token important">&amp;allowMultiQueries</span>=true    <span class="token key atrule">username</span><span class="token punctuation">:</span> root    <span class="token key atrule">password</span><span class="token punctuation">:</span> MySQL@123    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver    <span class="token key atrule">hikari</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># http://blog.didispace.com/Springboot-2-0-HikariCP-default-reason/</span>      <span class="token key atrule">minimum-idle</span><span class="token punctuation">:</span> <span class="token number">5</span>      <span class="token key atrule">maximum-pool-size</span><span class="token punctuation">:</span> <span class="token number">20</span>      <span class="token key atrule">auto-commit</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>      <span class="token key atrule">idle-timeout</span><span class="token punctuation">:</span> <span class="token number">30000</span>      <span class="token key atrule">pool-name</span><span class="token punctuation">:</span> TransferHikariCP      <span class="token key atrule">max-lifetime</span><span class="token punctuation">:</span> <span class="token number">1800000</span>      <span class="token key atrule">connection-timeout</span><span class="token punctuation">:</span> <span class="token number">30000</span>      <span class="token key atrule">connection-test-query</span><span class="token punctuation">:</span> SELECT 1  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>    <span class="token key atrule">database-platform</span><span class="token punctuation">:</span> org.hibernate.dialect.MySQL57Dialect    <span class="token key atrule">open-in-view</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>    <span class="token key atrule">show-sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>      <span class="token key atrule">ddl-auto</span><span class="token punctuation">:</span> update    <span class="token key atrule">properties</span><span class="token punctuation">:</span>      <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>        <span class="token key atrule">use_sql_comments</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>        <span class="token key atrule">format_sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token key atrule">logging</span><span class="token punctuation">:</span>  <span class="token key atrule">level</span><span class="token punctuation">:</span>    <span class="token key atrule">com.xiaozhangge.transfer.mapper</span><span class="token punctuation">:</span> debug</code></pre><h3 id="Jpaæ“ä½œæ•°æ®åº“"><a href="#Jpaæ“ä½œæ•°æ®åº“" class="headerlink" title="Jpaæ“ä½œæ•°æ®åº“"></a>Jpaæ“ä½œæ•°æ®åº“</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>transfer<span class="token punctuation">.</span>jpa<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>transfer<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>TransferAccount<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>JpaRepository<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>Modifying<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>Query<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>query<span class="token punctuation">.</span>Param<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Repository<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020/2/16. */</span><span class="token annotation punctuation">@Repository</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TransferRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token operator">&lt;</span>TransferAccount<span class="token punctuation">,</span> Long<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * @param in    è½¬å…¥äºº     * @param money é‡‘é¢     */</span>    <span class="token annotation punctuation">@Modifying</span>    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"update transfer_account set money = money + ?2 where name = ?1"</span><span class="token punctuation">,</span> nativeQuery <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token keyword">void</span> <span class="token function">inMoney</span><span class="token punctuation">(</span>String in<span class="token punctuation">,</span> <span class="token keyword">float</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * @param out   è½¬å‡ºäºº     * @param money é‡‘é¢     */</span>    <span class="token annotation punctuation">@Modifying</span>    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"update transfer_account set money = money - :money where name = :name"</span><span class="token punctuation">,</span> nativeQuery <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token keyword">void</span> <span class="token function">outMoney</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> String out<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"money"</span><span class="token punctuation">)</span> <span class="token keyword">float</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h4 id="ä¸šåŠ¡å±‚æ¨¡æ‹Ÿä¸€ä¸ªè½¬è´¦æ“ä½œ"><a href="#ä¸šåŠ¡å±‚æ¨¡æ‹Ÿä¸€ä¸ªè½¬è´¦æ“ä½œ" class="headerlink" title="ä¸šåŠ¡å±‚æ¨¡æ‹Ÿä¸€ä¸ªè½¬è´¦æ“ä½œ"></a>ä¸šåŠ¡å±‚æ¨¡æ‹Ÿä¸€ä¸ªè½¬è´¦æ“ä½œ</h4><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>transfer<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>transfer<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>TransferRepository<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>transfer<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>TransferMapper<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>transfer<span class="token punctuation">.</span>service<span class="token punctuation">.</span>TransferService<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Service<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>support<span class="token punctuation">.</span>TransactionTemplate<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020/2/16. */</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">TransferService</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> TransferRepository transferRepository<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> TransferMapper transferMapper<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> TransactionTemplate transactionTemplate<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span>String in<span class="token punctuation">,</span> String out<span class="token punctuation">,</span> <span class="token keyword">float</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è¿™é‡Œä½¿ç”¨çš„æ˜¯jpaæ“ä½œæ•°æ®åº“</span>        transferRepository<span class="token punctuation">.</span><span class="token function">outMoney</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>        transferRepository<span class="token punctuation">.</span><span class="token function">inMoney</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="æ–°å»ºæµ‹è¯•ç±»"><a href="#æ–°å»ºæµ‹è¯•ç±»" class="headerlink" title="æ–°å»ºæµ‹è¯•ç±»"></a>æ–°å»ºæµ‹è¯•ç±»</h4><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>transfer<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>transfer<span class="token punctuation">.</span>service<span class="token punctuation">.</span>TransferService<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Ignore<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>SpringRunner<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020/2/16. */</span><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@Ignore</span><span class="token annotation punctuation">@org</span><span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span><span class="token function">RunWith</span><span class="token punctuation">(</span>SpringRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@org</span><span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">SpringBootTest</span><span class="token punctuation">(</span>classes <span class="token operator">=</span> TransferApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferApplicationTests</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> TransferService transferService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        transferService<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token string">"jack.zhang"</span><span class="token punctuation">,</span> <span class="token string">"kevin.yu"</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ä½†æˆ‘ä»¬è¿è¡Œæ—¶ï¼Œä¼šæŠ›å‡ºå¦‚ä¸‹å¼‚å¸¸ï¼š</p><pre class=" language-verilog"><code class="language-verilog">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>InvalidDataAccessApiUsageException<span class="token punctuation">:</span> Executing an update<span class="token operator">/</span>delete query<span class="token punctuation">;</span> nested exception is javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span>TransactionRequiredException<span class="token punctuation">:</span> Executing an update<span class="token operator">/</span>delete query    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>orm<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>EntityManagerFactoryUtils<span class="token punctuation">.</span><span class="token function">convertJpaAccessExceptionIfPossible</span><span class="token punctuation">(</span>EntityManagerFactoryUtils<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">403</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>orm<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>vendor<span class="token punctuation">.</span>HibernateJpaDialect<span class="token punctuation">.</span><span class="token function">translateExceptionIfPossible</span><span class="token punctuation">(</span>HibernateJpaDialect<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">257</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>orm<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>AbstractEntityManagerFactoryBean<span class="token punctuation">.</span><span class="token function">translateExceptionIfPossible</span><span class="token punctuation">(</span>AbstractEntityManagerFactoryBean<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">528</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>support<span class="token punctuation">.</span>ChainedPersistenceExceptionTranslator<span class="token punctuation">.</span><span class="token function">translateExceptionIfPossible</span><span class="token punctuation">(</span>ChainedPersistenceExceptionTranslator<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">61</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>support<span class="token punctuation">.</span>DataAccessUtils<span class="token punctuation">.</span><span class="token function">translateIfNecessary</span><span class="token punctuation">(</span>DataAccessUtils<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">242</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>support<span class="token punctuation">.</span>PersistenceExceptionTranslationInterceptor<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>PersistenceExceptionTranslationInterceptor<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">153</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>ReflectiveMethodInvocation<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span>ReflectiveMethodInvocation<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">186</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>support<span class="token punctuation">.</span>CrudMethodMetadataPostProcessor$CrudMethodMetadataPopulatingMethodInterceptor<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>CrudMethodMetadataPostProcessor<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">149</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>ReflectiveMethodInvocation<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span>ReflectiveMethodInvocation<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">186</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span>ExposeInvocationInterceptor<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>ExposeInvocationInterceptor<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">93</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>ReflectiveMethodInvocation<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span>ReflectiveMethodInvocation<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">186</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>JdkDynamicAopProxy<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>JdkDynamicAopProxy<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">212</span><span class="token punctuation">)</span>    at com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span><span class="token property">$Proxy99</span><span class="token punctuation">.</span><span class="token function">outMoney</span><span class="token punctuation">(</span>Unknown Source<span class="token punctuation">)</span>    at com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>transfer<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>TransferServiceImpl<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>TransferServiceImpl<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">28</span><span class="token punctuation">)</span>    at com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>transfer<span class="token punctuation">.</span>TransferApplicationTests<span class="token punctuation">.</span><span class="token function">test1</span><span class="token punctuation">(</span>TransferApplicationTests<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">)</span>    at sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>NativeMethodAccessorImpl<span class="token punctuation">.</span><span class="token function">invoke0</span><span class="token punctuation">(</span>Native Method<span class="token punctuation">)</span>    at sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>NativeMethodAccessorImpl<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>NativeMethodAccessorImpl<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">62</span><span class="token punctuation">)</span>    at sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>DelegatingMethodAccessorImpl<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>DelegatingMethodAccessorImpl<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">43</span><span class="token punctuation">)</span>    at java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>Method<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">498</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>model<span class="token punctuation">.</span>FrameworkMethod$<span class="token number">1</span><span class="token punctuation">.</span><span class="token function">runReflectiveCall</span><span class="token punctuation">(</span>FrameworkMethod<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>model<span class="token punctuation">.</span>ReflectiveCallable<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>ReflectiveCallable<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>model<span class="token punctuation">.</span>FrameworkMethod<span class="token punctuation">.</span><span class="token function">invokeExplosively</span><span class="token punctuation">(</span>FrameworkMethod<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>statements<span class="token punctuation">.</span>InvokeMethod<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>InvokeMethod<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">17</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token keyword">context</span><span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>statements<span class="token punctuation">.</span>RunBeforeTestExecutionCallbacks<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>RunBeforeTestExecutionCallbacks<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">74</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token keyword">context</span><span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>statements<span class="token punctuation">.</span>RunAfterTestExecutionCallbacks<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>RunAfterTestExecutionCallbacks<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">84</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token keyword">context</span><span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>statements<span class="token punctuation">.</span>RunBeforeTestMethodCallbacks<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>RunBeforeTestMethodCallbacks<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">75</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token keyword">context</span><span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>statements<span class="token punctuation">.</span>RunAfterTestMethodCallbacks<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>RunAfterTestMethodCallbacks<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">86</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token keyword">context</span><span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>statements<span class="token punctuation">.</span>SpringRepeat<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>SpringRepeat<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">84</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>ParentRunner<span class="token punctuation">.</span><span class="token function">runLeaf</span><span class="token punctuation">(</span>ParentRunner<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">325</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token keyword">context</span><span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>SpringJUnit4ClassRunner<span class="token punctuation">.</span><span class="token function">runChild</span><span class="token punctuation">(</span>SpringJUnit4ClassRunner<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">251</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token keyword">context</span><span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>SpringJUnit4ClassRunner<span class="token punctuation">.</span><span class="token function">runChild</span><span class="token punctuation">(</span>SpringJUnit4ClassRunner<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">97</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>ParentRunner$<span class="token number">3</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>ParentRunner<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">290</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>ParentRunner$<span class="token number">1</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span>ParentRunner<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">71</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>ParentRunner<span class="token punctuation">.</span><span class="token function">runChildren</span><span class="token punctuation">(</span>ParentRunner<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">288</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>ParentRunner<span class="token punctuation">.</span>access$<span class="token function">000</span><span class="token punctuation">(</span>ParentRunner<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>ParentRunner$<span class="token number">2</span><span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>ParentRunner<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">268</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token keyword">context</span><span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>statements<span class="token punctuation">.</span>RunBeforeTestClassCallbacks<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>RunBeforeTestClassCallbacks<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">61</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token keyword">context</span><span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>statements<span class="token punctuation">.</span>RunAfterTestClassCallbacks<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>RunAfterTestClassCallbacks<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">70</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>ParentRunner<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>ParentRunner<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">363</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token keyword">context</span><span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>SpringJUnit4ClassRunner<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>SpringJUnit4ClassRunner<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">190</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span>JUnitCore<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>JUnitCore<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">137</span><span class="token punctuation">)</span>    at com<span class="token punctuation">.</span>intellij<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>JUnit4IdeaTestRunner<span class="token punctuation">.</span><span class="token function">startRunnerWithArgs</span><span class="token punctuation">(</span>JUnit4IdeaTestRunner<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">68</span><span class="token punctuation">)</span>    at com<span class="token punctuation">.</span>intellij<span class="token punctuation">.</span>rt<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>IdeaTestRunner$Repeater<span class="token punctuation">.</span><span class="token function">startRunnerWithArgs</span><span class="token punctuation">(</span>IdeaTestRunner<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">33</span><span class="token punctuation">)</span>    at com<span class="token punctuation">.</span>intellij<span class="token punctuation">.</span>rt<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>JUnitStarter<span class="token punctuation">.</span><span class="token function">prepareStreamsAndStart</span><span class="token punctuation">(</span>JUnitStarter<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">230</span><span class="token punctuation">)</span>    at com<span class="token punctuation">.</span>intellij<span class="token punctuation">.</span>rt<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>JUnitStarter<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span>JUnitStarter<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">58</span><span class="token punctuation">)</span>Caused by<span class="token punctuation">:</span> javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span>TransactionRequiredException<span class="token punctuation">:</span> Executing an update<span class="token operator">/</span>delete query    at org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>AbstractSharedSessionContract<span class="token punctuation">.</span><span class="token function">checkTransactionNeededForUpdateOperation</span><span class="token punctuation">(</span>AbstractSharedSessionContract<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">409</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>query<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>AbstractProducedQuery<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span>AbstractProducedQuery<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">1601</span><span class="token punctuation">)</span>    at sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>NativeMethodAccessorImpl<span class="token punctuation">.</span><span class="token function">invoke0</span><span class="token punctuation">(</span>Native Method<span class="token punctuation">)</span>    at sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>NativeMethodAccessorImpl<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>NativeMethodAccessorImpl<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">62</span><span class="token punctuation">)</span>    at sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>DelegatingMethodAccessorImpl<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>DelegatingMethodAccessorImpl<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">43</span><span class="token punctuation">)</span>    at java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>Method<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">498</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>orm<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>SharedEntityManagerCreator$DeferredQueryInvocationHandler<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>SharedEntityManagerCreator<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">409</span><span class="token punctuation">)</span>    at com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span><span class="token property">$Proxy115</span><span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span>Unknown Source<span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>query<span class="token punctuation">.</span>JpaQueryExecution$ModifyingExecution<span class="token punctuation">.</span><span class="token function">doExecute</span><span class="token punctuation">(</span>JpaQueryExecution<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">238</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>query<span class="token punctuation">.</span>JpaQueryExecution<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>JpaQueryExecution<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">88</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>query<span class="token punctuation">.</span>AbstractJpaQuery<span class="token punctuation">.</span><span class="token function">doExecute</span><span class="token punctuation">(</span>AbstractJpaQuery<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">154</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>query<span class="token punctuation">.</span>AbstractJpaQuery<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>AbstractJpaQuery<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">142</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>core<span class="token punctuation">.</span>support<span class="token punctuation">.</span>RepositoryFactorySupport$QueryExecutorMethodInterceptor<span class="token punctuation">.</span><span class="token function">doInvoke</span><span class="token punctuation">(</span>RepositoryFactorySupport<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">618</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>core<span class="token punctuation">.</span>support<span class="token punctuation">.</span>RepositoryFactorySupport$QueryExecutorMethodInterceptor<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>RepositoryFactorySupport<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">605</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>ReflectiveMethodInvocation<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span>ReflectiveMethodInvocation<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">186</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>projection<span class="token punctuation">.</span>DefaultMethodInvokingMethodInterceptor<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>DefaultMethodInvokingMethodInterceptor<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">80</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>ReflectiveMethodInvocation<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span>ReflectiveMethodInvocation<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">186</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span>TransactionAspectSupport<span class="token punctuation">.</span><span class="token function">invokeWithinTransaction</span><span class="token punctuation">(</span>TransactionAspectSupport<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">366</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span>TransactionInterceptor<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>TransactionInterceptor<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">99</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>ReflectiveMethodInvocation<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span>ReflectiveMethodInvocation<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">186</span><span class="token punctuation">)</span>    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>support<span class="token punctuation">.</span>PersistenceExceptionTranslationInterceptor<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>PersistenceExceptionTranslationInterceptor<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">139</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">39</span> more</code></pre><p>é‚£æ˜¯å› ä¸ºä½¿ç”¨jpaçš„æ—¶å€™ï¼Œæ¶‰åŠåˆ°<code>@Modifying</code>å°±è¡¨ç¤ºæ˜¯å¢åˆ æ”¹æ“ä½œï¼Œé‚£ä¹ˆå°±å¿…é¡»æ·»åŠ <code>@Transactional</code>ï¼Œå½“ç„¶å¦‚æœæ˜¯å•çº¯çš„æŸ¥è¯¢å°±ä¸éœ€è¦äº†ï¼ˆspringè€ƒè™‘çš„æŒºå…¨é¢ï¼‰ã€‚å½“åŠ ä¸Š<code>@Transactional</code>å°±å¯ä»¥æ­£å¸¸è¿è¡Œäº†ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸Šæ‰‹åŠ¨ç»™ä»–æ·»åŠ ä¸€ä¸ªå¼‚å¸¸ï¼Œå†æ¥çœ‹ç»“æœã€‚è¿™é‡Œæˆ‘ä»¬åŠ äº†ä¸€ä¸ª<code>int i = 1 / 0;</code>ä¼šäº§ç”Ÿä¸€ä¸ªé™¤ä»¥0çš„å¼‚å¸¸ï¼Œå› ä¸ºæœ‰<code>@Transactional</code>çš„å­˜åœ¨ï¼Œæ•´ä¸ªæ‰§è¡Œæ˜¯ä¸èƒ½æˆåŠŸçš„ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token annotation punctuation">@Transactional</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span>String in<span class="token punctuation">,</span> String out<span class="token punctuation">,</span> <span class="token keyword">float</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// è¿™é‡Œä½¿ç”¨çš„æ˜¯jpaæ“ä½œæ•°æ®åº“</span>  transferRepository<span class="token punctuation">.</span><span class="token function">outMoney</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>  transferRepository<span class="token punctuation">.</span><span class="token function">inMoney</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="MyBatis-Plusæ“ä½œæ•°æ®åº“"><a href="#MyBatis-Plusæ“ä½œæ•°æ®åº“" class="headerlink" title="MyBatis-Plusæ“ä½œæ•°æ®åº“"></a>MyBatis-Plusæ“ä½œæ•°æ®åº“</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>transfer<span class="token punctuation">.</span>mapper<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>BaseMapper<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>transfer<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>TransferAccount<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span>Param<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span>Update<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Repository<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020/2/16. */</span><span class="token annotation punctuation">@Repository</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TransferMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token operator">&lt;</span>TransferAccount<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * @param in    è½¬å…¥äºº     * @param money é‡‘é¢     */</span>    <span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">"update transfer_account set money = money + #{money} where name = #{name}"</span><span class="token punctuation">)</span>    <span class="token keyword">void</span> <span class="token function">inMoney</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> String in<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"money"</span><span class="token punctuation">)</span> <span class="token keyword">float</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * @param out   è½¬å‡ºäºº     * @param money é‡‘é¢     */</span>    <span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">"update transfer_account set money = money - #{money} where name = #{name}"</span><span class="token punctuation">)</span>    <span class="token keyword">void</span> <span class="token function">outMoney</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> String out<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"money"</span><span class="token punctuation">)</span> <span class="token keyword">float</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h4 id="ä¸šåŠ¡å±‚æ¨¡æ‹Ÿä¸€ä¸ªè½¬è´¦æ“ä½œ-1"><a href="#ä¸šåŠ¡å±‚æ¨¡æ‹Ÿä¸€ä¸ªè½¬è´¦æ“ä½œ-1" class="headerlink" title="ä¸šåŠ¡å±‚æ¨¡æ‹Ÿä¸€ä¸ªè½¬è´¦æ“ä½œ"></a>ä¸šåŠ¡å±‚æ¨¡æ‹Ÿä¸€ä¸ªè½¬è´¦æ“ä½œ</h4><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>transfer<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>transfer<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>TransferRepository<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>transfer<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>TransferMapper<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>transfer<span class="token punctuation">.</span>service<span class="token punctuation">.</span>TransferService<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Service<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Transactional<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>support<span class="token punctuation">.</span>TransactionTemplate<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020/2/16. */</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransferServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">TransferService</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> TransferRepository transferRepository<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> TransferMapper transferMapper<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> TransactionTemplate transactionTemplate<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span>String in<span class="token punctuation">,</span> String out<span class="token punctuation">,</span> <span class="token keyword">float</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è¿™é‡Œä½¿ç”¨çš„æ˜¯MyBatis-Plusæ“ä½œæ•°æ®åº“</span>        transferMapper<span class="token punctuation">.</span><span class="token function">outMoney</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// int i = 1 / 0;</span>        transferMapper<span class="token punctuation">.</span><span class="token function">inMoney</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>åœ¨æ²¡æœ‰å¼‚å¸¸æƒ…å†µä¸‹ï¼Œå°±ç®—ä¸åŠ <code> @Transactional</code>æ˜¯å¯ä»¥ç›´æ¥æ“ä½œæˆåŠŸçš„ï¼Œä½†æ˜¯å¦‚æœ <code>int i = 1 / 0;</code>å­˜åœ¨ï¼Œ<code>outMoney</code>æ–¹æ³•è¿˜æ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œçš„ï¼Œè¿™æ ·å°±ä¼šé€ æˆé’±è¢«æ‰£äº†ä½†æ˜¯å¯¹æ–¹å´æ²¡æœ‰æ”¶åˆ°çš„æƒ…å†µï¼Œæ‰€ä»¥è¿™æ—¶å€™å°±éœ€è¦æ·»åŠ <code> @Transactional</code>è®©ä»–è¿›è¡Œäº‹åŠ¡å¤„ç†ï¼Œè¿™é‡Œmybatiså°±æ²¡æœ‰jpaå¤„ç†çš„å¥½äº†ã€‚</p><h2 id="Transactional-ä»‹ç»"><a href="#Transactional-ä»‹ç»" class="headerlink" title="@Transactional ä»‹ç»"></a>@Transactional ä»‹ç»</h2><table><thead><tr><th><strong>å‚æ•°</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td><strong>readOnly</strong></td><td>è¯¥å±æ€§ç”¨äºè®¾ç½®å½“å‰äº‹åŠ¡æ˜¯å¦ä¸ºåªè¯»äº‹åŠ¡ï¼Œè®¾ç½®ä¸ºtrueè¡¨ç¤ºåªè¯»ï¼Œfalseåˆ™è¡¨ç¤ºå¯è¯»å†™ï¼Œé»˜è®¤å€¼ä¸ºfalseã€‚ä¾‹å¦‚ï¼š@Transactional(readOnly=true)</td></tr><tr><td><strong>rollbackFor</strong></td><td>è¯¥å±æ€§ç”¨äºè®¾ç½®éœ€è¦è¿›è¡Œå›æ»šçš„å¼‚å¸¸ç±»æ•°ç»„ï¼Œå½“æ–¹æ³•ä¸­æŠ›å‡ºæŒ‡å®šå¼‚å¸¸æ•°ç»„ä¸­çš„å¼‚å¸¸æ—¶ï¼Œåˆ™è¿›è¡Œäº‹åŠ¡å›æ»šã€‚ä¾‹å¦‚ï¼šæŒ‡å®šå•ä¸€å¼‚å¸¸ç±»ï¼š@Transactional(rollbackFor=RuntimeException.class)æŒ‡å®šå¤šä¸ªå¼‚å¸¸ç±»ï¼š@Transactional(rollbackFor={RuntimeException.class, Exception.class})</td></tr><tr><td><strong>rollbackForClassName</strong></td><td>è¯¥å±æ€§ç”¨äºè®¾ç½®éœ€è¦è¿›è¡Œå›æ»šçš„å¼‚å¸¸ç±»åç§°æ•°ç»„ï¼Œå½“æ–¹æ³•ä¸­æŠ›å‡ºæŒ‡å®šå¼‚å¸¸åç§°æ•°ç»„ä¸­çš„å¼‚å¸¸æ—¶ï¼Œåˆ™è¿›è¡Œäº‹åŠ¡å›æ»šã€‚ä¾‹å¦‚ï¼šæŒ‡å®šå•ä¸€å¼‚å¸¸ç±»åç§°ï¼š@Transactional(rollbackForClassName=â€RuntimeExceptionâ€)æŒ‡å®šå¤šä¸ªå¼‚å¸¸ç±»åç§°ï¼š@Transactional(rollbackForClassName={â€œRuntimeExceptionâ€,â€Exceptionâ€})</td></tr><tr><td><strong>noRollbackFor</strong></td><td>è¯¥å±æ€§ç”¨äºè®¾ç½®ä¸éœ€è¦è¿›è¡Œå›æ»šçš„å¼‚å¸¸ç±»æ•°ç»„ï¼Œå½“æ–¹æ³•ä¸­æŠ›å‡ºæŒ‡å®šå¼‚å¸¸æ•°ç»„ä¸­çš„å¼‚å¸¸æ—¶ï¼Œä¸è¿›è¡Œäº‹åŠ¡å›æ»šã€‚ä¾‹å¦‚ï¼šæŒ‡å®šå•ä¸€å¼‚å¸¸ç±»ï¼š@Transactional(noRollbackFor=RuntimeException.class)æŒ‡å®šå¤šä¸ªå¼‚å¸¸ç±»ï¼š@Transactional(noRollbackFor={RuntimeException.class, Exception.class})</td></tr><tr><td><strong>noRollbackForClassName</strong></td><td>è¯¥å±æ€§ç”¨äºè®¾ç½®ä¸éœ€è¦è¿›è¡Œå›æ»šçš„å¼‚å¸¸ç±»åç§°æ•°ç»„ï¼Œå½“æ–¹æ³•ä¸­æŠ›å‡ºæŒ‡å®šå¼‚å¸¸åç§°æ•°ç»„ä¸­çš„å¼‚å¸¸æ—¶ï¼Œä¸è¿›è¡Œäº‹åŠ¡å›æ»šã€‚ä¾‹å¦‚ï¼šæŒ‡å®šå•ä¸€å¼‚å¸¸ç±»åç§°ï¼š@Transactional(noRollbackForClassName=â€RuntimeExceptionâ€)æŒ‡å®šå¤šä¸ªå¼‚å¸¸ç±»åç§°ï¼š@Transactional(noRollbackForClassName={â€œRuntimeExceptionâ€,â€Exceptionâ€})</td></tr><tr><td><strong>propagation</strong></td><td>è¯¥å±æ€§ç”¨äºè®¾ç½®äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Œå…·ä½“å–å€¼å¯å‚è€ƒè¡¨6-7ã€‚ä¾‹å¦‚ï¼š@Transactional(propagation=Propagation.NOT_SUPPORTED,readOnly=true)</td></tr><tr><td><strong>isolation</strong></td><td>è¯¥å±æ€§ç”¨äºè®¾ç½®åº•å±‚æ•°æ®åº“çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡éš”ç¦»çº§åˆ«ç”¨äºå¤„ç†å¤šäº‹åŠ¡å¹¶å‘çš„æƒ…å†µï¼Œé€šå¸¸ä½¿ç”¨æ•°æ®åº“çš„é»˜è®¤éš”ç¦»çº§åˆ«å³å¯ï¼ŒåŸºæœ¬ä¸éœ€è¦è¿›è¡Œè®¾ç½®</td></tr><tr><td><strong>timeout</strong></td><td>è¯¥å±æ€§ç”¨äºè®¾ç½®äº‹åŠ¡çš„è¶…æ—¶ç§’æ•°ï¼Œé»˜è®¤å€¼ä¸º-1è¡¨ç¤ºæ°¸ä¸è¶…æ—¶</td></tr></tbody></table><p>ä»¥ä¸Šå‚è€ƒï¼š<a href="https://www.cnblogs.com/caoyc/p/5632963.html"><code>spring</code>äº‹åŠ¡æ³¨è§£</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»¥ä¸Šä»‹ç»äº†ä¸€ä¸‹springä¸­çš„äº‹åŠ¡æ¥å£å’Œäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºä»¥åŠéš”ç¦»çº§åˆ«ï¼Œä¹Ÿé€šè¿‡è½¬è´¦çš„ä¾‹å­æ¼”ç¤ºäº†æœ‰äº‹åŠ¡å’Œæ²¡æœ‰äº‹åŠ¡çš„åŒºåˆ«ï¼Œå†æœ‰äº†<code>spring boot</code>ä»¥åï¼ŒåŸºæœ¬éƒ½æ˜¯ä½¿ç”¨æ³¨è§£çš„å½¢å¼è¿›è¡Œäº‹åŠ¡å¤„ç†ã€‚</p><p>æºç åœ°å€ï¼š<a href="https://github.com/xiaomozhang/personal-life-example/tree/master/example-transaction">https://github.com/xiaomozhang/personal-life-example/tree/master/example-transaction</a></p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
            <tag> transaction </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Aop AspectJ æ‘˜å½•ç¬”è®°</title>
      <link href="2020/02/16/spring-aop/"/>
      <url>2020/02/16/spring-aop/</url>
      
        <content type="html"><![CDATA[<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://juejin.im/post/5a55af9e518825734d14813f">https://juejin.im/post/5a55af9e518825734d14813f</a></p><h2 id="AspectJ"><a href="#AspectJ" class="headerlink" title="@AspectJ"></a>@AspectJ</h2><p><strong>AspectJæ˜¯ä¸€ä¸ªAOPæ¡†æ¶ï¼Œå®ƒèƒ½å¤Ÿå¯¹javaä»£ç è¿›è¡ŒAOPç¼–è¯‘ï¼ˆä¸€èˆ¬åœ¨ç¼–è¯‘æœŸè¿›è¡Œï¼‰ï¼Œè®©javaä»£ç å…·æœ‰AspectJçš„AOPåŠŸèƒ½ï¼ˆå½“ç„¶éœ€è¦ç‰¹æ®Šçš„ç¼–è¯‘å™¨ï¼‰ï¼Œå¯ä»¥è¿™æ ·è¯´AspectJæ˜¯ç›®å‰å®ç°AOPæ¡†æ¶ä¸­æœ€æˆç†Ÿï¼ŒåŠŸèƒ½æœ€ä¸°å¯Œçš„è¯­è¨€ï¼Œæ›´å¹¸è¿çš„æ˜¯ï¼ŒAspectJä¸javaç¨‹åºå®Œå…¨å…¼å®¹ï¼Œå‡ ä¹æ˜¯æ— ç¼å…³è”ï¼Œå› æ­¤å¯¹äºæœ‰javaç¼–ç¨‹åŸºç¡€çš„å·¥ç¨‹å¸ˆï¼Œä¸Šæ‰‹å’Œä½¿ç”¨éƒ½éå¸¸å®¹æ˜“.</strong> </p><p>å…¶å®<strong>AspectJå•ç‹¬å°±æ˜¯ä¸€é—¨è¯­è¨€</strong>ï¼Œå®ƒéœ€è¦ä¸“é—¨çš„ç¼–è¯‘å™¨(ajcç¼–è¯‘å™¨). Spring AOP ä¸ApectJçš„ç›®çš„ä¸€è‡´ï¼Œéƒ½æ˜¯ä¸ºäº†ç»Ÿä¸€å¤„ç†æ¨ªåˆ‡ä¸šåŠ¡ï¼Œä½†ä¸AspectJä¸åŒçš„æ˜¯ï¼ŒSpring AOPå¹¶ä¸å°è¯•æä¾›å®Œæ•´çš„AOPåŠŸèƒ½(å³ä½¿å®ƒå®Œå…¨å¯ä»¥å®ç°)ï¼ŒSpring AOP æ›´æ³¨é‡çš„æ˜¯ä¸Spring IOCå®¹å™¨çš„ç»“åˆï¼Œå¹¶ç»“åˆè¯¥ä¼˜åŠ¿æ¥è§£å†³æ¨ªåˆ‡ä¸šåŠ¡çš„é—®é¢˜ï¼Œå› æ­¤åœ¨AOPçš„åŠŸèƒ½å®Œå–„æ–¹é¢ï¼Œç›¸å¯¹æ¥è¯´AspectJå…·æœ‰æ›´å¤§çš„ä¼˜åŠ¿ï¼ŒåŒæ—¶,Springæ³¨æ„åˆ°AspectJåœ¨AOPçš„å®ç°æ–¹å¼ä¸Šä¾èµ–äºç‰¹æ®Šç¼–è¯‘å™¨(ajcç¼–è¯‘å™¨)ï¼Œå› æ­¤Springå¾ˆæœºæ™ºå›é¿äº†è¿™ç‚¹ï¼Œ<strong>è½¬å‘é‡‡ç”¨åŠ¨æ€ä»£ç†æŠ€æœ¯çš„å®ç°åŸç†æ¥æ„å»ºSpring AOPçš„å†…éƒ¨æœºåˆ¶ï¼ˆåŠ¨æ€ç»‡å…¥ï¼‰ï¼Œè¿™æ˜¯ä¸AspectJï¼ˆé™æ€ç»‡å…¥ï¼‰æœ€æ ¹æœ¬çš„åŒºåˆ«</strong>ã€‚åœ¨AspectJ 1.5åï¼Œå¼•å…¥@Aspectå½¢å¼çš„æ³¨è§£é£æ ¼çš„å¼€å‘ï¼ŒSpringä¹Ÿéå¸¸å¿«åœ°è·Ÿè¿›äº†è¿™ç§æ–¹å¼ï¼Œå› æ­¤Spring 2.0åä¾¿ä½¿ç”¨äº†ä¸AspectJä¸€æ ·çš„æ³¨è§£ã€‚è¯·æ³¨æ„ï¼Œ<strong>Spring åªæ˜¯ä½¿ç”¨äº†ä¸ AspectJ 5 ä¸€æ ·çš„æ³¨è§£ï¼Œä½†ä»ç„¶æ²¡æœ‰ä½¿ç”¨ AspectJ çš„ç¼–è¯‘å™¨ï¼Œåº•å±‚ä¾æ˜¯åŠ¨æ€ä»£ç†æŠ€æœ¯çš„å®ç°ï¼Œå› æ­¤å¹¶ä¸ä¾èµ–äº AspectJ çš„ç¼–è¯‘å™¨</strong>ã€‚</p><p>æ‰€ä»¥ï¼ŒSpring AOPè™½ç„¶æ˜¯ä½¿ç”¨äº†é‚£ä¸€å¥—æ³¨è§£ï¼Œå…¶å®å®ç°AOPçš„åº•å±‚æ˜¯ä½¿ç”¨äº†åŠ¨æ€ä»£ç†(JDKæˆ–è€…CGLib)æ¥åŠ¨æ€æ¤å…¥ã€‚</p><blockquote><ul><li>åˆ‡ç‚¹:å®šä½åˆ°å…·ä½“æ–¹æ³•çš„ä¸€ä¸ªè¡¨è¾¾å¼</li><li>åˆ‡é¢: åˆ‡ç‚¹+å»ºè¨€</li><li>å»ºè¨€(å¢å¼º):å®šä½åˆ°æ–¹æ³•åå¹²ä»€ä¹ˆäº‹</li></ul></blockquote><h2 id="å‰ç½®é€šçŸ¥-Before"><a href="#å‰ç½®é€šçŸ¥-Before" class="headerlink" title="å‰ç½®é€šçŸ¥ @Before"></a>å‰ç½®é€šçŸ¥ @Before</h2><p>å‰ç½®é€šçŸ¥é€šè¿‡@Beforeæ³¨è§£è¿›è¡Œæ ‡æ³¨ï¼Œå¹¶å¯ç›´æ¥ä¼ å…¥åˆ‡ç‚¹è¡¨è¾¾å¼çš„å€¼ï¼Œè¯¥é€šçŸ¥åœ¨ç›®æ ‡å‡½æ•°æ‰§è¡Œå‰æ‰§è¡Œï¼Œæ³¨æ„JoinPointï¼Œæ˜¯Springæä¾›çš„é™æ€å˜é‡ï¼Œé€šè¿‡joinPoint å‚æ•°ï¼Œå¯ä»¥è·å–ç›®æ ‡å¯¹è±¡çš„ä¿¡æ¯,å¦‚ç±»åç§°,æ–¹æ³•å‚æ•°,æ–¹æ³•åç§°ç­‰ï¼Œè¯¥å‚æ•°æ˜¯å¯é€‰çš„ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"execution(* com.xiaozhangge.aop.service.*.*(..))"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span>JoinPoint joinPoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å‰ç½®é€šçŸ¥ CLASS_METHOD : {}"</span><span class="token punctuation">,</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaringTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å‰ç½®é€šçŸ¥ ARGS : {}"</span><span class="token punctuation">,</span> Arrays<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="åç½®é€šçŸ¥-AfterReturning"><a href="#åç½®é€šçŸ¥-AfterReturning" class="headerlink" title="åç½®é€šçŸ¥ @AfterReturning"></a>åç½®é€šçŸ¥ @AfterReturning</h2><p>é€šè¿‡@AfterReturningæ³¨è§£è¿›è¡Œæ ‡æ³¨ï¼Œè¯¥å‡½æ•°åœ¨ç›®æ ‡å‡½æ•°æ‰§è¡Œå®Œæˆåæ‰§è¡Œï¼Œå¹¶å¯ä»¥è·å–åˆ°ç›®æ ‡å‡½æ•°æœ€ç»ˆçš„è¿”å›å€¼returnValï¼Œå½“ç›®æ ‡å‡½æ•°æ²¡æœ‰è¿”å›å€¼æ—¶ï¼ŒreturnValå°†è¿”å›nullï¼Œå¿…é¡»é€šè¿‡returning = â€œreturnValâ€æ³¨æ˜å‚æ•°çš„åç§°è€Œä¸”å¿…é¡»ä¸é€šçŸ¥å‡½æ•°çš„å‚æ•°åç§°ç›¸åŒã€‚è¯·æ³¨æ„ï¼Œåœ¨ä»»ä½•é€šçŸ¥ä¸­è¿™äº›å‚æ•°éƒ½æ˜¯å¯é€‰çš„ï¼Œéœ€è¦ä½¿ç”¨æ—¶ç›´æ¥å¡«å†™å³å¯ï¼Œä¸éœ€è¦ä½¿ç”¨æ—¶ï¼Œå¯ä»¥å®Œæˆä¸ç”¨å£°æ˜å‡ºæ¥ã€‚<strong>å½“å‡ºç°å¼‚å¸¸åˆ™ä¸æ‰§è¡Œã€‚</strong></p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution(* com.xiaozhangge.aop.service.*.*(..))"</span><span class="token punctuation">,</span> returning <span class="token operator">=</span> <span class="token string">"returnVal"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">AfterReturning</span><span class="token punctuation">(</span>JoinPoint joinPoint<span class="token punctuation">,</span> Object returnVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"åç½®é€šçŸ¥ CLASS_METHOD : {}"</span><span class="token punctuation">,</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaringTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"åç½®é€šçŸ¥ ARGS : {}"</span><span class="token punctuation">,</span> Arrays<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"åç½®é€šçŸ¥ returnVal {} "</span><span class="token punctuation">,</span> returnVal<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="å¼‚å¸¸é€šçŸ¥-AfterThrowing"><a href="#å¼‚å¸¸é€šçŸ¥-AfterThrowing" class="headerlink" title="å¼‚å¸¸é€šçŸ¥ @AfterThrowing"></a>å¼‚å¸¸é€šçŸ¥ @AfterThrowing</h2><p>è¯¥é€šçŸ¥åªæœ‰åœ¨å¼‚å¸¸æ—¶æ‰ä¼šè¢«è§¦å‘ï¼Œå¹¶ç”±throwingæ¥å£°æ˜ä¸€ä¸ªæ¥æ”¶å¼‚å¸¸ä¿¡æ¯çš„å˜é‡ï¼ŒåŒæ ·å¼‚å¸¸é€šçŸ¥ä¹Ÿç”¨äºJoinpointå‚æ•°ï¼Œéœ€è¦æ—¶åŠ ä¸Šå³å¯ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution(* com.xiaozhangge.aop.service.*.*(..))"</span><span class="token punctuation">,</span> throwing <span class="token operator">=</span> <span class="token string">"e"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterThrowable</span><span class="token punctuation">(</span>Throwable e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"å¼‚å¸¸: "</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="æœ€ç»ˆé€šçŸ¥-After"><a href="#æœ€ç»ˆé€šçŸ¥-After" class="headerlink" title="æœ€ç»ˆé€šçŸ¥ @After"></a>æœ€ç»ˆé€šçŸ¥ @After</h2><p>è¯¥é€šçŸ¥æœ‰ç‚¹ç±»ä¼¼äºfinallyä»£ç å—ï¼Œåªè¦åº”ç”¨äº†æ— è®ºä»€ä¹ˆæƒ…å†µä¸‹éƒ½ä¼šæ‰§è¡Œã€‚</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">"execution(* com.xiaozhangge.aop.service.*.*(..))"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span>JoinPoint joinPoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æœ€ç»ˆé€šçŸ¥ CLASS_METHOD : {}"</span><span class="token punctuation">,</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaringTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æœ€ç»ˆé€šçŸ¥ ARGS : {}"</span><span class="token punctuation">,</span> Arrays<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="ç¯ç»•é€šçŸ¥-Around"><a href="#ç¯ç»•é€šçŸ¥-Around" class="headerlink" title="ç¯ç»•é€šçŸ¥ @Around"></a>ç¯ç»•é€šçŸ¥ @Around</h2><p>ç¯ç»•é€šçŸ¥æ—¢å¯ä»¥åœ¨ç›®æ ‡æ–¹æ³•å‰æ‰§è¡Œä¹Ÿå¯åœ¨ç›®æ ‡æ–¹æ³•ä¹‹åæ‰§è¡Œï¼Œæ›´é‡è¦çš„æ˜¯ç¯ç»•é€šçŸ¥å¯ä»¥æ§åˆ¶ç›®æ ‡æ–¹æ³•æ˜¯å¦æŒ‡å‘æ‰§è¡Œï¼Œä½†å³ä½¿å¦‚æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡ä»¥æœ€ç®€å•çš„æ–¹å¼æ»¡è¶³éœ€æ±‚ï¼Œåœ¨ä»…éœ€åœ¨ç›®æ ‡æ–¹æ³•å‰æ‰§è¡Œæ—¶ï¼Œåº”è¯¥é‡‡ç”¨å‰ç½®é€šçŸ¥è€Œéç¯ç»•é€šçŸ¥ã€‚ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ProceedingJoinPointï¼Œé€šè¿‡è¯¥å¯¹è±¡çš„proceed()æ–¹æ³•æ¥æ‰§è¡Œç›®æ ‡å‡½æ•°ï¼Œproceed()çš„è¿”å›å€¼å°±æ˜¯ç¯ç»•é€šçŸ¥çš„è¿”å›å€¼ã€‚åŒæ ·çš„ï¼ŒProceedingJoinPointå¯¹è±¡ä¹Ÿæ˜¯å¯ä»¥è·å–ç›®æ ‡å¯¹è±¡çš„ä¿¡æ¯ã€å¦‚ç±»åç§°ã€æ–¹æ³•å‚æ•°ã€æ–¹æ³•åç§°ç­‰ç­‰ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"execution(* com.xiaozhangge.aop.service.*.*(..))"</span><span class="token punctuation">)</span><span class="token keyword">public</span> Object <span class="token function">around</span><span class="token punctuation">(</span>ProceedingJoinPoint joinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ç¯ç»•é€šçŸ¥å‰...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// æ‰§è¡Œç›®æ ‡å‡½æ•°</span>  Object obj <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ç¯ç»•é€šçŸ¥å....{}"</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> obj<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="execution-è¯­æ³•"><a href="#execution-è¯­æ³•" class="headerlink" title="execution è¯­æ³•"></a>execution è¯­æ³•</h2><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// scope ï¼šæ–¹æ³•ä½œç”¨åŸŸï¼Œå¦‚public,private,protect</span><span class="token comment" spellcheck="true">// returnt-typeï¼šæ–¹æ³•è¿”å›å€¼ç±»å‹</span><span class="token comment" spellcheck="true">// fully-qualified-class-nameï¼šæ–¹æ³•æ‰€åœ¨ç±»çš„å®Œå…¨é™å®šåç§°</span><span class="token comment" spellcheck="true">// parameters æ–¹æ³•å‚æ•°</span><span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>scope<span class="token operator">></span> <span class="token operator">&lt;</span><span class="token keyword">return</span><span class="token operator">-</span>type<span class="token operator">></span> <span class="token operator">&lt;</span>fully<span class="token operator">-</span>qualified<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">-</span>name<span class="token operator">></span><span class="token punctuation">.</span>*<span class="token punctuation">(</span>parameters<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><ul><li><code>execution(* com.xiaozhangge.*.*(..))</code> com.xiaozhanggeåŒ…ä¸‹æ‰€æœ‰ç±»çš„æ‰€æœ‰æ–¹æ³•</li><li><code>execution(* com.xiaozhangge.Dog.*(..))</code> Dogç±»ä¸‹çš„æ‰€æœ‰æ–¹</li><li><code>execution(* com.xiaozhangge.Dog*.*(..))</code> Dogå¼€å¤´çš„ç±»ä¸‹çš„æ‰€æœ‰æ–¹æ³•</li></ul><h2 id="åˆ‡ç‚¹-Pointcut"><a href="#åˆ‡ç‚¹-Pointcut" class="headerlink" title="åˆ‡ç‚¹ @Pointcut"></a>åˆ‡ç‚¹ @Pointcut</h2><p>åœ¨ä½¿ç”¨åˆ‡å…¥ç‚¹æ—¶ï¼Œè¿˜å¯ä»¥æŠ½å‡ºæ¥ä¸€ä¸ª<code>@Pointcut</code>æ¥ä¾›ä½¿ç”¨ï¼Œå¯ä»¥é¿å…é‡å¤çš„executionåœ¨ä¸åŒçš„æ³¨è§£é‡Œå†™å¾ˆå¤šéã€‚</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"execution(public * com.xiaozhangge.aop.service.*.*(..))"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>ä½¿ç”¨</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"pointcut()"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ä½¿ç”¨@Pointcut çš„å‰ç½®é€šçŸ¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="AOPåˆ‡é¢çš„ä¼˜å…ˆçº§"><a href="#AOPåˆ‡é¢çš„ä¼˜å…ˆçº§" class="headerlink" title="AOPåˆ‡é¢çš„ä¼˜å…ˆçº§"></a>AOPåˆ‡é¢çš„ä¼˜å…ˆçº§</h2><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯¹ä¸€ä¸ªæ–¹æ³•ä¼šæœ‰å¤šä¸ªåˆ‡é¢çš„é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™è¿˜ä¼šæ¶‰åŠåˆ°åˆ‡é¢çš„æ‰§è¡Œé¡ºåºçš„é—®é¢˜ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å®šä¹‰æ¯ä¸ªåˆ‡é¢çš„ä¼˜å…ˆçº§ï¼Œ Spring ä¸­æä¾›æ³¨è§£ <code>@Order(i)</code> ï¼Œå½“ <code>i</code> çš„å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚</p><h2 id="ç¯ç»•å’Œå‰åç½®é€šçŸ¥çš„åŒºåˆ«"><a href="#ç¯ç»•å’Œå‰åç½®é€šçŸ¥çš„åŒºåˆ«" class="headerlink" title="ç¯ç»•å’Œå‰åç½®é€šçŸ¥çš„åŒºåˆ«"></a>ç¯ç»•å’Œå‰åç½®é€šçŸ¥çš„åŒºåˆ«</h2><p>å¯¹äºæœ‰å˜é‡ç¼“å­˜éœ€æ±‚ï¼Œçº¿ç¨‹å®‰å…¨çš„åº”ç”¨åœºæ™¯ï¼Œå‰åç½®é€šçŸ¥å®ç°æ¯”è¾ƒå›°éš¾ï¼Œè€Œç¯ç»•é€šçŸ¥å®ç°å°±éå¸¸å®¹æ˜“ï¼›</p><p><a href="https://www.cnblogs.com/yaphetsfang/articles/11378821.html">https://www.cnblogs.com/yaphetsfang/articles/11378821.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AspectJ </tag>
            
            <tag> Aop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨wgetæˆ–è€…curlä¸‹è½½github releaseæ–‡ä»¶</title>
      <link href="2020/02/14/cmd-download-file/"/>
      <url>2020/02/14/cmd-download-file/</url>
      
        <content type="html"><![CDATA[<p>æœ‰æ—¶å€™éœ€è¦åœ¨æœåŠ¡å™¨ä¸‹è½½GitHubä¸Šçš„releaseèµ„æºï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>wget</code>æˆ–è€…<code>curl</code>è¿›è¡Œå¤„ç†ï¼Œè¿™é‡Œæ‹¿æºç¨‹å¼€æºçš„é…ç½®ä¸­å¿ƒ<a href="https://github.com/ctripcorp/apollo">Apollo</a>ä¸ºä¾‹ï¼Œä¸‹è½½ä»–çš„releaseç‰ˆæœ¬</p><h2 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h2><p><code>wget --no-check-certificate --content-disposition https://github.com/ctripcorp/apollo/releases/download/v1.5.1/apollo-adminservice-1.5.1-github.zip</code></p><h2 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h2><p><code>curl -LJO https://github.com/ctripcorp/apollo/releases/download/v1.5.1/apollo-adminservice-1.5.1-github.zip</code></p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot2.x Rediså¤šæ•°æ®æºé…ç½®(Vavrå‡½æ•°å¼ç¼–ç¨‹æ–¹å¼å®ç°)</title>
      <link href="2020/01/10/spring-boot-redis-multi-instance/"/>
      <url>2020/01/10/spring-boot-redis-multi-instance/</url>
      
        <content type="html"><![CDATA[<p>Spring Boot 2.xç‰ˆæœ¬å‡çº§ä»¥åï¼ŒRedisè¿æ¥åº“ç”±åŸæ¥çš„<code>Jedis</code>æ¢æˆäº†<code>Lettuce</code>ï¼Œä½†æ˜¯æä¾›ç»™ä¸Šå±‚ä½¿ç”¨çš„apiæ²¡æœ‰å˜åŒ–ï¼Œåœ¨æ—¥å¸¸ä½¿ç”¨è¿‡ç¨‹ä¸­éš¾å…ä¼šæœ‰éœ€è¦ä½¿ç”¨å¤šä¸ªåº“çš„æƒ…å†µï¼Œæˆ–è€…ä½¿ç”¨å¤šä¸ªRediså®ä¾‹ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç»´æŠ¤ä¸¤ä¸ªRedisè¿æ¥æ± æˆ–è€…è¯´ä¸¤ä¸ª<code>RedisTemplate</code>ã€‚</p><h2 id="å®ç°æ€è·¯"><a href="#å®ç°æ€è·¯" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h2><ol><li>å¤šæ•°æ®æºæœ€ç»ˆè¡¨ç°å…¶å®å°±æ˜¯ <code>RedisConnectionFactory</code> ä¸åŒ</li><li>Spring Boot é€šè¿‡<code>RedisStandaloneConfiguration</code>ç»´æŠ¤äº†ä¸€å¥—é»˜è®¤çš„<code>RedisConnectionFactory</code>ï¼Œè¦å®ç°å¤šä¸ªå®ä¾‹æˆ–è€…ä½¿ç”¨å¤šä¸ªdbï¼Œç†è®ºä¸Šåªéœ€è¦è‡ªå·±åœ¨ç»´æŠ¤ä¸€å¥—<code>RedisConnectionFactory</code>å³å¯ã€‚</li><li>ä¸ç®¡æ˜¯<code>Jedis</code>æˆ–æ˜¯<code>Lettuce</code>ï¼Œéƒ½æ˜¯é€šç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†ä¸¤ä¸ªçš„å®ç°æ–¹å¼éƒ½æ•´ç†å‡ºæ¥ï¼ŒåŒºåˆ«å¦‚ä¸‹ï¼š<ul><li> <code>Lettuce</code>ä½¿ç”¨çš„æ˜¯<code>LettuceConnectionFactory</code></li><li><code>Jedis</code>ä½¿ç”¨çš„æ˜¯<code>JedisConnectionFactory</code></li></ul></li></ol><h2 id="åˆ›å»ºRedisæœåŠ¡"><a href="#åˆ›å»ºRedisæœåŠ¡" class="headerlink" title="åˆ›å»ºRedisæœåŠ¡"></a>åˆ›å»ºRedisæœåŠ¡</h2><p>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œç›´æ¥ä½¿ç”¨<code>docker</code>åˆ›å»ºä¸€ä¸ªRedisæœåŠ¡ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¯åŠ¨è„šæœ¬</p><ol><li><code>--restart=always</code>è®¾ç½®äº†RedisæœåŠ¡éšç€dockerè¿›ç¨‹çš„å¯åŠ¨è€Œå¯åŠ¨</li><li><code>-p 6379:6379</code> å°†dockerå¯åŠ¨çš„æœåŠ¡ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºï¼Œè¿™é‡Œæ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™å®¿ä¸»æœºå’Œredisçš„ç«¯å£æ˜¯ä¸èƒ½é€šä¿¡çš„</li><li><code>--requirepass "redis"</code> è®¾ç½®å¯†ç ä¸º<code>redis</code></li><li><code>--appendonly yes</code>ä¿å­˜aofæŒä¹…åŒ–æ–‡ä»¶</li><li><code>-v ~/share/docker/data/redis:/data \</code> å°†dockerå¯åŠ¨çš„redisçš„æ•°æ®æ˜ å°„åˆ°å®¿ä¸»æœºç›®å½•</li></ol><pre class=" language-dockerfile"><code class="language-dockerfile">mkdir -p ~/share/docker/data/redischmod 755 -R ~/share/docker/data/redisdocker run -dit --restart=always --name redis \    -v ~/share/docker/data/redis:/data \    -p 6379:6379 \    redis:latest redis-server --requirepass "redis" --appendonly yes</code></pre><p>å¦‚æœè§‰å¾—ä¸éœ€è¦è®¾ç½®è¿™ä¹ˆå¤šï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æœ€ç®€å•çš„è„šæœ¬ï¼Œä»…ä»…å°†ç«¯å£åšäº†æ˜ å°„ï¼Œå…¶ä»–çš„éƒ½æ˜¯æœ€ç®€å•çš„é…ç½®</p><pre class=" language-dockerfile"><code class="language-dockerfile">docker run -dit --name redis -p 6379:6379 redis:latest</code></pre><p>å…³äºdockerçš„ä¸€äº›æ–‡ç« ï¼Œè¯¦ç»†è¯·å‚è€ƒdockerå®˜ç½‘ï¼Œè¿™é‡Œä¸åšè¿‡å¤šèµ˜è¿°</p><h2 id="é¡¹ç›®pomé…ç½®"><a href="#é¡¹ç›®pomé…ç½®" class="headerlink" title="é¡¹ç›®pomé…ç½®"></a>é¡¹ç›®pomé…ç½®</h2><p>ä½¿ç”¨Spring Booté›†æˆRedisï¼Œåªéœ€è¦å°†<code>spring-boot-starter-data-redis</code>å’Œ<code>commons-pool2</code>åŠ åˆ°ä¾èµ–å³å¯</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>commons-pool2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><h2 id="è‡ªå®šä¹‰RedisConfigure"><a href="#è‡ªå®šä¹‰RedisConfigure" class="headerlink" title="è‡ªå®šä¹‰RedisConfigure"></a>è‡ªå®šä¹‰RedisConfigure</h2><p>è¿™é‡Œè¿™ä¸€æ­¥æ˜¯æœ€é‡è¦çš„ï¼Œå› ä¸ºSpring Booté»˜è®¤å¸®æˆ‘ä»¬ç»´æŠ¤äº†ä¸€ä¸ª<code>RedisConnectionFactory</code>ï¼Œå‰é¢è¯´äº†è¦ä½¿ç”¨ä¸åŒçš„Rediså®ä¾‹å°±éœ€è¦è‡ªå·±åœ¨ç»´æŠ¤ä¸€ä¸ª<code>RedisConnectionFactory</code>ï¼Œè¿™é‡Œå°±ä»¥ä½¿ç”¨ä¸¤ä¸ªredisçš„databaseä¸ºä¾‹</p><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p><code>spring.redis</code>å¼€å¤´çš„éƒ½æ˜¯Spring Bootè‡ªåŠ¨æ³¨å…¥éœ€è¦åŠ è½½çš„é…ç½®ï¼Œæˆ‘ä»¬ä¸ºäº†åœ¨ä½¿ç”¨ä¸€ä¸ªdb2ï¼Œè¿™é‡ŒåŠ äº†ä¸€ä¸ª<code>spring.redis-db-2</code>å¼€å¤´çš„é…ç½®</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">redis</span><span class="token punctuation">:</span>    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>    <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>    <span class="token key atrule">password</span><span class="token punctuation">:</span>    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">60000</span>    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>      <span class="token key atrule">pool</span><span class="token punctuation">:</span>        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">8 </span><span class="token comment" spellcheck="true"># è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ é»˜è®¤ 8</span>        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">-1 </span><span class="token comment" spellcheck="true"># è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ é»˜è®¤ -1</span>        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">8 </span><span class="token comment" spellcheck="true"># è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥ é»˜è®¤ 8</span>        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0 </span><span class="token comment" spellcheck="true"># è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ é»˜è®¤ 0</span>  <span class="token key atrule">redis-db-2</span><span class="token punctuation">:</span>    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">2</span>    <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>    <span class="token key atrule">password</span><span class="token punctuation">:</span>    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">60000</span>    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>      <span class="token key atrule">pool</span><span class="token punctuation">:</span>        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">8</span>        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">8</span>        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">8</span>        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span></code></pre><h3 id="RedisConfigure"><a href="#RedisConfigure" class="headerlink" title="RedisConfigure"></a>RedisConfigure</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>configure<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>JsonAutoDetect<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>PropertyAccessor<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span>ObjectMapper<span class="token punctuation">;</span><span class="token keyword">import</span> io<span class="token punctuation">.</span>vavr<span class="token punctuation">.</span>Tuple<span class="token punctuation">;</span><span class="token keyword">import</span> io<span class="token punctuation">.</span>vavr<span class="token punctuation">.</span>Tuple6<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span>StringUtils<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>pool2<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>GenericObjectPoolConfig<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Value<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>EnableCaching<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>RedisConnectionFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>RedisPassword<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>RedisStandaloneConfiguration<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span>JedisClientConfiguration<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span>JedisConnectionFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>lettuce<span class="token punctuation">.</span>LettuceConnectionFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>lettuce<span class="token punctuation">.</span>LettucePoolingClientConfiguration<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span>RedisTemplate<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span>Jackson2JsonRedisSerializer<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span>StringRedisSerializer<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>Duration<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020-01-10. * * @Value("${spring.redis-db-2.database}") int database, * @Value("${spring.redis-db-2.host}") String host, * @Value("${spring.redis-db-2.port}") int port, * @Value("${spring.redis-db-2.password}") String password, * @Value("${spring.redis-db-2.timeout}") long timeout, * @Value("${spring.redis-db-2.lettuce.pool.max-active}") int maxActive, * @Value("${spring.redis-db-2.lettuce.pool.max-wait}") int maxWait, * @Value("${spring.redis-db-2.lettuce.pool.max-idle}") int maxIdle, * @Value("${spring.redis-db-2.lettuce.pool.min-idle}") int minIdle */</span><span class="token annotation punctuation">@EnableCaching</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfigure</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> RedisTemplate <span class="token function">redisTemplateDB_2</span><span class="token punctuation">(</span>Tuple6<span class="token operator">&lt;</span>RedisStandaloneConfiguration<span class="token punctuation">,</span> Long<span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> Integer<span class="token operator">></span> redisConfigurationDB_2<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Long timeout <span class="token operator">=</span> redisConfigurationDB_2<span class="token punctuation">.</span><span class="token function">_2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> maxActive <span class="token operator">=</span> redisConfigurationDB_2<span class="token punctuation">.</span><span class="token function">_3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                maxWait <span class="token operator">=</span> redisConfigurationDB_2<span class="token punctuation">.</span><span class="token function">_4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                maxIdle <span class="token operator">=</span> redisConfigurationDB_2<span class="token punctuation">.</span><span class="token function">_5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                minIdle <span class="token operator">=</span> redisConfigurationDB_2<span class="token punctuation">.</span><span class="token function">_6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">/* ========= åŸºæœ¬é…ç½® ========= */</span>        RedisStandaloneConfiguration standaloneConfiguration <span class="token operator">=</span> redisConfigurationDB_2<span class="token punctuation">.</span><span class="token function">_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">/* ========= è¿æ¥æ± é€šç”¨é…ç½® ========= */</span>        GenericObjectPoolConfig genericObjectPoolConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericObjectPoolConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        genericObjectPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxTotal</span><span class="token punctuation">(</span>maxActive<span class="token punctuation">)</span><span class="token punctuation">;</span>        genericObjectPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxWaitMillis</span><span class="token punctuation">(</span>maxWait<span class="token punctuation">)</span><span class="token punctuation">;</span>        genericObjectPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxIdle</span><span class="token punctuation">(</span>maxIdle<span class="token punctuation">)</span><span class="token punctuation">;</span>        genericObjectPoolConfig<span class="token punctuation">.</span><span class="token function">setMinIdle</span><span class="token punctuation">(</span>minIdle<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">/* ========= jedis pool ========= */</span>        <span class="token comment" spellcheck="true">// jedisConnectionFactory(standaloneConfiguration, genericObjectPoolConfig, timeout);</span>        <span class="token comment" spellcheck="true">/* ========= lettuce pool ========= */</span>        LettuceConnectionFactory connectionFactory <span class="token operator">=</span> <span class="token function">lettuceConnectionFactory</span><span class="token punctuation">(</span>standaloneConfiguration<span class="token punctuation">,</span> genericObjectPoolConfig<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// è¿æ¥æ± åˆå§‹åŒ–</span>        connectionFactory<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// åˆ›å»º RedisTemplate</span>        <span class="token keyword">return</span> <span class="token function">createRedisTemplate</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * lettuceConnectionFactory     *     * @param standaloneConfiguration Redisæ ‡å‡†é…ç½®     * @param genericObjectPoolConfig Redisé€šç”¨é…ç½®     * @param timeout                 è¶…æ—¶æ—¶é—´     * @return     */</span>    <span class="token keyword">private</span> LettuceConnectionFactory <span class="token function">lettuceConnectionFactory</span><span class="token punctuation">(</span>RedisStandaloneConfiguration standaloneConfiguration<span class="token punctuation">,</span> GenericObjectPoolConfig genericObjectPoolConfig<span class="token punctuation">,</span> <span class="token keyword">long</span> timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>        LettucePoolingClientConfiguration<span class="token punctuation">.</span>LettucePoolingClientConfigurationBuilder builder <span class="token operator">=</span> LettucePoolingClientConfiguration<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        builder<span class="token punctuation">.</span><span class="token function">poolConfig</span><span class="token punctuation">(</span>genericObjectPoolConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>        builder<span class="token punctuation">.</span><span class="token function">commandTimeout</span><span class="token punctuation">(</span>Duration<span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LettuceConnectionFactory</span><span class="token punctuation">(</span>standaloneConfiguration<span class="token punctuation">,</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * jedisConnectionFactory     *     * @param standaloneConfiguration Redisæ ‡å‡†é…ç½®     * @param genericObjectPoolConfig Redisé€šç”¨é…ç½®     * @param timeout                 è¶…æ—¶æ—¶é—´     * @return     */</span>    <span class="token keyword">private</span> JedisConnectionFactory <span class="token function">jedisConnectionFactory</span><span class="token punctuation">(</span>RedisStandaloneConfiguration standaloneConfiguration<span class="token punctuation">,</span> GenericObjectPoolConfig genericObjectPoolConfig<span class="token punctuation">,</span> <span class="token keyword">long</span> timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>        JedisClientConfiguration<span class="token punctuation">.</span>DefaultJedisClientConfigurationBuilder builder <span class="token operator">=</span> <span class="token punctuation">(</span>JedisClientConfiguration<span class="token punctuation">.</span>DefaultJedisClientConfigurationBuilder<span class="token punctuation">)</span> JedisClientConfiguration                <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        builder<span class="token punctuation">.</span><span class="token function">connectTimeout</span><span class="token punctuation">(</span>Duration<span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        builder<span class="token punctuation">.</span><span class="token function">usePooling</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        builder<span class="token punctuation">.</span><span class="token function">poolConfig</span><span class="token punctuation">(</span>genericObjectPoolConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JedisConnectionFactory</span><span class="token punctuation">(</span>standaloneConfiguration<span class="token punctuation">,</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * @param redisConnectionFactory     * @return     */</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> RedisTemplate <span class="token function">redisTemplate</span><span class="token punctuation">(</span>RedisConnectionFactory redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">createRedisTemplate</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * json å®ç° redisTemplate     * &lt;p>     * è¯¥æ–¹æ³•ä¸èƒ½åŠ  @Bean å¦åˆ™ä¸ç®¡å¦‚ä½•è°ƒç”¨ï¼ŒRedisConnectionFactory éƒ½ä¼šæ˜¯é»˜è®¤é…ç½®     *     * @param redisConnectionFactory     * @return     */</span>    <span class="token keyword">private</span> RedisTemplate <span class="token function">createRedisTemplate</span><span class="token punctuation">(</span>RedisConnectionFactory redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>        RedisTemplate<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>        Jackson2JsonRedisSerializer<span class="token operator">&lt;</span>Object<span class="token operator">></span> jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ObjectMapper objectMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        objectMapper<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span>PropertyAccessor<span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> JsonAutoDetect<span class="token punctuation">.</span>Visibility<span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>        objectMapper<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span>ObjectMapper<span class="token punctuation">.</span>DefaultTyping<span class="token punctuation">.</span>NON_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span>        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>objectMapper<span class="token punctuation">)</span><span class="token punctuation">;</span>        StringRedisSerializer stringRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * è‡ªå®šä¹‰Redisçš„é…ç½®åŠ è½½     *     * @param database     * @param password     * @param host     * @param port     * @param timeout     * @param maxActive     * @param maxWait     * @param maxIdle     * @param minIdle     * @return     */</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> Tuple6<span class="token operator">&lt;</span>RedisStandaloneConfiguration<span class="token punctuation">,</span> Long<span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> Integer<span class="token operator">></span>    <span class="token function">redisConfigurationDB_2</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-db-2.database}"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> database<span class="token punctuation">,</span>                           <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-db-2.password}"</span><span class="token punctuation">)</span> String password<span class="token punctuation">,</span>                           <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-db-2.host}"</span><span class="token punctuation">)</span> String host<span class="token punctuation">,</span>                           <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-db-2.port}"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> port<span class="token punctuation">,</span>                           <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-db-2.timeout}"</span><span class="token punctuation">)</span> <span class="token keyword">long</span> timeout<span class="token punctuation">,</span>                           <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-db-2.lettuce.pool.max-active}"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> maxActive<span class="token punctuation">,</span>                           <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-db-2.lettuce.pool.max-wait}"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> maxWait<span class="token punctuation">,</span>                           <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-db-2.lettuce.pool.max-idle}"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> maxIdle<span class="token punctuation">,</span>                           <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-db-2.lettuce.pool.min-idle}"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> minIdle<span class="token punctuation">)</span> <span class="token punctuation">{</span>        RedisStandaloneConfiguration standaloneConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisStandaloneConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        standaloneConfiguration<span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span>database<span class="token punctuation">)</span><span class="token punctuation">;</span>        standaloneConfiguration<span class="token punctuation">.</span><span class="token function">setHostName</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>        standaloneConfiguration<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            RedisPassword redisPassword <span class="token operator">=</span> RedisPassword<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>            standaloneConfiguration<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>redisPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> Tuple<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>standaloneConfiguration<span class="token punctuation">,</span> timeout<span class="token punctuation">,</span> maxActive<span class="token punctuation">,</span> maxWait<span class="token punctuation">,</span> maxIdle<span class="token punctuation">,</span> minIdle<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¿™ä¸ªé…ç½®æœ‰ç‚¹é•¿ï¼Œä½†æ˜¯éƒ½æœ‰æ³¨é‡Šï¼Œè€Œä¸”è¿™é‡Œä¹Ÿç”¨åˆ°äº†ä¸Šç¯‡æ–‡ç« ä¸­è®²åˆ°çš„<code>tuple</code>ï¼ˆåœ¨æ–¹æ³•æœ‰å¤šä¸ªè¿”å›å€¼æ—¶ï¼Œå…ƒç»„çœŸé¦™ï¼‰,å…¶å®å°±å·²ç»å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„<code>RedisTemplate</code>äº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬åœ¨å¯åŠ¨é¡¹ç›®æ—¶åˆ†åˆ«æ³¨å…¥<code>redisTemplate</code>å’Œ<code>redisTemplateDB_2</code>ï¼Œåˆ«é—®æˆ‘ä¸ºå•¥åå­—æ˜¯è¿™ä¸¤è´§ã€‚</p><h2 id="é€šè¿‡debugæŸ¥çœ‹é…ç½®æ˜¯å¦æˆåŠŸ"><a href="#é€šè¿‡debugæŸ¥çœ‹é…ç½®æ˜¯å¦æˆåŠŸ" class="headerlink" title="é€šè¿‡debugæŸ¥çœ‹é…ç½®æ˜¯å¦æˆåŠŸ"></a>é€šè¿‡debugæŸ¥çœ‹é…ç½®æ˜¯å¦æˆåŠŸ</h2><p>å¯åŠ¨ç±»æˆ‘ä»¬å®ç°<code>CommandLineRunner</code>ï¼Œç„¶åé€šè¿‡debugæŸ¥çœ‹<code>redisTemplate</code>å’Œ<code>redisTemplateDB2</code>çš„<code>RedisConnectionFactory</code></p><p>å¹¶ä¸”æˆ‘ä»¬åœ¨database=0å­˜å‚¨äº†ä¸€ä¸ªstringæ•°æ®ï¼Œåœ¨database=2å­˜å‚¨äº†ä¸€ä¸ªhashæ•°æ®</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>redis<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>CommandLineRunner<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>SpringApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>SpringBootApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span>RedisTemplate<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020-01-10. */</span><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisApplication</span> <span class="token keyword">implements</span> <span class="token class-name">CommandLineRunner</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> RedisTemplate redisTemplate<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> RedisTemplate redisTemplateDB_2<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>RedisApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"redisTemplate:{}"</span><span class="token punctuation">,</span> redisTemplate<span class="token punctuation">)</span><span class="token punctuation">;</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"xiaozhangge"</span><span class="token punctuation">,</span> <span class="token string">"redisTemplate save value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"redisTemplateDB_2:{}"</span><span class="token punctuation">,</span> redisTemplateDB2<span class="token punctuation">)</span><span class="token punctuation">;</span>        redisTemplateDB2<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"xiaozhangge"</span><span class="token punctuation">,</span> <span class="token string">"xiaozhangge-hash"</span><span class="token punctuation">,</span> <span class="token string">"redisTemplateDB_2 save value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><ul><li>redisTemplate</li></ul><p><img src="/images/spring-boot/redis/redisTemplate.png" alt="redisTemplate"></p><ul><li>redisTemplateDB_2</li></ul><p><img src="/images/spring-boot/redis/redisTemplateDB2.png" alt="redisTemplateDB_2"></p><ul><li><p>ç™»å½•redisæŸ¥çœ‹ä¸¤ä¸ªTemplateå­˜å‚¨çš„stringå’Œhashæ•°æ®</p><ul><li>ä½¿ç”¨<code>RedisDesktopManager</code>è¿æ¥åˆ°æˆ‘ä»¬æ–°å»ºçš„redisæœåŠ¡ï¼Œå¹¶ä¸”æŸ¥çœ‹æ•°æ®</li></ul><p><img src="/images/spring-boot/redis/rdm.jpg" alt="rdm ä¸­çš„æ•°æ®"></p><ul><li>ä½¿ç”¨redis-cliæŸ¥çœ‹</li></ul><p>å› ä¸ºæˆ‘ä»¬çš„redisæœåŠ¡æ˜¯dockerå¯åŠ¨çš„ï¼Œæ‰€ä»¥è¦ä½¿ç”¨<code>redis-cli</code>æŸ¥çœ‹å°±éœ€è¦è¿›å…¥dockerå®¹å™¨å†…è¿›è¡ŒæŸ¥çœ‹ï¼Œè¿›å…¥å®¹å™¨ä¹Ÿå¾ˆç®€å•ï¼Œä½¿ç”¨<code>docker exec -it fd3da052e6f1 bash</code>ï¼Œè¿™é‡Œçš„<code>fd3da052e6f1</code>æ˜¯dockerå¯åŠ¨çš„containerIdï¼Œå¯ä»¥ä½¿ç”¨<code>docker ps</code>æŸ¥çœ‹</p><pre class=" language-verilog"><code class="language-verilog">root@fd3da052e6f1<span class="token punctuation">:</span><span class="token operator">/</span>data# redis<span class="token operator">-</span>cli<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">6379</span><span class="token operator">></span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">6379</span><span class="token operator">></span> keys <span class="token operator">*</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"xiaozhangge"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">6379</span><span class="token operator">></span> get xiaozhangge<span class="token string">"\"redisTemplate save value\""</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">6379</span><span class="token operator">></span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">6379</span><span class="token operator">></span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">6379</span><span class="token operator">></span> select <span class="token number">2</span> # é€‰æ‹©<span class="token number">2</span>è¿™ä¸ªæ•°æ®åº“OK<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">6379</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">6379</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">6379</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span> keys <span class="token operator">*</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"xiaozhangge"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">6379</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span> HVALS xiaozhangge<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"\xac\xed\x00\x05t\x00\x1bredisTemplateDB2 save value"</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">6379</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">6379</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span></code></pre></li></ul><p>  é€šè¿‡ä»¥ä¸Šæ—¥å¿—æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åˆ†åˆ«åœ¨ä¸åŒçš„æ•°æ®åº“å·²ç»å­˜å‚¨äº†ä¸åŒçš„æ•°æ®ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬redisé…ç½®å¤šå®ä¾‹å°±å·²ç»å®Œæˆã€‚ä½†æ˜¯æˆ‘ä»¬æ¯æ¬¡æ³¨å…¥çš„æ—¶å€™éƒ½è¦è®°å¾—è‡ªå·±åˆ›å»ºçš„Beançš„åå­—ï¼Œè¿™æ ·å¯¹å…¶ä»–äººä¸å¤ªå‹å¥½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥å°è£…ä¸€ä¸‹ï¼Œè‡ªå®šä¹‰ä¸€ä¸ªhandlerè¿›è¡Œè·å–RedisTemplateï¼Œè¿™æ ·ä¼šä¸ä¼šæ›´ä¾¿æ·å‘¢ï¼Ÿ</p><h2 id="è‡ªå®šä¹‰RedisHandlerå’ŒRedisOperations"><a href="#è‡ªå®šä¹‰RedisHandlerå’ŒRedisOperations" class="headerlink" title="è‡ªå®šä¹‰RedisHandlerå’ŒRedisOperations"></a>è‡ªå®šä¹‰RedisHandlerå’ŒRedisOperations</h2><p>  åšè¿™ä¸€æ­¥ä¸»è¦æ˜¯ä¸ºäº†å°†ä¸‹å±‚çš„RedisTemplateè¿›è¡Œç»Ÿä¸€çš„å°è£…ï¼Œå¯¹å¤–åªæ˜¯ä¸€ä¸ª<code>RedisHandler</code>å’Œ<code>RedisOperations</code>ï¼Œ<code>RedisHandler</code>æä¾›è·å–<code>RedisOperations</code>çš„æ–¹æ³•ï¼Œ<code>RedisOperations</code>é‡Œé¢å¯ä»¥å°è£…ä¸€äº›å¸¸ç”¨çš„redisæ“ä½œï¼Œè¿™æ ·å°±åªéœ€è¦å’Œ<code>RedisOperations</code>è¿›è¡Œæ“ä½œï¼Œä»è€Œé¿å…åŒæ—¶æ“ä½œå¤šä¸ª<code>RedisTemplate</code></p><h3 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h3><pre class=" language-verilog"><code class="language-verilog"> âœ  example<span class="token operator">-</span>redis git<span class="token punctuation">:</span><span class="token punctuation">(</span>master<span class="token punctuation">)</span> âœ— tree <span class="token punctuation">.</span><span class="token operator">/</span> <span class="token punctuation">.</span><span class="token operator">/</span> â”œâ”€â”€ example<span class="token operator">-</span>redis<span class="token punctuation">.</span>iml â”œâ”€â”€ pom<span class="token punctuation">.</span>xml â””â”€â”€ src     â”œâ”€â”€ main     â”‚   â”œâ”€â”€ java     â”‚   â”‚   â””â”€â”€ com     â”‚   â”‚       â””â”€â”€ xiaozhangge     â”‚   â”‚           â””â”€â”€ redis     â”‚   â”‚               â”œâ”€â”€ RedisApplication<span class="token punctuation">.</span>java     â”‚   â”‚               â””â”€â”€ configure     â”‚   â”‚                   â”œâ”€â”€ RedisConfigure<span class="token punctuation">.</span>java     â”‚   â”‚                   â”œâ”€â”€ handler     â”‚   â”‚                   â”‚   â””â”€â”€ RedisHandler<span class="token punctuation">.</span>java     â”‚   â”‚                   â””â”€â”€ util     â”‚   â”‚                       â””â”€â”€ RedisOperations<span class="token punctuation">.</span>java     â”‚   â””â”€â”€ resources     â”‚       â””â”€â”€ application<span class="token punctuation">.</span>yml     â””â”€â”€ test         â””â”€â”€ java</code></pre><h3 id="RedisOperations"><a href="#RedisOperations" class="headerlink" title="RedisOperations"></a>RedisOperations</h3><p>  è¯¥ç±»å¯ä»¥ä½œä¸ºredisçš„å·¥å…·ç±»ä½¿ç”¨ï¼Œè‡ªå·±æ·»åŠ ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>configure<span class="token punctuation">.</span>util<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span>RedisTemplate<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020-01-10. */</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisOperations</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> RedisTemplate redisTemplate<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token function">RedisOperations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token function">RedisOperations</span><span class="token punctuation">(</span>RedisTemplate redisTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>redisTemplate <span class="token operator">=</span> redisTemplate<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> RedisTemplate <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="RedisHandler"><a href="#RedisHandler" class="headerlink" title="RedisHandler"></a>RedisHandler</h3><p>  <code>RedisHandler</code>æä¾›äº†ç»Ÿä¸€æ“ä½œ<code>RedisTemplate</code>çš„å…¥å£ï¼Œå¯¹ç”¨æˆ·æ¥è¯´ä¸‹å±‚çš„<code>RedisTemplate</code>æ˜¯è°å°±ä¸éœ€è¦å…³å¿ƒäº†</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>configure<span class="token punctuation">.</span>handler<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>configure<span class="token punctuation">.</span>util<span class="token punctuation">.</span>RedisOperations<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span>RedisTemplate<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Component<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020-01-10. */</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisHandler</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> RedisTemplate redisTemplate<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> RedisTemplate redisTemplateDB_2<span class="token punctuation">;</span>    <span class="token keyword">private</span> RedisOperations redisOperations<span class="token punctuation">,</span> redisDB2Operations<span class="token punctuation">;</span>    <span class="token keyword">public</span> RedisOperations <span class="token function">redisOperations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>redisOperations <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            redisOperations <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisOperations</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> redisOperations<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> RedisOperations <span class="token function">redisDB2Operations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>redisDB2Operations <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            redisDB2Operations <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisOperations</span><span class="token punctuation">(</span>redisTemplateDB_2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> redisDB2Operations<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="æœ€ç»ˆç»“æœ"><a href="#æœ€ç»ˆç»“æœ" class="headerlink" title="æœ€ç»ˆç»“æœ"></a>æœ€ç»ˆç»“æœ</h2><p>æˆ‘ä»¬åœ¨å¯åŠ¨æ—¶çœ‹ä¸€ä¸‹ç»è¿‡<code>RedisHandler</code>ä¿è¯çš„<code>RedisTemplate</code>æ˜¯å¦å’Œæˆ‘ä»¬æƒ³çš„ä¸€è‡´ï¼Œä¿®æ”¹ä»¥åçš„å¯åŠ¨ç±»</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>redis<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>configure<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>RedisHandler<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>configure<span class="token punctuation">.</span>util<span class="token punctuation">.</span>RedisOperations<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>CommandLineRunner<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>SpringApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>SpringBootApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span>RedisTemplate<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020-01-10. */</span><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisApplication</span> <span class="token keyword">implements</span> <span class="token class-name">CommandLineRunner</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> RedisTemplate redisTemplate<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> RedisTemplate redisTemplateDB_2<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> RedisHandler redisHandler<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>RedisApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"redisTemplate:{}"</span><span class="token punctuation">,</span> redisTemplate<span class="token punctuation">)</span><span class="token punctuation">;</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"xiaozhangge"</span><span class="token punctuation">,</span> <span class="token string">"redisTemplate save value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"redisTemplateDB_2:{}"</span><span class="token punctuation">,</span> redisTemplateDB_2<span class="token punctuation">)</span><span class="token punctuation">;</span>        redisTemplateDB_2<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"xiaozhangge"</span><span class="token punctuation">,</span> <span class="token string">"xiaozhangge-hash"</span><span class="token punctuation">,</span> <span class="token string">"redisTemplateDB_2 save value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// é€šè¿‡ç»Ÿä¸€çš„RedisOperationså¯¹Redisè¿›è¡Œæ“ä½œ</span>        <span class="token comment" spellcheck="true">// è¿™é‡Œå¯ä»¥è‡ªå·±å°è£…ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ï¼Œè¿™æ ·å°±èƒ½æŠŠä¸‹å±‚çš„RedisTemplateè¿›è¡Œå°è£…ï¼Œå¯¹å¤–ä»…ä»…åªæ˜¯ä¸€ä¸ªRedisOperationsè€Œå·²</span>        <span class="token comment" spellcheck="true">// å½“ç„¶è¿™é‡Œä¹Ÿæä¾›å¯¹åº”çš„æ–¹æ³•è·å–ä¸åŒRedisTemplateå¯¹è±¡æœ€åçš„å°è£…å®ä¾‹</span>        RedisOperations redisOperations <span class="token operator">=</span> redisHandler<span class="token punctuation">.</span><span class="token function">redisOperations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        RedisOperations redisDB2Operations <span class="token operator">=</span> redisHandler<span class="token punctuation">.</span><span class="token function">redisDB2Operations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"redisOperations redisTemplate:{}"</span><span class="token punctuation">,</span> redisOperations<span class="token punctuation">.</span><span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"redisDB2Operations redisTemplate:{}"</span><span class="token punctuation">,</span> redisDB2Operations<span class="token punctuation">.</span><span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å¯åŠ¨æ—¥å¿—</p><pre class=" language-velocity"><code class="language-velocity">2020-01-10 23:54:39.579  INFO 66673 --- [           main] com.xiaozhangge.redis.RedisApplication      : Started RedisApplication in 8.672 seconds (JVM running for 10.951)2020-01-10 23:54:39.580  INFO 66673 --- [           main] com.xiaozhangge.redis.RedisApplication      : redisTemplate:org.springframework.data.redis.core.RedisTemplate@449245872020-01-10 23:54:39.679  INFO 66673 --- [           main] io.lettuce.core.EpollProvider            : Starting without optional epoll library2020-01-10 23:54:39.682  INFO 66673 --- [           main] io.lettuce.core.KqueueProvider           : Starting without optional kqueue library2020-01-10 23:54:39.910  INFO 66673 --- [           main] com.xiaozhangge.redis.RedisApplication      : redisTemplateDB2:org.springframework.data.redis.core.RedisTemplate@7fb666502020-01-10 23:54:39.927  INFO 66673 --- [           main] com.xiaozhangge.redis.RedisApplication      : redisOperations redisTemplate:org.springframework.data.redis.core.RedisTemplate@449245872020-01-10 23:54:39.929  INFO 66673 --- [           main] com.xiaozhangge.redis.RedisApplication      : redisDB2Operations redisTemplate:org.springframework.data.redis.core.RedisTemplate@7fb66650</code></pre><p>é€šè¿‡æ—¥å¿—æˆ‘ä»¬å¯ä»¥çœ‹åˆ°</p><ol><li><code>redisTemplate</code>å’Œ<code>redisOperations redisTemplate</code>æ˜¯åŒä¸€ä¸ªå¯¹è±¡</li><li><code>redisTemplateDB2</code> å’Œ<code>redisDB2Operations redisTemplate</code>ä¹Ÿæ˜¯åŒä¸€ä¸ªå¯¹è±¡</li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡æœ¬æ–‡ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªé¡¹ç›®å¦‚æœéœ€è¦ä½¿ç”¨ä½¿ç”¨å¤šä¸ªredisè¿æ¥è·å–ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰<code>RedisConnectionFactory</code>æ¥å®Œæˆï¼Œç¬¬äºŒç‚¹å°±æ˜¯å¦‚æœå®šä¹‰çš„<code>RedisTemplate</code>è¿‡å¤šï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸Šé¢å®šä¹‰ä¸€ä¸ª<code>RedisHandler</code>æ¥è¿›è¡Œå°è£…ä¸‹å±‚çš„APIæ“ä½œï¼Œæš´éœ²ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£è¿›è¡Œç®€åŒ–å¤„ç†ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.bbsmax.com/A/lk5aAmO251/">https://www.bbsmax.com/A/lk5aAmO251/</a></p><p>ç¤ºä¾‹ä»£ç ï¼š<a href="https://github.com/xiaomozhang/personal-life-example/tree/master/example-redis">https://github.com/xiaomozhang/personal-life-example/tree/master/example-redis</a></p>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaä¸­ä½¿ç”¨å…ƒç»„</title>
      <link href="2020/01/09/java-tuple/"/>
      <url>2020/01/09/java-tuple/</url>
      
        <content type="html"><![CDATA[<p>å…ƒç»„ï¼ˆTupleï¼‰æ˜¯å›ºå®šæ•°é‡çš„ä¸åŒç±»å‹çš„å…ƒç´ çš„ç»„åˆã€‚å…ƒç»„ä¸é›†åˆçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå…ƒç»„ä¸­çš„å…ƒç´ ç±»å‹å¯ä»¥æ˜¯ä¸åŒçš„ï¼Œè€Œä¸”æ•°é‡å›ºå®šã€‚å…ƒç»„çš„å¥½å¤„åœ¨äºå¯ä»¥æŠŠå¤šä¸ªå…ƒç´ ä½œä¸ºä¸€ä¸ªå•å…ƒä¼ é€’ã€‚å¦‚æœä¸€ä¸ªæ–¹æ³•éœ€è¦è¿”å›å¤šä¸ªå€¼ï¼Œå¯ä»¥æŠŠè¿™å¤šä¸ªå€¼ä½œä¸ºå…ƒç»„è¿”å›ï¼Œè€Œä¸éœ€è¦åˆ›å»ºé¢å¤–çš„ç±»æ¥è¡¨ç¤ºã€‚æ ¹æ®å…ƒç´ æ•°é‡çš„ä¸åŒï¼ŒVavr æ€»å…±æä¾›äº† Tuple0ã€Tuple1 åˆ° Tuple8 ç­‰ 9 ä¸ªç±»ã€‚æ¯ä¸ªå…ƒç»„ç±»éƒ½éœ€è¦å£°æ˜å…¶å…ƒç´ ç±»å‹ã€‚å¦‚ Tuple2&lt;String, Integer&gt;è¡¨ç¤ºçš„æ˜¯ä¸¤ä¸ªå…ƒç´ çš„å…ƒç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ çš„ç±»å‹ä¸º Stringï¼Œç¬¬äºŒä¸ªå…ƒç´ çš„ç±»å‹ä¸º Integerã€‚å¯¹äºå…ƒç»„å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ _1ã€_2 åˆ° _8 æ¥è®¿é—®å…¶ä¸­çš„å…ƒç´ ã€‚æ‰€æœ‰å…ƒç»„å¯¹è±¡éƒ½æ˜¯ä¸å¯å˜çš„ï¼Œåœ¨åˆ›å»ºä¹‹åä¸èƒ½æ›´æ”¹ã€‚</p><p>å…ƒç»„é€šè¿‡æ¥å£ Tuple çš„é™æ€æ–¹æ³• of æ¥åˆ›å»ºã€‚å…ƒç»„ç±»ä¹Ÿæä¾›äº†ä¸€äº›æ–¹æ³•å¯¹å®ƒä»¬è¿›è¡Œæ“ä½œã€‚ç”±äºå…ƒç»„æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€æœ‰ç›¸å…³çš„æ“ä½œéƒ½è¿”å›ä¸€ä¸ªæ–°çš„å…ƒç»„å¯¹è±¡ã€‚åœ¨ æ¸…å• 1 ä¸­ï¼Œä½¿ç”¨ Tuple.of åˆ›å»ºäº†ä¸€ä¸ª Tuple2 å¯¹è±¡ã€‚Tuple2 çš„ map æ–¹æ³•ç”¨æ¥è½¬æ¢å…ƒç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œè¿”å›æ–°çš„å…ƒç»„å¯¹è±¡ã€‚è€Œ apply æ–¹æ³•åˆ™æŠŠå…ƒç»„è½¬æ¢æˆå•ä¸ªå€¼ã€‚å…¶ä»–å…ƒç»„ç±»ä¹Ÿæœ‰ç±»ä¼¼çš„æ–¹æ³•ã€‚é™¤äº† map æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜æœ‰ map1ã€map2ã€map3 ç­‰æ–¹æ³•æ¥è½¬æ¢ç¬¬ N ä¸ªå…ƒç´ ï¼›update1ã€update2 å’Œ update3 ç­‰æ–¹æ³•ç”¨æ¥æ›´æ–°å•ä¸ªå…ƒç´ ã€‚</p><br><p>Pythonå’ŒScalaè¯­è¨€ä¸­æœ‰è‡ªå¸¦å…ƒç»„ï¼ŒJdkä¸­æ˜¯æ²¡æœ‰è¿™ä¸ªæ•°æ®ç±»å‹çš„ï¼Œè™½ç„¶ä½¿ç”¨æ•°ç»„æˆ–è€…mapä¹Ÿèƒ½è¾¾åˆ°æƒ³è¦çš„æ•ˆæœï¼Œä½†æ€»å½’æ˜¯æ²¡æœ‰å…ƒç»„æ–¹ä¾¿ã€‚</p><p>æ¯”å¦‚è¯´ä¸€ä¸ªæ–¹æ³•æœ‰å¤šä¸ªè¿”å›å€¼æ—¶ï¼Œè™½ç„¶å¯ä»¥ç”¨<code>Object[]</code>æˆ–è€…<code>Map</code>è¿›è¡Œå°è£…ï¼Œä½†æ˜¯åœ¨æ‹†ç®±çš„æ—¶å€™ç±»å‹ä¼šç¼ºå¤±ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¸å¤ªæ–¹ä¾¿ã€‚Javaä¸­æœ‰å¾ˆå¤šå…ƒç»„åº“ï¼Œè¿™é‡Œæ¨èä¸€ä¸ªæˆ‘ç»å¸¸ä½¿ç”¨çš„<a href="https://www.vavr.io/">vavr</a>ï¼Œå½“ç„¶<code>Tuple</code>åªæ˜¯è¿™ä¸ªåº“ä¸­çš„ä¸€å°éƒ¨åˆ†ï¼Œè¯¥åº“æä¾›äº†å¼ºå¤§çš„å‡½æ•°å¼ç¼–ç¨‹çš„èƒ½åŠ›ï¼Œå¯ä»¥åƒå†™Scalaä¸€æ ·å†™Java</p><h2 id="å¼•å…¥pomä¾èµ–"><a href="#å¼•å…¥pomä¾èµ–" class="headerlink" title="å¼•å…¥pomä¾èµ–"></a>å¼•å…¥pomä¾èµ–</h2><p>ç›®å‰æœ€æ–°çš„ç¨³å®šç‰ˆæ˜¯<code>0.10.2</code></p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- https://mvnrepository.com/artifact/io.vavr/vavr --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>io.vavr<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>vavr<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.10.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><h2 id="å¸¸ç”¨æ–¹æ³•ä½¿ç”¨"><a href="#å¸¸ç”¨æ–¹æ³•ä½¿ç”¨" class="headerlink" title="å¸¸ç”¨æ–¹æ³•ä½¿ç”¨"></a>å¸¸ç”¨æ–¹æ³•ä½¿ç”¨</h2><h3 id="åˆ›å»ºå…ƒç»„å¯¹è±¡"><a href="#åˆ›å»ºå…ƒç»„å¯¹è±¡" class="headerlink" title="åˆ›å»ºå…ƒç»„å¯¹è±¡"></a>åˆ›å»ºå…ƒç»„å¯¹è±¡</h3><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  Tuple3<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> LocalDateTime<span class="token punctuation">,</span> Long<span class="token operator">></span> tuple3 <span class="token operator">=</span> Tuple<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"TupleTests"</span><span class="token punctuation">,</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Long<span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>tuple3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬é€šè¿‡<code>Tuple.of</code>åˆ›å»ºäº†ä¸€ä¸ªæœ‰ä¸‰ä¸ªå…ƒç´ çš„å…ƒç»„å¯¹è±¡ï¼Œè¾“å‡ºç»“æœ</p><pre class=" language-verilog"><code class="language-verilog"><span class="token punctuation">(</span>TupleTests<span class="token punctuation">,</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">09</span>T20<span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">26.137</span><span class="token punctuation">,</span> <span class="token number">9223372036854775807</span><span class="token punctuation">)</span></code></pre><h3 id="æ›´æ–°å…ƒç»„å†…å®¹"><a href="#æ›´æ–°å…ƒç»„å†…å®¹" class="headerlink" title="æ›´æ–°å…ƒç»„å†…å®¹"></a>æ›´æ–°å…ƒç»„å†…å®¹</h3><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  Tuple3<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> LocalDateTime<span class="token punctuation">,</span> Long<span class="token operator">></span> tuple3 <span class="token operator">=</span> Tuple<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"TupleTests"</span><span class="token punctuation">,</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Long<span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>tuple3<span class="token punctuation">)</span><span class="token punctuation">;</span>  tuple3 <span class="token operator">=</span> tuple3<span class="token punctuation">.</span><span class="token function">update1</span><span class="token punctuation">(</span><span class="token string">"å“ˆå“ˆå“ˆå“ˆ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>tuple3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>é€šè¿‡<code>update1-n</code>æ–¹æ³•ï¼Œå¯ä»¥å®ç°å…ƒç»„å†…å®¹çš„æ›´æ–°ï¼Œæ›´æ–°ç»“æœ</p><pre class=" language-verilog"><code class="language-verilog"><span class="token punctuation">(</span>TupleTests<span class="token punctuation">,</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">09</span>T20<span class="token punctuation">:</span><span class="token number">42</span><span class="token punctuation">:</span><span class="token number">27.623</span><span class="token punctuation">,</span> <span class="token number">9223372036854775807</span><span class="token punctuation">)</span><span class="token punctuation">(</span>å“ˆå“ˆå“ˆå“ˆ<span class="token punctuation">,</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">09</span>T20<span class="token punctuation">:</span><span class="token number">42</span><span class="token punctuation">:</span><span class="token number">27.623</span><span class="token punctuation">,</span> <span class="token number">9223372036854775807</span><span class="token punctuation">)</span></code></pre><h3 id="æ–¹æ³•å¤šä¸ªè¿”å›å€¼ä½¿ç”¨å…ƒç»„æ¥æ”¶"><a href="#æ–¹æ³•å¤šä¸ªè¿”å›å€¼ä½¿ç”¨å…ƒç»„æ¥æ”¶" class="headerlink" title="æ–¹æ³•å¤šä¸ªè¿”å›å€¼ä½¿ç”¨å…ƒç»„æ¥æ”¶"></a>æ–¹æ³•å¤šä¸ªè¿”å›å€¼ä½¿ç”¨å…ƒç»„æ¥æ”¶</h3><p>è¿™ä¸ªéœ€æ±‚å…¶å®ä¹‹å‰åœ¨<a href="https://xiaomozhang.github.io/2020/01/04/java8-date-cycle/">Java8 å¤„ç†å¸¸è§çš„æ—¥æœŸå‘¨æœŸ</a>è¿™ç¯‡æ–‡ç« å·²ç»ç”¨è¿‡äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬éœ€è¦è·å–ä¸€ä¸ªå‘¨æœŸæ•°æ®ï¼Œæœ‰å¼€å§‹å’Œç»“æŸï¼Œé‚£ä¹ˆå…ƒç»„æ— ç–‘æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚æ¯”å¦‚æˆ‘ä»¬éœ€è¦å°è£…ä¸€ä¸ªæ–¹æ³•è·å–ä»Šå¤©çš„æœ€å°æ—¶é—´å’Œæœ€å¤§æ—¶é—´ï¼Œé‚£ä¹ˆè¿™é‡Œå°±éœ€è¦ä¸¤ä¸ªè¿”å›å€¼ï¼Œè™½ç„¶æˆ‘ä»¬å¯ä»¥ç”¨<code>Object[]</code>æˆ–è€…<code>Map</code>ä¹‹ç±»çš„å®¹å™¨è¾¾åˆ°æˆ‘ä»¬çš„æ•ˆæœï¼Œä½†æ˜¯å¦‚æœæˆ‘è¿”å›å€¼å¾—ç±»å‹éƒ½ä¸å°½æƒ³åŒï¼Œé‚£ä¹ˆåœ¨è·å–çš„æ—¶å€™å°±è¦è¿›è¡Œç±»å‹è½¬æ¢ï¼ŒåŠ åˆ°äº†è½¬æ¢å‡ºé”™çš„æ¦‚ç‡ï¼Œä½†æ˜¯ä½¿ç”¨å…ƒç»„å°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ã€‚</p><ul><li><p>è·å–ä¸€å¤©çš„å¼€å§‹å’Œç»“æŸæ—¶é—´</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> Tuple2<span class="token operator">&lt;</span>LocalDateTime<span class="token punctuation">,</span> LocalDateTime<span class="token operator">></span> <span class="token function">getNowRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  LocalDate now <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// ä¸€å¤©ä¸­ä»é›¶æ—¶å¼€å§‹</span>  LocalDateTime startTime <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">atTime</span><span class="token punctuation">(</span>LocalTime<span class="token punctuation">.</span>MIN<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// ä¸€å¤©åˆ°23:59:59ç§’ç»“æŸ</span>  LocalDateTime endTime <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">atTime</span><span class="token punctuation">(</span>LocalTime<span class="token punctuation">.</span>MAX<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> Tuple<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>startTime<span class="token punctuation">,</span> endTime<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre></li><li><p>è·å–è¿”å›å€¼</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  Tuple2<span class="token operator">&lt;</span>LocalDateTime<span class="token punctuation">,</span> LocalDateTime<span class="token operator">></span> tuple2 <span class="token operator">=</span> <span class="token function">getNowRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// è¿™é‡Œé€šè¿‡ _n æˆ–è€… _n() è·å–æ¯ä¸€ä¸ªå…ƒç»„ä¸­çš„ä¸€åˆ—æ•°æ®</span>  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¼€å§‹æ—¶é—´:"</span> <span class="token operator">+</span> tuple2<span class="token punctuation">.</span><span class="token function">_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç»“æŸæ—¶é—´:"</span> <span class="token operator">+</span> tuple2<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>getNowRange</code>åŒæ—¶æœ‰ä¸¤ä¸ªæ”¾å›å€¼ï¼Œé€šè¿‡<code>Tuple2</code>è¿›è¡Œä¿å­˜ï¼Œè¿‡ _n æˆ–è€… _n() è·å–æ¯ä¸€ä¸ªå…ƒç»„ä¸­çš„ä¸€åˆ—æ•°æ®ã€‚æœ€åè·å–çš„ç»“æœä¸º</p><pre><code>å¼€å§‹æ—¶é—´:2020-01-09T00:00ç»“æŸæ—¶é—´:2020-01-09T23:59:59.999999999</code></pre></li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»¥ä¸Šå°±æ˜¯å…ƒç»„æœ€å¸¸ç”¨çš„ä¸€äº›æ–¹æ³•ï¼Œå…¶å®æˆ‘ç†è§£çš„å…ƒç»„å°±æ˜¯ä¸€ç§åˆ—å¼å­˜å‚¨çš„æ•°æ®å®¹å™¨ï¼Œå’Œæˆ‘ä»¬å¹³æ—¶ç”¨çš„<code>Collection</code>æ¥å£ä¸‹çš„ä¸€äº›<code>List</code>ï¼Œ<code>Set</code>ä¸åŒï¼Œä»–ä»¬éƒ½æ˜¯ä»¥è¡Œçš„å½¢å¼å­˜å‚¨ï¼Œæœ‰äº†<code>Tuple</code>ä»¥åï¼Œåœ¨æ—¥å¸¸å¼€å‘ä¸­ä¹Ÿå¤šäº†ä¸€ç§æ•°æ®åœ¨å†…å­˜ä¸­å­˜å‚¨çš„é€‰æ‹©ã€‚</p><p>å½“ç„¶å…ƒç»„åªæ˜¯<code>vavr</code>åº“ä¸­çš„ä¸€å°éƒ¨åˆ†ï¼Œæ›´å¤šä½¿ç”¨æ–¹æ³•è¿˜æ˜¯è¦çœ‹å®˜æ–¹æ–‡æ¡£</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.ibm.com/developerworks/cn/java/j-understanding-functional-programming-4/index.html">ä½¿ç”¨ Vavr è¿›è¡Œå‡½æ•°å¼ç¼–ç¨‹</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS7 å®‰è£… MySQL5.7.X</title>
      <link href="2020/01/08/software-install-mysql5-7-x-centos7/"/>
      <url>2020/01/08/software-install-mysql5-7-x-centos7/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…å‰å‡†å¤‡"><a href="#å®‰è£…å‰å‡†å¤‡" class="headerlink" title="å®‰è£…å‰å‡†å¤‡"></a><strong>å®‰è£…å‰å‡†å¤‡</strong></h2><p>MySQLå®‰è£…éœ€è¦å‡†å¤‡rootè´¦æˆ·</p><h3 id="å¸è½½MariaDBç›¸å…³ç»„ä»¶"><a href="#å¸è½½MariaDBç›¸å…³ç»„ä»¶" class="headerlink" title="å¸è½½MariaDBç›¸å…³ç»„ä»¶"></a>å¸è½½MariaDBç›¸å…³ç»„ä»¶</h3><blockquote><p>ç”±äºMariaDBä¸MySQLç±»ä¼¼ï¼Œåœ¨å®‰è£…æ—¶å€™ä¼šæç¤ºä¸å·²ç»å®‰è£…çš„RPMåŒ…æœ‰å†²çªï¼Œå› æ­¤éœ€è¦å¸è½½ä¸€äº›åŒ…å«æœ‰MariaDBå…³é”®å­—çš„RPMåŒ…ã€‚ </p><p>æ‰§è¡Œ<code>rpm -qa | grep mysql</code>æ£€æŸ¥éœ€è¦å¸è½½çš„åŒ…</p><p> æ‰§è¡Œ<code>rpm -qa | grep mariadb</code>æ£€æŸ¥éœ€è¦å¸è½½çš„åŒ…</p><p>å¦‚å‘ç°å­˜åœ¨<code>mariadb</code>ä¸<code>mysql</code>åˆ™ä½¿ç”¨<code>rpm -e --nodeps xxx</code>è¿›è¡Œå¸è½½</p></blockquote><pre class=" language-SHELL"><code class="language-SHELL">[root@vm31_123 mysql-5.7.28-1.el7.x86_64]# rpm -qa | grep mariadb # æ£€æŸ¥mariadbmariadb-libs-5.5.64-1.el7.x86_64# å¦‚æœ‰å°±è¿›è¡Œå¸è½½[root@vm31_123 mysql-5.7.28-1.el7.x86_64]# rpm -e --nodeps mariadb-libs-5.5.64-1.el7.x86_64</code></pre><h3 id="ä¸‹è½½å®‰è£…æ–‡ä»¶"><a href="#ä¸‹è½½å®‰è£…æ–‡ä»¶" class="headerlink" title="ä¸‹è½½å®‰è£…æ–‡ä»¶"></a>ä¸‹è½½å®‰è£…æ–‡ä»¶</h3><p>è¿™é‡Œæˆ‘ç›´æ¥åœ¨å®˜ç½‘æ‹¿åˆ°äº†MySQL5.7.28çš„ä¸‹è½½åœ°å€ï¼Œé€šè¿‡wgetè¿›è¡Œä¸‹è½½</p><pre class=" language-shell"><code class="language-shell">wget https://cdn.mysql.com//Downloads/MySQL-5.7/mysql-5.7.28-1.el7.x86_64.rpm-bundle.tar</code></pre><h3 id="è§£å‹å®‰è£…æ–‡ä»¶"><a href="#è§£å‹å®‰è£…æ–‡ä»¶" class="headerlink" title="è§£å‹å®‰è£…æ–‡ä»¶"></a>è§£å‹å®‰è£…æ–‡ä»¶</h3><p>è¿™é‡Œè§£å‹æ–‡ä»¶ä»¥åï¼Œç›´æ¥æ”¾åˆ°æ–°æ–‡ä»¶å¤¹<code>mysql-5.7.28-1.el7.x86_64</code>äº†ï¼Œå¯ä»¥çœ‹åˆ°ç›®å½•ä¸‹é¢æœ‰å¾ˆå¤šrpmåŒ…</p><pre class=" language-verilog"><code class="language-verilog">tar xvf mysql<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpm<span class="token operator">-</span>bundle<span class="token punctuation">.</span>tar <span class="token operator">-</span>C mysql<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">[</span>root@vm31_123 mysql<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">]</span># llæ€»ç”¨é‡ <span class="token number">595272</span><span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span> <span class="token number">1</span> <span class="token number">7155</span> <span class="token number">31415</span>  <span class="token number">45109364</span> <span class="token number">9</span>æœˆ  <span class="token number">30</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">04</span> mysql<span class="token operator">-</span>community<span class="token operator">-</span>client<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpm<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span> <span class="token number">1</span> <span class="token number">7155</span> <span class="token number">31415</span>    <span class="token number">318768</span> <span class="token number">9</span>æœˆ  <span class="token number">30</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">04</span> mysql<span class="token operator">-</span>community<span class="token operator">-</span>common<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpm<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span> <span class="token number">1</span> <span class="token number">7155</span> <span class="token number">31415</span>   <span class="token number">7037096</span> <span class="token number">9</span>æœˆ  <span class="token number">30</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">04</span> mysql<span class="token operator">-</span>community<span class="token operator">-</span>devel<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpm<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span> <span class="token number">1</span> <span class="token number">7155</span> <span class="token number">31415</span>  <span class="token number">49329100</span> <span class="token number">9</span>æœˆ  <span class="token number">30</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">04</span> mysql<span class="token operator">-</span>community<span class="token operator">-</span>embedded<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpm<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span> <span class="token number">1</span> <span class="token number">7155</span> <span class="token number">31415</span>  <span class="token number">23354908</span> <span class="token number">9</span>æœˆ  <span class="token number">30</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">04</span> mysql<span class="token operator">-</span>community<span class="token operator">-</span>embedded<span class="token operator">-</span>compat<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpm<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span> <span class="token number">1</span> <span class="token number">7155</span> <span class="token number">31415</span> <span class="token number">136837816</span> <span class="token number">9</span>æœˆ  <span class="token number">30</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">04</span> mysql<span class="token operator">-</span>community<span class="token operator">-</span>embedded<span class="token operator">-</span>devel<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpm<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span> <span class="token number">1</span> <span class="token number">7155</span> <span class="token number">31415</span>   <span class="token number">4374364</span> <span class="token number">9</span>æœˆ  <span class="token number">30</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">04</span> mysql<span class="token operator">-</span>community<span class="token operator">-</span>libs<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpm<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span> <span class="token number">1</span> <span class="token number">7155</span> <span class="token number">31415</span>   <span class="token number">1353312</span> <span class="token number">9</span>æœˆ  <span class="token number">30</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">04</span> mysql<span class="token operator">-</span>community<span class="token operator">-</span>libs<span class="token operator">-</span>compat<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpm<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span> <span class="token number">1</span> <span class="token number">7155</span> <span class="token number">31415</span> <span class="token number">208694824</span> <span class="token number">9</span>æœˆ  <span class="token number">30</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">05</span> mysql<span class="token operator">-</span>community<span class="token operator">-</span>server<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpm<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span> <span class="token number">1</span> <span class="token number">7155</span> <span class="token number">31415</span> <span class="token number">133129992</span> <span class="token number">9</span>æœˆ  <span class="token number">30</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">05</span> mysql<span class="token operator">-</span>community<span class="token operator">-</span>test<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpm</code></pre><h2 id="å¼€å§‹å®‰è£…"><a href="#å¼€å§‹å®‰è£…" class="headerlink" title="å¼€å§‹å®‰è£…"></a>å¼€å§‹å®‰è£…</h2><h3 id="æ£€æŸ¥3306ç«¯å£"><a href="#æ£€æŸ¥3306ç«¯å£" class="headerlink" title="æ£€æŸ¥3306ç«¯å£"></a>æ£€æŸ¥3306ç«¯å£</h3><p>MySQLé»˜è®¤ä½¿ç”¨3306ç«¯å£ï¼Œå®‰è£…å‰æŸ¥çœ‹ç«¯å£æ˜¯å¦è¢«å ç”¨</p><pre class=" language-shell"><code class="language-shell">netstat -anp|grep 3306</code></pre><h3 id="å®‰è£…ç›¸åº”çš„rpmåŒ…"><a href="#å®‰è£…ç›¸åº”çš„rpmåŒ…" class="headerlink" title="å®‰è£…ç›¸åº”çš„rpmåŒ…"></a>å®‰è£…ç›¸åº”çš„rpmåŒ…</h3><ul><li>mysql-community-common-5.7.28-1.el7.x86_64.rpm</li><li>mysql-community-libs-5.7.28-1.el7.x86_64.rpm</li><li>mysql-community-client-5.7.28-1.el7.x86_64.rpm</li><li>mysql-community-server-5.7.28-1.el7.x86_64.rpm</li></ul><p>ä»¥ä¸Šå››ä¸ªæ–‡ä»¶æŒ‰ç…§é¡ºåºä¾æ¬¡å®‰è£…ï¼Œé¡ºåºä¸èƒ½é”™ä¹±</p><pre class=" language-shell"><code class="language-shell">rpm -ivh mysql-community-common-5.7.28-1.el7.x86_64.rpmrpm -ivh mysql-community-libs-5.7.28-1.el7.x86_64.rpmrpm -ivh mysql-community-client-5.7.28-1.el7.x86_64.rpmrpm -ivh mysql-community-server-5.7.28-1.el7.x86_64.rpm</code></pre><p>ä»¥ä¸‹ä¸ºå®‰è£…æ—¥å¿—ï¼Œåªè¦ä¹‹å‰çš„<code>mariadb</code>å’Œ<code>mysql</code>å¸è½½å¹²å‡€äº†ï¼Œä¸€èˆ¬ä¸ä¼šæœ‰é—®é¢˜</p><pre class=" language-verilog"><code class="language-verilog"><span class="token punctuation">[</span>root@vm31_123 mysql<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">]</span># rpm <span class="token operator">-</span>ivh mysql<span class="token operator">-</span>community<span class="token operator">-</span>common<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpmè­¦å‘Šï¼šmysql<span class="token operator">-</span>community<span class="token operator">-</span>common<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpm<span class="token punctuation">:</span> å¤´V3 DSA<span class="token operator">/</span>SHA1 Signature<span class="token punctuation">,</span> å¯†é’¥ ID <span class="token number">5072e1</span>f5<span class="token punctuation">:</span> NOKEYå‡†å¤‡ä¸­<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                          ################################# <span class="token punctuation">[</span><span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">]</span>æ­£åœ¨å‡çº§<span class="token operator">/</span>å®‰è£…<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>   <span class="token number">1</span><span class="token punctuation">:</span>mysql<span class="token operator">-</span>community<span class="token operator">-</span>common<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>e################################# <span class="token punctuation">[</span><span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">]</span><span class="token punctuation">[</span>root@vm31_123 mysql<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">]</span># rpm <span class="token operator">-</span>ivh mysql<span class="token operator">-</span>community<span class="token operator">-</span>libs<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpmè­¦å‘Šï¼šmysql<span class="token operator">-</span>community<span class="token operator">-</span>libs<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpm<span class="token punctuation">:</span> å¤´V3 DSA<span class="token operator">/</span>SHA1 Signature<span class="token punctuation">,</span> å¯†é’¥ ID <span class="token number">5072e1</span>f5<span class="token punctuation">:</span> NOKEYå‡†å¤‡ä¸­<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                          ################################# <span class="token punctuation">[</span><span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">]</span>æ­£åœ¨å‡çº§<span class="token operator">/</span>å®‰è£…<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>   <span class="token number">1</span><span class="token punctuation">:</span>mysql<span class="token operator">-</span>community<span class="token operator">-</span>libs<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7################################# <span class="token punctuation">[</span><span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">]</span><span class="token punctuation">[</span>root@vm31_123 mysql<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">]</span># rpm <span class="token operator">-</span>ivh mysql<span class="token operator">-</span>community<span class="token operator">-</span>client<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpmè­¦å‘Šï¼šmysql<span class="token operator">-</span>community<span class="token operator">-</span>client<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpm<span class="token punctuation">:</span> å¤´V3 DSA<span class="token operator">/</span>SHA1 Signature<span class="token punctuation">,</span> å¯†é’¥ ID <span class="token number">5072e1</span>f5<span class="token punctuation">:</span> NOKEYå‡†å¤‡ä¸­<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                          ################################# <span class="token punctuation">[</span><span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">]</span>æ­£åœ¨å‡çº§<span class="token operator">/</span>å®‰è£…<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>   <span class="token number">1</span><span class="token punctuation">:</span>mysql<span class="token operator">-</span>community<span class="token operator">-</span>client<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>e################################# <span class="token punctuation">[</span><span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">]</span><span class="token punctuation">[</span>root@vm31_123 mysql<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">]</span># rpm <span class="token operator">-</span>ivh mysql<span class="token operator">-</span>community<span class="token operator">-</span>server<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpmè­¦å‘Šï¼šmysql<span class="token operator">-</span>community<span class="token operator">-</span>server<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">.</span>rpm<span class="token punctuation">:</span> å¤´V3 DSA<span class="token operator">/</span>SHA1 Signature<span class="token punctuation">,</span> å¯†é’¥ ID <span class="token number">5072e1</span>f5<span class="token punctuation">:</span> NOKEYå‡†å¤‡ä¸­<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                          ################################# <span class="token punctuation">[</span><span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">]</span>æ­£åœ¨å‡çº§<span class="token operator">/</span>å®‰è£…<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>   <span class="token number">1</span><span class="token punctuation">:</span>mysql<span class="token operator">-</span>community<span class="token operator">-</span>server<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>e################################# <span class="token punctuation">[</span><span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">]</span></code></pre><h2 id="åç»­å·¥ä½œ"><a href="#åç»­å·¥ä½œ" class="headerlink" title="åç»­å·¥ä½œ"></a>åç»­å·¥ä½œ</h2><h3 id="å¯åŠ¨MySQLæœåŠ¡"><a href="#å¯åŠ¨MySQLæœåŠ¡" class="headerlink" title="å¯åŠ¨MySQLæœåŠ¡"></a>å¯åŠ¨MySQLæœåŠ¡</h3><pre class=" language-shell"><code class="language-shell">systemctl start mysqld</code></pre><h3 id="æŸ¥çœ‹MySQLæœåŠ¡çŠ¶æ€"><a href="#æŸ¥çœ‹MySQLæœåŠ¡çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹MySQLæœåŠ¡çŠ¶æ€"></a>æŸ¥çœ‹MySQLæœåŠ¡çŠ¶æ€</h3><pre class=" language-shell"><code class="language-shell">systemctl status mysqld</code></pre><p>è¾“å‡ºæ—¥å¿—</p><pre class=" language-verilog"><code class="language-verilog"><span class="token punctuation">[</span>root@vm31_123 mysql<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">]</span># systemctl status mysqldâ— mysqld<span class="token punctuation">.</span>service <span class="token operator">-</span> MySQL Server   Loaded<span class="token punctuation">:</span> loaded <span class="token punctuation">(</span><span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>mysqld<span class="token punctuation">.</span>service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset<span class="token punctuation">:</span> disabled<span class="token punctuation">)</span>   Active<span class="token punctuation">:</span> active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since ä¸‰ <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06</span> CST<span class="token punctuation">;</span> <span class="token number">6</span>s ago     Docs<span class="token punctuation">:</span> man<span class="token punctuation">:</span><span class="token function">mysqld</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>           http<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//dev.mysql.com/doc/refman/en/using-systemd.html</span>  Process<span class="token punctuation">:</span> <span class="token number">22483</span> ExecStart<span class="token operator">=/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>mysqld <span class="token operator">--</span>daemonize <span class="token operator">--</span>pid<span class="token operator">-</span>file<span class="token operator">=/</span><span class="token keyword">var</span><span class="token operator">/</span>run<span class="token operator">/</span>mysqld<span class="token operator">/</span>mysqld<span class="token punctuation">.</span>pid <span class="token property">$MYSQLD_OPTS</span> <span class="token punctuation">(</span>code<span class="token operator">=</span>exited<span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token number">0</span><span class="token operator">/</span>SUCCESS<span class="token punctuation">)</span>  Process<span class="token punctuation">:</span> <span class="token number">22450</span> ExecStartPre<span class="token operator">=/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>mysqld_pre_systemd <span class="token punctuation">(</span>code<span class="token operator">=</span>exited<span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token number">0</span><span class="token operator">/</span>SUCCESS<span class="token punctuation">)</span> Main PID<span class="token punctuation">:</span> <span class="token number">22486</span> <span class="token punctuation">(</span>mysqld<span class="token punctuation">)</span>    Tasks<span class="token punctuation">:</span> <span class="token number">27</span>   Memory<span class="token punctuation">:</span> <span class="token number">193.8</span>M   CGroup<span class="token punctuation">:</span> <span class="token operator">/</span>system<span class="token punctuation">.</span>slice<span class="token operator">/</span>mysqld<span class="token punctuation">.</span>service           â””â”€<span class="token number">22486</span> <span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>mysqld <span class="token operator">--</span>daemonize <span class="token operator">--</span>pid<span class="token operator">-</span>file<span class="token operator">=/</span><span class="token keyword">var</span><span class="token operator">/</span>run<span class="token operator">/</span>mysqld<span class="token operator">/</span>mysqld<span class="token punctuation">.</span>pid<span class="token number">1</span>æœˆ <span class="token number">08</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06</span> vm31_123 mysqld<span class="token punctuation">[</span><span class="token number">22483</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>T13<span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06.468981</span>Z <span class="token number">0</span> <span class="token punctuation">[</span>Note<span class="token punctuation">]</span> Found ca<span class="token punctuation">.</span>pem<span class="token punctuation">,</span> server<span class="token operator">-</span>cert<span class="token punctuation">.</span>pem <span class="token keyword">and</span> server<span class="token operator">-</span>key<span class="token punctuation">.</span>pem in data directory<span class="token punctuation">.</span> Trying to enable SSL support using them<span class="token punctuation">.</span><span class="token number">1</span>æœˆ <span class="token number">08</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06</span> vm31_123 mysqld<span class="token punctuation">[</span><span class="token number">22483</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>T13<span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06.469015</span>Z <span class="token number">0</span> <span class="token punctuation">[</span>Note<span class="token punctuation">]</span> Skipping generation of SSL certificates as certificate files are present in data directory<span class="token punctuation">.</span><span class="token number">1</span>æœˆ <span class="token number">08</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06</span> vm31_123 mysqld<span class="token punctuation">[</span><span class="token number">22483</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>T13<span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06.470439</span>Z <span class="token number">0</span> <span class="token punctuation">[</span>Warning<span class="token punctuation">]</span> CA certificate ca<span class="token punctuation">.</span>pem is self <span class="token keyword">signed</span><span class="token punctuation">.</span><span class="token number">1</span>æœˆ <span class="token number">08</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06</span> vm31_123 mysqld<span class="token punctuation">[</span><span class="token number">22483</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>T13<span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06.470543</span>Z <span class="token number">0</span> <span class="token punctuation">[</span>Note<span class="token punctuation">]</span> Skipping generation of RSA key pair as key files are present in data directory<span class="token punctuation">.</span><span class="token number">1</span>æœˆ <span class="token number">08</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06</span> vm31_123 mysqld<span class="token punctuation">[</span><span class="token number">22483</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>T13<span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06.471329</span>Z <span class="token number">0</span> <span class="token punctuation">[</span>Note<span class="token punctuation">]</span> Server hostname <span class="token punctuation">(</span><span class="token keyword">bind</span><span class="token operator">-</span>address<span class="token punctuation">)</span><span class="token punctuation">:</span> '<span class="token operator">*</span>'<span class="token punctuation">;</span> port<span class="token punctuation">:</span> <span class="token number">3306</span><span class="token number">1</span>æœˆ <span class="token number">08</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06</span> vm31_123 mysqld<span class="token punctuation">[</span><span class="token number">22483</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>T13<span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06.471412</span>Z <span class="token number">0</span> <span class="token punctuation">[</span>Note<span class="token punctuation">]</span> IPv6 is available<span class="token punctuation">.</span><span class="token number">1</span>æœˆ <span class="token number">08</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06</span> vm31_123 mysqld<span class="token punctuation">[</span><span class="token number">22483</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>T13<span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06.471436</span>Z <span class="token number">0</span> <span class="token punctuation">[</span>Note<span class="token punctuation">]</span>   <span class="token operator">-</span> '<span class="token punctuation">:</span><span class="token punctuation">:</span>' resolves to '<span class="token punctuation">:</span><span class="token punctuation">:</span>'<span class="token punctuation">;</span><span class="token number">1</span>æœˆ <span class="token number">08</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06</span> vm31_123 mysqld<span class="token punctuation">[</span><span class="token number">22483</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>T13<span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06.471467</span>Z <span class="token number">0</span> <span class="token punctuation">[</span>Note<span class="token punctuation">]</span> Server socket created on IP<span class="token punctuation">:</span> '<span class="token punctuation">:</span><span class="token punctuation">:</span>'<span class="token punctuation">.</span><span class="token number">1</span>æœˆ <span class="token number">08</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06</span> vm31_123 mysqld<span class="token punctuation">[</span><span class="token number">22483</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>T13<span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06.485478</span>Z <span class="token number">0</span> <span class="token punctuation">[</span>Note<span class="token punctuation">]</span> Event Scheduler<span class="token punctuation">:</span> Loaded <span class="token number">0</span> events<span class="token number">1</span>æœˆ <span class="token number">08</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">06</span> vm31_123 systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span> Started MySQL Server<span class="token punctuation">.</span></code></pre><h3 id="ä¿®æ”¹é»˜è®¤å¯†ç "><a href="#ä¿®æ”¹é»˜è®¤å¯†ç " class="headerlink" title="ä¿®æ”¹é»˜è®¤å¯†ç "></a>ä¿®æ”¹é»˜è®¤å¯†ç </h3><h4 id="æŸ¥çœ‹MySQLå®‰è£…æˆåŠŸä»¥åç”Ÿæˆçš„é›¶æ—¶å¯†ç "><a href="#æŸ¥çœ‹MySQLå®‰è£…æˆåŠŸä»¥åç”Ÿæˆçš„é›¶æ—¶å¯†ç " class="headerlink" title="æŸ¥çœ‹MySQLå®‰è£…æˆåŠŸä»¥åç”Ÿæˆçš„é›¶æ—¶å¯†ç "></a>æŸ¥çœ‹MySQLå®‰è£…æˆåŠŸä»¥åç”Ÿæˆçš„é›¶æ—¶å¯†ç </h4><pre class=" language-shell"><code class="language-shell">sudo cat /var/log/mysqld.log |grep 'temporary password'</code></pre><p>è¾“å‡ºç»“æœï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„mysqlé›¶æ—¶å¯†ç æ˜¯<code>;2o1:2h%!ruT</code></p><pre class=" language-verilog"><code class="language-verilog"><span class="token punctuation">[</span>root@vm31_123 mysql<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">]</span># sudo cat <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log<span class="token operator">/</span>mysqld<span class="token punctuation">.</span>log <span class="token operator">|</span>grep 'temporary password'<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>T12<span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">09.914526</span>Z <span class="token number">1</span> <span class="token punctuation">[</span>Note<span class="token punctuation">]</span> A temporary password is generated <span class="token keyword">for</span> root@localhost<span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token number">2</span>o1<span class="token punctuation">:</span><span class="token number">2</span>h<span class="token operator">%!</span>ruT</code></pre><h4 id="ä½¿ç”¨é›¶æ—¶å¯†ç ç™»å½•ä¿®æ”¹"><a href="#ä½¿ç”¨é›¶æ—¶å¯†ç ç™»å½•ä¿®æ”¹" class="headerlink" title="ä½¿ç”¨é›¶æ—¶å¯†ç ç™»å½•ä¿®æ”¹"></a>ä½¿ç”¨é›¶æ—¶å¯†ç ç™»å½•ä¿®æ”¹</h4><p>è¾“å…¥<code>mysql -uroot -p</code>ä»¥åä¼šæç¤ºæˆ‘ä»¬è¾“å…¥å¯†ç ï¼Œè¿™æ—¶å€™è¾“å…¥åˆšåˆšç”Ÿæˆçš„é›¶æ—¶å¯†ç <code>;2o1:2h%!ruT</code>å³å¯ç™»å½•</p><p>æ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨<code>ALTER USER 'root'@'localhost' IDENTIFIED BY 'MySQL@123';</code>ï¼ˆæ­¤å¤„MySQL@123ä¸ºæ•°æ®åº“å¯†ç ï¼Œæ ¹æ®éœ€æ±‚è‡ªè¡Œè®¾ç½®æ›´æ”¹ï¼‰</p><pre class=" language-verilog"><code class="language-verilog"><span class="token punctuation">[</span>root@vm31_123 mysql<span class="token operator">-</span><span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span>el7<span class="token punctuation">.</span>x86_64<span class="token punctuation">]</span># mysql <span class="token operator">-</span>uroot <span class="token operator">-</span>pEnter password<span class="token punctuation">:</span>Welcome to the MySQL monitor<span class="token punctuation">.</span>  Commands <span class="token keyword">end</span> <span class="token keyword">with</span> <span class="token punctuation">;</span> <span class="token keyword">or</span> \g<span class="token punctuation">.</span>Your MySQL connection id is <span class="token number">2</span>Server version<span class="token punctuation">:</span> <span class="token number">5.7</span><span class="token punctuation">.</span><span class="token number">28</span>Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">2019</span><span class="token punctuation">,</span> Oracle <span class="token keyword">and</span><span class="token operator">/</span><span class="token keyword">or</span> its affiliates<span class="token punctuation">.</span> All rights reserved<span class="token punctuation">.</span>Oracle is a registered trademark of Oracle Corporation <span class="token keyword">and</span><span class="token operator">/</span><span class="token keyword">or</span> itsaffiliates<span class="token punctuation">.</span> Other names may be trademarks of their respectiveowners<span class="token punctuation">.</span>Type <span class="token number">'he</span>lp<span class="token punctuation">;</span>' <span class="token keyword">or</span> '\h' <span class="token keyword">for</span> help<span class="token punctuation">.</span> Type '\c' to clear the current <span class="token keyword">input</span> statement<span class="token punctuation">.</span>mysql<span class="token operator">></span> ALTER USER 'root'@'localhost' IDENTIFIED BY 'MySQL@<span class="token number">123</span>'<span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span></code></pre><h2 id="è®¾ç½®å¤–éƒ¨IPè®¿é—®MySQL"><a href="#è®¾ç½®å¤–éƒ¨IPè®¿é—®MySQL" class="headerlink" title="è®¾ç½®å¤–éƒ¨IPè®¿é—®MySQL"></a>è®¾ç½®å¤–éƒ¨IPè®¿é—®MySQL</h2><p>ä¸ºäº†èƒ½å¤Ÿè®©å¤–éƒ¨è®¿é—®æ•°æ®åº“ï¼Œéœ€è¦å°†rootçš„Hostå€¼æ”¹ä¸ºâ€™%â€™ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>æŸ¥çœ‹å…è®¸è¿æ¥åˆ°æœ¬æ•°æ®åº“çš„ä¿¡æ¯ï¼Œæ‰§è¡Œå‘½ä»¤<code>select host,user from mysql.user;</code></p><p>é»˜è®¤rootåªèƒ½é€šè¿‡localhostè¿æ¥ï¼Œä¸èƒ½è¿œç¨‹è®¿é—®ã€‚</p><ul><li>é€‰æ‹©æ•°æ®åº“ï¼š<code>use mysql;</code></li><li>å…ˆæ‰§è¡Œï¼š<code>update user set Host='%' where User='root';</code></li><li> å†æ‰§è¡Œ:<code>flush privileges;</code> # åˆ·æ–°æƒé™</li></ul><pre class=" language-verilog"><code class="language-verilog">mysql<span class="token operator">></span> <span class="token keyword">use</span> mysql<span class="token punctuation">;</span>Reading <span class="token keyword">table</span> information <span class="token keyword">for</span> completion of <span class="token keyword">table</span> <span class="token keyword">and</span> column namesYou can turn off <span class="token keyword">this</span> feature to get a quicker startup <span class="token keyword">with</span> <span class="token operator">-</span>ADatabase changedmysql<span class="token operator">></span> update user set Host<span class="token operator">=</span>'<span class="token operator">%</span>' where User<span class="token operator">=</span>'root'<span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">1</span> row affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>Rows matched<span class="token punctuation">:</span> <span class="token number">1</span>  Changed<span class="token punctuation">:</span> <span class="token number">1</span>  Warnings<span class="token punctuation">:</span> <span class="token number">0</span>mysql<span class="token operator">></span> flush privileges<span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span></code></pre><p>å½“è®¾ç½®å®Œhost=%ä»¥åï¼Œå°±å¯ä»¥ä½¿ç”¨æˆ‘ä»¬ç†Ÿæ‚‰<code>navicat</code>æˆ–è€…<code>sequel</code>è¿›è¡Œè¿æ¥äº†</p><h2 id="ä¿®æ”¹MySQLé»˜è®¤ç¼–ç ä¸ºutf8"><a href="#ä¿®æ”¹MySQLé»˜è®¤ç¼–ç ä¸ºutf8" class="headerlink" title="ä¿®æ”¹MySQLé»˜è®¤ç¼–ç ä¸ºutf8"></a>ä¿®æ”¹MySQLé»˜è®¤ç¼–ç ä¸º<code>utf8</code></h2><p>å½“æˆ‘ä»¬MySQLå®‰è£…å®Œæˆä»¥åï¼Œé»˜è®¤ç¼–ç ä¸ä¸€å®šæ˜¯<code>utf8</code>ï¼Œè™½ç„¶åœ¨å»ºåº“å»ºè¡¨çš„æ—¶å€™å¯ä»¥æŒ‡å®šï¼Œä½†æ˜¯å§‹ç»ˆä¸æ–¹ä¾¿ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°†MySQLé»˜è®¤ç¼–ç è®¾ç½®ä¸º<code>utf8</code></p><h3 id="æŸ¥çœ‹MySQLé»˜è®¤ç¼–ç "><a href="#æŸ¥çœ‹MySQLé»˜è®¤ç¼–ç " class="headerlink" title="æŸ¥çœ‹MySQLé»˜è®¤ç¼–ç "></a>æŸ¥çœ‹MySQLé»˜è®¤ç¼–ç </h3><p>ä½¿ç”¨<code>show variables like 'character_set_%';</code></p><pre class=" language-verilog"><code class="language-verilog">mysql<span class="token operator">></span> show variables like 'character_set_<span class="token operator">%</span>'<span class="token punctuation">;</span><span class="token operator">+--------------------------+----------------------------+</span><span class="token operator">|</span> Variable_name            <span class="token operator">|</span> Value                      <span class="token operator">|</span><span class="token operator">+--------------------------+----------------------------+</span><span class="token operator">|</span> character_set_client     <span class="token operator">|</span> utf8                       <span class="token operator">|</span><span class="token operator">|</span> character_set_connection <span class="token operator">|</span> utf8                       <span class="token operator">|</span><span class="token operator">|</span> character_set_database   <span class="token operator">|</span> latin1                     <span class="token operator">|</span><span class="token operator">|</span> character_set_filesystem <span class="token operator">|</span> binary                     <span class="token operator">|</span><span class="token operator">|</span> character_set_results    <span class="token operator">|</span> utf8                       <span class="token operator">|</span><span class="token operator">|</span> character_set_server     <span class="token operator">|</span> latin1                     <span class="token operator">|</span><span class="token operator">|</span> character_set_system     <span class="token operator">|</span> utf8                       <span class="token operator">|</span><span class="token operator">|</span> character_sets_dir       <span class="token operator">|</span> <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>mysql<span class="token operator">/</span>charsets<span class="token operator">/</span> <span class="token operator">|</span><span class="token operator">+--------------------------+----------------------------+</span><span class="token number">8</span> rows in set <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></code></pre><p>å¯ä»¥çœ‹åˆ°<code>character_set_server</code>è¿™é‡Œæ˜¯<code>latin1</code>ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„<code>utf8</code>ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦ç¼–è¾‘<code>/etc/my.cnf</code>æ–‡ä»¶è¿›è¡Œè®¾ç½®</p><h3 id="ç¼–è¾‘my-cnfæ–‡ä»¶"><a href="#ç¼–è¾‘my-cnfæ–‡ä»¶" class="headerlink" title="ç¼–è¾‘my.cnfæ–‡ä»¶"></a>ç¼–è¾‘<code>my.cnf</code>æ–‡ä»¶</h3><p><code>sudo vim /etc/my.cnf</code>è¿›è¡Œç¼–è¾‘ï¼ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ï¼Œç„¶åä¿å­˜é‡å¯MySQLæœåŠ¡<code>systemctl restart mysqld</code></p><p><strong>æ³¨æ„ï¼š<code>my.cnf</code>ä¸­é»˜è®¤åŒ…å«<code>[mysqld]</code>ï¼Œä¿®æ”¹çš„æ—¶å€™å°±åœ¨åŸæ¥çš„åŸºç¡€ä¸Šæ”¹å°±å¥½äº†ï¼Œä¸è¦é‡å¤äº†</strong></p><pre class=" language-verilog"><code class="language-verilog"><span class="token punctuation">[</span>client<span class="token punctuation">]</span><span class="token keyword">default</span><span class="token operator">-</span>character<span class="token operator">-</span>set<span class="token operator">=</span>utf8<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>collation<span class="token operator">-</span>server <span class="token operator">=</span> utf8_unicode_ciinit<span class="token operator">-</span>connect<span class="token operator">=</span>'SET NAMES utf8'character<span class="token operator">-</span>set<span class="token operator">-</span>server <span class="token operator">=</span> utf8<span class="token punctuation">[</span>mysql<span class="token punctuation">]</span><span class="token keyword">default</span><span class="token operator">-</span>character<span class="token operator">-</span>set<span class="token operator">=</span>utf8</code></pre><h3 id="å†æ¬¡æŸ¥çœ‹ä¿®æ”¹ä»¥åçš„ç¼–ç "><a href="#å†æ¬¡æŸ¥çœ‹ä¿®æ”¹ä»¥åçš„ç¼–ç " class="headerlink" title="å†æ¬¡æŸ¥çœ‹ä¿®æ”¹ä»¥åçš„ç¼–ç "></a>å†æ¬¡æŸ¥çœ‹ä¿®æ”¹ä»¥åçš„ç¼–ç </h3><pre class=" language-verilog"><code class="language-verilog">mysql<span class="token operator">></span> show variables like 'character_set_<span class="token operator">%</span>'<span class="token punctuation">;</span><span class="token operator">+--------------------------+----------------------------+</span><span class="token operator">|</span> Variable_name            <span class="token operator">|</span> Value                      <span class="token operator">|</span><span class="token operator">+--------------------------+----------------------------+</span><span class="token operator">|</span> character_set_client     <span class="token operator">|</span> utf8                       <span class="token operator">|</span><span class="token operator">|</span> character_set_connection <span class="token operator">|</span> utf8                       <span class="token operator">|</span><span class="token operator">|</span> character_set_database   <span class="token operator">|</span> utf8                       <span class="token operator">|</span><span class="token operator">|</span> character_set_filesystem <span class="token operator">|</span> binary                     <span class="token operator">|</span><span class="token operator">|</span> character_set_results    <span class="token operator">|</span> utf8                       <span class="token operator">|</span><span class="token operator">|</span> character_set_server     <span class="token operator">|</span> utf8                       <span class="token operator">|</span><span class="token operator">|</span> character_set_system     <span class="token operator">|</span> utf8                       <span class="token operator">|</span><span class="token operator">|</span> character_sets_dir       <span class="token operator">|</span> <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>mysql<span class="token operator">/</span>charsets<span class="token operator">/</span> <span class="token operator">|</span><span class="token operator">+--------------------------+----------------------------+</span><span class="token number">8</span> rows in set <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></code></pre><p>åˆ°è¿™é‡Œï¼ŒMySQLçš„é»˜è®¤ç¼–ç å°±æ˜¯æˆ‘ä¹ˆç†Ÿæ‚‰çš„<code>utf8</code>äº†</p><h2 id="å¿˜è®°MySQLå¯†ç "><a href="#å¿˜è®°MySQLå¯†ç " class="headerlink" title="å¿˜è®°MySQLå¯†ç "></a>å¿˜è®°MySQLå¯†ç </h2><p>å½“å¿˜è®°MySQLå¯†ç æˆ–è€…MySQLå¯†ç é”™è¯¯æ˜¯ä¼šæç¤ºé”™è¯¯<code>ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)</code></p><p>å¦‚æœæ‰¾ä¸åˆ°MySQLå¯†ç æ—¶å¯ä»¥ä½¿ç”¨è·³è¿‡mysqlæƒé™è¡¨å¯åŠ¨çš„æ–¹å¼è¿›è¡Œå¯†ç é‡ç½®</p><ol><li><p>åœæ­¢MySQLæœåŠ¡</p><pre class=" language-shell"><code class="language-shell">systemctl stop mysqld</code></pre></li><li><p>è·³è¿‡mysqlæƒé™è¡¨å¯åŠ¨</p><pre class=" language-shell"><code class="language-shell">/usr/bin/mysqld_safe --skip-grant-tables</code></pre></li><li><p>æ— å¯†ç ç™»å½•</p><pre class=" language-shell"><code class="language-shell">mysql -uroot</code></pre></li></ol><ol start="4"><li><p>é€‰æ‹©<code>mysql</code>æ•°æ®åº“</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">use</span> mysql<span class="token punctuation">;</span> </code></pre></li></ol><ol start="5"><li><p>é‡ç½®å¯†ç </p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">update</span> <span class="token keyword">user</span> <span class="token keyword">set</span> authentication_string<span class="token operator">=</span>password<span class="token punctuation">(</span><span class="token string">'MySQL@123'</span><span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token keyword">user</span><span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">;</span> </code></pre></li></ol><ol start="6"><li><p>åˆ·æ–°æƒé™</p><pre class=" language-shell"><code class="language-shell">flush privileges;</code></pre></li></ol><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><ol><li><p>ä¿®æ”¹é»˜è®¤é…ç½®ï¼Œå½“æ’å…¥æˆ–æ›´æ–°çš„æ•°æ®æ¯”è¾ƒå¤§æ—¶ï¼Œéœ€è¦ä¿®æ”¹<code>/etc/my.cnf</code>é…ç½®æ–‡ä»¶</p><p>åœ¨[mysqlId]ä¸‹åŠ ä¸Š max_allowed_packet=20M (å¯ä»¥é€šè¿‡ mysql â€“help | grep my.cnfæŸ¥æ‰¾æ–‡ä»¶è·¯å¾„)</p></li></ol><ol start="2"><li><p>å½“é‡å¯æœåŠ¡å™¨åï¼ŒMySQLæ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œé‡åˆ°ä»¥ä¸‹é—®é¢˜ <code>Job for mysqld.service failed. See 'systemctl status mysqld.service' and 'journalctl -xn' for details.</code> æŸ¥çœ‹æ—¥å¿—ï¼Œå‡ºç°å¦‚ä¸‹é”™è¯¯å†…å®¹ï¼š</p><pre class=" language-verilog"><code class="language-verilog"><span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>mysqld<span class="token punctuation">:</span> Can't create<span class="token operator">/</span>write to file '<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>run<span class="token operator">/</span>mysqld<span class="token operator">/</span>mysqld<span class="token punctuation">.</span>pid' <span class="token punctuation">(</span>Errcode<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token operator">-</span> No such file <span class="token keyword">or</span> directory<span class="token punctuation">)</span><span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> Can't start server<span class="token punctuation">:</span> can't create PID file<span class="token punctuation">:</span> No such file <span class="token keyword">or</span> directoryCopy</code></pre><p>è§£å†³æ–¹æ¡ˆï¼š</p><pre><code>##æˆæƒchown mysql.mysql /var/run/mysqld/##å¯åŠ¨/etc/init.d/mysqld start</code></pre></li></ol>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8 ä¸­çš„æ—¥æœŸç±»åºåˆ—åŒ–é—®é¢˜</title>
      <link href="2020/01/07/java8-date-gson/"/>
      <url>2020/01/07/java8-date-gson/</url>
      
        <content type="html"><![CDATA[<p>è‡ªä»ä¹ æƒ¯äº†ä½¿ç”¨Java8 ä¸­çš„æ—¥æœŸç±»ä»¥åï¼Œå°±å·²ç»å®Œå…¨æŠ›å¼ƒäº†<code>java.sql</code>ã€<code>java.util</code>ä¸­çš„æ—¥æœŸå¤„ç†ç±»ï¼Œä½†æ˜¯Java8ä¸­çš„æ—¥æœŸç±»åœ¨åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ—¶ä¸æ˜¯æˆ‘ä»¬æ­£å¸¸çœ‹åˆ°çš„æ ‡å‡†æ ¼å¼ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨<code>Gson</code>è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ—¶æ­£å¸¸å¯¹Java8çš„æ—¥æœŸç±»è¿›è¡Œå¤„ç†</p><h2 id="é»˜è®¤åºåˆ—åŒ–ç»“æœ"><a href="#é»˜è®¤åºåˆ—åŒ–ç»“æœ" class="headerlink" title="é»˜è®¤åºåˆ—åŒ–ç»“æœ"></a>é»˜è®¤åºåˆ—åŒ–ç»“æœ</h2><p>è¿™é‡Œå†™äº†ä¸€ä¸ªå¾ˆç®€å•çš„testï¼Œå¯¹<code>LocalDate</code>ã€<code>LocalDateTime</code>è¿›è¡Œåºåˆ—åŒ–ä¸ååºåˆ—åŒ–</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span>Gson<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>Data<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Serializable<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalDate<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalDateTime<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020-01-07. */</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Java8DateTests</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        DateMetric dateMetric <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DateMetric</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dateMetric<span class="token punctuation">.</span><span class="token function">setLocalDate</span><span class="token punctuation">(</span>LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dateMetric<span class="token punctuation">.</span><span class="token function">setLocalDateTime</span><span class="token punctuation">(</span>LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// serializer</span>        Gson gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        String json <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>dateMetric<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"serializer:{}"</span><span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// deserializer</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"deserializer:{}"</span><span class="token punctuation">,</span> gson<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> DateMetric<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Data</span>    <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">DateMetric</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>        <span class="token keyword">private</span> LocalDate localDate<span class="token punctuation">;</span>        <span class="token keyword">private</span> LocalDateTime localDateTime<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æŸ¥çœ‹ç»“æœï¼Œå¯ä»¥çœ‹åˆ°ååºåˆ—åŒ–çš„ç»“æœæ˜¯æˆ‘ä»¬è‡ªå·±æƒ³è¦çš„ï¼Œä½†æ˜¯åºåˆ—åŒ–çš„ç»“æœå¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„<code>yyyy-MM-dd HH:mm:ss</code> è¿™ç§æ ¼å¼ï¼Œé‚£ä¹ˆè¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°<code>GsonBuilder</code>æ¥æ³¨å†Œ<code>registerTypeAdapter</code></p><pre class=" language-verilog"><code class="language-verilog"><span class="token number">22</span><span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">01.345</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>Java8DateTests <span class="token operator">-</span> serializer<span class="token punctuation">:</span><span class="token operator">{</span><span class="token string">"localDate"</span><span class="token punctuation">:</span><span class="token operator">{</span><span class="token string">"year"</span><span class="token punctuation">:</span><span class="token number">2020</span><span class="token punctuation">,</span><span class="token string">"month"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"day"</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token operator">}</span><span class="token punctuation">,</span><span class="token string">"localDateTime"</span><span class="token punctuation">:</span><span class="token operator">{</span><span class="token string">"date"</span><span class="token punctuation">:</span><span class="token operator">{</span><span class="token string">"year"</span><span class="token punctuation">:</span><span class="token number">2020</span><span class="token punctuation">,</span><span class="token string">"month"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"day"</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token operator">}</span><span class="token punctuation">,</span><span class="token string">"time"</span><span class="token punctuation">:</span><span class="token operator">{</span><span class="token string">"hour"</span><span class="token punctuation">:</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token string">"minute"</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">"second"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"nano"</span><span class="token punctuation">:</span><span class="token number">271000000</span><span class="token operator">}}}</span><span class="token number">22</span><span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">01.356</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>Java8DateTests <span class="token operator">-</span> deserializer<span class="token punctuation">:</span>Java8DateTests<span class="token punctuation">.</span><span class="token function">DateMetric</span><span class="token punctuation">(</span>localDate<span class="token operator">=</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span><span class="token punctuation">,</span> localDateTime<span class="token operator">=</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>T22<span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">01.271</span><span class="token punctuation">)</span></code></pre><h2 id="è‡ªå®šä¹‰åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„Adapter"><a href="#è‡ªå®šä¹‰åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„Adapter" class="headerlink" title="è‡ªå®šä¹‰åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„Adapter"></a>è‡ªå®šä¹‰åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„Adapter</h2><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**     * å¤„ç†LocalDateçš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–     */</span><span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">LocalDateAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">JsonSerializer</span><span class="token operator">&lt;</span>LocalDate<span class="token operator">></span><span class="token punctuation">,</span> JsonDeserializer<span class="token operator">&lt;</span>LocalDate<span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">public</span> JsonElement <span class="token function">serialize</span><span class="token punctuation">(</span>LocalDate date<span class="token punctuation">,</span> Type typeOfSrc<span class="token punctuation">,</span> JsonSerializationContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JsonPrimitive</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span>ISO_LOCAL_DATE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> LocalDate <span class="token function">deserialize</span><span class="token punctuation">(</span>JsonElement element<span class="token punctuation">,</span> Type type<span class="token punctuation">,</span> JsonDeserializationContext context<span class="token punctuation">)</span> <span class="token keyword">throws</span> JsonParseException <span class="token punctuation">{</span>    String timestamp <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">getAsJsonPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> LocalDate<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">,</span> DateTimeFormatter<span class="token punctuation">.</span>ISO_LOCAL_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/**     * å¤„ç†LocalDateTimeåºåˆ—åŒ–ä¸ååºåˆ—åŒ–     */</span><span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">LocalDateTimeAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">JsonSerializer</span><span class="token operator">&lt;</span>LocalDateTime<span class="token operator">></span><span class="token punctuation">,</span> JsonDeserializer<span class="token operator">&lt;</span>LocalDateTime<span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">public</span> JsonElement <span class="token function">serialize</span><span class="token punctuation">(</span>LocalDateTime date<span class="token punctuation">,</span> Type typeOfSrc<span class="token punctuation">,</span> JsonSerializationContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JsonPrimitive</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span>ISO_LOCAL_DATE_TIME<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> LocalDateTime <span class="token function">deserialize</span><span class="token punctuation">(</span>JsonElement element<span class="token punctuation">,</span> Type type<span class="token punctuation">,</span> JsonDeserializationContext context<span class="token punctuation">)</span> <span class="token keyword">throws</span> JsonParseException <span class="token punctuation">{</span>    String timestamp <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">getAsJsonPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">,</span> DateTimeFormatter<span class="token punctuation">.</span>ISO_LOCAL_DATE_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="ä½¿ç”¨GsonBuilderåˆ›å»ºgsonå¯¹è±¡"><a href="#ä½¿ç”¨GsonBuilderåˆ›å»ºgsonå¯¹è±¡" class="headerlink" title="ä½¿ç”¨GsonBuilderåˆ›å»ºgsonå¯¹è±¡"></a>ä½¿ç”¨GsonBuilderåˆ›å»ºgsonå¯¹è±¡</h3><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  DateMetric dateMetric <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DateMetric</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  dateMetric<span class="token punctuation">.</span><span class="token function">setLocalDate</span><span class="token punctuation">(</span>LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  dateMetric<span class="token punctuation">.</span><span class="token function">setLocalDateTime</span><span class="token punctuation">(</span>LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// serializer</span>  Gson gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GsonBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">registerTypeAdapter</span><span class="token punctuation">(</span>LocalDate<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LocalDateAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">registerTypeAdapter</span><span class="token punctuation">(</span>LocalDateTime<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LocalDateTimeAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  String json <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>dateMetric<span class="token punctuation">)</span><span class="token punctuation">;</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"serializer:{}"</span><span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// deserializer</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"deserializer:{}"</span><span class="token punctuation">,</span> gson<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> DateMetric<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ç»“æœ</p><pre class=" language-verilog"><code class="language-verilog"><span class="token number">22</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token number">15.738</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>Java8DateTests <span class="token operator">-</span> serializer<span class="token punctuation">:</span><span class="token operator">{</span><span class="token string">"localDate"</span><span class="token punctuation">:</span><span class="token string">"2020-01-07"</span><span class="token punctuation">,</span><span class="token string">"localDateTime"</span><span class="token punctuation">:</span><span class="token string">"2020-01-07T22:16:15.662"</span><span class="token operator">}</span><span class="token number">22</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token number">15.745</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>Java8DateTests <span class="token operator">-</span> deserializer<span class="token punctuation">:</span>Java8DateTests<span class="token punctuation">.</span><span class="token function">DateMetric</span><span class="token punctuation">(</span>localDate<span class="token operator">=</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span><span class="token punctuation">,</span> localDateTime<span class="token operator">=</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>T22<span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token number">15.662</span><span class="token punctuation">)</span></code></pre><h2 id="è¾“å‡ºjsonè¿›è¡Œæ ¼å¼åŒ–å¤„ç†"><a href="#è¾“å‡ºjsonè¿›è¡Œæ ¼å¼åŒ–å¤„ç†" class="headerlink" title="è¾“å‡ºjsonè¿›è¡Œæ ¼å¼åŒ–å¤„ç†"></a>è¾“å‡ºjsonè¿›è¡Œæ ¼å¼åŒ–å¤„ç†</h2><p>å¹³æ—¶è¾“å‡ºçš„jsonéƒ½æ˜¯ä¸€è¡Œæ–‡æœ¬ï¼Œå¦‚æœéœ€è¦å¯¹jsonçš„è¾“å‡ºç»“æœéœ€è¦è¿›è¡Œæ ¼å¼åŒ–å¤„ç†çš„è¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>GsonBuilder</code>çš„<code>setPrettyPrinting()</code>æ–¹æ³•</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  DateMetric dateMetric <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DateMetric</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  dateMetric<span class="token punctuation">.</span><span class="token function">setLocalDate</span><span class="token punctuation">(</span>LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  dateMetric<span class="token punctuation">.</span><span class="token function">setLocalDateTime</span><span class="token punctuation">(</span>LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// serializer</span>  Gson gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GsonBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">setPrettyPrinting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// è®¾ç½®è¾“å‡ºæ ¼å¼æ ¼å¼åŒ–æ˜¾ç¤º</span>    <span class="token punctuation">.</span><span class="token function">registerTypeAdapter</span><span class="token punctuation">(</span>LocalDate<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LocalDateAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">registerTypeAdapter</span><span class="token punctuation">(</span>LocalDateTime<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LocalDateTimeAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  String json <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>dateMetric<span class="token punctuation">)</span><span class="token punctuation">;</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"serializer:\n{}"</span><span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// deserializer</span>  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"deserializer:{}"</span><span class="token punctuation">,</span> gson<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> DateMetric<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>è¾“å‡ºç»“æœ</p><pre class=" language-verilog"><code class="language-verilog"><span class="token number">22</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">03.307</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>Java8DateTests <span class="token operator">-</span> serializer<span class="token punctuation">:</span><span class="token operator">{</span>  <span class="token string">"localDate"</span><span class="token punctuation">:</span> <span class="token string">"2020-01-07"</span><span class="token punctuation">,</span>  <span class="token string">"localDateTime"</span><span class="token punctuation">:</span> <span class="token string">"2020-01-07T22:21:03.218"</span><span class="token operator">}</span><span class="token number">22</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">03.313</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> INFO com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>Java8DateTests <span class="token operator">-</span> deserializer<span class="token punctuation">:</span>Java8DateTests<span class="token punctuation">.</span><span class="token function">DateMetric</span><span class="token punctuation">(</span>localDate<span class="token operator">=</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span><span class="token punctuation">,</span> localDateTime<span class="token operator">=</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>T22<span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">03.218</span><span class="token punctuation">)</span></code></pre><h2 id="å¯¹å·²æœ‰çš„jsonè¿›è¡Œæ ¼å¼åŒ–å¤„ç†"><a href="#å¯¹å·²æœ‰çš„jsonè¿›è¡Œæ ¼å¼åŒ–å¤„ç†" class="headerlink" title="å¯¹å·²æœ‰çš„jsonè¿›è¡Œæ ¼å¼åŒ–å¤„ç†"></a>å¯¹å·²æœ‰çš„jsonè¿›è¡Œæ ¼å¼åŒ–å¤„ç†</h2><p>å¦‚æœæˆ‘ä»¬çš„jsonæ–‡æœ¬å·²ç»å­˜åœ¨ï¼Œé‚£æˆ‘æˆ‘ä»¬æƒ³é€šè¿‡gsonè¿›è¡Œæ ¼å¼åŒ–å±•ç¤ºè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>è¿™é‡Œåšæ³•ä¹Ÿå¾ˆç®€å•ï¼Œä¸è¿‡<code>JsonObject</code>å’Œ<code>JsonArray</code>ç•¥æœ‰åŒºåˆ«ï¼Œä¸è¿‡éƒ½æ˜¯éœ€è¦å°†jsonè¯»å–æˆ<code>JsonObject</code>æˆ–è€…<code>JsonArray</code>å¯¹è±¡</p><h3 id="JsonObject-æ ¼å¼åŒ–"><a href="#JsonObject-æ ¼å¼åŒ–" class="headerlink" title="JsonObject æ ¼å¼åŒ–"></a>JsonObject æ ¼å¼åŒ–</h3><p>åŸå§‹JsonObjectæ•°æ®</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span><span class="token property">"localDate"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"year"</span><span class="token operator">:</span><span class="token number">2020</span><span class="token punctuation">,</span><span class="token property">"month"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"day"</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"localDateTime"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"date"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"year"</span><span class="token operator">:</span><span class="token number">2020</span><span class="token punctuation">,</span><span class="token property">"month"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"day"</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"time"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"hour"</span><span class="token operator">:</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token property">"minute"</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token property">"second"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"nano"</span><span class="token operator">:</span><span class="token number">271000000</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jsonObjectFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  JsonObject jsonObject <span class="token operator">=</span> JsonParser<span class="token punctuation">.</span><span class="token function">parseString</span><span class="token punctuation">(</span>JSON_STRING<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAsJsonObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Gson gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GsonBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPrettyPrinting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>è¾“å‡ºç»“æœï¼š</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"localDate"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"year"</span><span class="token operator">:</span> <span class="token number">2020</span><span class="token punctuation">,</span>    <span class="token property">"month"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token property">"day"</span><span class="token operator">:</span> <span class="token number">7</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"localDateTime"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"date"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"year"</span><span class="token operator">:</span> <span class="token number">2020</span><span class="token punctuation">,</span>      <span class="token property">"month"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      <span class="token property">"day"</span><span class="token operator">:</span> <span class="token number">7</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"time"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"hour"</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>      <span class="token property">"minute"</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>      <span class="token property">"second"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      <span class="token property">"nano"</span><span class="token operator">:</span> <span class="token number">271000000</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="JsonArray-æ ¼å¼åŒ–"><a href="#JsonArray-æ ¼å¼åŒ–" class="headerlink" title="JsonArray æ ¼å¼åŒ–"></a>JsonArray æ ¼å¼åŒ–</h3><p>åŸå§‹JsonArrayæ•°æ®</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">"localDate"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"year"</span><span class="token operator">:</span><span class="token number">2020</span><span class="token punctuation">,</span><span class="token property">"month"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"day"</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"localDateTime"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"date"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"year"</span><span class="token operator">:</span><span class="token number">2020</span><span class="token punctuation">,</span><span class="token property">"month"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"day"</span><span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"time"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"hour"</span><span class="token operator">:</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token property">"minute"</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token property">"second"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"nano"</span><span class="token operator">:</span><span class="token number">271000000</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jsonArrayFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  JsonArray jsonArray <span class="token operator">=</span> JsonParser<span class="token punctuation">.</span><span class="token function">parseString</span><span class="token punctuation">(</span>JSON_STRING_ARRAY<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAsJsonArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Gson gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GsonBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPrettyPrinting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>jsonArray<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>è¾“å‡ºç»“æœï¼š</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">[</span>  <span class="token punctuation">{</span>    <span class="token property">"localDate"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"year"</span><span class="token operator">:</span> <span class="token number">2020</span><span class="token punctuation">,</span>      <span class="token property">"month"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      <span class="token property">"day"</span><span class="token operator">:</span> <span class="token number">7</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"localDateTime"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"date"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"year"</span><span class="token operator">:</span> <span class="token number">2020</span><span class="token punctuation">,</span>        <span class="token property">"month"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token property">"day"</span><span class="token operator">:</span> <span class="token number">7</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token property">"time"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"hour"</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>        <span class="token property">"minute"</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>        <span class="token property">"second"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token property">"nano"</span><span class="token operator">:</span> <span class="token number">271000000</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">]</span></code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†ä½¿ç”¨Gsonå¯¹Java8ä¸­çš„æ—¥å¿—è¿›è¡Œåºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ ¼å¼çš„å¤„ç†ï¼Œä»¥åŠä½¿ç”¨gsonå¯¹jsonè¿›è¡Œæ ¼å¼åŒ–çš„è¾“å‡ºã€‚</p><p>å‚è€ƒåœ°å€ï¼š<a href="https://stackoverflow.com/questions/39192945/serialize-java-8-localdate-as-yyyy-mm-dd-with-gson">Serialize Java 8 LocalDate as yyyy-mm-dd with Gson</a></p><p>å®Œæ•´ä»£ç ï¼š<a href="https://github.com/xiaomozhang/personal-life-example/blob/master/example-kafka/src/test/java/com/xiaozhangge/Java8DateTests.java">Java8DateTests</a></p>]]></content>
      
      
      <categories>
          
          <category> Java8 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gson </tag>
            
            <tag> Java8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Boot æ•´åˆkafka</title>
      <link href="2020/01/06/spring-boot-kafka/"/>
      <url>2020/01/06/spring-boot-kafka/</url>
      
        <content type="html"><![CDATA[<p>å…³äºkafkaçš„ä»‹ç»è¿™é‡Œå°±ä¸åœ¨è¿‡å¤šè¯´æ˜ï¼Œå¯ä»¥çœ‹ä¹‹å‰å†™è¿‡ä¸€éæ–‡ç« <a href="http://xiaomozhang.github.io/2018/07/28/docker-compose-zk-kafka/">ä½¿ç”¨docker-composeæ„å»ºkafkaé›†ç¾¤</a> æ–‡ç« é‡Œé¢æœ‰å…³äºkafkaçš„ä¸€äº›ä»‹ç»ä»¥åŠç¯å¢ƒæ­å»ºï¼Œæ–‡ç« ä¸­çš„ç¯å¢ƒæ­å»ºæ˜¯åŸºäºdockerå’Œdocker-composeçš„ï¼Œå¦‚æœä¸æƒ³é€šè¿‡dockeræ„å»ºï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¸‹è½½kafkaçš„å®‰è£…åŒ…ç›´æ¥åœ¨æœºå™¨ä¸Šå¯åŠ¨ï¼Œä¹‹å‰çš„æ–‡ç« é“¾æ¥<a href="http://xiaomozhang.github.io/2018/07/30/kafka-note/">kafkaå¸¸ç”¨æ“ä½œç¬”è®°</a>ã€‚è¿™é‡Œä¹Ÿä¸å†å™è¿°ï¼Œä»Šå¤©ä¸»è¦æ¥çœ‹Spring Bootä¸­å¦‚ä½•å¯¹æ¥kafkaè¿›è¡Œæ•°æ®çš„æ¶ˆè´¹ä¸ç”Ÿäº§ã€‚</p><h2 id="é…ç½®POM"><a href="#é…ç½®POM" class="headerlink" title="é…ç½®POM"></a>é…ç½®POM</h2><p>ç¬¬ä¸€æ­¥å½“ç„¶æ˜¯å…ˆå¼•å…¥pomä¾èµ–</p><pre class=" language-xml"><code class="language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.kafka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-kafka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><h2 id="é…ç½®kafkaåŸºæœ¬ä¿¡æ¯"><a href="#é…ç½®kafkaåŸºæœ¬ä¿¡æ¯" class="headerlink" title="é…ç½®kafkaåŸºæœ¬ä¿¡æ¯"></a>é…ç½®kafkaåŸºæœ¬ä¿¡æ¯</h2><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">kafka</span><span class="token punctuation">:</span>    <span class="token key atrule">bootstrap-servers</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">9092  </span><span class="token comment" spellcheck="true"># å¤šä¸ªä½¿ç”¨`,`éš”å¼€</span>    <span class="token key atrule">producer</span><span class="token punctuation">:</span>      <span class="token key atrule">key-serializer</span><span class="token punctuation">:</span> org.apache.kafka.common.serialization.StringSerializer      <span class="token key atrule">value-serializer</span><span class="token punctuation">:</span> org.apache.kafka.common.serialization.StringSerializer      <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">0 </span><span class="token comment" spellcheck="true"># å¤±è´¥é‡è¯•æ¬¡æ•°</span>      <span class="token key atrule">batch-size</span><span class="token punctuation">:</span> <span class="token number">16384</span>      <span class="token key atrule">buffer-memory</span><span class="token punctuation">:</span> <span class="token number">33554432</span>      <span class="token key atrule">acks</span><span class="token punctuation">:</span> <span class="token number">-1 </span><span class="token comment" spellcheck="true"># å–å€¼ all, -1, 0, 1</span>    <span class="token key atrule">consumer</span><span class="token punctuation">:</span>      <span class="token key atrule">enable-auto-commit</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>      <span class="token key atrule">auto-commit-interval</span><span class="token punctuation">:</span> <span class="token number">5000</span>      <span class="token key atrule">group-id</span><span class="token punctuation">:</span> group<span class="token punctuation">-</span>test      <span class="token key atrule">auto-offset-reset</span><span class="token punctuation">:</span> earliest <span class="token comment" spellcheck="true"># æ¶ˆè´¹offsetå–å€¼earliest,latest,noneï¼ˆé»˜è®¤ï¼šlatestï¼‰</span>      <span class="token key atrule">key-deserializer</span><span class="token punctuation">:</span> org.apache.kafka.common.serialization.StringDeserializer      <span class="token key atrule">value-deserializer</span><span class="token punctuation">:</span> org.apache.kafka.common.serialization.StringDeserializer<span class="token comment" spellcheck="true"># è‡ªå®šä¹‰producer topic</span><span class="token key atrule">kafka</span><span class="token punctuation">:</span>  <span class="token key atrule">producer</span><span class="token punctuation">:</span>    <span class="token key atrule">topic</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>producer</code></pre><p>è¯¦ç»†çš„é…ç½®ä»‹ç»ï¼š<a href="https://www.cnblogs.com/yx88/p/11013338.html"></a><a href="https://www.cnblogs.com/yx88/p/11013338.html">spring-kafkaç”Ÿäº§è€…æ¶ˆè´¹è€…é…ç½®è¯¦è§£</a></p><h2 id="å¯åŠ¨zookeeperå’ŒkafkaæœåŠ¡"><a href="#å¯åŠ¨zookeeperå’ŒkafkaæœåŠ¡" class="headerlink" title="å¯åŠ¨zookeeperå’ŒkafkaæœåŠ¡"></a>å¯åŠ¨zookeeperå’ŒkafkaæœåŠ¡</h2><h3 id="å¯åŠ¨zookeeper"><a href="#å¯åŠ¨zookeeper" class="headerlink" title="å¯åŠ¨zookeeper"></a>å¯åŠ¨zookeeper</h3><pre class=" language-shell"><code class="language-shell">./bin/zookeeper-server-start.sh  -daemon  config/zookeeper.properties</code></pre><h3 id="å¯åŠ¨kafka"><a href="#å¯åŠ¨kafka" class="headerlink" title="å¯åŠ¨kafka"></a>å¯åŠ¨kafka</h3><pre class=" language-shell"><code class="language-shell">./bin/kafka-server-start.sh -daemon config/server.properties</code></pre><p>é€šè¿‡<code>jps</code>æ£€æŸ¥è¿›ç¨‹</p><pre class=" language-shell"><code class="language-shell">âœ  kafka_2.11-2.3.0 jps2744240473 QuorumPeerMain # zookeeperè¿›ç¨‹40795 Kafka # kafkaè¿›ç¨‹40847 Jps</code></pre><h2 id="ç”Ÿäº§æ¶ˆæ¯"><a href="#ç”Ÿäº§æ¶ˆæ¯" class="headerlink" title="ç”Ÿäº§æ¶ˆæ¯"></a>ç”Ÿäº§æ¶ˆæ¯</h2><p>ä¸ºäº†æ–¹ä¾¿çœ‹æ•°æ®ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª<code>Metric</code>ç±»ï¼Œç”¨æ¥ä¿å­˜æ•°æ®ï¼Œå¹¶æ¯éš”<code>3s</code>å¾€kafkaæœåŠ¡å™¨å‘é€ä¸€æ¬¡æ•°æ®ï¼Œå¹¶ä¸”åœ¨ç¨‹åºå¯åŠ¨ä»¥åï¼Œé€šè¿‡<code>CommandLineRunner</code>åˆå§‹åŒ–å‘é€</p><ul><li>metricç±»</li></ul><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span>SerializedName<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>AllArgsConstructor<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>Data<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>NoArgsConstructor<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Serializable<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalDateTime<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020-01-07. */</span><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Metric</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String hostname<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">long</span> total<span class="token punctuation">;</span>    <span class="token annotation punctuation">@SerializedName</span><span class="token punctuation">(</span><span class="token string">"succ_cnt"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token keyword">long</span> succCnt<span class="token punctuation">;</span>    <span class="token annotation punctuation">@SerializedName</span><span class="token punctuation">(</span><span class="token string">"succ_rate"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token keyword">float</span> succRate<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> status<span class="token punctuation">;</span>    <span class="token keyword">private</span> LocalDateTime timestamp<span class="token punctuation">;</span>    <span class="token keyword">private</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> tags<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><ul><li>Spring Bootå¯åŠ¨ç±»</li></ul><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>collect<span class="token punctuation">.</span>Maps<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>common<span class="token punctuation">.</span>util<span class="token punctuation">.</span>DecimalUtils<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>common<span class="token punctuation">.</span>util<span class="token punctuation">.</span>IdHelper<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>common<span class="token punctuation">.</span>util<span class="token punctuation">.</span>JsonParse<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span>Metric<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Value<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>CommandLineRunner<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>SpringApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>core<span class="token punctuation">.</span>KafkaTemplate<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalDateTime<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Random<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>TimeUnit<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020-01-06. * åŠ¨æ€é…ç½®å¤šä¸ªtopic * https://github.com/spring-projects/spring-kafka/issues/361 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KafkaApplication</span> <span class="token keyword">implements</span> <span class="token class-name">CommandLineRunner</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> KafkaTemplate kafkaTemplate<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * è¿™é‡Œå¯¹åº”æˆ‘ä»¬åœ¨ymlä¸­è‡ªå®šä¹‰çš„é…ç½®ï¼Œç”¨äºè·å–å‘é€æ•°æ®ç”¨çš„topic     */</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${kafka.producer.topic}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String producerTopic<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>KafkaApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        Random random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">writer2Kafka</span><span class="token punctuation">(</span>random<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// æ¯éš”3så‘kafkaå‘é€æ•°æ®</span>            TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writer2Kafka</span><span class="token punctuation">(</span>Random random<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Metric metric <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Metric</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        metric<span class="token punctuation">.</span><span class="token function">setHostname</span><span class="token punctuation">(</span><span class="token string">"NODE-"</span> <span class="token operator">+</span> IdHelper<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        metric<span class="token punctuation">.</span><span class="token function">setTotal</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        metric<span class="token punctuation">.</span><span class="token function">setSuccCnt</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">9900</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">float</span> v <span class="token operator">=</span> DecimalUtils<span class="token punctuation">.</span><span class="token function">divide</span><span class="token punctuation">(</span>metric<span class="token punctuation">.</span><span class="token function">getSuccCnt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metric<span class="token punctuation">.</span><span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        metric<span class="token punctuation">.</span><span class="token function">setSuccRate</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>        metric<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        metric<span class="token punctuation">.</span><span class="token function">setTimestamp</span><span class="token punctuation">(</span>LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> tagMap <span class="token operator">=</span> Maps<span class="token punctuation">.</span><span class="token function">newHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        tagMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"cpu_util"</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span><span class="token function">nextFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        tagMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"mem_util"</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span><span class="token function">nextFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        metric<span class="token punctuation">.</span><span class="token function">setTags</span><span class="token punctuation">(</span>tagMap<span class="token punctuation">)</span><span class="token punctuation">;</span>        kafkaTemplate<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>producerTopic<span class="token punctuation">,</span> JsonParse<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>metric<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        kafkaTemplate<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å¯åŠ¨ç¨‹åºåï¼Œå¦‚æœtopicä¸å­˜åœ¨åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºtopicï¼ˆæˆ‘ä»¬å¹¶æ²¡æœ‰å…³é—­è‡ªåŠ¨åˆ›å»ºtopicï¼‰ï¼Œé€šè¿‡kafka-consumeerå‘½ä»¤å¯ä»¥çœ‹åˆ°topicä¸­çš„æ•°æ®</p><pre class=" language-shell"><code class="language-shell">./bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test-producer --from-beginning# æ ·ä¾‹æ•°æ®{"hostname":"NODE-55","total":6704,"succ_cnt":1441,"succ_rate":0.2149463,"status":0,"timestamp":"2020-01-07T21:29:21.501","tags":{"mem_util":5.2691402,"cpu_util":97.53448}}{"hostname":"NODE-23","total":9579,"succ_cnt":2191,"succ_rate":0.22872952,"status":0,"timestamp":"2020-01-07T21:29:25.422","tags":{"mem_util":27.203756,"cpu_util":43.626713}}{"hostname":"NODE-8","total":6889,"succ_cnt":786,"succ_rate":0.114094935,"status":0,"timestamp":"2020-01-07T21:29:28.428","tags":{"mem_util":18.526094,"cpu_util":87.67309}}{"hostname":"NODE-142","total":8753,"succ_cnt":4227,"succ_rate":0.48292014,"status":0,"timestamp":"2020-01-07T21:29:31.436","tags":{"mem_util":87.426476,"cpu_util":12.49879}}{"hostname":"NODE-198","total":2261,"succ_cnt":4251,"succ_rate":1.8801415,"status":0,"timestamp":"2020-01-07T21:29:34.444","tags":{"mem_util":5.665392,"cpu_util":69.29729}}{"hostname":"NODE-46","total":2846,"succ_cnt":6600,"succ_rate":2.3190444,"status":0,"timestamp":"2020-01-07T21:29:37.451","tags":{"mem_util":66.49958,"cpu_util":18.604118}}{"hostname":"NODE-47","total":5110,"succ_cnt":9650,"succ_rate":1.888454,"status":1,"timestamp":"2020-01-07T21:29:40.459","tags":{"mem_util":92.13784,"cpu_util":60.55072}}Processed a total of 195 messages</code></pre><p>é€šè¿‡å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°kafkaä¸­å·²ç»æœ‰æ–°å†™è¿›å»çš„æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨Spring Bootä¸­åˆè¯¥å¦‚ä½•å¯¹æ•°æ®è¿›è¡Œæ¶ˆè´¹å‘¢ï¼Ÿ</p><h2 id="æ¶ˆè´¹æ¶ˆæ¯"><a href="#æ¶ˆè´¹æ¶ˆæ¯" class="headerlink" title="æ¶ˆè´¹æ¶ˆæ¯"></a>æ¶ˆè´¹æ¶ˆæ¯</h2><p>ç”Ÿäº§æ•°æ®å¾ˆç®€å•ï¼Œæ¶ˆè´¹æ•°æ®ä¹Ÿä¸éš¾ï¼Œä¸»è¦ä½¿ç”¨Spring Bootæä¾›çš„æ³¨è§£<code>@KafkaListener</code>ï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªconsumerç±»ï¼Œåˆšåˆšæˆ‘ä»¬æ˜¯å¾€<code>test-producer</code>è¿™ä¸ªtopicé‡Œé¢å†™ï¼Œç°åœ¨é€šè¿‡ç¨‹åºæ¶ˆè´¹è¿™ä¸ªtopic</p><p><code>@KafkaListener</code> å¸¸ç”¨çš„å‚æ•°</p><ul><li>topic è®¾ç½®æ¶ˆè´¹çš„topic</li><li>groupId æŒ‡å®šæ¶ˆè´¹ç»„</li></ul><h3 id="MetricConsumer"><a href="#MetricConsumer" class="headerlink" title="MetricConsumer"></a>MetricConsumer</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>common<span class="token punctuation">.</span>util<span class="token punctuation">.</span>JsonParse<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span>Metric<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>ConsumerRecord<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>KafkaListener<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Component<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Optional<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020-01-07. */</span><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MetricConsumer</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@KafkaListener</span><span class="token punctuation">(</span>topics <span class="token operator">=</span> <span class="token string">"test-producer"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">event</span><span class="token punctuation">(</span>ConsumerRecord<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> record<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> kafkaMessage <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        kafkaMessage<span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>x <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>            Metric metric <span class="token operator">=</span> JsonParse<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> Metric<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆè´¹kafkaä¸­çš„æ•°æ®:{}"</span><span class="token punctuation">,</span> metric<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ¶ˆè´¹åˆ°çš„æ•°æ®ç»“æœ</p><pre class=" language-verilog"><code class="language-verilog"><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">10.646</span>  INFO <span class="token number">42501</span> <span class="token operator">---</span> <span class="token punctuation">[</span>ntainer#<span class="token number">0</span><span class="token operator">-</span><span class="token number">0</span><span class="token operator">-</span>C<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> c<span class="token punctuation">.</span>i<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>MetricConsumer        <span class="token punctuation">:</span> æ¶ˆè´¹kafkaä¸­çš„æ•°æ®<span class="token punctuation">:</span><span class="token function">Metric</span><span class="token punctuation">(</span>hostname<span class="token operator">=</span>NODE<span class="token operator">-</span><span class="token number">128</span><span class="token punctuation">,</span> total<span class="token operator">=</span><span class="token number">7849</span><span class="token punctuation">,</span> succCnt<span class="token operator">=</span><span class="token number">9252</span><span class="token punctuation">,</span> succRate<span class="token operator">=</span><span class="token number">1.1787488</span><span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>T21<span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">10.639</span><span class="token punctuation">,</span> tags<span class="token operator">={</span>mem_util<span class="token operator">=</span><span class="token number">83.20216</span><span class="token punctuation">,</span> cpu_util<span class="token operator">=</span><span class="token number">2.36848</span><span class="token operator">}</span><span class="token punctuation">)</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">13.651</span>  INFO <span class="token number">42501</span> <span class="token operator">---</span> <span class="token punctuation">[</span>ntainer#<span class="token number">0</span><span class="token operator">-</span><span class="token number">0</span><span class="token operator">-</span>C<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> c<span class="token punctuation">.</span>i<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>MetricConsumer        <span class="token punctuation">:</span> æ¶ˆè´¹kafkaä¸­çš„æ•°æ®<span class="token punctuation">:</span><span class="token function">Metric</span><span class="token punctuation">(</span>hostname<span class="token operator">=</span>NODE<span class="token operator">-</span><span class="token number">199</span><span class="token punctuation">,</span> total<span class="token operator">=</span><span class="token number">3799</span><span class="token punctuation">,</span> succCnt<span class="token operator">=</span><span class="token number">595</span><span class="token punctuation">,</span> succRate<span class="token operator">=</span><span class="token number">0.15662016</span><span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>T21<span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">13.647</span><span class="token punctuation">,</span> tags<span class="token operator">={</span>mem_util<span class="token operator">=</span><span class="token number">37.34904</span><span class="token punctuation">,</span> cpu_util<span class="token operator">=</span><span class="token number">56.30006</span><span class="token operator">}</span><span class="token punctuation">)</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">16.662</span>  INFO <span class="token number">42501</span> <span class="token operator">---</span> <span class="token punctuation">[</span>ntainer#<span class="token number">0</span><span class="token operator">-</span><span class="token number">0</span><span class="token operator">-</span>C<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> c<span class="token punctuation">.</span>i<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>MetricConsumer        <span class="token punctuation">:</span> æ¶ˆè´¹kafkaä¸­çš„æ•°æ®<span class="token punctuation">:</span><span class="token function">Metric</span><span class="token punctuation">(</span>hostname<span class="token operator">=</span>NODE<span class="token operator">-</span><span class="token number">82</span><span class="token punctuation">,</span> total<span class="token operator">=</span><span class="token number">2797</span><span class="token punctuation">,</span> succCnt<span class="token operator">=</span><span class="token number">3004</span><span class="token punctuation">,</span> succRate<span class="token operator">=</span><span class="token number">1.0740079</span><span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>T21<span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">16.654</span><span class="token punctuation">,</span> tags<span class="token operator">={</span>mem_util<span class="token operator">=</span><span class="token number">87.53287</span><span class="token punctuation">,</span> cpu_util<span class="token operator">=</span><span class="token number">53.029602</span><span class="token operator">}</span><span class="token punctuation">)</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">19.671</span>  INFO <span class="token number">42501</span> <span class="token operator">---</span> <span class="token punctuation">[</span>ntainer#<span class="token number">0</span><span class="token operator">-</span><span class="token number">0</span><span class="token operator">-</span>C<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> c<span class="token punctuation">.</span>i<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>MetricConsumer        <span class="token punctuation">:</span> æ¶ˆè´¹kafkaä¸­çš„æ•°æ®<span class="token punctuation">:</span><span class="token function">Metric</span><span class="token punctuation">(</span>hostname<span class="token operator">=</span>NODE<span class="token operator">-</span><span class="token number">102</span><span class="token punctuation">,</span> total<span class="token operator">=</span><span class="token number">3232</span><span class="token punctuation">,</span> succCnt<span class="token operator">=</span><span class="token number">3041</span><span class="token punctuation">,</span> succRate<span class="token operator">=</span><span class="token number">0.9409035</span><span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>T21<span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">19.664</span><span class="token punctuation">,</span> tags<span class="token operator">={</span>mem_util<span class="token operator">=</span><span class="token number">87.7293</span><span class="token punctuation">,</span> cpu_util<span class="token operator">=</span><span class="token number">51.062298</span><span class="token operator">}</span><span class="token punctuation">)</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">22.679</span>  INFO <span class="token number">42501</span> <span class="token operator">---</span> <span class="token punctuation">[</span>ntainer#<span class="token number">0</span><span class="token operator">-</span><span class="token number">0</span><span class="token operator">-</span>C<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> c<span class="token punctuation">.</span>i<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>MetricConsumer        <span class="token punctuation">:</span> æ¶ˆè´¹kafkaä¸­çš„æ•°æ®<span class="token punctuation">:</span><span class="token function">Metric</span><span class="token punctuation">(</span>hostname<span class="token operator">=</span>NODE<span class="token operator">-</span><span class="token number">173</span><span class="token punctuation">,</span> total<span class="token operator">=</span><span class="token number">904</span><span class="token punctuation">,</span> succCnt<span class="token operator">=</span><span class="token number">759</span><span class="token punctuation">,</span> succRate<span class="token operator">=</span><span class="token number">0.83960176</span><span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>T21<span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">22.672</span><span class="token punctuation">,</span> tags<span class="token operator">={</span>mem_util<span class="token operator">=</span><span class="token number">3.923422</span><span class="token punctuation">,</span> cpu_util<span class="token operator">=</span><span class="token number">36.679466</span><span class="token operator">}</span><span class="token punctuation">)</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">25.685</span>  INFO <span class="token number">42501</span> <span class="token operator">---</span> <span class="token punctuation">[</span>ntainer#<span class="token number">0</span><span class="token operator">-</span><span class="token number">0</span><span class="token operator">-</span>C<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> c<span class="token punctuation">.</span>i<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>MetricConsumer        <span class="token punctuation">:</span> æ¶ˆè´¹kafkaä¸­çš„æ•°æ®<span class="token punctuation">:</span><span class="token function">Metric</span><span class="token punctuation">(</span>hostname<span class="token operator">=</span>NODE<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> total<span class="token operator">=</span><span class="token number">2250</span><span class="token punctuation">,</span> succCnt<span class="token operator">=</span><span class="token number">8072</span><span class="token punctuation">,</span> succRate<span class="token operator">=</span><span class="token number">3.5875556</span><span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>T21<span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">25.681</span><span class="token punctuation">,</span> tags<span class="token operator">={</span>mem_util<span class="token operator">=</span><span class="token number">71.37522</span><span class="token punctuation">,</span> cpu_util<span class="token operator">=</span><span class="token number">2.6286244</span><span class="token operator">}</span><span class="token punctuation">)</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">28.696</span>  INFO <span class="token number">42501</span> <span class="token operator">---</span> <span class="token punctuation">[</span>ntainer#<span class="token number">0</span><span class="token operator">-</span><span class="token number">0</span><span class="token operator">-</span>C<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> c<span class="token punctuation">.</span>i<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>MetricConsumer        <span class="token punctuation">:</span> æ¶ˆè´¹kafkaä¸­çš„æ•°æ®<span class="token punctuation">:</span><span class="token function">Metric</span><span class="token punctuation">(</span>hostname<span class="token operator">=</span>NODE<span class="token operator">-</span><span class="token number">87</span><span class="token punctuation">,</span> total<span class="token operator">=</span><span class="token number">2798</span><span class="token punctuation">,</span> succCnt<span class="token operator">=</span><span class="token number">3955</span><span class="token punctuation">,</span> succRate<span class="token operator">=</span><span class="token number">1.4135096</span><span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>T21<span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">28.689</span><span class="token punctuation">,</span> tags<span class="token operator">={</span>mem_util<span class="token operator">=</span><span class="token number">98.27863</span><span class="token punctuation">,</span> cpu_util<span class="token operator">=</span><span class="token number">23.622477</span><span class="token operator">}</span><span class="token punctuation">)</span></code></pre><p>ä½†æ˜¯å¤§å®¶å‘ç°äº†ä¸€ç‚¹ï¼Œå°±æ˜¯æˆ‘ä»¬çš„<code>topic</code>éƒ½æ˜¯å†™æ­»åœ¨ç¨‹åºé‡Œé¢çš„ï¼Œä¸èƒ½åŠ¨æ€ä¼ é€’è¯»å–é…ç½®æ–‡ä»¶ï¼Œè¿™æ ·çš„è‚¯å®šæ˜¯ä¸å¯ä»¥çš„ï¼Œé‚£ä¹ˆå¦‚ä½•åŠ¨æ€é…ç½®åˆæ˜¯ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œæœ‰äººå¯èƒ½ä¼šè¯´è¿™é‡Œä½¿ç”¨<code>@Value</code>è¿›è¡Œæ³¨å…¥ï¼Œä½†æ˜¯å®é™…è¿™æ ·æ˜¯ç¼–è¯‘ä¸è¿‡å»çš„ï¼Œå› ä¸ºæ³¨è§£å±æ€§çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªconstantï¼Œè§£å†³æ–¹æ³•å°±æ˜¯ä½¿ç”¨<code>SPEL</code>è¡¨è¾¾å¼</p><p>Issuesåœ°å€ï¼š<a href="https://github.com/spring-projects/spring-kafka/issues/361">åŠ¨æ€é…ç½®å¤šä¸ªtopic</a></p><p>ä¿®æ”¹ä»¥åçš„ä»£ç </p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>consumer<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>common<span class="token punctuation">.</span>util<span class="token punctuation">.</span>JsonParse<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span>Metric<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>ConsumerRecord<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>KafkaListener<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Component<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Optional<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020-01-07. * &lt;p> * åŠ¨æ€é…ç½®å¤šä¸ªtopic * * https://github.com/spring-projects/spring-kafka/issues/361 */</span><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MetricConsumer</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * æ³¨æ„è¿™é‡Œçš„topicé…ç½®     * å½“ç„¶groupIdä¹Ÿå¯ä»¥ä½¿ç”¨SPELè¡¨è¾¾ä¹¦è¿›è¡Œé…ç½®ï¼Œè¿™é‡Œå°±ä¸åœ¨èµ˜è¿°     *     * @param record     */</span>    <span class="token annotation punctuation">@KafkaListener</span><span class="token punctuation">(</span>topics <span class="token operator">=</span> <span class="token string">"#{'${kafka.producer.topic}'}"</span><span class="token punctuation">,</span> groupId <span class="token operator">=</span> <span class="token string">"metric-group"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">event</span><span class="token punctuation">(</span>ConsumerRecord<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> record<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> kafkaMessage <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        kafkaMessage<span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>x <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>            Metric metric <span class="token operator">=</span> JsonParse<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> Metric<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆè´¹kafkaä¸­çš„æ•°æ®:{}"</span><span class="token punctuation">,</span> metric<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ä¿®æ”¹å®Œæˆï¼Œé‡å¯è¿›ç¨‹ï¼ŒæŸ¥çœ‹ä¾æ—§å¯ä»¥æ­£å¸¸æ¶ˆè´¹åˆ°æ•°æ®ï¼Œå¹¶ä¸”topicæ˜¯åŠ¨æ€é…ç½®çš„ï¼Œå¦‚æœéœ€è¦é…ç½®å¤šä¸ªä½¿ç”¨spiltè¿›è¡Œåˆ†å‰²å³å¯</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†Spring Bootä¸kafka çš„æ•´åˆï¼Œæ—¥å¸¸å¼€å‘ä¸­é™¤äº†kafkaè¿˜æœ‰å…¶ä»–çš„å„ç§æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œæ•´åˆæ–¹å¼å¤§åŒå°å¼‚ï¼Œæ¯•ç«ŸSpring Bootå·²ç»å¸®æˆ‘ä»¬å°è£…çš„å¾ˆå¥½äº†ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„å°±æ˜¯æ³¨è§£å±æ€§çš„åŠ¨æ€æ³¨å…¥ï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨SPELè¡¨è¾¾å¼ã€‚</p><p>å®Œæ•´ä»£ç ï¼š<a href="https://github.com/xiaomozhang/personal-life-example/tree/master/example-kafka">https://github.com/xiaomozhang/personal-life-example/tree/master/example-kafka</a></p>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Boot </tag>
            
            <tag> Kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Boot ä½¿ç”¨jpaå’ŒH2æ•°æ®åº“</title>
      <link href="2020/01/05/spring-boot-jpa-h2/"/>
      <url>2020/01/05/spring-boot-jpa-h2/</url>
      
        <content type="html"><![CDATA[<p>æ—¥å¸¸æµ‹è¯•æ—¶æ²¡æœ‰æ•°æ®åº“å¯ç”¨æ—¶ï¼Œä½¿ç”¨H2ä¸å¤±ä¸ºä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œè€Œä¸”H2ä¹Ÿç»å¸¸ç”¨åœ¨æŒä¹…å±‚çš„å•å…ƒæµ‹è¯•ï¼ŒSpring Bootä¸­ä½¿ç”¨H2ä¹Ÿå¾ˆç®€å•ï¼Œåªè¦ä¸€äº›é…ç½®å³å¯ã€‚</p><h2 id="é¡¹ç›®ç»“æ„ä¸pom-xml"><a href="#é¡¹ç›®ç»“æ„ä¸pom-xml" class="headerlink" title="é¡¹ç›®ç»“æ„ä¸pom.xml"></a>é¡¹ç›®ç»“æ„ä¸pom.xml</h2><p>å…ˆçœ‹çœ‹æ•´ä½“çš„é¡¹ç›®ç»“æ„</p><pre class=" language-shell"><code class="language-shell">âœ  example-h2 git:(master) âœ— tree /Users/xiaozhangge/share/life-example/example-h2/Users/xiaozhangge/share/life-example/example-h2â”œâ”€â”€ example-h2.imlâ”œâ”€â”€ pom.xmlâ””â”€â”€ src    â”œâ”€â”€ main    â”‚&nbsp;&nbsp; â”œâ”€â”€ java    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp; â””â”€â”€ com    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â””â”€â”€ example    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;         â””â”€â”€ h2    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;             â”œâ”€â”€ H2DbApplication.java    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;             â”œâ”€â”€ entity    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;             â”‚&nbsp;&nbsp; â””â”€â”€ UserEntity.java    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;             â””â”€â”€ repository    â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;                 â””â”€â”€ UserRepository.java    â”‚&nbsp;&nbsp; â””â”€â”€ resources    â”‚&nbsp;&nbsp;     â”œâ”€â”€ application.yml    â”‚&nbsp;&nbsp;     â””â”€â”€ db    â”‚&nbsp;&nbsp;         â”œâ”€â”€ data.sql    â”‚&nbsp;&nbsp;         â””â”€â”€ schema.sql    â””â”€â”€ test        â””â”€â”€ java            â””â”€â”€ com                â””â”€â”€ xiaozhange                    â””â”€â”€ h2                        â””â”€â”€ H2DbApplicationTests.java15 directories, 9 files</code></pre><p>è¿™é‡Œä½¿ç”¨H2æ•°æ®ï¼Œä¸ºäº†æ–¹ä¾¿æµ‹è¯•ä¹Ÿä½¿ç”¨jpaè¿›è¡Œæ•°æ®åº“æ“ä½œï¼Œç¬¬ä¸€æ­¥è‚¯å®šæ˜¯éœ€è¦å¼•å…¥mavenä¾èµ–</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-jpa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.h2database<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>h2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><h2 id="åˆ›å»ºæ•°æ®åº“è„šæœ¬ä¸åˆå§‹åŒ–æ•°æ®è„šæœ¬"><a href="#åˆ›å»ºæ•°æ®åº“è„šæœ¬ä¸åˆå§‹åŒ–æ•°æ®è„šæœ¬" class="headerlink" title="åˆ›å»ºæ•°æ®åº“è„šæœ¬ä¸åˆå§‹åŒ–æ•°æ®è„šæœ¬"></a>åˆ›å»ºæ•°æ®åº“è„šæœ¬ä¸åˆå§‹åŒ–æ•°æ®è„šæœ¬</h2><ul><li>schema.sql</li></ul><pre class=" language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> user_info<span class="token punctuation">(</span>  id       <span class="token keyword">bigint</span> <span class="token keyword">auto_increment</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>  name     <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>                      <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>  birthday <span class="token keyword">datetime</span>                          <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>  remark   <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>data.sql</li></ul><pre class=" language-sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> user_info<span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'å°å¼ å“¥'</span><span class="token punctuation">,</span> <span class="token string">'2020-01-05 15:40:00'</span><span class="token punctuation">,</span> <span class="token string">'å“ˆå“ˆå“ˆ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8081</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>h2<span class="token punctuation">:</span>mem<span class="token punctuation">:</span>h2<span class="token punctuation">-</span>test;DB_CLOSE_DELAY=<span class="token punctuation">-</span>1;DB_CLOSE_ON_EXIT=FALSE    <span class="token key atrule">username</span><span class="token punctuation">:</span> sa    <span class="token key atrule">password</span><span class="token punctuation">:</span>    <span class="token key atrule">platform</span><span class="token punctuation">:</span> h2    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> org.h2.Driver    <span class="token key atrule">hikari</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># http://blog.didispace.com/Springboot-2-0-HikariCP-default-reason/</span>      <span class="token key atrule">minimum-idle</span><span class="token punctuation">:</span> <span class="token number">5</span>      <span class="token key atrule">maximum-pool-size</span><span class="token punctuation">:</span> <span class="token number">20</span>      <span class="token key atrule">auto-commit</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>      <span class="token key atrule">idle-timeout</span><span class="token punctuation">:</span> <span class="token number">30000</span>      <span class="token key atrule">pool-name</span><span class="token punctuation">:</span> H2HikariCP      <span class="token key atrule">max-lifetime</span><span class="token punctuation">:</span> <span class="token number">1800000</span>      <span class="token key atrule">connection-timeout</span><span class="token punctuation">:</span> <span class="token number">30000</span>      <span class="token key atrule">connection-test-query</span><span class="token punctuation">:</span> SELECT 1    <span class="token key atrule">schema</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>db/schema.sql    <span class="token key atrule">data</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>db/data.sql  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>    <span class="token key atrule">database-platform</span><span class="token punctuation">:</span> org.hibernate.dialect.H2Dialect    <span class="token key atrule">show-sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>      <span class="token key atrule">ddl-auto</span><span class="token punctuation">:</span> update    <span class="token key atrule">properties</span><span class="token punctuation">:</span>      <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>        <span class="token key atrule">use_sql_comments</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>        <span class="token key atrule">format_sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">h2</span><span class="token punctuation">:</span>    <span class="token key atrule">console</span><span class="token punctuation">:</span>      <span class="token comment" spellcheck="true"># è¿›è¡Œè¯¥é…ç½®ï¼Œç¨‹åºå¼€å¯æ—¶å°±ä¼šå¯åŠ¨h2 web consoleã€‚å½“ç„¶è¿™æ˜¯é»˜è®¤çš„ï¼Œå¦‚æœä½ ä¸æƒ³åœ¨å¯åŠ¨ç¨‹åºæ—¶å¯åŠ¨h2 web consoleï¼Œé‚£ä¹ˆå°±è®¾ç½®ä¸ºfalseã€‚</span>      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>      <span class="token comment" spellcheck="true"># è¿›è¡Œè¯¥é…ç½®ï¼Œä½ å°±å¯ä»¥é€šè¿‡ URL/h2-consoleè®¿é—®h2 web consoleã€‚</span>      <span class="token key atrule">path</span><span class="token punctuation">:</span> /h2<span class="token punctuation">-</span>console      <span class="token key atrule">settings</span><span class="token punctuation">:</span>        <span class="token key atrule">trace</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>        <span class="token comment" spellcheck="true"># è¿›è¡Œè¯¥é…ç½®åï¼Œh2 web console å°±å¯ä»¥åœ¨è¿œç¨‹è®¿é—®äº†ã€‚å¦åˆ™åªèƒ½åœ¨æœ¬æœºè®¿é—®ã€‚</span>        <span class="token key atrule">web-allow-others</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></code></pre><p><code>application.yml</code>ä¸­ï¼Œåˆ†åˆ«æœ‰datasourceã€jpaã€h2ç­‰é…ç½®</p><h3 id="datasouce"><a href="#datasouce" class="headerlink" title="datasouce"></a>datasouce</h3><p>å…¶ä¸­<code>url</code>ä½¿ç”¨äº†h2çš„é…ç½®è¿æ¥å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”ä½¿ç”¨äº†<code>hikari</code>æ•°æ®åº“è¿æ¥æ± ï¼Œè¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹<a href="http://blog.didispace.com/Springboot-2-0-HikariCP-default-reason/">Springboot 2.0é€‰æ‹©HikariCPä½œä¸ºé»˜è®¤æ•°æ®åº“è¿æ¥æ± çš„äº”å¤§ç†ç”±</a></p><h3 id="jpa"><a href="#jpa" class="headerlink" title="jpa"></a>jpa</h3><p>jpaä¸­é…ç½®äº†æ•°æ®åº“æ–¹è¨€<code>database-platform</code>ï¼Œæ˜¾ç¤ºsqlç­‰é…ç½®</p><h3 id="h2"><a href="#h2" class="headerlink" title="h2"></a>h2</h3><p><code>spring.datasource.schema=classpath:db/schema.sql</code>è¿›è¡Œè¯¥é…ç½®åï¼Œæ¯æ¬¡å¯åŠ¨ç¨‹åºï¼Œç¨‹åºéƒ½ä¼šè¿è¡Œ<code>resources/db/schema.sql</code>æ–‡ä»¶ï¼Œå¯¹æ•°æ®åº“çš„ç»“æ„è¿›è¡Œæ“ä½œã€‚</p><p><code>spring.datasource.data=classpath:db/data.sql</code>è¿›è¡Œè¯¥é…ç½®åï¼Œæ¯æ¬¡å¯åŠ¨ç¨‹åºï¼Œç¨‹åºéƒ½ä¼šè¿è¡Œ<code>resources/db/data.sql</code>æ–‡ä»¶ï¼Œå¯¹æ•°æ®åº“çš„æ•°æ®æ“ä½œã€‚</p><h4 id="h2-web-consoleé…ç½®"><a href="#h2-web-consoleé…ç½®" class="headerlink" title="h2 web consoleé…ç½®"></a>h2 web consoleé…ç½®</h4><p><code>h2 web console</code>æ˜¯ä¸€ä¸ªæ•°æ®åº“<code>GUI</code>ç®¡ç†åº”ç”¨ï¼Œå°±å’Œ<code>phpMyAdmin</code>ç±»ä¼¼ã€‚ç¨‹åºè¿è¡Œæ—¶ï¼Œä¼šè‡ªåŠ¨å¯åŠ¨<code>h2 web console</code>ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥è¿›è¡Œå¦‚ä¸‹çš„é…ç½®ã€‚</p><ul><li><code>spring.h2.console.settings.web-allow-others=true</code>ï¼Œè¿›è¡Œè¯¥é…ç½®åï¼Œ<code>h2 web console</code>å°±å¯ä»¥åœ¨è¿œç¨‹è®¿é—®äº†ã€‚å¦åˆ™åªèƒ½åœ¨æœ¬æœºè®¿é—®ã€‚</li><li><code>spring.h2.console.path=/h2-console</code>ï¼Œè¿›è¡Œè¯¥é…ç½®ï¼Œä½ å°±å¯ä»¥é€šè¿‡ <code>URL/h2-console</code>è®¿é—®<code>h2 web console</code>ã€‚</li><li><code>spring.h2.console.enabled=true</code>ï¼Œè¿›è¡Œè¯¥é…ç½®ï¼Œç¨‹åºå¼€å¯æ—¶å°±ä¼šå¯åŠ¨<code>h2 web console</code>ã€‚å½“ç„¶è¿™æ˜¯é»˜è®¤çš„ï¼Œå¦‚æœä½ ä¸æƒ³åœ¨å¯åŠ¨ç¨‹åºæ—¶å¯åŠ¨<code>h2 web console</code>ï¼Œé‚£ä¹ˆå°±è®¾ç½®ä¸ºfalseã€‚</li></ul><h2 id="å®ä½“ç±»"><a href="#å®ä½“ç±»" class="headerlink" title="å®ä½“ç±»"></a>å®ä½“ç±»</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>h2<span class="token punctuation">.</span>entity<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>AllArgsConstructor<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>Data<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>NoArgsConstructor<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span>Column<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span>Entity<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span>Id<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span>Table<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Serializable<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalDateTime<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020-01-05. */</span><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@Entity</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"user_info"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserEntity</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Id</span>    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"birthday"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> LocalDateTime birthday<span class="token punctuation">;</span>    <span class="token keyword">private</span> String remark<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">UserEntity</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> LocalDateTime birthday<span class="token punctuation">,</span> String remark<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>birthday <span class="token operator">=</span> birthday<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>remark <span class="token operator">=</span> remark<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="repository"><a href="#repository" class="headerlink" title="repository"></a>repository</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>h2<span class="token punctuation">.</span>repository<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>h2<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>UserEntity<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>JpaRepository<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020-01-05. */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token operator">&lt;</span>UserEntity<span class="token punctuation">,</span> Long<span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ç»“æœï¼Œå†™ä¸€ä¸ªæµ‹è¯•ç±»æŸ¥çœ‹ç»“æœ</p><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>h2<span class="token punctuation">.</span>H2DbApplication<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>h2<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>UserEntity<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>h2<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>UserRepository<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Ignore<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span>RunWith<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>SpringBootTest<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>SpringRunner<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalDateTime<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Optional<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>UUID<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020-01-05. */</span><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@Ignore</span><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>SpringRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>classes <span class="token operator">=</span> H2DbApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">H2DbApplicationTests</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> UserRepository userRepository<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// æ–°å¢æ•°æ®</span>        UserEntity entity <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserEntity</span><span class="token punctuation">(</span><span class="token string">"é˜¿ç‰›"</span> <span class="token operator">+</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"æ–°å¢æµ‹è¯•"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ–°å¢ç»“æœ:{}\n"</span><span class="token punctuation">,</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// ä¿®æ”¹æ•°æ®</span>        entity <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserEntity</span><span class="token punctuation">(</span>1L<span class="token punctuation">,</span> <span class="token string">"å“ˆå“ˆå“ˆå“ˆ"</span><span class="token punctuation">,</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"ä¿®æ”¹ä»¥åçš„ç»“æœ"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æŒ‰ç…§idä¿®æ”¹ç»“æœ:{}\n"</span><span class="token punctuation">,</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// æŒ‰ç…§idæŸ¥è¯¢</span>        Optional<span class="token operator">&lt;</span>UserEntity<span class="token operator">></span> optional <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>1L<span class="token punctuation">)</span><span class="token punctuation">;</span>        optional<span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>x <span class="token operator">-</span><span class="token operator">></span> log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æŒ‰ç…§idæŸ¥è¯¢ç»“æœ:{}\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// æŸ¥è¯¢æ‰€æœ‰</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æŸ¥è¯¢æ‰€æœ‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Iterable<span class="token operator">&lt;</span>UserEntity<span class="token operator">></span> iterable <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        iterable<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>x <span class="token operator">-</span><span class="token operator">></span> log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"item:{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// åˆ é™¤æ•°æ®</span>        userRepository<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>1L<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// åˆ é™¤id=1çš„æ•°æ®ä»¥å</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"åˆ é™¤id=1çš„æ•°æ®ä»¥å"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        iterable <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        iterable<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>x <span class="token operator">-</span><span class="token operator">></span> log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"item:{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æµ‹è¯•ç»“æœå¦‚ä¸‹</p><pre class=" language-shell"><code class="language-shell">2020-01-05 18:07:40.499  INFO 28214 --- [           main] com.xiaozhangge.h2.H2DbApplicationTests     : æ–°å¢ç»“æœ:UserEntity(id=2, name=é˜¿ç‰›33dc0a6d-29cd-4e79-9ae4-ad64b1588e69, birthday=2020-01-05T18:07:40.383, remark=æ–°å¢æµ‹è¯•)2020-01-05 18:07:40.527  INFO 28214 --- [           main] com.xiaozhangge.h2.H2DbApplicationTests     : æŒ‰ç…§idä¿®æ”¹ç»“æœ:UserEntity(id=1, name=å“ˆå“ˆå“ˆå“ˆ, birthday=2020-01-05T18:07:40.500, remark=ä¿®æ”¹ä»¥åçš„ç»“æœ)2020-01-05 18:07:40.578  INFO 28214 --- [           main] com.xiaozhangge.h2.H2DbApplicationTests     : æŒ‰ç…§idæŸ¥è¯¢ç»“æœ:UserEntity(id=1, name=å“ˆå“ˆå“ˆå“ˆ, birthday=2020-01-05T18:07:40.500, remark=ä¿®æ”¹ä»¥åçš„ç»“æœ)2020-01-05 18:07:40.578  INFO 28214 --- [           main] com.xiaozhangge.h2.H2DbApplicationTests     : æŸ¥è¯¢æ‰€æœ‰2020-01-05 18:07:40.586  INFO 28214 --- [           main] com.xiaozhangge.h2.H2DbApplicationTests     : item:UserEntity(id=1, name=å“ˆå“ˆå“ˆå“ˆ, birthday=2020-01-05T18:07:40.500, remark=ä¿®æ”¹ä»¥åçš„ç»“æœ)2020-01-05 18:07:40.586  INFO 28214 --- [           main] com.xiaozhangge.h2.H2DbApplicationTests     : item:UserEntity(id=2, name=é˜¿ç‰›33dc0a6d-29cd-4e79-9ae4-ad64b1588e69, birthday=2020-01-05T18:07:40.383, remark=æ–°å¢æµ‹è¯•)2020-01-05 18:07:40.602  INFO 28214 --- [           main] com.xiaozhangge.h2.H2DbApplicationTests     : åˆ é™¤id=1çš„æ•°æ®ä»¥å2020-01-05 18:07:40.604  INFO 28214 --- [           main] com.xiaozhangge.h2.H2DbApplicationTests     : item:UserEntity(id=2, name=é˜¿ç‰›33dc0a6d-29cd-4e79-9ae4-ad64b1588e69, birthday=2020-01-05T18:07:40.383, remark=æ–°å¢æµ‹è¯•)</code></pre><h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><p><a href="https://github.com/xiaozhangge/life-example/tree/master/example-h2">https://github.com/xiaozhangge/life-example/tree/master/example-h2</a></p>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8 å¤„ç†å¸¸è§çš„æ—¥æœŸå‘¨æœŸ</title>
      <link href="2020/01/04/java8-date-cycle/"/>
      <url>2020/01/04/java8-date-cycle/</url>
      
        <content type="html"><![CDATA[<p>æ—¥å¸¸å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šæœ‰è·å–å‘¨ã€æœˆã€å­£åº¦çš„å¼€å§‹å’Œç»“æŸæ—¶é—´çš„éœ€æ±‚ï¼ŒJava8ä¹‹å‰çš„dateç±»å’ŒCalendarç»“åˆä¹Ÿå¯ä»¥å®ç°ï¼Œä½†æ˜¯è¿˜æ˜¯æ¯”è¾ƒå¤æ‚ï¼Œä¸‹é¢ä½¿ç”¨Java8çš„æ—¥æœŸapiè·å–å‘¨æœˆå­£çš„å‘¨æœŸã€‚</p><h2 id="è·å–å½“å‰æ˜¯å‘¨å‡ "><a href="#è·å–å½“å‰æ˜¯å‘¨å‡ " class="headerlink" title="è·å–å½“å‰æ˜¯å‘¨å‡ "></a>è·å–å½“å‰æ˜¯å‘¨å‡ </h2><pre class=" language-java"><code class="language-java">LocalDateTime now <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>now<span class="token punctuation">.</span><span class="token function">getDayOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è¾“å‡ºç»“æœ</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span>04T14<span class="token operator">:</span><span class="token number">07</span><span class="token operator">:</span><span class="token number">15.870</span><span class="token number">6</span></code></pre><h2 id="è·å–å½“å‰å‘¨çš„å¼€å§‹å’Œç»“æŸæ—¶é—´"><a href="#è·å–å½“å‰å‘¨çš„å¼€å§‹å’Œç»“æŸæ—¶é—´" class="headerlink" title="è·å–å½“å‰å‘¨çš„å¼€å§‹å’Œç»“æŸæ—¶é—´"></a>è·å–å½“å‰å‘¨çš„å¼€å§‹å’Œç»“æŸæ—¶é—´</h2><pre class=" language-java"><code class="language-java">LocalDateTime now <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´:"</span> <span class="token operator">+</span> now <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å½“å‰æ—¶é—´å‡å»ä»Šå¤©æ˜¯å‘¨å‡ ()</span>LocalDateTime startTime <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">minusDays</span><span class="token punctuation">(</span>now<span class="token punctuation">.</span><span class="token function">getDayOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å½“å‰æ—¶é—´åŠ ä¸Šï¼ˆ8-ä»Šå¤©å‘¨å‡ ï¼‰</span>LocalDateTime endTime <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">plusDays</span><span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">-</span> now<span class="token punctuation">.</span><span class="token function">getDayOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æœ¬å‘¨å¼€å§‹æ—¶é—´:"</span> <span class="token operator">+</span> startTime<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æœ¬å‘¨ç»“æŸæ—¶é—´:"</span> <span class="token operator">+</span> endTime<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è¾“å‡ºç»“æœ</span>å½“å‰æ—¶é—´<span class="token operator">:</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span>04T14<span class="token operator">:</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">56.110</span>æœ¬å‘¨å¼€å§‹æ—¶é—´<span class="token operator">:</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span>29T14<span class="token operator">:</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">56.110</span>æœ¬å‘¨ç»“æŸæ—¶é—´<span class="token operator">:</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span>06T14<span class="token operator">:</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">56.110</span></code></pre><p>ä½†æ˜¯å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œä»¥ä¸Šè·å–åˆ°çš„ç»“æœä¸€å‘¨å¼€å§‹æ˜¯ä»å‘¨å¤©å¼€å§‹çš„ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬æ—¥å¸¸çš„ä¹ æƒ¯ä»å‘¨ä¸€å¼€å§‹ï¼Œé‚£ä¹ˆè¦ä»å‘¨ä¸€å¼€å§‹å¯ä»¥ä½¿ç”¨<code>WeekFields</code>è®¾ç½®ä¸€å‘¨çš„å¼€å§‹æ˜¯å‘¨å‡ </p><pre class=" language-java"><code class="language-java">LocalDateTime now <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´:"</span> <span class="token operator">+</span> now <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ä½¿ç”¨WeekFieldsè®¾ç½®ä¸€å‘¨çš„å¼€å§‹ä¸ºå‘¨ä¸€</span>TemporalField fieldISO <span class="token operator">=</span> WeekFields<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>DayOfWeek<span class="token punctuation">.</span>MONDAY<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dayOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>LocalDateTime startTime <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>fieldISO<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>LocalDateTime endTime <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>fieldISO<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æœ¬å‘¨å¼€å§‹æ—¶é—´:"</span> <span class="token operator">+</span> startTime<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æœ¬å‘¨ç»“æŸæ—¶é—´:"</span> <span class="token operator">+</span> endTime<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è¾“å‡ºç»“æœ</span>å½“å‰æ—¶é—´<span class="token operator">:</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span>04T14<span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">13.176</span>æœ¬å‘¨å¼€å§‹æ—¶é—´<span class="token operator">:</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span>30T14<span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">13.176</span>æœ¬å‘¨ç»“æŸæ—¶é—´<span class="token operator">:</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span>05T14<span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">13.176</span></code></pre><p>ä»¥ä¸Šä¸¤ç§æ–¹å¼å¯ä»¥è·å–åˆ°æœ¬å‘¨çš„å¼€å§‹å’Œç»“æŸæ—¶é—´ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€å‘¨ä»00ç‚¹å¼€å§‹ï¼Œåˆ°23:59:59ç§’ç»“æŸï¼Œåˆè¯¥å¦‚ä½•è®¾ç½®å‘¢ï¼Ÿ</p><p>å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨<code>LocalDateTime</code>å¯¹è±¡çš„ <code>LocalTime</code>å³å¯</p><pre class=" language-java"><code class="language-java">LocalDateTime now <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´:"</span> <span class="token operator">+</span> now <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ä½¿ç”¨WeekFieldsè®¾ç½®ä¸€å‘¨çš„å¼€å§‹ä¸ºå‘¨ä¸€</span>TemporalField fieldISO <span class="token operator">=</span> WeekFields<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>DayOfWeek<span class="token punctuation">.</span>MONDAY<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dayOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è®¾ç½®å¼€å§‹æ—¶é—´ä¸ºLocalTime.MIN</span>LocalDateTime startTime <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>fieldISO<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>LocalTime<span class="token punctuation">.</span>MIN<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è®¾ç½®ç»“æŸæ—¶é—´ä¸ºLocalTime.MAX</span>LocalDateTime endTime <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>fieldISO<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>LocalTime<span class="token punctuation">.</span>MAX<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æœ¬å‘¨å¼€å§‹æ—¶é—´:"</span> <span class="token operator">+</span> startTime<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æœ¬å‘¨ç»“æŸæ—¶é—´:"</span> <span class="token operator">+</span> endTime<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è¾“å‡ºç»“æœ</span>å½“å‰æ—¶é—´<span class="token operator">:</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span>04T14<span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">01.291</span>æœ¬å‘¨å¼€å§‹æ—¶é—´<span class="token operator">:</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span>30T00<span class="token operator">:</span><span class="token number">00</span>æœ¬å‘¨ç»“æŸæ—¶é—´<span class="token operator">:</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span>05T23<span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">59.999999999</span></code></pre><h2 id="è·å–æœ¬æœˆçš„å¼€å§‹å’Œç»“æŸæ—¶é—´"><a href="#è·å–æœ¬æœˆçš„å¼€å§‹å’Œç»“æŸæ—¶é—´" class="headerlink" title="è·å–æœ¬æœˆçš„å¼€å§‹å’Œç»“æŸæ—¶é—´"></a>è·å–æœ¬æœˆçš„å¼€å§‹å’Œç»“æŸæ—¶é—´</h2><p>å¦‚æœä¸éœ€è¦æ—¶é—´å½’åˆ°00ç‚¹å’Œ23:59:59ï¼Œåˆ™ä¸è®¾ç½®<code>LocalTime</code>å³å¯</p><pre class=" language-java"><code class="language-java">LocalDateTime now <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´:"</span> <span class="token operator">+</span> now <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>LocalDateTime startTime <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>TemporalAdjusters<span class="token punctuation">.</span><span class="token function">firstDayOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>LocalTime<span class="token punctuation">.</span>MIN<span class="token punctuation">)</span><span class="token punctuation">;</span>LocalDateTime endTime <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>TemporalAdjusters<span class="token punctuation">.</span><span class="token function">lastDayOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>LocalTime<span class="token punctuation">.</span>MAX<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æœ¬æœˆå¼€å§‹æ—¶é—´:"</span> <span class="token operator">+</span> startTime<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æœ¬æœˆç»“æŸæ—¶é—´:"</span> <span class="token operator">+</span> endTime<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è¾“å‡ºç»“æœ</span>å½“å‰æ—¶é—´<span class="token operator">:</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span>04T14<span class="token operator">:</span><span class="token number">27</span><span class="token operator">:</span><span class="token number">33.706</span>æœ¬æœˆå¼€å§‹æ—¶é—´<span class="token operator">:</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span>01T00<span class="token operator">:</span><span class="token number">00</span>æœ¬æœˆç»“æŸæ—¶é—´<span class="token operator">:</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span>31T23<span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">59.999999999</span></code></pre><h2 id="è·å–ä¸€ä¸ªå­£åº¦çš„å¼€å§‹å’Œç»“æœ"><a href="#è·å–ä¸€ä¸ªå­£åº¦çš„å¼€å§‹å’Œç»“æœ" class="headerlink" title="è·å–ä¸€ä¸ªå­£åº¦çš„å¼€å§‹å’Œç»“æœ"></a>è·å–ä¸€ä¸ªå­£åº¦çš„å¼€å§‹å’Œç»“æœ</h2><p>è·å–å­£åº¦çš„å¼€å§‹å’Œç»“æŸJava8å¹¶æ²¡æœ‰æä¾›ç›´æ¥çš„apiä½¿ç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>TemporalQuery</code>è¿›è¡Œè‡ªå®šä¹‰æŸ¥è¯¢è·å–ï¼Œè€Œä¸”å­£åº¦å’Œæœˆåº¦ä»¥åŠå‘¨æœ‰äº›è®¸ä¸åŒï¼Œæ¯å¹´çš„å­£åº¦å¼€å§‹å’Œç»“æŸéƒ½æ˜¯å›ºå®šçš„</p><ul><li>ä¸€å­£åº¦çš„å§‹ç»ˆæ˜¯æ¯å¹´çš„<code>01.01-03.31</code></li><li>äºŒå­£åº¦çš„å§‹ç»ˆæ˜¯æ¯å¹´çš„<code>04.01-06.30</code></li><li>ä¸‰å­£åº¦çš„å§‹ç»ˆæ˜¯æ¯å¹´çš„<code>07.01-09.30</code></li><li>å››å­£åº¦çš„å§‹ç»ˆæ˜¯æ¯å¹´çš„<code>10.01-12.31</code></li></ul><p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç ï¼Œå…ˆå®šä¹‰äº†ä¸€ä¸ª<code>QuarterCycle</code>ç±»</p><p><code>getQuarterRange</code>æ–¹æ³•ä¸­ä½¿ç”¨äº†<code>Tuple</code>ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿å­˜å‚¨å¼€å§‹å’Œç»“æŸæ—¶é—´ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>LocalDateTime[]</code>å­˜å‚¨ï¼Œå¹¶æ²¡æœ‰ç‰¹æ®Šæ„ä¹‰</p><h3 id="QuarterCycle"><a href="#QuarterCycle" class="headerlink" title="QuarterCycle"></a>QuarterCycle</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> io<span class="token punctuation">.</span>vavr<span class="token punctuation">.</span>Tuple<span class="token punctuation">;</span><span class="token keyword">import</span> io<span class="token punctuation">.</span>vavr<span class="token punctuation">.</span>Tuple2<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalDate<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalDateTime<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalTime<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>Month<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>temporal<span class="token punctuation">.</span>TemporalAccessor<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>temporal<span class="token punctuation">.</span>TemporalQuery<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2020-01-03. */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QuarterCycle</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * å®šä¹‰å››ä¸ªå­£åº¦æšä¸¾å€¼     */</span>    <span class="token keyword">enum</span> QuarterEnum <span class="token punctuation">{</span>        FIRST<span class="token punctuation">,</span> SECOND<span class="token punctuation">,</span> THIRD<span class="token punctuation">,</span> FOURTH    <span class="token punctuation">}</span>    <span class="token keyword">class</span> <span class="token class-name">QuarterOfYearQuery</span> <span class="token keyword">implements</span> <span class="token class-name">TemporalQuery</span><span class="token operator">&lt;</span>QuarterEnum<span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> QuarterEnum <span class="token function">queryFrom</span><span class="token punctuation">(</span>TemporalAccessor temporal<span class="token punctuation">)</span> <span class="token punctuation">{</span>            LocalDate now <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>temporal<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>now<span class="token punctuation">.</span><span class="token function">isBefore</span><span class="token punctuation">(</span>now<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Month<span class="token punctuation">.</span>APRIL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withDayOfMonth</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> QuarterEnum<span class="token punctuation">.</span>FIRST<span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>now<span class="token punctuation">.</span><span class="token function">isBefore</span><span class="token punctuation">(</span>now<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Month<span class="token punctuation">.</span>JULY<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withDayOfMonth</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> QuarterEnum<span class="token punctuation">.</span>SECOND<span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>now<span class="token punctuation">.</span><span class="token function">isBefore</span><span class="token punctuation">(</span>now<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Month<span class="token punctuation">.</span>OCTOBER<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withDayOfMonth</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> QuarterEnum<span class="token punctuation">.</span>THIRD<span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> QuarterEnum<span class="token punctuation">.</span>FOURTH<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * æ ¹æ® LocalDateTime è·å–å­£åº¦     *     * @param dateTime     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getQuarter</span><span class="token punctuation">(</span>LocalDateTime dateTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">getQuarter</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">.</span><span class="token function">toLocalDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * æ ¹æ® LocalDate è·å–å­£åº¦     *     * @param date     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getQuarter</span><span class="token punctuation">(</span>LocalDate date<span class="token punctuation">)</span> <span class="token punctuation">{</span>        TemporalQuery<span class="token operator">&lt;</span>QuarterEnum<span class="token operator">></span> quarterOfYearQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QuarterOfYearQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        QuarterEnum quarter <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>quarterOfYearQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>quarter<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> FIRST<span class="token operator">:</span>                <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> SECOND<span class="token operator">:</span>                <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> THIRD<span class="token operator">:</span>                <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> FOURTH<span class="token operator">:</span>                <span class="token keyword">return</span> <span class="token number">4</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> Tuple2<span class="token operator">&lt;</span>LocalDateTime<span class="token punctuation">,</span> LocalDateTime<span class="token operator">></span> <span class="token function">getQuarterRange</span><span class="token punctuation">(</span>LocalDateTime dateTime<span class="token punctuation">,</span> <span class="token keyword">int</span> quarter<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">getQuarterRange</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">.</span><span class="token function">getYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> quarter<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> Tuple2<span class="token operator">&lt;</span>LocalDateTime<span class="token punctuation">,</span> LocalDateTime<span class="token operator">></span> <span class="token function">getQuarterRange</span><span class="token punctuation">(</span>LocalDate dateTime<span class="token punctuation">,</span> <span class="token keyword">int</span> quarter<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">getQuarterRange</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">.</span><span class="token function">getYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> quarter<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * è·å–æŸå¹´æŸå­£åº¦çš„ç¬¬ä¸€å¤©å’Œæœ€åä¸€å¤©     *     * @param year    å“ªä¸€å¹´     * @param quarter ç¬¬å‡ å­£åº¦     */</span>    <span class="token keyword">public</span> Tuple2<span class="token operator">&lt;</span>LocalDateTime<span class="token punctuation">,</span> LocalDateTime<span class="token operator">></span> <span class="token function">getQuarterRange</span><span class="token punctuation">(</span><span class="token keyword">int</span> year<span class="token punctuation">,</span> <span class="token keyword">int</span> quarter<span class="token punctuation">)</span> <span class="token punctuation">{</span>        LocalDate startDate<span class="token punctuation">,</span> endDate<span class="token punctuation">;</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>quarter<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>                <span class="token comment" spellcheck="true">// 01.01-03.31</span>                startDate <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>year<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                endDate <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>year<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>                <span class="token comment" spellcheck="true">// 04.01-06.30</span>                startDate <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>year<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                endDate <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>year<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>                <span class="token comment" spellcheck="true">// 07.01-09.30</span>                startDate <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>year<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                endDate <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>year<span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>                <span class="token comment" spellcheck="true">// 10.01-12.31</span>                startDate <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>year<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                endDate <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>year<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">default</span><span class="token operator">:</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"quarter range [1-4]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> Tuple<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>startDate<span class="token punctuation">.</span><span class="token function">atTime</span><span class="token punctuation">(</span>LocalTime<span class="token punctuation">.</span>MIN<span class="token punctuation">)</span><span class="token punctuation">,</span> endDate<span class="token punctuation">.</span><span class="token function">atTime</span><span class="token punctuation">(</span>LocalTime<span class="token punctuation">.</span>MAX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="æµ‹è¯•ä»£ç "><a href="#æµ‹è¯•ä»£ç " class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h3><pre class=" language-java"><code class="language-java">QuarterCycle quarterCycle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QuarterCycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>LocalDateTime now <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ—¶é—´:"</span> <span class="token operator">+</span> now <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> quarter <span class="token operator">=</span> quarterCycle<span class="token punctuation">.</span><span class="token function">getQuarter</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å½“å‰å­£åº¦:"</span> <span class="token operator">+</span> quarter <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Tuple2<span class="token operator">&lt;</span>LocalDateTime<span class="token punctuation">,</span> LocalDateTime<span class="token operator">></span> tuple2 <span class="token operator">=</span> quarterCycle<span class="token punctuation">.</span><span class="token function">getQuarterRange</span><span class="token punctuation">(</span>now<span class="token punctuation">,</span> quarter<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å½“å‰å­£åº¦å¼€å§‹å’Œç»“æŸæ—¶é—´:"</span> <span class="token operator">+</span> tuple2 <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è¾“å‡ºç»“æœ</span>å½“å‰æ—¶é—´<span class="token operator">:</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span>04T15<span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">43.949</span>å½“å‰å­£åº¦<span class="token operator">:</span><span class="token number">1</span>å½“å‰å­£åº¦å¼€å§‹å’Œç»“æŸæ—¶é—´<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span>01T00<span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">,</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span>31T23<span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">59.999999999</span><span class="token punctuation">)</span></code></pre><h2 id="å¸¸ç”¨æ–¹æ³•æ•´ç†"><a href="#å¸¸ç”¨æ–¹æ³•æ•´ç†" class="headerlink" title="å¸¸ç”¨æ–¹æ³•æ•´ç†"></a>å¸¸ç”¨æ–¹æ³•æ•´ç†</h2><table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>adjustInto</td><td>è°ƒæ•´æŒ‡å®šçš„Temporalå’Œå½“å‰LocalDateTimeå¯¹</td></tr><tr><td>atOffset</td><td>ç»“åˆLocalDateTimeå’ŒZoneOffsetåˆ›å»ºä¸€ä¸ª</td></tr><tr><td>atZone</td><td>ç»“åˆLocalDateTimeå’ŒæŒ‡å®šæ—¶åŒºåˆ›å»ºä¸€ä¸ªZonedD</td></tr><tr><td>compareTo</td><td>æ¯”è¾ƒä¸¤ä¸ªLocalDateTime</td></tr><tr><td>format</td><td>æ ¼å¼åŒ–LocalDateTimeç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²</td></tr><tr><td>from</td><td>è½¬æ¢TemporalAccessorä¸ºLocalDateTime</td></tr><tr><td>get</td><td>å¾—åˆ°LocalDateTimeçš„æŒ‡å®šå­—æ®µçš„å€¼</td></tr><tr><td>getDayOfMonth</td><td>å¾—åˆ°LocalDateTimeæ˜¯æœˆçš„ç¬¬å‡ å¤©</td></tr><tr><td>getDayOfWeek</td><td>å¾—åˆ°LocalDateTimeæ˜¯æ˜ŸæœŸå‡ </td></tr><tr><td>getDayOfYear</td><td>å¾—åˆ°LocalDateTimeæ˜¯å¹´çš„ç¬¬å‡ å¤©</td></tr><tr><td>getHour</td><td>å¾—åˆ°LocalDateTimeçš„å°æ—¶</td></tr><tr><td>getLong</td><td>å¾—åˆ°LocalDateTimeæŒ‡å®šå­—æ®µçš„å€¼</td></tr><tr><td>getMinute</td><td>å¾—åˆ°LocalDateTimeçš„åˆ†é’Ÿ</td></tr><tr><td>getMonth</td><td>å¾—åˆ°LocalDateTimeçš„æœˆä»½</td></tr><tr><td>getMonthValue</td><td>å¾—åˆ°LocalDateTimeçš„æœˆä»½ï¼Œä»1åˆ°12</td></tr><tr><td>getNano</td><td>å¾—åˆ°LocalDateTimeçš„çº³ç§’æ•°</td></tr><tr><td>getSecond</td><td>å¾—åˆ°LocalDateTimeçš„ç§’æ•°</td></tr><tr><td>getYear</td><td>å¾—åˆ°LocalDateTimeçš„å¹´ä»½</td></tr><tr><td>isAfter</td><td>åˆ¤æ–­LocalDateTimeæ˜¯å¦åœ¨æŒ‡å®šLocalDateTimeä¹‹å</td></tr><tr><td>isBefore</td><td>åˆ¤æ–­LocalDateTimeæ˜¯å¦åœ¨æŒ‡å®šLocalDateTimeä¹‹å‰</td></tr><tr><td>isEqual</td><td>åˆ¤æ–­ä¸¤ä¸ªLocalDateTimeæ˜¯å¦ç›¸ç­‰</td></tr><tr><td>isSupported</td><td>åˆ¤æ–­LocalDateTimeæ˜¯å¦æ”¯æŒæŒ‡å®šæ—¶é—´å­—æ®µæˆ–å•å…ƒ</td></tr><tr><td>minus</td><td>è¿”å›LocalDateTimeå‡å»æŒ‡å®šæ•°é‡çš„æ—¶é—´å¾—åˆ°çš„å€¼</td></tr><tr><td>minusDays</td><td>è¿”å›LocalDateTimeå‡å»æŒ‡å®šå¤©æ•°å¾—åˆ°çš„å€¼</td></tr><tr><td>minusHours</td><td>è¿”å›LocalDateTimeå‡å»æŒ‡å®šå°æ—¶æ•°å¾—åˆ°çš„å€¼</td></tr><tr><td>minusMinutes</td><td>è¿”å›LocalDateTimeå‡å»æŒ‡å®šåˆ†é’Ÿæ•°å¾—åˆ°çš„å€¼</td></tr><tr><td>minusMonths</td><td>è¿”å›LocalDateTimeå‡å»æŒ‡å®šæœˆæ•°å¾—åˆ°çš„å€¼</td></tr><tr><td>minusNanos</td><td>è¿”å›LocalDateTimeå‡å»æŒ‡å®šçº³ç§’æ•°å¾—åˆ°çš„å€¼</td></tr><tr><td>minusSeconds</td><td>è¿”å›LocalDateTimeå‡å»æŒ‡å®šç§’æ•°å¾—åˆ°çš„å€¼</td></tr><tr><td>minusWeeks</td><td>è¿”å›LocalDateTimeå‡å»æŒ‡å®šæ˜ŸæœŸæ•°å¾—åˆ°çš„å€¼</td></tr><tr><td>minusYears</td><td>è¿”å›LocalDateTimeå‡å»æŒ‡å®šå¹´æ•°å¾—åˆ°çš„å€¼</td></tr><tr><td>now</td><td>è¿”å›æŒ‡å®šæ—¶é’Ÿçš„å½“å‰LocalDateTime</td></tr><tr><td>of</td><td>æ ¹æ®å¹´ã€æœˆã€æ—¥ã€æ—¶ã€åˆ†ã€ç§’ã€çº³ç§’ç­‰åˆ›å»ºLocalDateTime</td></tr><tr><td>ofEpochSecond</td><td>æ ¹æ®ç§’æ•°(ä»1970-01-0100:00:00å¼€å§‹)åˆ›å»ºLocalDateTime</td></tr><tr><td>ofInstant</td><td>æ ¹æ®Instantå’ŒZoneIdåˆ›å»ºLocalDateTime</td></tr><tr><td>parse</td><td>è§£æå­—ç¬¦ä¸²å¾—åˆ°LocalDateTime</td></tr><tr><td>plus</td><td>è¿”å›LocalDateTimeåŠ ä¸ŠæŒ‡å®šæ•°é‡çš„æ—¶é—´å¾—åˆ°çš„å€¼</td></tr><tr><td>plusDays</td><td>è¿”å›LocalDateTimeåŠ ä¸ŠæŒ‡å®šå¤©æ•°å¾—åˆ°çš„å€¼</td></tr><tr><td>plusHours</td><td>è¿”å›LocalDateTimeåŠ ä¸ŠæŒ‡å®šå°æ—¶æ•°å¾—åˆ°çš„å€¼</td></tr><tr><td>plusMinutes</td><td>è¿”å›LocalDateTimeåŠ ä¸ŠæŒ‡å®šåˆ†é’Ÿæ•°å¾—åˆ°çš„å€¼</td></tr><tr><td>plusMonths</td><td>è¿”å›LocalDateTimeåŠ ä¸ŠæŒ‡å®šæœˆæ•°å¾—åˆ°çš„å€¼</td></tr><tr><td>plusNanos</td><td>è¿”å›LocalDateTimeåŠ ä¸ŠæŒ‡å®šçº³ç§’æ•°å¾—åˆ°çš„å€¼</td></tr><tr><td>plusSeconds</td><td>è¿”å›LocalDateTimeåŠ ä¸ŠæŒ‡å®šç§’æ•°å¾—åˆ°çš„å€¼</td></tr><tr><td>plusWeeks</td><td>è¿”å›LocalDateTimeåŠ ä¸ŠæŒ‡å®šæ˜ŸæœŸæ•°å¾—åˆ°çš„å€¼</td></tr><tr><td>plusYears</td><td>è¿”å›LocalDateTimeåŠ ä¸ŠæŒ‡å®šå¹´æ•°å¾—åˆ°çš„å€¼</td></tr><tr><td>query</td><td>æŸ¥è¯¢LocalDateTime</td></tr><tr><td>range</td><td>è¿”å›æŒ‡å®šæ—¶é—´å­—æ®µçš„èŒƒå›´</td></tr><tr><td>toLocalDate</td><td>è¿”å›LocalDateTimeçš„LocalDateéƒ¨åˆ†</td></tr><tr><td>toLocalTime</td><td>è¿”å›LocalDateTimeçš„LocalTimeéƒ¨åˆ†</td></tr><tr><td>toString</td><td>è¿”å›LocalDateTimeçš„å­—ç¬¦ä¸²è¡¨ç¤º</td></tr><tr><td>truncatedTo</td><td>è¿”å›LocalDateTimeæˆªå–åˆ°æŒ‡å®šæ—¶é—´å•ä½çš„æ‹·è´</td></tr><tr><td>until</td><td>è®¡ç®—LocalDateTimeå’Œå¦ä¸€ä¸ªLocalDateTime</td></tr><tr><td>with</td><td>è¿”å›LocalDateTimeæŒ‡å®šå­—æ®µæ›´æ”¹ä¸ºæ–°å€¼åçš„æ‹·è´</td></tr><tr><td>withDayOfMonth</td><td>è¿”å›LocalDateTimeæœˆçš„ç¬¬å‡ å¤©æ›´æ”¹ä¸ºæ–°å€¼åçš„æ‹·è´</td></tr><tr><td>withDayOfYear</td><td>è¿”å›LocalDateTimeå¹´çš„ç¬¬å‡ å¤©æ›´æ”¹ä¸ºæ–°å€¼åçš„æ‹·è´</td></tr><tr><td>withHour</td><td>è¿”å›LocalDateTimeçš„å°æ—¶æ•°æ›´æ”¹ä¸ºæ–°å€¼åçš„æ‹·è´</td></tr><tr><td>withMinute</td><td>è¿”å›LocalDateTimeçš„åˆ†é’Ÿæ•°æ›´æ”¹ä¸ºæ–°å€¼åçš„æ‹·è´</td></tr><tr><td>withMonth</td><td>è¿”å›LocalDateTimeçš„æœˆä»½æ›´æ”¹ä¸ºæ–°å€¼åçš„æ‹·è´</td></tr><tr><td>withNano</td><td>è¿”å›LocalDateTimeçš„çº³ç§’æ•°æ›´æ”¹ä¸ºæ–°å€¼åçš„æ‹·è´</td></tr><tr><td>withSecond</td><td>è¿”å›LocalDateTimeçš„ç§’æ•°æ›´æ”¹ä¸ºæ–°å€¼åçš„æ‹·è´</td></tr><tr><td>withYear</td><td>è¿”å›LocalDateTimeå¹´ä»½æ›´æ”¹ä¸ºæ–°å€¼åçš„æ‹·è´</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Java8 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Swagger2 å¸¸ç”¨æ³¨è§£</title>
      <link href="2020/01/03/swagger-annotation/"/>
      <url>2020/01/03/swagger-annotation/</url>
      
        <content type="html"><![CDATA[<p>Spring Boot å¼€å‘restfulæ¥å£æ—¶ï¼Œå¾€å¾€ä¼šæœ‰å¾ˆå¤šRESTful APIï¼Œä¸€èˆ¬ä¼šé€‰æ‹©swaggerå¯¹æ¥å£è¿›è¡Œç®¡ç†</p><h2 id="Spring-Bootæ·»åŠ swaggeræ”¯æŒ"><a href="#Spring-Bootæ·»åŠ swaggeræ”¯æŒ" class="headerlink" title="Spring Bootæ·»åŠ swaggeræ”¯æŒ"></a>Spring Bootæ·»åŠ swaggeræ”¯æŒ</h2><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>springfox-swagger2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.9.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>springfox-swagger-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.9.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><h2 id="é…ç½®ç±»"><a href="#é…ç½®ç±»" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span><span class="token keyword">import</span> springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>builders<span class="token punctuation">.</span>ApiInfoBuilder<span class="token punctuation">;</span><span class="token keyword">import</span> springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>builders<span class="token punctuation">.</span>ParameterBuilder<span class="token punctuation">;</span><span class="token keyword">import</span> springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>builders<span class="token punctuation">.</span>PathSelectors<span class="token punctuation">;</span><span class="token keyword">import</span> springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>builders<span class="token punctuation">.</span>RequestHandlerSelectors<span class="token punctuation">;</span><span class="token keyword">import</span> springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>ModelRef<span class="token punctuation">;</span><span class="token keyword">import</span> springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>service<span class="token punctuation">.</span>ApiInfo<span class="token punctuation">;</span><span class="token keyword">import</span> springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>service<span class="token punctuation">.</span>Parameter<span class="token punctuation">;</span><span class="token keyword">import</span> springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>spi<span class="token punctuation">.</span>DocumentationType<span class="token punctuation">;</span><span class="token keyword">import</span> springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>web<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>Docket<span class="token punctuation">;</span><span class="token keyword">import</span> springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>swagger2<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span>EnableSwagger2<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>Collectors<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>Stream<span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EnableSwagger2</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Swagger2Configuration</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> Docket <span class="token function">createRestApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// æ„å»ºä¸€ä¸ªheader</span>        ParameterBuilder parameterBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ParameterBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">parameterType</span><span class="token punctuation">(</span><span class="token string">"header"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span>BaseConst<span class="token punctuation">.</span>AUTH_TOKEN<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">defaultValue</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">modelRef</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ModelRef</span><span class="token punctuation">(</span><span class="token string">"string"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        List<span class="token operator">&lt;</span>Parameter<span class="token operator">></span> parameters <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>parameterBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Docket</span><span class="token punctuation">(</span>DocumentationType<span class="token punctuation">.</span>SWAGGER_2<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">globalOperationParameters</span><span class="token punctuation">(</span>parameters<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">apis</span><span class="token punctuation">(</span>RequestHandlerSelectors<span class="token punctuation">.</span><span class="token function">basePackage</span><span class="token punctuation">(</span><span class="token string">"com.xiaozhangge"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">paths</span><span class="token punctuation">(</span>PathSelectors<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> ApiInfo <span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ApiInfoBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">"RESTful APIs"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">"æè¿°"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">termsOfServiceUrl</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contact</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Contact</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"url"</span><span class="token punctuation">,</span> <span class="token string">"email"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">"1.0"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="æ³¨è§£è¯¦ç»†è¯´æ˜"><a href="#æ³¨è§£è¯¦ç»†è¯´æ˜" class="headerlink" title="æ³¨è§£è¯¦ç»†è¯´æ˜"></a>æ³¨è§£è¯¦ç»†è¯´æ˜</h2><table><thead><tr><th align="left">å±æ€§</th><th align="left"><strong>å–å€¼</strong></th><th><strong>ä½œç”¨</strong></th></tr></thead><tbody><tr><td align="left">ä½œç”¨èŒƒå›´</td><td align="left">@API</td><td>ä½¿ç”¨ä½ç½®</td></tr><tr><td align="left">å¯¹è±¡å±æ€§</td><td align="left">@ApiModelProperty</td><td>ç”¨åœ¨å‡ºå…¥å‚æ•°å¯¹è±¡çš„å­—æ®µä¸Š</td></tr><tr><td align="left">åè®®é›†æè¿°</td><td align="left">@Api</td><td>ç”¨äºcontrollerç±»ä¸Š</td></tr><tr><td align="left">åè®®æè¿°</td><td align="left">@ApiOperation</td><td>ç”¨åœ¨controllerçš„æ–¹æ³•ä¸Š</td></tr><tr><td align="left">Responseé›†</td><td align="left">@ApiResponses</td><td>ç”¨åœ¨controllerçš„æ–¹æ³•ä¸Š</td></tr><tr><td align="left">Response</td><td align="left">@ApiResponse</td><td>ç”¨åœ¨ @ApiResponsesé‡Œè¾¹</td></tr><tr><td align="left">éå¯¹è±¡å‚æ•°é›†</td><td align="left">@ApiImplicitParams</td><td>ç”¨åœ¨controllerçš„æ–¹æ³•ä¸Š</td></tr><tr><td align="left">éå¯¹è±¡å‚æ•°æè¿°</td><td align="left">@ApiImplicitParam</td><td>ç”¨åœ¨@ApiImplicitParamsçš„æ–¹æ³•é‡Œè¾¹</td></tr><tr><td align="left">æè¿°è¿”å›å¯¹è±¡çš„æ„ä¹‰</td><td align="left">@ApiModel</td><td>ç”¨åœ¨è¿”å›å¯¹è±¡ç±»ä¸Š</td></tr><tr><td align="left">æ ‡è®°@RequestBody</td><td align="left">@ApiParam</td><td>ç”¨åœ¨æ–¹æ³•å‚æ•°</td></tr></tbody></table><h2 id="ApiImplicitParam"><a href="#ApiImplicitParam" class="headerlink" title="@ApiImplicitParam"></a>@ApiImplicitParam</h2><table><thead><tr><th><strong>å±æ€§</strong></th><th><strong>å–å€¼</strong></th><th><strong>ä½œç”¨</strong></th></tr></thead><tbody><tr><td>paramType</td><td>æŸ¥è¯¢å‚æ•°ç±»å‹</td><td></td></tr><tr><td></td><td>path</td><td>ä»¥åœ°å€çš„å½¢å¼æäº¤æ•°æ®</td></tr><tr><td></td><td>query</td><td>ç›´æ¥è·Ÿå‚æ•°å®Œæˆè‡ªåŠ¨æ˜ å°„èµ‹å€¼</td></tr><tr><td></td><td>body</td><td>ä»¥æµçš„å½¢å¼æäº¤ ä»…æ”¯æŒPOST</td></tr><tr><td></td><td>header</td><td>å‚æ•°åœ¨request headers é‡Œè¾¹æäº¤</td></tr><tr><td></td><td>form</td><td>ä»¥formè¡¨å•çš„å½¢å¼æäº¤ ä»…æ”¯æŒPOST</td></tr><tr><td>dataType</td><td></td><td>å‚æ•°çš„æ•°æ®ç±»å‹ åªä½œä¸ºæ ‡å¿—è¯´æ˜ ä¸ä¼šéªŒè¯</td></tr><tr><td></td><td>Long</td><td></td></tr><tr><td></td><td>String</td><td></td></tr><tr><td></td><td>Integer</td><td></td></tr><tr><td>name</td><td></td><td>æ¥æ”¶å‚æ•°å</td></tr><tr><td>value</td><td></td><td>æ¥æ”¶å‚æ•°çš„æ„ä¹‰æè¿°</td></tr><tr><td>required</td><td></td><td>å‚æ•°æ˜¯å¦å¿…å¡«</td></tr><tr><td></td><td>true</td><td>å¿…å¡«</td></tr><tr><td></td><td>false</td><td>éå¿…å¡«</td></tr><tr><td>defaultValue</td><td></td><td>é»˜è®¤å€¼</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Swagger </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Swagger </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mavenå½’æ¡£æ’ä»¶assemblyä»‹ç»</title>
      <link href="2020/01/02/maven-assembly/"/>
      <url>2020/01/02/maven-assembly/</url>
      
        <content type="html"><![CDATA[<p>2020å¹´çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œç¥å¤§å®¶æ–°å¹´å¿«ä¹ï¼</p><p>assemblyæ’ä»¶ä¸»è¦ç”¨äºå¯¹æ‰“åŒ…ä»¥åçš„æ–‡ä»¶è¿›è¡Œå½’æ¡£å¤„ç†ï¼Œæ¯”å¦‚é¡¹ç›®ä¸­çš„jarï¼Œé…ç½®æ–‡ä»¶ï¼Œè„šæœ¬â€¦. æ‰“åŒ…éœ€è¦å½’æ¡£åˆ°ä¸€èµ·æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨maven-assembly-pluginã€‚assemblyä½¿ç”¨å¾ˆç®€å•ï¼Œç¬¬ä¸€æ˜¯éœ€è¦æ·»åŠ å¯¹åº”çš„mavenæ’ä»¶ï¼Œç¬¬äºŒå°±æ˜¯æ·»åŠ assemblyéœ€è¦å½’æ¡£çš„æè¿°æ–‡ä»¶</p><h2 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h2><p>è¿™é‡Œç”¨ä¹‹å‰çš„ä¸€ä¸ªä»‹ç»çš„mavenå¤šæ¨¡å—é¡¹ç›®é…ç½®æ¥è¿›è¡Œé…ç½®</p><pre class=" language-shell"><code class="language-shell">âœ  personal-life-multi-module git:(master) âœ— tree.â”œâ”€â”€ HELP.mdâ”œâ”€â”€ life-multi-module.imlâ”œâ”€â”€ multi-apiâ”‚&nbsp;&nbsp; â”œâ”€â”€ multi-api.imlâ”‚&nbsp;&nbsp; â”œâ”€â”€ pom.xmlâ”‚&nbsp;&nbsp; â””â”€â”€ srcâ”‚&nbsp;&nbsp;     â”œâ”€â”€ assemblyâ”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â””â”€â”€ assembly-descriptor.xmlâ”‚&nbsp;&nbsp;     â”œâ”€â”€ mainâ”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â”œâ”€â”€ javaâ”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp; â””â”€â”€ comâ”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â””â”€â”€ xiaozhanggeâ”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;         â””â”€â”€ MainApplication.javaâ”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â”œâ”€â”€ java-templatesâ”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp; â””â”€â”€ comâ”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â””â”€â”€ xiaozhanggeâ”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;         â””â”€â”€ Version.javaâ”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â””â”€â”€ resourcesâ”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp;     â””â”€â”€ git.propertiesâ”‚&nbsp;&nbsp;     â””â”€â”€ testâ”‚&nbsp;&nbsp;         â””â”€â”€ javaâ”œâ”€â”€ multi-commonâ”‚&nbsp;&nbsp; â”œâ”€â”€ multi-common.imlâ”‚&nbsp;&nbsp; â”œâ”€â”€ pom.xmlâ”‚&nbsp;&nbsp; â””â”€â”€ srcâ”‚&nbsp;&nbsp;     â”œâ”€â”€ mainâ”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â”œâ”€â”€ javaâ”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp; â””â”€â”€ comâ”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;     â””â”€â”€ xiaozhanggeâ”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;         â””â”€â”€ commonâ”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;             â”œâ”€â”€ CommonApplication.javaâ”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;             â””â”€â”€ utilâ”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â”‚&nbsp;&nbsp;                 â””â”€â”€ IdHelper.javaâ”‚&nbsp;&nbsp;     â”‚&nbsp;&nbsp; â””â”€â”€ resourcesâ”‚&nbsp;&nbsp;     â””â”€â”€ testâ”‚&nbsp;&nbsp;         â””â”€â”€ javaâ”œâ”€â”€ mvnwâ”œâ”€â”€ mvnw.cmdâ””â”€â”€ pom.xml</code></pre><h2 id="æ·»åŠ mavené…ç½®"><a href="#æ·»åŠ mavené…ç½®" class="headerlink" title="æ·»åŠ mavené…ç½®"></a>æ·»åŠ mavené…ç½®</h2><p>å¦‚æœæ˜¯åœ¨å¤šæ¨¡å—é¡¹ç›®ä¸‹ï¼Œè¯¥é…ç½®æ”¾åœ¨å¯¹åº”æ¨¡å—ä¸‹ï¼Œä¸è¦æ”¾åœ¨parent pom.xmlä¸­ï¼Œç¤ºä¾‹æ”¾åœ¨<code>./multi-api/pom.xml</code></p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven-assembly-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">></span></span>      <span class="token comment" spellcheck="true">&lt;!-- åœ¨packageä»»åŠ¡ä»¥åæ‰§è¡Œ --></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">></span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">></span></span>single<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- ç”Ÿäº§å‹ç¼©åŒ…åç§° --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>finalName</span><span class="token punctuation">></span></span>${project.artifactId}-${project.version}-${timestamp}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>finalName</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appendAssemblyId</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appendAssemblyId</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- assemblyé…ç½®æè¿°æ–‡ä»¶ --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptors</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptor</span><span class="token punctuation">></span></span>src/assembly/assembly-descriptor.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptor</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptors</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span></code></pre><h2 id="assemblyé…ç½®æè¿°æ–‡ä»¶"><a href="#assemblyé…ç½®æè¿°æ–‡ä»¶" class="headerlink" title="assemblyé…ç½®æè¿°æ–‡ä»¶"></a>assemblyé…ç½®æè¿°æ–‡ä»¶</h2><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assembly</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.2<span class="token punctuation">"</span></span>          <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>          <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.2          http://maven.apache.org/xsd/assembly-1.1.2.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>release<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>formats</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>format</span><span class="token punctuation">></span></span>tar.gz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>format</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>format</span><span class="token punctuation">></span></span>zip<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>format</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>formats</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includeBaseDirectory</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includeBaseDirectory</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSets</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>../docs/bin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>multi-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileMode</span><span class="token punctuation">></span></span>0755<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileMode</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>*.sh<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>../docs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>multi-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>db/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>db/*/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>target<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>multi-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>*.jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>lib/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>src/main/resources<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>multi-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>logback-spring.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>application.properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileSet</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">></span></span>../<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>multi-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>*.MD<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSet</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileSets</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>assembly</span><span class="token punctuation">></span></span></code></pre><h3 id="é…ç½®æè¿°æ–‡ä»¶ä»‹ç»"><a href="#é…ç½®æè¿°æ–‡ä»¶ä»‹ç»" class="headerlink" title="é…ç½®æè¿°æ–‡ä»¶ä»‹ç»"></a>é…ç½®æè¿°æ–‡ä»¶ä»‹ç»</h3><ul><li>id</li></ul><p>id æ ‡è¯†ç¬¦ï¼Œæ·»åŠ åˆ°ç”Ÿæˆæ–‡ä»¶åç§°çš„åç¼€ç¬¦ã€‚å¦‚æœæŒ‡å®š id çš„è¯ï¼Œç›®æ ‡æ–‡ä»¶åˆ™æ˜¯ ${artifactId}-${id}.tar.gz</p><ul><li>formats</li></ul><p>maven-assembly-plugin æ”¯æŒçš„æ‰“åŒ…æ ¼å¼æœ‰zipã€tarã€tar.gz (or tgz)ã€tar.bz2 (or tbz2)ã€jarã€dirã€warï¼Œå¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªæ‰“åŒ…æ ¼å¼</p><ul><li>includeBaseDirectory</li></ul><p>è§£å‹æ—¶æ˜¯å¦è®²å½“å‰å‹ç¼©åŒ…åç§°ä½œä¸ºæ–‡ä»¶å¤¹åç§°</p><ul><li>fileSets</li></ul><p>ç®¡ç†ä¸€ç»„æ–‡ä»¶çš„å­˜æ”¾ä½ç½®ï¼Œæ ¸å¿ƒå…ƒç´ å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚</p><table><thead><tr><th><strong>å…ƒç´ </strong></th><th><strong>ç±»å‹</strong></th><th><strong>ä½œç”¨</strong></th></tr></thead><tbody><tr><td>directory</td><td>string</td><td>æŒ‡å®šä»å“ªä¸ªç›®å½•è¿›è¡Œè·å–æ–‡ä»¶è¿›è¡Œå½’æ¡£</td></tr><tr><td>outputDirectory</td><td>string</td><td>æŒ‡å®šæ–‡ä»¶é›†åˆçš„è¾“å‡ºç›®å½•ï¼Œè¯¥ç›®å½•æ˜¯ç›¸å¯¹äºæ ¹ç›®å½•</td></tr><tr><td>fileMode</td><td>String</td><td>æŒ‡å®šæ–‡ä»¶å±æ€§ï¼Œä½¿ç”¨å…«è¿›åˆ¶è¡¨è¾¾ï¼Œåˆ†åˆ«ä¸º(User)(Group)(Other)æ‰€å±å±æ€§ï¼Œé»˜è®¤ä¸º 0644</td></tr><tr><td>includes/include*</td><td></td><td>åŒ…å«æ–‡ä»¶</td></tr><tr><td>excludes/exclude*</td><td></td><td>æ’é™¤æ–‡ä»¶</td></tr></tbody></table><br><p>å®Œæ•´ä»£ç ï¼š<a href="https://github.com/xiaomozhang/personal-life-multi-module">https://github.com/xiaomozhang/personal-life-multi-module</a></p>]]></content>
      
      
      <categories>
          
          <category> maven </category>
          
      </categories>
      
      
        <tags>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å•†ä¸šè®ºè¯ä¸­çš„è´¢åŠ¡æµ‹é‡æŒ‡æ ‡</title>
      <link href="2020/01/01/pmp-note-01/"/>
      <url>2020/01/01/pmp-note-01/</url>
      
        <content type="html"><![CDATA[<h1 id="å•†ä¸šè®ºè¯ä¸­çš„è´¢åŠ¡æµ‹é‡æŒ‡æ ‡"><a href="#å•†ä¸šè®ºè¯ä¸­çš„è´¢åŠ¡æµ‹é‡æŒ‡æ ‡" class="headerlink" title="å•†ä¸šè®ºè¯ä¸­çš„è´¢åŠ¡æµ‹é‡æŒ‡æ ‡"></a>å•†ä¸šè®ºè¯ä¸­çš„è´¢åŠ¡æµ‹é‡æŒ‡æ ‡</h1><p>å•†ä¸šè®ºè¯ä¸­å¸¸è§çš„è´¢åŠ¡æŒ‡æ ‡æµ‹é‡æ–¹æ³•</p><ul><li>ROI æŠ•èµ„å›æŠ¥ç‡</li><li>PBP æŠ•èµ„å›æŠ¥å‘¨æœŸ</li><li>NPV å‡€ç°å€¼</li><li>IRR å†…éƒ¨æ”¶ç›Šç‡</li><li>BCR æ•ˆç›Šæˆæœ¬æ¯”ç‡</li></ul><h2 id="é™æ€è¯„ä»·æ³•"><a href="#é™æ€è¯„ä»·æ³•" class="headerlink" title="é™æ€è¯„ä»·æ³•"></a>é™æ€è¯„ä»·æ³•</h2><p>é€‚ç”¨äºé¡¹ç›®æ—©æœŸï¼Œä¸è®¡è¾ƒåˆ©æ¯çš„æƒ…å†µã€‚</p><p>600ä¸‡ä¹°ä¸€ä¸ªæˆ¿å­ï¼Œå‡ºç§Ÿï¼Œæ¯ä¸ªæœˆç§Ÿé‡‘æ”¶å…¥1ä¸‡ã€‚</p><ol><li>è¯·é—®æŠ•èµ„å›æŠ¥ç‡(ROI)æ˜¯å¤šå°‘ï¼Ÿ</li><li>ä¸€ç›´ç§Ÿä¸‹å»ï¼ŒæŠ•èµ„å›æŠ¥æœŸ(PBP)å‡ å¹´ï¼Ÿ</li></ol><h3 id="æŠ•èµ„å›æŠ¥ç‡-ROI"><a href="#æŠ•èµ„å›æŠ¥ç‡-ROI" class="headerlink" title="æŠ•èµ„å›æŠ¥ç‡(ROI)"></a>æŠ•èµ„å›æŠ¥ç‡(ROI)</h3><pre class=" language-java"><code class="language-java">æŠ•èµ„å›æŠ¥ç‡<span class="token punctuation">(</span>ROI<span class="token punctuation">)</span> <span class="token operator">=</span> å¹´å‡åˆ©æ¶¦ â— æŠ•èµ„é¢ </code></pre><p><strong>ROI = 12 â— 600 = 2%</strong></p><h3 id="æŠ•èµ„å›æŠ¥æœŸ-PBP"><a href="#æŠ•èµ„å›æŠ¥æœŸ-PBP" class="headerlink" title="æŠ•èµ„å›æŠ¥æœŸ(PBP)"></a>æŠ•èµ„å›æŠ¥æœŸ(PBP)</h3><pre class=" language-java"><code class="language-java">æŠ•èµ„å›æŠ¥æœŸ<span class="token punctuation">(</span>PBP<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> â— ROI</code></pre><p><strong>PBP = 1 â— (2%) = 50å¹´</strong></p><p>å†é—®ï¼š600ä¸‡ä¹°ä¸€ä¸ªæˆ¿å­ï¼Œå‡ºç§Ÿï¼Œæ¯ä¸ªæœˆç§Ÿé‡‘æ”¶å…¥1ä¸‡ï¼Œ5å¹´åæˆ¿ä»·ç¿»äº†ä¸€ç•ªï¼Œé—®ROIæ˜¯å¤šå°‘ï¼ŸPBPæ˜¯å¤šå°‘å¹´ï¼Ÿ</p><p><img src="/images/pmp/pmp-01.png" alt="img1"></p><table><thead><tr><th align="center">å¹´ä»½</th><th align="center">0</th><th align="center">1</th><th align="center">2</th><th align="center">3</th><th align="center">4</th><th align="center">5</th></tr></thead><tbody><tr><td align="center">æ”¶å…¥</td><td align="center"></td><td align="center">12</td><td align="center">12</td><td align="center">12</td><td align="center">12</td><td align="center">1212</td></tr><tr><td align="center">æ”¯å‡º</td><td align="center">-600</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="center">å‡€ç°é‡‘æµ</td><td align="center">-600</td><td align="center">12</td><td align="center">12</td><td align="center">12</td><td align="center">12</td><td align="center">1212</td></tr><tr><td align="center">ç´¯è®¡ç°é‡‘æµ</td><td align="center">-600</td><td align="center">-588</td><td align="center">-576</td><td align="center">-564</td><td align="center">-552</td><td align="center">660</td></tr></tbody></table><ul><li>æŠ•èµ„å›æŠ¥ç‡(ROI) = å¹´å‡åˆ©æ¶¦ â— æŠ•èµ„é¢ </li></ul><pre class=" language-java"><code class="language-java">ROI<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">600</span> â— <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">12</span><span class="token punctuation">)</span> â— <span class="token number">600</span> <span class="token operator">=</span> <span class="token number">22</span><span class="token operator">%</span></code></pre><ul><li>æŠ•èµ„å›æŠ¥æœŸ(PBP) = 1 â— ROI</li></ul><pre class=" language-java"><code class="language-java">PBP <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">552</span> â— <span class="token number">1212</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">4.46</span>å¹´</code></pre><p>ç®€å•è§£æ³•ï¼Œåˆ©ç”¨ç›¸ä¼¼ä¸‰è§’å½¢åŸç†</p><p><img src="/images/pmp/pmp-02.png" alt="img2"></p><p>PBP =  (x-4) â— (5-x) = (-552) â— 660 = 4.46å¹´</p><h2 id="åŠ¨æ€åˆ†ææ³•"><a href="#åŠ¨æ€åˆ†ææ³•" class="headerlink" title="åŠ¨æ€åˆ†ææ³•"></a>åŠ¨æ€åˆ†ææ³•</h2><pre class=" language-java"><code class="language-java">å¤åˆ©è®¡ç®—<span class="token operator">:</span> ç»ˆå€¼ <span class="token operator">=</span> ç°å€¼ âœ–ï¸ <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token operator">^</span>næŠ˜ç°è®¡ç®—<span class="token operator">:</span> ç°å€¼ <span class="token operator">=</span> ç»ˆå€¼ â— <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token operator">^</span>n</code></pre><p><strong>åè¯è§£é‡Š:</strong></p><blockquote><p>ç°å€¼=æœ¬é‡‘</p><p>ç»ˆå€¼=æ”¶ç›Šæ€»é¢</p><p>i = åˆ©ç‡</p><p>n = å‘¨æœŸ(å•ä½å¹´)</p></blockquote><h3 id="å‡€ç°å€¼-NPV-æœ‰åˆ©æ¯çš„è®¡ç®—"><a href="#å‡€ç°å€¼-NPV-æœ‰åˆ©æ¯çš„è®¡ç®—" class="headerlink" title="å‡€ç°å€¼ NPV (æœ‰åˆ©æ¯çš„è®¡ç®—)"></a>å‡€ç°å€¼ NPV (æœ‰åˆ©æ¯çš„è®¡ç®—)</h3><table><thead><tr><th align="center">å¹´ä»½</th><th align="center">0</th><th align="center">1</th><th align="center">2</th><th align="center">3</th><th align="center">4</th><th align="center">5</th></tr></thead><tbody><tr><td align="center">æ”¶å…¥</td><td align="center"></td><td align="center">12</td><td align="center">12</td><td align="center">12</td><td align="center">12</td><td align="center">1212</td></tr><tr><td align="center">æ”¯å‡º</td><td align="center">-600</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="center">å‡€ç°é‡‘æµ</td><td align="center">-600</td><td align="center">12</td><td align="center">12</td><td align="center">12</td><td align="center">12</td><td align="center">1212</td></tr><tr><td align="center">å‡€ç°é‡‘æµ(æŠ˜ç°)</td><td align="center">-600</td><td align="center">10.91<br>12/(1+10%)</td><td align="center">9.92<br>12/(1+10%)^2</td><td align="center">9.02</td><td align="center">8.20</td><td align="center">752.56<br>1212/(1+10%)^5</td></tr><tr><td align="center">ç´¯è®¡ç°é‡‘æµ</td><td align="center">-600</td><td align="center">-598.09<br>(600-10.91)</td><td align="center">-579.17<br>(598.09-9.92)</td><td align="center">-570.16<br>(579.17-9.02)</td><td align="center">-561.96</td><td align="center">190.60</td></tr></tbody></table><blockquote><p>å–åŸºå‡†æŠ˜ç°ç‡ <strong>i = 10%</strong></p><p>é™æ€ï¼š<strong>PBP   (x-4) â— (5-x) = (-552) â— 660  x = 4.46å¹´</strong> - è®¡ç®—æ–¹å¼å‚è€ƒå›¾äºŒ</p><p>åŠ¨æ€ï¼š**PBP   (x-4) â— (5-x) = (-561.96) â— 190.60  x = 4.75å¹´ **</p><p>å‡€ç°å€¼ï¼š<strong>NPV = 190.60ä¸‡å…ƒï¼Œè¯¥å€¼è¡¨ç¤ºæœ€åçš„å‡€åˆ©æ¶¦</strong></p></blockquote><h3 id="å†…éƒ¨æ”¶ç›Šç‡-IRR"><a href="#å†…éƒ¨æ”¶ç›Šç‡-IRR" class="headerlink" title="å†…éƒ¨æ”¶ç›Šç‡ IRR"></a>å†…éƒ¨æ”¶ç›Šç‡ IRR</h3><p><strong>è¯¥å€¼è¶Šé«˜ï¼Œç†è®ºä¸Šè¡¨ç¤ºå¯ä»¥æ‰¿å—çš„é£é™©è¶Šé«˜ã€‚</strong></p><table><thead><tr><th align="center">å¹´ä»½</th><th align="center">0</th><th align="center">1</th><th align="center">2</th><th align="center">3</th><th align="center">4</th><th align="center">5</th><th>i</th><th>NPV</th></tr></thead><tbody><tr><td align="center">æ”¶å…¥</td><td align="center"></td><td align="center">12</td><td align="center">12</td><td align="center">12</td><td align="center">12</td><td align="center">1212</td><td></td><td></td></tr><tr><td align="center">æ”¯å‡º</td><td align="center">-600</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td></td><td></td></tr><tr><td align="center">å‡€ç°é‡‘æµ</td><td align="center">-600</td><td align="center">12</td><td align="center">12</td><td align="center">12</td><td align="center">12</td><td align="center">1212</td><td></td><td></td></tr><tr><td align="center">å‡€ç°é‡‘æµ(æŠ˜ç°)1</td><td align="center">-600</td><td align="center">10.91<br>12/(1+10%)</td><td align="center">9.92<br>12/(1+10%)^2</td><td align="center">9.02</td><td align="center">8.20</td><td align="center">752.56<br>1212/(1+10%)^5</td><td>10%</td><td>190.60</td></tr><tr><td align="center">å‡€ç°é‡‘æµ(æŠ˜ç°)2</td><td align="center">-600</td><td align="center">10.62</td><td align="center">9.40</td><td align="center">8.32</td><td align="center">7.36</td><td align="center">657.83</td><td>13%</td><td>93.52</td></tr><tr><td align="center">å‡€ç°é‡‘æµ(æŠ˜ç°)3</td><td align="center">-600</td><td align="center">10.43</td><td align="center">9.07</td><td align="center">7.89</td><td align="center">6.86</td><td align="center">602.58</td><td>15%</td><td>36.84</td></tr><tr><td align="center">å‡€ç°é‡‘æµ(æŠ˜ç°)4</td><td align="center">-600</td><td align="center">10.34</td><td align="center">8.92</td><td align="center">7.69</td><td align="center">6.63</td><td align="center">577.05</td><td>16%</td><td>10.63</td></tr><tr><td align="center">å‡€ç°é‡‘æµ(æŠ˜ç°)5</td><td align="center">-600</td><td align="center">10.26</td><td align="center">8.77</td><td align="center">7.49</td><td align="center">6.40</td><td align="center">552.81</td><td>17%</td><td>-14.27</td></tr></tbody></table><p><img src="/images/pmp/pmp-03.png"></p><p>é‡‡ç”¨ ç›¸ä¼¼ä¸‰è§’å½¢å®šå¾‹ æ–¹å¼è¿›è¡Œè®¡ç®—</p><p><a href="https://baike.baidu.com/item/%E7%BA%BF%E6%80%A7%E6%8F%92%E5%80%BC/19113392?fr=aladdin">çº¿æ€§æ’å€¼</a></p><pre class=" language-java"><code class="language-java">IRR <span class="token operator">=</span> <span class="token punctuation">(</span>IRR<span class="token operator">-</span><span class="token number">16</span><span class="token operator">%</span><span class="token punctuation">)</span> â— <span class="token punctuation">(</span><span class="token number">17</span><span class="token operator">%</span><span class="token operator">-</span>IRR<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">10.63</span> â— <span class="token number">14.27</span>IRR <span class="token operator">=</span> <span class="token number">16.43</span><span class="token operator">%</span> <span class="token comment" spellcheck="true">// è¯¥å€¼è¡¨ç¤ºåœ¨è¿™ä¸ªåˆ©ç‡ä¸‹ï¼Œä¸èµšä¸èµ”</span></code></pre><h4 id="å¤šä¸ªé¡¹ç›®è¿›è¡Œæ¯”è¾ƒ"><a href="#å¤šä¸ªé¡¹ç›®è¿›è¡Œæ¯”è¾ƒ" class="headerlink" title="å¤šä¸ªé¡¹ç›®è¿›è¡Œæ¯”è¾ƒ"></a>å¤šä¸ªé¡¹ç›®è¿›è¡Œæ¯”è¾ƒ</h4><table><thead><tr><th align="center">é¡¹ç›®</th><th align="center">A</th><th align="center">B</th><th align="center">C</th></tr></thead><tbody><tr><td align="center">NPV(ä¸‡å…ƒ)</td><td align="center">1500</td><td align="center">1000</td><td align="center">1000</td></tr><tr><td align="center">IRR</td><td align="center">16%</td><td align="center">16%</td><td align="center">38%</td></tr></tbody></table><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ¯”è¾ƒIRRæ˜¯éœ€è¦NPVä½œä¸ºè€ƒé‡æ ‡å‡†ï¼Œåœ¨æ²¡æœ‰NPVçš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰æ¯”è¾ƒæ„ä¹‰ã€‚</p><p>å¦‚æœéè¦æ¯”è¾ƒçš„è¯ï¼Œä¸ªäººè®¤ä¸ºå¯ä»¥ä»å¯¹å¾…é£é™©çš„æ€åº¦æ–¹é¢æ¥è®²ã€‚</p><ul><li>Aã€B ==&gt; IRRç›¸åŒï¼Œè¡¨ç¤ºå†…éƒ¨æ”¶ç›Šç‡ç›¸åŒï¼ŒæŠ—é£é™©èƒ½åŠ›æ›´å¼ºï¼ŒAé¡¹ç›®çš„NPV(å‡€ç°å€¼)æ”¶ç›Šæ›´é«˜ï¼Œæ‰€æœ‰é€‰A</li><li>Bã€C ==&gt; NPV(å‡€ç°å€¼)ç›¸åŒï¼Œè¡¨ç¤ºèµšçš„é’±æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯Cé¡¹ç›®çš„IRR(å†…éƒ¨æ”¶ç›Šç‡)é«˜ï¼Œæ‰€ä»¥é€‰æ‹©C</li></ul><h3 id="æ•ˆç›Šæˆæœ¬æ¯”ç‡-BCR-Benefit-cost-ratio"><a href="#æ•ˆç›Šæˆæœ¬æ¯”ç‡-BCR-Benefit-cost-ratio" class="headerlink" title="æ•ˆç›Šæˆæœ¬æ¯”ç‡ BCR (Benefit cost ratio)"></a>æ•ˆç›Šæˆæœ¬æ¯”ç‡ BCR (Benefit cost ratio)</h3><table><thead><tr><th align="center"></th><th align="center">æ±½æ²¹è½¦</th><th align="center">æ··åˆåŠ¨åŠ›</th><th align="center">çº¯ç”µåŠ¨</th></tr></thead><tbody><tr><td align="center">ç™¾å…¬é‡Œèƒ½æºæˆæœ¬</td><td align="center">65ï¿¥</td><td align="center">39ï¿¥</td><td align="center">7.5ï¿¥</td></tr><tr><td align="center">è´­ä¹°æˆæœ¬</td><td align="center"></td><td align="center">+10 ä¸‡ï¿¥</td><td align="center">+5 ä¸‡ï¿¥</td></tr><tr><td align="center">èŠ‚æ²¹æ•ˆç›Š</td><td align="center"></td><td align="center">2.6 ä¸‡ï¿¥</td><td align="center">5.75 ä¸‡ï¿¥</td></tr><tr><td align="center">æ•ˆç›Šæˆæœ¬BCR</td><td align="center"></td><td align="center">0.26</td><td align="center">1.15</td></tr></tbody></table><p><img src="/images/pmp/pmp-04.png" alt="img"></p><p>åœ¨C0è¿™ä¸ªç‚¹ï¼Œæˆæœ¬å’Œæ•ˆç›Šè¾¾åˆ°æœ€ä½³ç‚¹ã€‚â–³C åŒºé—´ï¼šæˆæœ¬å¢åŠ ï¼Œæ•ˆç›Šæ”¶ç›Šä¸æ˜æ˜¾ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> PMPå®æˆ˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PMP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FTP å¸¸ç”¨å‘½ä»¤</title>
      <link href="2019/12/12/ftp-command/"/>
      <url>2019/12/12/ftp-command/</url>
      
        <content type="html"><![CDATA[<p>FTPæ˜¯å¯ç”¨äºè®¸å¤šä¸åŒæ“ä½œç³»ç»Ÿä¸Šçš„åè®®ã€‚å¦‚æœ FTP æœåŠ¡å™¨ç«¯å…è®¸ PASV è¢«åŠ¨æ¨¡å¼ï¼Œå¯ä»¥ç”¨æµè§ˆå™¨è®¿é—® FTP ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨FTPå‘½ä»¤ï¼Œç›´æ¥ä¸è¿œç¨‹è®¡ç®—æœºè¿æ¥ã€‚</p><h1 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h1><p>Linux ç»ˆç«¯ç›´æ¥æ•²å…¥ ftp å›è½¦ï¼Œæˆ–è€…æŒ‰ç…§ä¸‹é¢æ¨¡å¼ï¼Œç›´æ¥è¿å…¥ FTP æœåŠ¡å™¨ï¼š</p><p>   *~&gt;ftp æœåŠ¡å™¨åœ°å€ï¼ˆIPæˆ–URLï¼‰<br>      â€¦<br>      Name â€¦:ç”¨æˆ·å<br>      â€¦<br>      Password:å¯†ç <br>      â€¦<br>      ftp&gt;<br>     è¿æ¥æˆåŠŸ<br>å¦‚æœå¸Œæœ›åŒ¿åç™»å½•ï¼Œä½¿ç”¨ç”¨æˆ·åå¯†ç å…¨éƒ¨æ˜¯ftpï¼Œæˆ–è€…ç”¨æˆ· Anonymous å¯†ç ä¸ºç©ºã€‚</p><h1 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h1><h2 id="ç›®å½•å‘½ä»¤"><a href="#ç›®å½•å‘½ä»¤" class="headerlink" title="ç›®å½•å‘½ä»¤"></a>ç›®å½•å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>pwd</td><td>æ˜¾ç¤ºè¿œç¨‹è®¡ç®—æœºä¸Šçš„å½“å‰ç›®å½•</td></tr><tr><td>ls/dir</td><td>åˆ—å‡ºå½“å‰è¿œç¨‹ç›®å½•çš„å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤åœ¨Linuxä¸‹çš„ä»»ä½•åˆæ³•çš„lsé€‰é¡¹</td></tr><tr><td>cd</td><td>ç§»åŠ¨åˆ°cd åçš„ç›®å½•</td></tr><tr><td>cdup/cd ..</td><td>è¿”å›ä¸Šä¸€çº§ç›®å½•</td></tr><tr><td>lcd</td><td>åˆ—å‡ºå½“å‰æœ¬åœ°ç›®å½•è·¯å¾„</td></tr></tbody></table><h2 id="éœ€è¦æƒé™çš„å‘½ä»¤"><a href="#éœ€è¦æƒé™çš„å‘½ä»¤" class="headerlink" title="éœ€è¦æƒé™çš„å‘½ä»¤"></a>éœ€è¦æƒé™çš„å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>mkdir</td><td>åœ¨è¿œç¨‹ç³»ç»Ÿä¸­åˆ›å»ºç›®å½•</td></tr><tr><td>rname</td><td>é‡å‘½åä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•</td></tr><tr><td>redir</td><td>åˆ é™¤è¿œç¨‹ç›®å½•</td></tr><tr><td>delete</td><td>åˆ é™¤è¿œç¨‹æ–‡ä»¶</td></tr><tr><td>mdelete</td><td>åˆ é™¤å¤šä¸ªè¿œç¨‹æ–‡ä»¶</td></tr></tbody></table><h2 id="æ–‡ä»¶ä¸Šä¼ ä¸‹è½½"><a href="#æ–‡ä»¶ä¸Šä¼ ä¸‹è½½" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ ä¸‹è½½"></a>æ–‡ä»¶ä¸Šä¼ ä¸‹è½½</h2><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>binary/bin</td><td>ç”¨äºäºŒè¿›åˆ¶æ–‡ä»¶ä¼ é€ï¼ˆå›¾åƒæ–‡ä»¶ç­‰ï¼‰</td></tr><tr><td>ascii</td><td>ç”¨äºæ–‡æœ¬æ–‡ä»¶ä¼ é€</td></tr><tr><td>get/mget</td><td>åœ¨å½“å‰è¿œç¨‹ç›®å½•ä¸‹å¤åˆ¶ï¼ˆä¸€ä¸ª/å¤šä¸ªï¼‰æ–‡ä»¶åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå½“å‰ç›®å½•</td></tr><tr><td>put/mput</td><td>ä»å½“å‰ç›®å½•æŠŠæ–‡ä»¶å¤åˆ¶åˆ°å½“å‰è¿œç¨‹ç›®å½•</td></tr><tr><td>prompt</td><td>å…³é—­äºŒæ¬¡ç¡®è®¤æ—¶çš„æç¤º</td></tr></tbody></table><h2 id="é€€å‡º"><a href="#é€€å‡º" class="headerlink" title="é€€å‡º"></a>é€€å‡º</h2><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>!</td><td>ä¸´æ—¶é€€å‡ºftpæ¨¡å¼ï¼Œè¿”å›æœ¬åœ°Linux Shellæ¨¡å¼ï¼Œé”®å…¥exitè¿”å›</td></tr><tr><td>close</td><td>å…³é—­å½“å‰è¿æ¥</td></tr><tr><td>bye</td><td>å…³é—­è¿æ¥å¹¶é€€å‡ºftpå‘½ä»¤æ¨¡å¼</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> å·¥å…·ä½¿ç”¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FTP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javacç¼–è¯‘javaæ–‡ä»¶</title>
      <link href="2019/11/05/javac-compiler/"/>
      <url>2019/11/05/javac-compiler/</url>
      
        <content type="html"><![CDATA[<h1 id="javacç¼–è¯‘javaæ–‡ä»¶"><a href="#javacç¼–è¯‘javaæ–‡ä»¶" class="headerlink" title="javacç¼–è¯‘javaæ–‡ä»¶"></a>javacç¼–è¯‘javaæ–‡ä»¶</h1><p>ç”±äºæœ€è¿‘é¡¹ç›®éœ€æ±‚æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼Œç”Ÿäº§ä¸Šæ–°ç»™äº†ä¸€ä¸ªcsvæ–‡ä»¶ï¼Œç¨‹åºéœ€è¦è¯»å–å†…å®¹è¿›è¡Œæ¸…æ´—ï¼Œä½†æ˜¯æ‹¿ä¸å‡ºæ¥çœ‹ï¼Œä¹Ÿä¸å¯èƒ½ä¸ºäº†è¿™ä¸€ä¸ªå°æµ‹è¯•ä¸“é—¨æ‰“å®¡æ‰¹ç»™ç”Ÿäº§ä¸Šä¼ ä¸€ä¸ªç¨‹åºåŒ…ï¼Œå°±æƒ³åˆ°äº†ä½¿ç”¨javacå†™ä¸ªç®€å•çš„æµ‹è¯•çœ‹ä¸‹æ•°æ®ã€‚ä¸‹é¢å…ˆæ¥å¤ä¹ ä¸€ä¸‹javacè¿™ä¸ªå‘½ä»¤</p><p>ä¸‹é¢æµ‹è¯•çš„æ‰€æœ‰javaæºæ–‡ä»¶ç»Ÿä¸€ä¿å­˜åœ¨ <code>/Users/xxx/Downloads/compiler</code></p><h2 id="ç¼–è¯‘å•æ–‡ä»¶"><a href="#ç¼–è¯‘å•æ–‡ä»¶" class="headerlink" title="ç¼–è¯‘å•æ–‡ä»¶"></a>ç¼–è¯‘å•æ–‡ä»¶</h2><p>ç°åœ¨å†™ä¸€æ®µç®€å•çš„Javaä»£ç </p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test1</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello world!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ä½¿ç”¨javacç¼–è¯‘</p><pre class=" language-shell"><code class="language-shell">âœ  compiler pwd/Users/xxx/Downloads/compiler # å½“å‰è·¯å¾„âœ  compiler ls -lrttotal 8-rw-r--r--@ 1 xxx  staff  119 11  5 22:11 Test1.java # è¿™é‡Œæ˜¯æºæ–‡ä»¶âœ  compiler javac Test1.java # ä½¿ç”¨javacè¿›è¡Œç¼–è¯‘âœ  compiler ls -lrttotal 16-rw-r--r--@ 1 xxx  staff  119 11  5 22:11 Test1.java-rw-r--r--  1 xxx  staff  418 11  5 22:28 Test1.class # ç¼–è¯‘ä»¥åçš„classæ–‡ä»¶âœ  compiler java Test1 # è¿è¡Œç»“æœhello world!!!</code></pre><p>å¯ä»¥çœ‹åˆ°ç»“æœå°±æ˜¯æˆ‘ä»¬æ­£å¸¸çš„ä¸€ä¸ªè¾“å‡º hello world</p><h2 id="ç¼–è¯‘ä¸¤ä¸ªç›¸äº’ä¾èµ–çš„Javaæºæ–‡ä»¶"><a href="#ç¼–è¯‘ä¸¤ä¸ªç›¸äº’ä¾èµ–çš„Javaæºæ–‡ä»¶" class="headerlink" title="ç¼–è¯‘ä¸¤ä¸ªç›¸äº’ä¾èµ–çš„Javaæºæ–‡ä»¶"></a>ç¼–è¯‘ä¸¤ä¸ªç›¸äº’ä¾èµ–çš„Javaæºæ–‡ä»¶</h2><ul><li>A.java</li></ul><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æˆ‘æ˜¯ class A  hello world!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><ul><li>B.java</li></ul><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        A a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        a<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ä½¿ç”¨javacåˆ†åˆ«è¿›è¡Œç¼–è¯‘ï¼Œè¿™é‡Œæ³¨æ„å…ˆåé¡ºåºï¼Œå…ˆç¼–è¯‘A.javaï¼Œåœ¨ç¼–è¯‘B.javaï¼Œå½“ç„¶ï¼Œå› ä¸ºBä¸­å¼•ç”¨äº†Aï¼ŒA.javaä¹Ÿå¯ä»¥ä¸ç”¨ç¼–è¯‘ï¼Œåœ¨ç¼–è¯‘B.javaçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨ç¼–è¯‘A.javaçš„ï¼Œåé¢æˆ‘ä»¬ä¼šçœ‹åˆ°</p><pre class=" language-shell"><code class="language-shell">âœ  compiler ls -lrttotal 24-rw-r--r--@ 1 xxx  staff  119 11  5 22:11 Test1.java-rw-r--r--@ 1 xxx  staff  112 11  5 22:20 B.java-rw-r--r--@ 1 xxx  staff  113 11  5 22:21 A.javaâœ  compiler javac A.javaâœ  compiler javac B.javaâœ  compiler ls -lrttotal 40-rw-r--r--@ 1 xxx  staff  119 11  5 22:11 Test1.java-rw-r--r--@ 1 xxx  staff  112 11  5 22:20 B.java-rw-r--r--@ 1 xxx  staff  113 11  5 22:21 A.java-rw-r--r--  1 xxx  staff  402 11  5 22:39 A.class-rw-r--r--  1 xxx  staff  297 11  5 22:39 B.classâœ  compiler java B # è¿è¡ŒBè¿™ä¸ªç¨‹åºæˆ‘æ˜¯ class A  hello world!!!</code></pre><h2 id="ç¼–è¯‘å¸¦å¤–éƒ¨ä¾èµ–çš„jar"><a href="#ç¼–è¯‘å¸¦å¤–éƒ¨ä¾èµ–çš„jar" class="headerlink" title="ç¼–è¯‘å¸¦å¤–éƒ¨ä¾èµ–çš„jar"></a>ç¼–è¯‘å¸¦å¤–éƒ¨ä¾èµ–çš„jar</h2><p>è¿™é‡Œæ¯”å¦‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨Googleçš„guava-27.1-jre.jarï¼Œä½¿ç”¨å…¶ä¸­çš„apiè¯»å–ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶çš„å†…å®¹ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿ï¼Œå°†guava-27.1-jre.jarå¤åˆ¶åˆ°å½“å‰è·¯å¾„ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œæ–°å»ºæ–‡ä»¶GuavaTest.java</p><pre class=" language-shell"><code class="language-shell">âœ  compiler ls -lrttotal 5400-rw-r--r--  1 xxx  staff  2746671 11  5 09:33 guava-27.1-jre.jar # æ–°å¤åˆ¶çš„å¤–éƒ¨jaræ–‡ä»¶-rw-r--r--@ 1 xxx  staff      119 11  5 22:11 Test1.java-rw-r--r--@ 1 xxx  staff      112 11  5 22:20 B.java-rw-r--r--@ 1 xxx  staff      113 11  5 22:21 A.java-rw-r--r--@ 1 xxx  staff      663 11  5 22:54 GuavaTest.java</code></pre><p>GuavaTest.javaå†…å®¹</p><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Files<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span>StandardCharsets<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xxx on 2019-11-05. */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GuavaTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        String path <span class="token operator">=</span> <span class="token string">"/Users/xxx/Downloads/compiler/A.java"</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>              <span class="token comment" spellcheck="true">// æŒ‰è¡Œè¯»å–æ–‡ä»¶å†…å®¹</span>            List<span class="token operator">&lt;</span>String<span class="token operator">></span> list <span class="token operator">=</span> Files<span class="token punctuation">.</span><span class="token function">readLines</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">,</span> StandardCharsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>            list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ç„¶åä½¿ç”¨javacè¿›è¡Œç¼–è¯‘ï¼Œå’Œé¢„æœŸçš„ç»“æœä¸ä¸€è‡´ï¼Œå¼•ç”¨äº†guava-27.1-jre.jarä¸­çš„classä¸å­˜åœ¨</p><pre class=" language-shell"><code class="language-shell">âœ  compiler javac GuavaTest.javaGuavaTest.java:2: é”™è¯¯: ç¨‹åºåŒ…com.google.common.ioä¸å­˜åœ¨import com.google.common.io.Files;                           ^GuavaTest.java:19: é”™è¯¯: æ‰¾ä¸åˆ°ç¬¦å·            List<String> list = Files.readLines(new File(path), StandardCharsets.UTF_8);                                ^  ç¬¦å·:   å˜é‡ Files  ä½ç½®: ç±» GuavaTest2 ä¸ªé”™è¯¯</code></pre><p>é‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±ä¸èƒ½å•çº¯çš„ä½¿ç”¨<code>javac GuavaTest.java</code> è€Œæ˜¯éœ€è¦ä½¿ç”¨java -cp æŒ‡å®šå¤–éƒ¨ä¾èµ–çš„jarè·¯å¾„ï¼Œå¯ä»¥çœ‹åˆ°åŠ äº† -cp å‚æ•°æŒ‡å®šå¤–éƒ¨ä¾èµ–çš„jarä»¥åç¼–è¯‘æˆåŠŸäº†</p><pre class=" language-shell"><code class="language-shell">âœ  compiler javac -cp guava-27.1-jre.jar GuavaTest.javaâœ  compiler ls -lrttotal 5408-rw-r--r--  1 xxx  staff  2746671 11  5 09:33 guava-27.1-jre.jar-rw-r--r--@ 1 xxx  staff      119 11  5 22:11 Test1.java-rw-r--r--@ 1 xxx  staff      112 11  5 22:20 B.java-rw-r--r--@ 1 xxx  staff      113 11  5 22:21 A.java-rw-r--r--@ 1 xxx  staff      663 11  5 22:54 GuavaTest.java-rw-r--r--  1 xxx  staff     1548 11  5 22:59 GuavaTest.class</code></pre><p>è¿™ä¸ªæ—¶å€™ä½¿ç”¨<code>java GuavaTest</code>å»è¿è¡Œç¨‹åºæ˜¯å¦å¯è¡Œå‘¢ï¼Ÿ</p><pre class=" language-shell"><code class="language-shell">âœ  compiler java GuavaTestException in thread "main" java.lang.NoClassDefFoundError: com/google/common/io/Files    at GuavaTest.main(GuavaTest.java:19)Caused by: java.lang.ClassNotFoundException: com.google.common.io.Files    at java.net.URLClassLoader.findClass(URLClassLoader.java:382)    at java.lang.ClassLoader.loadClass(ClassLoader.java:424)    at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:349)    at java.lang.ClassLoader.loadClass(ClassLoader.java:357)    ... 1 more</code></pre><p>ç­”æ¡ˆå½“ç„¶æ˜¯no</p><p>è¿™é‡Œè¿è¡Œçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä½¿ç”¨ -cp å‚æ•°æŒ‡å®šå¤–éƒ¨ä¾èµ–çš„jaræ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°ä¾ç„¶æŠ¥é”™ï¼Œå®é™…ä¸Šå½“æˆ‘ä»¬ä½¿ç”¨cpå‚æ•°ä»¥åæŒ‡å®šå¤–éƒ¨ä¾èµ–jarä»¥åï¼Œè€Œå¹¶æ²¡æœ‰åŒ…å«å½“å‰ç›®å½•ï¼Œå°±ç®—ç¼–è¯‘æˆåŠŸï¼Œä¹Ÿæ˜¯æ‰¾ä¸åˆ°ä¸»ç±»çš„ã€‚</p><pre class=" language-shell"><code class="language-shell">âœ  compiler java -cp guava-27.1-jre.jar GuavaTesté”™è¯¯: æ‰¾ä¸åˆ°æˆ–æ— æ³•åŠ è½½ä¸»ç±» GuavaTest</code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥æŠŠå½“å‰è·¯å¾„ä¹ŸåŠ è¿›å»ï¼Œè¿™é‡Œç‰¹åˆ«æ³¨æ„çš„å°±æ˜¯ï¼Œå’Œä¸Šä¸€æ¬¡çš„å‘½ä»¤ç›¸æ¯”ï¼Œæ·»åŠ äº†<code>:.</code>ï¼Œ<code>:</code> ä½œä¸ºåˆ†éš”ï¼Œ<code>.</code> è¡¨ç¤ºå½“å‰è·¯å¾„ã€‚å½“ç„¶ä¹Ÿæœ‰åšå®¢æŒ‡å‡ºï¼Œåœ¨Linuxä¸‹é¢ä½¿ç”¨<code>:</code>åˆ†éš”ï¼Œä½†æ˜¯åœ¨Windowsä¸‹é¢ä½¿ç”¨<code>;</code>åˆ†éš”ï¼Œå› ä¸ºæˆ‘æ˜¯Macï¼Œæ²¡æœ‰Windowså»éªŒè¯ï¼Œè¿™é‡Œå¦‚æœæœ‰éœ€è¦å°±è‡ªå·±éªŒè¯ä¸€ä¸‹å³å¯ã€‚å°±å¯ä»¥çœ‹åˆ°å½“å‰è¯»å–é™¤äº†A.javaæ–‡ä»¶ä¸­çš„å†…å®¹</p><pre class=" language-shell"><code class="language-shell">âœ  compiler java -cp guava-27.1-jre.jar:. GuavaTestpublic class A {    public void sayHi() {        System.out.println("æˆ‘æ˜¯ class A  hello world!!!");    }}</code></pre><h2 id="ç¼–è¯‘æºæ–‡ä»¶ä¸­å¸¦æœ‰packageçš„æ–‡ä»¶"><a href="#ç¼–è¯‘æºæ–‡ä»¶ä¸­å¸¦æœ‰packageçš„æ–‡ä»¶" class="headerlink" title="ç¼–è¯‘æºæ–‡ä»¶ä¸­å¸¦æœ‰packageçš„æ–‡ä»¶"></a>ç¼–è¯‘æºæ–‡ä»¶ä¸­å¸¦æœ‰packageçš„æ–‡ä»¶</h2><p>ä¸Šé¢æˆ‘ä»¬æè¿°äº†ç¼–è¯‘å•ä¸ªæ–‡ä»¶ï¼Œä¸¤ä¸ªç›¸äº’ä¾èµ–çš„æ–‡ä»¶ä»¥åŠä¾èµ–å¤–éƒ¨æ–‡ä»¶çš„å¤„ç†æ–¹å¼ï¼Œå¦‚æœåœ¨æˆ‘ä»¬çš„æºæ–‡ä»¶ä¸­åŒ…å«packageåˆè¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­æ¥çœ‹ï¼Œé¦–å…ˆæˆ‘ä»¬ç»™A.javaå’ŒB.javaåˆ†åˆ«æ·»åŠ ä¸Špackage</p><ul><li>A.java</li></ul><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> compiler<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æˆ‘æ˜¯ class A  hello world!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><ul><li>B.java</li></ul><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> compiler<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        A a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        a<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨javacè¿›è¡Œç¼–è¯‘ï¼Œå¯ä»¥çœ‹åˆ°A.javaå¯ä»¥æ­£å¸¸ç¼–è¯‘ï¼Œä½†æ˜¯B.javaç¼–è¯‘å°±å‡ºé”™äº†ã€‚è¿™æ˜¯å› ä¸ºï¼Œæ·»åŠ äº†packageè¯­å¥åï¼Œç¼–è¯‘å™¨éœ€è¦æ‰¾çš„æ˜¯compiler.Aç±»ï¼Œç¼–è¯‘å™¨ä¼šé¦–å…ˆæ‰¾åˆ°compilerç›®å½•ï¼Œç„¶åå†ä»compilerç›®å½•ä¸­æ‰¾åˆ°Aï¼Œæ­¤æ—¶å½“å‰ç›®å½•ä¸­(compilerç›®å½•å†…)ä¸å­˜åœ¨compilerå­ç›®å½•ï¼Œå› æ­¤ï¼Œç¼–è¯‘å™¨æ‰¾ä¸åˆ°Aç±»ï¼Œç¼–è¯‘å¤±è´¥ã€‚è¿™è¯´æ˜æˆ‘ä»¬åŒ…å«çš„ç±»è·¯å¾„éœ€è¦åŒ…æ‹¬ç±»æ‰€åœ¨çš„åŒ…ï¼Œ<strong>è¿™é‡Œéœ€è¦åŒ…å«compilerç›®å½•çš„ä¸Šä¸€çº§å­ç›®å½•</strong>ã€‚</p><pre class=" language-shell"><code class="language-shell">âœ  compiler javac A.javaâœ  compiler javac B.javaB.java:5: é”™è¯¯: æ‰¾ä¸åˆ°ç¬¦å·        A a = new A();        ^  ç¬¦å·:   ç±» A  ä½ç½®: ç±» BB.java:5: é”™è¯¯: æ‰¾ä¸åˆ°ç¬¦å·        A a = new A();                  ^  ç¬¦å·:   ç±» A  ä½ç½®: ç±» B2 ä¸ªé”™è¯¯</code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç¼–è¯‘çš„æ—¶å€™å°±éœ€è¦æŒ‡å®šcompilerçš„ä¸Šä¸€çº§å­ç›®å½•</p><pre class=" language-shell"><code class="language-shell">âœ  compiler ls -lrttotal 5400-rw-r--r--  1 xxx  staff  2746671 11  5 09:33 guava-27.1-jre.jar-rw-r--r--@ 1 xxx  staff      119 11  5 22:11 Test1.java-rw-r--r--@ 1 xxx  staff      663 11  5 22:54 GuavaTest.java-rw-r--r--@ 1 xxx  staff      131 11  5 23:19 B.java-rw-r--r--@ 1 xxx  staff      131 11  5 23:19 A.java# æ³¨æ„è¿™é‡Œä½¿ç”¨äº†ä¸¤ä¸ª.. è¡¨ç¤ºä¸Šä¸€çº§ç›®å½•ï¼Œå› ä¸ºBé‡Œé¢ä¾èµ–äº†Aï¼Œæ‰€æœ‰ä¹Ÿä¼šæŠŠA.javaè‡ªåŠ¨ç¼–è¯‘ï¼ŒA.javaå¯ä»¥ä¸ç®¡âœ  compiler javac -cp .. B.javaâœ  compiler ls -lrttotal 5416-rw-r--r--  1 xxx  staff  2746671 11  5 09:33 guava-27.1-jre.jar-rw-r--r--@ 1 xxx  staff      119 11  5 22:11 Test1.java-rw-r--r--@ 1 xxx  staff      663 11  5 22:54 GuavaTest.java-rw-r--r--@ 1 xxx  staff      131 11  5 23:19 B.java-rw-r--r--@ 1 xxx  staff      131 11  5 23:19 A.java-rw-r--r--  1 xxx  staff      315 11  5 23:28 B.class-rw-r--r--  1 xxx  staff      411 11  5 23:28 A.class# è¿è¡Œæ˜¯ä¹Ÿä¸€æ ·ï¼Œéœ€è¦.. æŒ‡å®šåˆ°ä¸Šä¸€çº§ç›®å½•ï¼Œå¹¶ä¸”è¦ä½¿ç”¨compiler.Bâœ  compiler java -cp .. compiler.Bæˆ‘æ˜¯ class A  hello world!!! # A.javaä¸­çš„è¾“å‡ºè¯­å¥</code></pre><h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h1><p>ä»¥ä¸Šå†…å®¹è™½ç„¶å¹³æ—¶å¾ˆå°‘ç”¨åˆ°ï¼Œåº”ç”¨åœºæ™¯è™½ç„¶ä¸å¤šï¼Œä½†æ˜¯ä¹Ÿæ˜¯çŸ¥è¯†ç‚¹çš„ä¸€æ¬¡å·©å›ºå¤ä¹ ï¼Œæœ‰ä¸è¶³çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨webpackæ„å»ºvueé¡¹ç›®</title>
      <link href="2019/10/20/web-vue-starter/"/>
      <url>2019/10/20/web-vue-starter/</url>
      
        <content type="html"><![CDATA[<h1 id="å®‰è£…nodejs"><a href="#å®‰è£…nodejs" class="headerlink" title="å®‰è£…nodejs"></a>å®‰è£…nodejs</h1><p><a href="https://nodejs.org/zh-cn/download/">Nodejs å®˜ç½‘ä¸‹è½½åœ°å€</a></p><p>æ¨èä¸‹è½½LTSé•¿æœŸæ”¯æŒç‰ˆæœ¬ï¼Œç„¶åä¸‹ä¸€æ­¥å®‰è£…å³å¯</p><h2 id="æŸ¥çœ‹-nodeç‰ˆæœ¬"><a href="#æŸ¥çœ‹-nodeç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹ nodeç‰ˆæœ¬"></a>æŸ¥çœ‹ nodeç‰ˆæœ¬</h2><pre class=" language-shell"><code class="language-shell">node -v# ç»“æœâœ  ~ node -vv10.16.3âœ  ~</code></pre><h2 id="æŸ¥çœ‹-npm-ç‰ˆæœ¬"><a href="#æŸ¥çœ‹-npm-ç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹ npm ç‰ˆæœ¬"></a>æŸ¥çœ‹ npm ç‰ˆæœ¬</h2><pre class=" language-shell"><code class="language-shell">npm -v# ç»“æœâœ  ~ npm -v6.11.3âœ  ~</code></pre><h1 id="å®‰è£…vueç»„ä»¶ä»¥åŠwebpack"><a href="#å®‰è£…vueç»„ä»¶ä»¥åŠwebpack" class="headerlink" title="å®‰è£…vueç»„ä»¶ä»¥åŠwebpack"></a>å®‰è£…vueç»„ä»¶ä»¥åŠwebpack</h1><h2 id="å®‰è£…-vue-cli"><a href="#å®‰è£…-vue-cli" class="headerlink" title="å®‰è£… @vue/cli"></a>å®‰è£… @vue/cli</h2><pre class=" language-shell"><code class="language-shell">npm install -g @vue/cli</code></pre><h2 id="å®‰è£…-vue-cli-init"><a href="#å®‰è£…-vue-cli-init" class="headerlink" title="å®‰è£… @vue/cli-init"></a>å®‰è£… @vue/cli-init</h2><pre class=" language-shell"><code class="language-shell">npm install -g @vue/cli-init</code></pre><h2 id="å®‰è£…-webpack"><a href="#å®‰è£…-webpack" class="headerlink" title="å®‰è£… webpack"></a>å®‰è£… webpack</h2><pre class=" language-shell"><code class="language-shell">npm install webpack webpack-cli -g</code></pre><h1 id="åˆ›å»ºvueé¡¹ç›®"><a href="#åˆ›å»ºvueé¡¹ç›®" class="headerlink" title="åˆ›å»ºvueé¡¹ç›®"></a>åˆ›å»ºvueé¡¹ç›®</h1><pre class=" language-javascript"><code class="language-javascript">vue create vue<span class="token operator">-</span>template</code></pre><p>è¾“å…¥<code>vue create vue-template</code>ä»¥åï¼ŒæŒ‰ç…§æç¤ºé€‰æ‹©å¯¹åº”çš„é€‰å‹ï¼Œå³å¯åˆ›å»ºä¸€ä¸ªvueè„šæ‰‹æ¶é¡¹ç›®</p><h1 id="å¸¸ç”¨å­¦ä¹ ç½‘ç«™"><a href="#å¸¸ç”¨å­¦ä¹ ç½‘ç«™" class="headerlink" title="å¸¸ç”¨å­¦ä¹ ç½‘ç«™"></a>å¸¸ç”¨å­¦ä¹ ç½‘ç«™</h1><blockquote><p>Vueå®˜ç½‘ï¼š<a href="https://cn.vuejs.org/index.html">https://cn.vuejs.org/index.html</a></p><p>Vueè·¯ç”±ï¼š<a href="https://router.vuejs.org/">https://router.vuejs.org/</a></p><p>Vuexï¼š<a href="https://vuex.vuejs.org/zh/guide/">https://vuex.vuejs.org/zh/guide/</a></p><p>ES6è¯­æ³•ï¼š<a href="http://es6.ruanyifeng.com/">http://es6.ruanyifeng.com/</a></p><p>JSå·¥å…·åº“ï¼š<a href="https://www.lodashjs.com/docs/latest">https://www.lodashjs.com/docs/latest</a></p><p>æ—¥æœŸå¤„ç†ï¼š<a href="http://momentjs.cn/docs/">http://momentjs.cn/docs/</a></p><p>ç½‘ç»œè¯·æ±‚ï¼š<a href="http://www.axios-js.com/zh-cn/docs/">http://www.axios-js.com/zh-cn/docs/</a></p><p>CSSé¢„ç¼–è¯‘ï¼š<a href="https://www.sass.hk/docs/">https://www.sass.hk/docs/</a></p><p>Babelï¼š<a href="http://www.ruanyifeng.com/blog/2016/01/babel.html">http://www.ruanyifeng.com/blog/2016/01/babel.html</a></p><p>Flexå¸ƒå±€ï¼š<a href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html?utm_source=tuicool">http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html?utm_source=tuicool</a></p><p>HTMLæ•™ç¨‹ï¼š<a href="https://www.w3school.com.cn/html/index.asp">https://www.w3school.com.cn/html/index.asp</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Webå¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mavenæ„å»ºSpring-Bootå¤šæ¨¡å—é¡¹ç›®</title>
      <link href="2019/07/27/spring-boot-multi-module-project/"/>
      <url>2019/07/27/spring-boot-multi-module-project/</url>
      
        <content type="html"><![CDATA[<p>æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­è‚¯å®šä¼šç”¨åˆ°mavenæ„å»ºé¡¹ç›®ï¼Œç”¨æ¥ç®¡ç†ä¾èµ–çš„jaræ–‡ä»¶ï¼Œå¯¹äºä½¿ç”¨mavenæ„å»ºå¤šmoduleé¡¹ç›®å¾ˆå¤šæ—¶å€™è¿˜æ˜¯ä¸æ€ä¹ˆç†Ÿæ‚‰ï¼Œè¿™ç¯‡æ–‡ç« å°†å¸¦ç€å¤§å®¶ä»å¤´å¼€å§‹æ­å»ºä¸€ä¸ªä½¿ç”¨mavenæ„å»ºçš„å¤šmoduleé¡¹ç›®ï¼Œå¹¶é›†æˆå¸¸ç”¨çš„é¡¹ç›®æ’ä»¶ã€‚</p><h2 id="ä½¿ç”¨Spring-Initializråˆ›å»ºé¡¹ç›®"><a href="#ä½¿ç”¨Spring-Initializråˆ›å»ºé¡¹ç›®" class="headerlink" title="ä½¿ç”¨Spring Initializråˆ›å»ºé¡¹ç›®"></a>ä½¿ç”¨Spring Initializråˆ›å»ºé¡¹ç›®</h2><p>è¿™ä¸€æ­¥å¾ˆç®€å•ï¼Œç›´æ¥ä½¿ç”¨ideaè‡ªå¸¦çš„åŠŸèƒ½ï¼Œåˆ›å»ºä¸€ä¸ªspring-booté¡¹ç›®</p><p><img src="/images/multi-module/image-20190715083738989.png" alt="image-20190715083738989"></p><p><img src="/images/multi-module/image-20190715084023794.png" alt="image-20190715084023794"></p><p><img src="/images/multi-module/image-20190715084104125.png" alt="image-20190715084104125"></p><p><img src="/images/multi-module/image-20190715084159602.png" alt="image-20190715084159602"></p><p>ä¸€ä¸ªåˆå§‹åŒ–çš„é¡¹ç›®ç›®å½•ç»“æ„å¦‚ä¸‹</p><p><img src="/images/multi-module/image-20190727103316490.png" alt="image-20190727103316490"></p><h2 id="æ·»åŠ æ–°çš„module"><a href="#æ·»åŠ æ–°çš„module" class="headerlink" title="æ·»åŠ æ–°çš„module"></a>æ·»åŠ æ–°çš„module</h2><p>ä¸€ä¸ªé¡¹ç›®ä¸­å¯èƒ½éœ€è¦ç”¨åˆ°å¤šä¸ªå­æ¨¡å—ï¼Œä½†æ˜¯åˆæœ‰ä¸€äº›å…¬å…±çš„å·¥å…·ç±»ï¼Œmodelä¹‹ç±»çš„ï¼Œä½†æ˜¯åˆä¸æƒ³ä¼ åˆ°nexusç§æœä¸Šé¢å»ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ·»åŠ å­moduleï¼Œç„¶åinstallä»¥åï¼Œæä¾›ç»™å½“å‰projectæ¥ä½¿ç”¨äº†ã€‚æ¯”å¦‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªcommonå’Œä¸€ä¸ªæä¾›apiæœåŠ¡çš„moduleï¼Œé‚£ä¹ˆå¯ä»¥æ–°å»ºä¸¤ä¸ªmoduleï¼Œparentä¸‹é¢çš„srcç›®å½•ä¹Ÿå°±æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤ã€‚åœ¨projectä¸Šé¢å³é”®æ–°å»ºmoduleï¼Œæ­¥éª¤å’Œæ–°å»ºä¸€ä¸ªmaven projectæ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œå°±ä¸åšæˆªå›¾å±•ç¤ºäº†ã€‚å¤šmoduleçš„ä¸€ä¸ªå®Œæ•´ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/images/multi-module/image-20190727103756285.png" alt="image-20190727103756285"></p><h2 id="moduleé—´ç›¸äº’ä¾èµ–"><a href="#moduleé—´ç›¸äº’ä¾èµ–" class="headerlink" title="moduleé—´ç›¸äº’ä¾èµ–"></a>moduleé—´ç›¸äº’ä¾èµ–</h2><p>å¤šmoduleå°±æ˜¯ä¸ºäº†æ–¹ä¾¿å…¬å…±éƒ¨åˆ†è¢«å…¶ä»–moduleå¼•ç”¨ï¼Œå…¶å®å¼•ç”¨ä¹Ÿå°±å¾ˆç®€å•äº†ï¼Œå°±ç±»ä¼¼äºä¸€ä¸ªæ­£å¸¸çš„maven depå°±å¯ä»¥ï¼Œæ¯”å¦‚åœ¨multi-apiè¿™ä¸ªmoduleä¸­å¼•ç”¨multi-commonï¼Œè¿™æ ·ä¸€æ¥ï¼Œmulti-commonä¸­çš„ç±»å°±èƒ½è¢«multi-apiæ­£å¸¸è®¿é—®ä½¿ç”¨äº†</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.xiaozhangge<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>multi-common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>åœ¨multi-commonå†™äº†ä¸€ä¸ªç±»å« <em>com.xiaozhangge.common.util.IdHelper</em> é‡Œé¢æœ‰ä¸€ä¸ªè·å–UUIDçš„æ–¹æ³•ï¼Œæ—©å…¶ä»–å·²ç»å¼•ç”¨multi-commonçš„è¿™ä¸ªmoduleä¸­ï¼Œåªéœ€è¦ç›´æ¥è°ƒç”¨å³å¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>common<span class="token punctuation">.</span>util<span class="token punctuation">.</span>IdHelper<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019-07-27. */</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainApplicatiom</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è¿™é‡Œçš„IdHelper ç±»ï¼Œæ¥è‡ªäºmulti-common module</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"uuid [{}]"</span><span class="token punctuation">,</span> IdHelper<span class="token punctuation">.</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="æ‰“åŒ…å¤šmoduleé¡¹ç›®"><a href="#æ‰“åŒ…å¤šmoduleé¡¹ç›®" class="headerlink" title="æ‰“åŒ…å¤šmoduleé¡¹ç›®"></a>æ‰“åŒ…å¤šmoduleé¡¹ç›®</h2><p>å…³äºå¤šmoduleé¡¹ç›®æ‰“åŒ…ï¼Œspring bootå‡çº§åˆ°2.0ä»¥åï¼Œæ‰“åŒ…æ’ä»¶æœ‰ä¸€äº›å°å˜åŒ–ï¼Œæ¯”å¦‚åªåœ¨multi-commonåŠ ä¸€ä¸ªå·¥å…·ç±»ï¼Œä½¿ç”¨mavenè‡ªå¸¦çš„æ‰“åŒ…å·¥å…·æ‰“åŒ…ï¼Œä¼šæŠ¥é”™è¯¯ï¼Œä½†æ˜¯ä¸å½±å“é¡¹ç›®æ­£å¸¸è¿è¡Œã€‚æ—¥å¿—å¦‚ä¸‹</p><pre class=" language-verilog"><code class="language-verilog"><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Scanning <span class="token keyword">for</span> projects<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Reactor Build Order<span class="token punctuation">:</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> life<span class="token operator">-</span>multi<span class="token operator">-</span><span class="token keyword">module</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> multi<span class="token operator">-</span>common<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> multi<span class="token operator">-</span>api<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span>                                                                         <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Building life<span class="token operator">-</span>multi<span class="token operator">-</span><span class="token keyword">module</span> <span class="token number">0.0</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">-</span>SNAPSHOT<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">---</span> spring<span class="token operator">-</span>boot<span class="token operator">-</span>maven<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">2.1</span><span class="token punctuation">.</span><span class="token number">6</span><span class="token punctuation">.</span>RELEASE<span class="token punctuation">:</span>repackage <span class="token punctuation">(</span>repackage<span class="token punctuation">)</span> @ life<span class="token operator">-</span>multi<span class="token operator">-</span><span class="token keyword">module</span> <span class="token operator">---</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span>                                                                         <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Building multi<span class="token operator">-</span>common <span class="token number">0.0</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">-</span>SNAPSHOT<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">---</span> maven<span class="token operator">-</span>resources<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">3.1</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">:</span>resources <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">-</span>resources<span class="token punctuation">)</span> @ multi<span class="token operator">-</span>common <span class="token operator">---</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Using 'UTF<span class="token operator">-</span><span class="token number">8</span>' encoding to copy filtered resources<span class="token punctuation">.</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Copying <span class="token number">0</span> resource<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Copying <span class="token number">0</span> resource<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">---</span> maven<span class="token operator">-</span>compiler<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">3.8</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">:</span>compile <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">-</span>compile<span class="token punctuation">)</span> @ multi<span class="token operator">-</span>common <span class="token operator">---</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Changes detected <span class="token operator">-</span> recompiling the <span class="token keyword">module</span><span class="token operator">!</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Compiling <span class="token number">2</span> source files to <span class="token operator">/</span>Users<span class="token operator">/</span>xiaozhangge<span class="token operator">/</span>tmp<span class="token operator">/</span>life<span class="token operator">-</span>multi<span class="token operator">-</span><span class="token keyword">module</span><span class="token operator">/</span>multi<span class="token operator">-</span>common<span class="token operator">/</span>target<span class="token operator">/</span>classes<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">---</span> maven<span class="token operator">-</span>resources<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">3.1</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">:</span>testResources <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">-</span>testResources<span class="token punctuation">)</span> @ multi<span class="token operator">-</span>common <span class="token operator">---</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Using 'UTF<span class="token operator">-</span><span class="token number">8</span>' encoding to copy filtered resources<span class="token punctuation">.</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> skip non existing resourceDirectory <span class="token operator">/</span>Users<span class="token operator">/</span>xiaozhangge<span class="token operator">/</span>tmp<span class="token operator">/</span>life<span class="token operator">-</span>multi<span class="token operator">-</span><span class="token keyword">module</span><span class="token operator">/</span>multi<span class="token operator">-</span>common<span class="token operator">/</span>src<span class="token operator">/</span>test<span class="token operator">/</span>resources<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">---</span> maven<span class="token operator">-</span>compiler<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">3.8</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">:</span>testCompile <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">-</span>testCompile<span class="token punctuation">)</span> @ multi<span class="token operator">-</span>common <span class="token operator">---</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Changes detected <span class="token operator">-</span> recompiling the <span class="token keyword">module</span><span class="token operator">!</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">---</span> maven<span class="token operator">-</span>surefire<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">2.22</span><span class="token punctuation">.</span><span class="token number">2</span><span class="token punctuation">:</span>test <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">-</span>test<span class="token punctuation">)</span> @ multi<span class="token operator">-</span>common <span class="token operator">---</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Tests are skipped<span class="token punctuation">.</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">---</span> maven<span class="token operator">-</span>jar<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">3.1</span><span class="token punctuation">.</span><span class="token number">2</span><span class="token punctuation">:</span>jar <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">-</span>jar<span class="token punctuation">)</span> @ multi<span class="token operator">-</span>common <span class="token operator">---</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Building jar<span class="token punctuation">:</span> <span class="token operator">/</span>Users<span class="token operator">/</span>xiaozhangge<span class="token operator">/</span>tmp<span class="token operator">/</span>life<span class="token operator">-</span>multi<span class="token operator">-</span><span class="token keyword">module</span><span class="token operator">/</span>multi<span class="token operator">-</span>common<span class="token operator">/</span>target<span class="token operator">/</span>multi<span class="token operator">-</span>common<span class="token operator">-</span><span class="token number">0.0</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">-</span>SNAPSHOT<span class="token punctuation">.</span>jar<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">---</span> spring<span class="token operator">-</span>boot<span class="token operator">-</span>maven<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">2.1</span><span class="token punctuation">.</span><span class="token number">6</span><span class="token punctuation">.</span>RELEASE<span class="token punctuation">:</span>repackage <span class="token punctuation">(</span>repackage<span class="token punctuation">)</span> @ multi<span class="token operator">-</span>common <span class="token operator">---</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Reactor Summary<span class="token punctuation">:</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> life<span class="token operator">-</span>multi<span class="token operator">-</span><span class="token keyword">module</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> SUCCESS <span class="token punctuation">[</span>  <span class="token number">1.037</span> s<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> multi<span class="token operator">-</span>common <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> FAILURE <span class="token punctuation">[</span>  <span class="token number">2.536</span> s<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> multi<span class="token operator">-</span>api <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> SKIPPED<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> BUILD FAILURE<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Total <span class="token keyword">time</span><span class="token punctuation">:</span> <span class="token number">4.037</span> s<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Finished at<span class="token punctuation">:</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">27</span>T10<span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token operator">+</span><span class="token number">08</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Final Memory<span class="token punctuation">:</span> <span class="token number">35</span>M<span class="token operator">/</span><span class="token number">293</span>M<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> Failed to execute goal org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">:</span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>maven<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">2.1</span><span class="token punctuation">.</span><span class="token number">6</span><span class="token punctuation">.</span>RELEASE<span class="token punctuation">:</span>repackage <span class="token punctuation">(</span>repackage<span class="token punctuation">)</span> on project multi<span class="token operator">-</span>common<span class="token punctuation">:</span> Execution repackage of goal org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">:</span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>maven<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">2.1</span><span class="token punctuation">.</span><span class="token number">6</span><span class="token punctuation">.</span>RELEASE<span class="token punctuation">:</span>repackage failed<span class="token punctuation">:</span> Unable to find main <span class="token keyword">class</span> <span class="token operator">-></span> <span class="token punctuation">[</span>Help <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> To see the full stack trace of the errors<span class="token punctuation">,</span> re<span class="token operator">-</span>run Maven <span class="token keyword">with</span> the <span class="token operator">-</span>e switch<span class="token punctuation">.</span><span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> Re<span class="token operator">-</span>run Maven using the <span class="token operator">-</span>X switch to enable full debug logging<span class="token punctuation">.</span><span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> For more information about the errors <span class="token keyword">and</span> possible solutions<span class="token punctuation">,</span> please read the following articles<span class="token punctuation">:</span><span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>Help <span class="token number">1</span><span class="token punctuation">]</span> http<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//cwiki.apache.org/confluence/display/MAVEN/PluginExecutionException</span><span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> After correcting the problems<span class="token punctuation">,</span> you can resume the build <span class="token keyword">with</span> the command<span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span>   mvn <span class="token operator">&lt;</span>goals<span class="token operator">></span> <span class="token operator">-</span>rf <span class="token punctuation">:</span>multi<span class="token operator">-</span>common</code></pre><p>æ„æ€å°±æ˜¯è¯´æˆ‘ä»¬åœ¨multi-commonè¿™ä¸ªmoduleä¸­ç¼ºå°‘äº†main classï¼Œé‚£ä¹ˆæˆ‘ä»¬åŠ ä¸Šåœ¨multi-commonä¸­æ·»åŠ ä¸€ä¸ªç±»ï¼Œåªæœ‰ä¸€ä¸ªmainæ–¹æ³•ï¼Œç„¶åå†æ¥æ‰“åŒ…ï¼Œä¾æ—§æŠ¥é”™ï¼Œæ—¥å¿—å¦‚ä¸‹</p><pre class=" language-verilog"><code class="language-verilog"><span class="token operator">/</span>Library<span class="token operator">/</span>Java<span class="token operator">/</span>JavaVirtualMachines<span class="token operator">/</span>jdk1<span class="token number">.8</span><span class="token punctuation">.</span><span class="token number">0_201</span><span class="token punctuation">.</span>jdk<span class="token operator">/</span>Contents<span class="token operator">/</span>Home<span class="token operator">/</span>bin<span class="token operator">/</span>java <span class="token operator">-</span>Dvisualvm<span class="token punctuation">.</span>id<span class="token operator">=</span><span class="token number">375540266385044</span> <span class="token operator">-</span>Dmaven<span class="token punctuation">.</span>multiModuleProjectDirectory<span class="token operator">=/</span>Users<span class="token operator">/</span>xiaozhangge<span class="token operator">/</span>tmp<span class="token operator">/</span>life<span class="token operator">-</span>multi<span class="token operator">-</span><span class="token keyword">module</span> <span class="token string">"-Dmaven.home=/Applications/IntelliJ IDEA.app/Contents/plugins/maven/lib/maven3"</span> <span class="token string">"-Dclassworlds.conf=/Applications/IntelliJ IDEA.app/Contents/plugins/maven/lib/maven3/bin/m2.conf"</span> <span class="token string">"-javaagent:/Applications/IntelliJ IDEA.app/Contents/lib/idea_rt.jar=56994:/Applications/IntelliJ IDEA.app/Contents/bin"</span> <span class="token operator">-</span>Dfile<span class="token punctuation">.</span>encoding<span class="token operator">=</span>UTF<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">-</span>classpath <span class="token string">"/Applications/IntelliJ IDEA.app/Contents/plugins/maven/lib/maven3/boot/plexus-classworlds-2.5.2.jar"</span> org<span class="token punctuation">.</span>codehaus<span class="token punctuation">.</span>classworlds<span class="token punctuation">.</span>Launcher <span class="token operator">-</span>Didea<span class="token punctuation">.</span>version<span class="token operator">=</span><span class="token number">2018.3</span><span class="token punctuation">.</span><span class="token number">5</span> <span class="token operator">-</span>DskipTests<span class="token operator">=</span>true <span class="token keyword">package</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Scanning <span class="token keyword">for</span> projects<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Reactor Build Order<span class="token punctuation">:</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> life<span class="token operator">-</span>multi<span class="token operator">-</span><span class="token keyword">module</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> multi<span class="token operator">-</span>common<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> multi<span class="token operator">-</span>api<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span>                                                                         <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Building life<span class="token operator">-</span>multi<span class="token operator">-</span><span class="token keyword">module</span> <span class="token number">0.0</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">-</span>SNAPSHOT<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">---</span> spring<span class="token operator">-</span>boot<span class="token operator">-</span>maven<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">2.1</span><span class="token punctuation">.</span><span class="token number">6</span><span class="token punctuation">.</span>RELEASE<span class="token punctuation">:</span>repackage <span class="token punctuation">(</span>repackage<span class="token punctuation">)</span> @ life<span class="token operator">-</span>multi<span class="token operator">-</span><span class="token keyword">module</span> <span class="token operator">---</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span>                                                                         <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Building multi<span class="token operator">-</span>common <span class="token number">0.0</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">-</span>SNAPSHOT<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">---</span> maven<span class="token operator">-</span>resources<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">3.1</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">:</span>resources <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">-</span>resources<span class="token punctuation">)</span> @ multi<span class="token operator">-</span>common <span class="token operator">---</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Using 'UTF<span class="token operator">-</span><span class="token number">8</span>' encoding to copy filtered resources<span class="token punctuation">.</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Copying <span class="token number">0</span> resource<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Copying <span class="token number">0</span> resource<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">---</span> maven<span class="token operator">-</span>compiler<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">3.8</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">:</span>compile <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">-</span>compile<span class="token punctuation">)</span> @ multi<span class="token operator">-</span>common <span class="token operator">---</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Changes detected <span class="token operator">-</span> recompiling the <span class="token keyword">module</span><span class="token operator">!</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Compiling <span class="token number">2</span> source files to <span class="token operator">/</span>Users<span class="token operator">/</span>xiaozhangge<span class="token operator">/</span>tmp<span class="token operator">/</span>life<span class="token operator">-</span>multi<span class="token operator">-</span><span class="token keyword">module</span><span class="token operator">/</span>multi<span class="token operator">-</span>common<span class="token operator">/</span>target<span class="token operator">/</span>classes<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">---</span> maven<span class="token operator">-</span>resources<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">3.1</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">:</span>testResources <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">-</span>testResources<span class="token punctuation">)</span> @ multi<span class="token operator">-</span>common <span class="token operator">---</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Using 'UTF<span class="token operator">-</span><span class="token number">8</span>' encoding to copy filtered resources<span class="token punctuation">.</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> skip non existing resourceDirectory <span class="token operator">/</span>Users<span class="token operator">/</span>xiaozhangge<span class="token operator">/</span>tmp<span class="token operator">/</span>life<span class="token operator">-</span>multi<span class="token operator">-</span><span class="token keyword">module</span><span class="token operator">/</span>multi<span class="token operator">-</span>common<span class="token operator">/</span>src<span class="token operator">/</span>test<span class="token operator">/</span>resources<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">---</span> maven<span class="token operator">-</span>compiler<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">3.8</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">:</span>testCompile <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">-</span>testCompile<span class="token punctuation">)</span> @ multi<span class="token operator">-</span>common <span class="token operator">---</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Changes detected <span class="token operator">-</span> recompiling the <span class="token keyword">module</span><span class="token operator">!</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">---</span> maven<span class="token operator">-</span>surefire<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">2.22</span><span class="token punctuation">.</span><span class="token number">2</span><span class="token punctuation">:</span>test <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">-</span>test<span class="token punctuation">)</span> @ multi<span class="token operator">-</span>common <span class="token operator">---</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Tests are skipped<span class="token punctuation">.</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">---</span> maven<span class="token operator">-</span>jar<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">3.1</span><span class="token punctuation">.</span><span class="token number">2</span><span class="token punctuation">:</span>jar <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">-</span>jar<span class="token punctuation">)</span> @ multi<span class="token operator">-</span>common <span class="token operator">---</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Building jar<span class="token punctuation">:</span> <span class="token operator">/</span>Users<span class="token operator">/</span>xiaozhangge<span class="token operator">/</span>tmp<span class="token operator">/</span>life<span class="token operator">-</span>multi<span class="token operator">-</span><span class="token keyword">module</span><span class="token operator">/</span>multi<span class="token operator">-</span>common<span class="token operator">/</span>target<span class="token operator">/</span>multi<span class="token operator">-</span>common<span class="token operator">-</span><span class="token number">0.0</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">-</span>SNAPSHOT<span class="token punctuation">.</span>jar<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">---</span> spring<span class="token operator">-</span>boot<span class="token operator">-</span>maven<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">2.1</span><span class="token punctuation">.</span><span class="token number">6</span><span class="token punctuation">.</span>RELEASE<span class="token punctuation">:</span>repackage <span class="token punctuation">(</span>repackage<span class="token punctuation">)</span> @ multi<span class="token operator">-</span>common <span class="token operator">---</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Replacing main artifact <span class="token keyword">with</span> repackaged archive<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span>                                                                         <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Building multi<span class="token operator">-</span>api <span class="token number">0.0</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">-</span>SNAPSHOT<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">---</span> maven<span class="token operator">-</span>resources<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">3.1</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">:</span>resources <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">-</span>resources<span class="token punctuation">)</span> @ multi<span class="token operator">-</span>api <span class="token operator">---</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Using 'UTF<span class="token operator">-</span><span class="token number">8</span>' encoding to copy filtered resources<span class="token punctuation">.</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Copying <span class="token number">0</span> resource<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Copying <span class="token number">0</span> resource<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">---</span> maven<span class="token operator">-</span>compiler<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">3.8</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">:</span>compile <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">-</span>compile<span class="token punctuation">)</span> @ multi<span class="token operator">-</span>api <span class="token operator">---</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Changes detected <span class="token operator">-</span> recompiling the <span class="token keyword">module</span><span class="token operator">!</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Compiling <span class="token number">1</span> source file to <span class="token operator">/</span>Users<span class="token operator">/</span>xiaozhangge<span class="token operator">/</span>tmp<span class="token operator">/</span>life<span class="token operator">-</span>multi<span class="token operator">-</span><span class="token keyword">module</span><span class="token operator">/</span>multi<span class="token operator">-</span>api<span class="token operator">/</span>target<span class="token operator">/</span>classes<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">-------------------------------------------------------------</span><span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> COMPILATION ERROR <span class="token punctuation">:</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">-------------------------------------------------------------</span><span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token operator">/</span>Users<span class="token operator">/</span>xiaozhangge<span class="token operator">/</span>tmp<span class="token operator">/</span>life<span class="token operator">-</span>multi<span class="token operator">-</span><span class="token keyword">module</span><span class="token operator">/</span>multi<span class="token operator">-</span>api<span class="token operator">/</span>src<span class="token operator">/</span>main<span class="token operator">/</span>java<span class="token operator">/</span>com<span class="token operator">/</span>xiaozhangge<span class="token operator">/</span>MainApplicatiom<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">]</span> ç¨‹åºåŒ…com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utilä¸å­˜åœ¨<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token number">1</span> error<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">-------------------------------------------------------------</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Reactor Summary<span class="token punctuation">:</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> life<span class="token operator">-</span>multi<span class="token operator">-</span><span class="token keyword">module</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> SUCCESS <span class="token punctuation">[</span>  <span class="token number">1.499</span> s<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> multi<span class="token operator">-</span>common <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> SUCCESS <span class="token punctuation">[</span>  <span class="token number">2.279</span> s<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> multi<span class="token operator">-</span>api <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> FAILURE <span class="token punctuation">[</span>  <span class="token number">0.540</span> s<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> BUILD FAILURE<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Total <span class="token keyword">time</span><span class="token punctuation">:</span> <span class="token number">4.828</span> s<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Finished at<span class="token punctuation">:</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">27</span>T10<span class="token punctuation">:</span><span class="token number">52</span><span class="token punctuation">:</span><span class="token number">45</span><span class="token operator">+</span><span class="token number">08</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Final Memory<span class="token punctuation">:</span> <span class="token number">38</span>M<span class="token operator">/</span><span class="token number">302</span>M<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token operator">------------------------------------------------------------------------</span><span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> Failed to execute goal org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>maven<span class="token punctuation">.</span>plugins<span class="token punctuation">:</span>maven<span class="token operator">-</span>compiler<span class="token operator">-</span>plugin<span class="token punctuation">:</span><span class="token number">3.8</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">:</span>compile <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token operator">-</span>compile<span class="token punctuation">)</span> on project multi<span class="token operator">-</span>api<span class="token punctuation">:</span> Compilation failure<span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token operator">/</span>Users<span class="token operator">/</span>xiaozhangge<span class="token operator">/</span>tmp<span class="token operator">/</span>life<span class="token operator">-</span>multi<span class="token operator">-</span><span class="token keyword">module</span><span class="token operator">/</span>multi<span class="token operator">-</span>api<span class="token operator">/</span>src<span class="token operator">/</span>main<span class="token operator">/</span>java<span class="token operator">/</span>com<span class="token operator">/</span>xiaozhangge<span class="token operator">/</span>MainApplicatiom<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">]</span> ç¨‹åºåŒ…com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utilä¸å­˜åœ¨<span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token operator">-></span> <span class="token punctuation">[</span>Help <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> To see the full stack trace of the errors<span class="token punctuation">,</span> re<span class="token operator">-</span>run Maven <span class="token keyword">with</span> the <span class="token operator">-</span>e switch<span class="token punctuation">.</span><span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> Re<span class="token operator">-</span>run Maven using the <span class="token operator">-</span>X switch to enable full debug logging<span class="token punctuation">.</span><span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> For more information about the errors <span class="token keyword">and</span> possible solutions<span class="token punctuation">,</span> please read the following articles<span class="token punctuation">:</span><span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>Help <span class="token number">1</span><span class="token punctuation">]</span> http<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//cwiki.apache.org/confluence/display/MAVEN/MojoFailureException</span><span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> After correcting the problems<span class="token punctuation">,</span> you can resume the build <span class="token keyword">with</span> the command<span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span>   mvn <span class="token operator">&lt;</span>goals<span class="token operator">></span> <span class="token operator">-</span>rf <span class="token punctuation">:</span>multi<span class="token operator">-</span>apiProcess finished <span class="token keyword">with</span> exit code <span class="token number">1</span></code></pre><p>è¿™ä¸ªé…ç½®ï¼Œåœ¨spring boot2.0ç‰ˆæœ¬ä¹‹å‰ï¼Œå…¶å®æ˜¯å®Œå…¨å¯ä»¥çš„ï¼Œåœ¨åˆ†æé”™è¯¯ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æ•´ä¸ªé¡¹ç›®çš„ç›®å½•ç»“æ„</p><p><img src="/images/multi-module/image-20190727105533948.png" alt="image-20190727105533948"></p><p>å¯ä»¥çœ‹åˆ°åœ¨multi-commonä¸‹é¢æœ‰ä¸¤ä¸ªclassï¼Œåœ¨multi-apiä¸‹é¢æœ‰ä¸€ä¸ªclassï¼Œé‚£é‡Œé¢çš„å†…å®¹å°±æ˜¯å¼•ç”¨äº†multi-commonä¸­çš„com.xiaozhangge.common.util.IdHelperï¼Œä½†æ˜¯ç°åœ¨é”™è¯¯æ—¥å¿—å´è¯´com.xiaozhangge.common.utilä¸å­˜åœ¨ï¼Œè¿™é‡Œå°±å¾ˆçº³é—·äº†å§ï¼Œæ¥ä¸‹æ¥ï¼Œä»‹ç»ä¸€ä¸‹spring bootçš„æ‰“åŒ…æ’ä»¶ï¼Œè¿˜å¾—å›åˆ°parent pom.xmlä¸­ï¼Œä½¿ç”¨Spring Initializråˆ›å»ºé¡¹ç›®åï¼Œé»˜è®¤æœ‰ä¸€ä¸ª spring-boot-maven-plugin è¿™ä¸ªmavenæ’ä»¶ï¼Œä¸»è¦åŸå› å°±åœ¨è¿™é‡Œï¼Œsprint boot2.0å‡çº§ä»¥åï¼Œå¯¹æ’ä»¶ä¹Ÿåšäº†ç›¸åº”çš„å‡çº§ï¼Œå¦‚æœè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦åœ¨æ­¤åŸºç¡€ä¸Šåšä¸€äº›é…ç½®</p><pre class=" language-xml"><code class="language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span></code></pre><p>pluginä¿®æ”¹ä»¥åï¼Œå…³äºconfigurationçš„é…ç½®ä»‹ç»ï¼Œå¯ä»¥çœ‹spring bootå®˜æ–¹çš„æ–‡æ¡£</p><p><a href="https://docs.spring.io/spring-boot/docs/current/maven-plugin/repackage-mojo.html">maven-plugin</a></p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>classifier</span><span class="token punctuation">></span></span>bootJar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>classifier</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputDirectory</span><span class="token punctuation">></span></span>${project.build.directory}/boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputDirectory</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span></code></pre><p>ä¿®æ”¹æ’ä»¶ä»¥åï¼Œåœ¨æ­¤æ‰§è¡Œæ‰“åŒ…å‘½ä»¤å°±å¯ä»¥æ­£å¸¸æ‰“åŒ…ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹æ‰“åŒ…ä»¥å targetç›®å½•çš„ç»“æœï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»ç›¸åº”çš„ç›®å½•çœ‹ä¸€ä¸‹æ–‡ä»¶çš„å¤§å°ï¼Œè¿™é‡Œæˆ‘å°±ä¸åœ¨æ‰©å±•äº†ï¼Œæ ¸å¿ƒæ—¥å¿—æˆ‘ä¹Ÿæœ‰åšæ ‡è®°</p><p><img src="/images/multi-module/image-20190727110524269.png" alt="image-20190727110524269"></p><p>å¥½äº†ï¼Œåˆ°è¿™é‡Œï¼Œä¸€ä¸ªå®Œæ•´çš„spring bootå¤šmoduleæ„å»ºçš„é¡¹ç›®éª¨æ¶åŸºæœ¬å®Œæˆäº†ï¼Œä¸‹é¢ä»‹ç»ä¸€äº›å®ç”¨çš„mavenæ’ä»¶ï¼Œé…åˆspring booté£Ÿç”¨æ›´ä½³ã€‚</p><p><a href="https://github.com/xiaomozhang/personal-life-multi-module">github</a></p><h2 id="å¸¸ç”¨æ’ä»¶ä½¿ç”¨ä»‹ç»"><a href="#å¸¸ç”¨æ’ä»¶ä½¿ç”¨ä»‹ç»" class="headerlink" title="å¸¸ç”¨æ’ä»¶ä½¿ç”¨ä»‹ç»"></a>å¸¸ç”¨æ’ä»¶ä½¿ç”¨ä»‹ç»</h2><h3 id="spring-boot-maven-plugin"><a href="#spring-boot-maven-plugin" class="headerlink" title="spring-boot-maven-plugin"></a>spring-boot-maven-plugin</h3><p>è¯¥æ’ä»¶ä¸»è¦ç”¨äºspring booté¡¹ç›®æ„å»ºå’Œæ‰“åŒ…ï¼Œä¸Šé¢æœ‰ç®€å•çš„ä»‹ç»å’Œå®˜ç½‘é“¾æ¥ï¼Œä¸»è¦å°±æ˜¯é…ç½®</p><h3 id="templating-maven-plugin"><a href="#templating-maven-plugin" class="headerlink" title="templating-maven-plugin"></a>templating-maven-plugin</h3><p>è¯¥æ’ä»¶ä¸»è¦ç”Ÿæˆä¸€ä¸ªæ¨¡æ¿ç±»ï¼Œå¯ä»¥ç›´æ¥è¯»å–maven pomä¸­çš„artifactIdã€groupIdã€versionç­‰ä¿¡æ¯ï¼Œä¸Šé¢çš„é¡¹ç›®æºç ä¸­æˆ‘ä¼šåšå‡ºç¤ºä¾‹ï¼Œç”¨äº†è¯¥æ’ä»¶ä»¥åï¼Œç¬¬ä¸€æ¬¡checkout projectä»¥å éœ€è¦ä½¿ç”¨mavençš„ compileæ„å»ºä¸€ä¸‹</p><h3 id="buildnumber-maven-plugin"><a href="#buildnumber-maven-plugin" class="headerlink" title="buildnumber-maven-plugin"></a>buildnumber-maven-plugin</h3><p>è¯¥æ’ä»¶ä¸»è¦è§£å†³mavenæ‰“åŒ…ä»¥åçš„æ—¶é—´æœ¬åœ°åŒ–é—®é¢˜ï¼Œä¸ç„¶ä¸€ç›´ä¼šæœ‰8å°æ—¶çš„æ—¶å·®ï¼Œä¸€èˆ¬é…åˆmaven-assembly-pluginä½¿ç”¨æ›´å¥½</p><h3 id="maven-assembly-plugin"><a href="#maven-assembly-plugin" class="headerlink" title="maven-assembly-plugin"></a>maven-assembly-plugin</h3><p>è¯¥æ’ä»¶ä¸»è¦ç”¨äºé¡¹ç›®æ‰“åŒ…ä»¥åçš„æ–‡ä»¶å½’æ¡£æˆæŒ‡å®šçš„å‹ç¼©åŒ…ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶è‡ªå®šä¹‰éœ€è¦å½’æ¡£çš„æ–‡ä»¶</p><h3 id="maven-compiler-plugin"><a href="#maven-compiler-plugin" class="headerlink" title="maven-compiler-plugin"></a>maven-compiler-plugin</h3><p>è¯¥æ’ä»¶ä¸»è¦è§„èŒƒmaven projectçš„compilerçš„jdkç‰ˆæœ¬</p><h3 id="git-commit-id-plugin"><a href="#git-commit-id-plugin" class="headerlink" title="git-commit-id-plugin"></a>git-commit-id-plugin</h3><p>è¯¥æ’ä»¶ç”¨äºç”Ÿäº§é¡¹ç›®çš„gitä¿¡æ¯ï¼Œæ–¹ä¾¿ç¨‹åºè¯»å–</p><h3 id="maven-jar-pluginã€maven-dependency-plugin"><a href="#maven-jar-pluginã€maven-dependency-plugin" class="headerlink" title="maven-jar-pluginã€maven-dependency-plugin"></a>maven-jar-pluginã€maven-dependency-plugin</h3><p>spring bootæ‰“åŒ…çš„jaré»˜è®¤æ˜¯all in oneï¼Œæ—¢ä¸€ä¸ªjaråŒ…å«æ‰€æœ‰ä¾èµ–ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸¤ä¸ªæ’ä»¶ï¼Œå°†æ‰“å‡ºçš„jaråšä¸€ä¸ªlibçš„åˆ†ç¦»</p>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Cloud é…ç½®ä¸­â¼¼</title>
      <link href="2019/04/06/spring-cloud-config/"/>
      <url>2019/04/06/spring-cloud-config/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ç³»ç»Ÿæ¶æ„ä¸­ï¼Œå’Œå®‰å…¨ã€â½‡æ—¥å¿—ã€ç›‘æ§ç­‰â¾®éåŠŸèƒ½éœ€æ±‚â¼€ä¸€æ ·ï¼Œé…ç½®ç®¡ç†ï§¤ä¹Ÿæ˜¯â¼€ä¸€ç§â¾®éåŠŸèƒ½éœ€æ±‚ã€‚é…ç½®ä¸­â¼¼å¿ƒæ˜¯æ•´<br>ä¸ªå¾®æœåŠ¡åŸºç¡€æ¶æ„ä½“ç³»ä¸­çš„â¼€ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒçš„åŠŸèƒ½çœ‹ä¸Šå»å¹¶ä¸ï¥§èµ·çœ¼ï¼Œâ½†æ— â¾®éå°±æ˜¯ç®€å•é…ç½®çš„ç®¡ç†ï§¤å’Œå­˜å–ï¼Œä½†<br>å®ƒæ˜¯æ•´ä¸ªå¾®æœåŠ¡æ¶æ„ä¸­ä¸ï¥§å¯æˆ–ç¼ºçš„â¼€ä¸€ç¯ã€‚å¦å¤–ï¼Œé…ç½®ä¸­â¼¼å¿ƒå¦‚æœçœŸå¾—â½¤ç”¨å¥½äº†ï¦ºï¼Œå®ƒè¿˜èƒ½æ¨åŠ¨æŠ€æœ¯ç»„ç»‡æŒç»­äº¤<br>ä»˜å’ŒDevOpsâ½‚æ–‡åŒ–è½¬å‹ã€‚</p><h1 id="å¸¸ç”¨é…ç½®ä¸­å¿ƒ"><a href="#å¸¸ç”¨é…ç½®ä¸­å¿ƒ" class="headerlink" title="å¸¸ç”¨é…ç½®ä¸­å¿ƒ"></a>å¸¸ç”¨é…ç½®ä¸­å¿ƒ</h1><p><img src="/images/config/config.png" alt="img"></p><ol><li>é˜¿â¾¥é‡Œï§©å·´å·´ä¸­é—´ä»¶éƒ¨â»”é—¨å¾ˆæ—©å°±â¾ƒè‡ªç ”äº†ï¦ºé…ç½®ä¸­â¼¼å¿ƒDiamondï¼Œå¹¶ä¸”æ˜¯å¼€æºçš„ã€‚Diamondå¯¹é˜¿â¾¥é‡Œï§©ç³»ç»Ÿçš„çµ æ´»ç¨³å®šæ€§å‘æŒ¥äº†ï¦ºâ¾„è‡³å…³é‡è¦çš„ä½œâ½¤ç”¨ã€‚å¼€æºç‰ˆæœ¬çš„Diamondç”±äºç ”å‘æ—¶é—´â½æ¯”è¾ƒæ—©ï¼Œä½¿â½¤ç”¨çš„æŠ€æœ¯â½æ¯”è¾ƒ â½¼è€ï¤´ï¼ŒåŠŸèƒ½ä¹Ÿä¸ï¥§å¤Ÿå®Œå–„ï¼Œâ½¬ç›®å‰ç¤¾åŒºä¸ï¥§çƒ­å·²ç»ä¸ï¥§ç»´æŠ¤äº†ï¦ºã€‚ </li><li>Facebookå†…éƒ¨ä¹Ÿæœ‰â¼€ä¸€æ•´å¥—å®Œå–„çš„é…ç½®ç®¡ç†ï§¤ä½“ç³»ï¼Œå…¶ä¸­â¼€ä¸€ä¸ªäº§å“å«Gatekeeperï¼Œâ½¬ç›®å‰æ²¡æœ‰å¼€æºã€‚ </li><li>Netflixå†…éƒ¨æœ‰â¼¤å¤§é‡ï¥¾çš„å¾®æœåŠ¡ï¼Œå®ƒçš„æœåŠ¡çš„ç¨³å®šçµæ´»æ€§ä¹Ÿé‡åº¦ä¾èµ–äºé…ç½®ä¸­â¼¼å¿ƒã€‚Netflixå¼€æºäº†ï¦ºå®ƒçš„é… ç½®ä¸­â¼¼å¿ƒçš„å®¢æˆ·ç«¯ï¼Œå«å˜â¾Šè‰²â»°é¾™Archaiusï¼Œâ½æ¯”è¾ƒå¯æƒœçš„æ˜¯ï¼ŒNetflixæ²¡æœ‰å¼€æºå®ƒçš„é…ç½®ä¸­â¼¼å¿ƒçš„æœåŠ¡å™¨ï¨¸ç«¯ã€‚ </li><li>Apolloæ˜¯æºç¨‹æ¡†æ¶éƒ¨ç ”å‘å¹¶å¼€æºçš„â¼€ä¸€æ¬¾é…ç½®ä¸­â¼¼å¿ƒäº§å“ï¼Œä¼ä¸šçº§æ²»ç†ï§¤åŠŸèƒ½å®Œå–„ï¼Œâ½¬ç›®å‰ç¤¾åŒºâ½æ¯”è¾ƒâ½•ç«ï¼Œåœ¨ githubä¸Šæœ‰è¶…è¿‡10kæ˜Ÿï¼Œåœ¨å›½å†…ä¼—å¤šäº’è”â½¹ç½‘å…¬å¸æœ‰è½åœ°æ¡ˆä¾‹ï¦µã€‚â½¬ç›®å‰<strong>ITOA</strong>ä¹Ÿæ˜¯é‡‡â½¤ç”¨çš„<strong>Apollo</strong>é…ç½®ä¸­ â¼¼å¿ƒã€‚ </li><li>ç™¾åº¦ä¹‹å‰ä¹Ÿå¼€æºè¿‡â¼€ä¸€ä¸ªå«Disconfçš„é…ç½®ä¸­â¼¼å¿ƒäº§å“ï¼Œä½œè€…æ˜¯å‰ç™¾åº¦èµ„æ·±â¼¯å·¥ç¨‹å¸ˆå»–ç»®ç»®ã€‚åœ¨Apolloæ²¡ æœ‰å‡ºæ¥ä¹‹å‰ï¼ŒDisconfåœ¨ç¤¾åŒºæ˜¯â½æ¯”è¾ƒâ½•ç«çš„ï¼Œä½†æ˜¯â¾ƒè‡ªä»å»–ç¦ç¦ç¦»å¼€ç™¾åº¦ä¹‹åï¼Œä»–å¥½åƒæ²¡æœ‰â¾œè¶³å¤Ÿç²¾â¼’åŠ›ï¦ŠæŠ• â¼Šå…¥ç»´æŠ¤è¿™ä¸ªé¡¹â½¬ç›®ï¼Œâ½¬ç›®å‰ç¤¾åŒºæ´»è·ƒåº¦å·²ç»â¼¤å¤§ä¸ï¥§å¦‚å‰ã€‚ </li><li>ä»¥åŠ Spring Cloud Configï¼Œå’Œspring cloudâ½£ç”Ÿæ€æ˜¯å¤©ç„¶â½€æ”¯æŒï¼Œå½“ç„¶ï¼Œæˆ‘ä¸ªâ¼ˆäººè§‰å¾—ä½œä¸ºâ¼€ä¸€ä¸ªâ½£ç”Ÿäº§çº§ åˆ«çš„é…ç½®ä¸­â¼¼å¿ƒï¼Œspring cloud configè¿˜æ˜¯å­˜åœ¨â¼€ä¸€å®šçš„ç¼ºé™·çš„ï¼Œâ½æ¯”å¦‚â¼€ä¸€ä¸ªå¯è§†åŒ–çš„ç®¡ç†ï§¤ç•Œâ¾¯é¢ï¼Œæ²¡æœ‰ spring cloud busç­‰â½€æ”¯æŒï¼Œâ½†æ— æ³•åšåˆ°çƒ­å‘å¸ƒç­‰ç­‰ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯ç®€å•ä»‹ç»â¼€ä¸€ä¸‹spring cloud configã€‚ä¸ªâ¼ˆäººæ¨èâ½£ç”Ÿäº§ä½¿â½¤ç”¨æºç¨‹<strong>Apollo</strong>ã€‚ </li></ol><h1 id="Spring-Cloud-Config"><a href="#Spring-Cloud-Config" class="headerlink" title="Spring Cloud Config"></a>Spring Cloud Config</h1><p>Spring Cloud Configé¡¹ç›®æ˜¯ä¸€ä¸ªè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿçš„é…ç½®ç®¡ç†æ–¹æ¡ˆã€‚å®ƒåŒ…å«äº†Clientå’ŒServerä¸¤ä¸ªéƒ¨åˆ†ï¼Œserveræä¾›é…ç½®æ–‡ä»¶çš„å­˜å‚¨ã€ä»¥æ¥å£çš„å½¢å¼å°†é…ç½®æ–‡ä»¶çš„å†…å®¹æä¾›å‡ºå»ï¼Œclienté€šè¿‡æ¥å£è·å–æ•°æ®ã€å¹¶ä¾æ®æ­¤æ•°æ®åˆå§‹åŒ–è‡ªå·±çš„åº”ç”¨ã€‚Spring cloudä½¿ç”¨gitæˆ–svnå­˜æ”¾é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨gitã€‚</p><p>æˆ‘ä»¬è¿˜æ˜¯ä»¥ä¹‹å‰çš„service-producerä¸ºåŸºç¡€ï¼Œå¹¶ä¸”åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªcloud-conf-repoæ–‡ä»¶å¤¹ç”¨æ¥å­˜æ”¾é…ç½®ï¼Œå¹¶ä¸”å‡†å¤‡ä¸‰ä¸ªæ–‡ä»¶</p><pre class=" language-properties"><code class="language-properties"><span class="token comment" spellcheck="true"># å¼€å‘ç¯å¢ƒ</span>life-example-producer-dev.properties<span class="token comment" spellcheck="true"># æµ‹è¯•ç¯å¢ƒ</span>life-example-producer-test.properties<span class="token comment" spellcheck="true"># ç”Ÿäº§ç¯å¢ƒ</span>life-example-producer-pro.properties</code></pre><p>æ–‡ä»¶å†…å®¹ä¸ºåˆ†åˆ«ä¸ºsharplook.instance=sharplook-[dev/test/pro]</p><h3 id="Server-ç«¯é…ç½®"><a href="#Server-ç«¯é…ç½®" class="headerlink" title="Server ç«¯é…ç½®"></a>Server ç«¯é…ç½®</h3><h4 id="pom-é…ç½®"><a href="#pom-é…ç½®" class="headerlink" title="pom é…ç½®"></a>pom é…ç½®</h4><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-config-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><h4 id="å±æ€§æ–‡ä»¶é…ç½®"><a href="#å±æ€§æ–‡ä»¶é…ç½®" class="headerlink" title="å±æ€§æ–‡ä»¶é…ç½®"></a>å±æ€§æ–‡ä»¶é…ç½®</h4><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">life-cloud-config</span><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8899</span><span class="token attr-name">eureka.instance.prefer-ip-address</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span class="token attr-name">eureka.client.service-url.defaultZone</span><span class="token punctuation">=</span><span class="token attr-value">http://localhost:8761/eureka/</span><span class="token comment" spellcheck="true"># gitä»“åº“åœ°å€</span><span class="token attr-name">spring.cloud.config.server.git.uri</span><span class="token punctuation">=</span><span class="token comment" spellcheck="true"># gitä»“åº“åœ°å€ä¸‹çš„ç›¸å¯¹åœ°å€ å¯ä»¥é…ç½®å¤šä¸ª ç”¨,åˆ†å‰²ã€‚</span><span class="token attr-name">spring.cloud.config.server.git.search-paths</span><span class="token punctuation">=</span><span class="token comment" spellcheck="true"># git ä»“åº“ç”¨æˆ·å</span><span class="token attr-name">spring.cloud.config.server.git.username</span><span class="token punctuation">=</span><span class="token comment" spellcheck="true"># git ä»“åº“å¯†ç </span><span class="token attr-name">spring.cloud.config.server.git.password</span><span class="token punctuation">=</span><span class="token comment" spellcheck="true"># å¦‚æœæœ‰åˆ†æ”¯ å¯ä»¥åœ¨è¿™é‡Œé…ç½®åˆ†æ”¯åç§°</span><span class="token attr-name">spring.cloud.config.server.git.default-label</span><span class="token punctuation">=</span></code></pre><h4 id="å¯åŠ¨ç±»é…ç½®"><a href="#å¯åŠ¨ç±»é…ç½®" class="headerlink" title="å¯åŠ¨ç±»é…ç½®"></a>å¯åŠ¨ç±»é…ç½®</h4><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>config<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>SpringApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>SpringBootApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>config<span class="token punctuation">.</span>server<span class="token punctuation">.</span>EnableConfigServer<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>eureka<span class="token punctuation">.</span>EnableEurekaClient<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019-03-16. */</span><span class="token annotation punctuation">@EnableConfigServer</span><span class="token annotation punctuation">@EnableEurekaClient</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigApplication</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>ConfigApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>æµè§ˆå™¨è®¿é—®</p><pre class=" language-html"><code class="language-html">http://localhost:8899/life-example-producer/devhttp://localhost:8899/life-example-producer/testhttp://localhost:8899/life-example-producer/pro</code></pre><p>åˆ†åˆ«ä¼šæŒ‰ç…§æˆ‘ä»¬çš„é…ç½®è¿”å›ç›¸åº”çš„æ•°æ®ï¼Œæ ¼å¼å¦‚ä¸‹</p><pre class=" language-json"><code class="language-json">// <span class="token number">20190317102625</span>// http<span class="token operator">:</span>//localhost<span class="token operator">:</span><span class="token number">8899</span>/life-example-producer/dev<span class="token punctuation">{</span>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"life-example-producer"</span><span class="token punctuation">,</span>  <span class="token property">"profiles"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token string">"dev"</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token property">"label"</span><span class="token operator">:</span> <span class="token null">null</span><span class="token punctuation">,</span>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"131d288174b48601af4461dfde809913c87b91ca"</span><span class="token punctuation">,</span>  <span class="token property">"state"</span><span class="token operator">:</span> <span class="token null">null</span><span class="token punctuation">,</span>  <span class="token property">"propertySources"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"https://gitlab.eoitek.net/zengtao/life-cloud-example.git/cloud-conf-repo/life-example-producer-dev.properties"</span><span class="token punctuation">,</span>      <span class="token property">"source"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"sharplook.instance"</span><span class="token operator">:</span> <span class="token string">"sharplook-dev"</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><p>ä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶ä¼šè¢«è½¬æ¢æˆwebæ¥å£ï¼Œè®¿é—®å¯ä»¥å‚ç…§ä»¥ä¸‹çš„è§„åˆ™ï¼š</p><ul><li>/{application}/{profile}[/{label}]</li><li>/{application}-{profile}.yml</li><li>/{label}/{application}-{profile}.yml</li><li>/{application}-{profile}.properties</li><li>/{label}/{application}-{profile}.properties</li></ul><h3 id="Clienté…ç½®"><a href="#Clienté…ç½®" class="headerlink" title="Clienté…ç½®"></a>Clienté…ç½®</h3><p>client ä¸»è¦æ˜¯å…¶ä»–æœåŠ¡æ€ä¹ˆå»è·å–configä¸­çš„é…ç½®ä¿¡æ¯ï¼Œè¿˜æ˜¯ä»¥service-producerä¸ºä¾‹</p><h4 id="pom-é…ç½®-1"><a href="#pom-é…ç½®-1" class="headerlink" title="pom é…ç½®"></a>pom é…ç½®</h4><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- æ·»åŠ configå®¢æˆ·ç«¯ä¾èµ– --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><h4 id="å±æ€§æ–‡ä»¶é…ç½®-1"><a href="#å±æ€§æ–‡ä»¶é…ç½®-1" class="headerlink" title="å±æ€§æ–‡ä»¶é…ç½®"></a>å±æ€§æ–‡ä»¶é…ç½®</h4><p>application.propertiesæ— éœ€ä¿®æ”¹ï¼Œæ–°å»ºbootstrap.propertiesæ–‡ä»¶ï¼Œç”¨äºé…ç½®spring cloud configçš„æœåŠ¡å™¨ä¿¡æ¯</p><pre class=" language-properties"><code class="language-properties"><span class="token comment" spellcheck="true"># é…ç½®ä¸­å¿ƒåœ°å€</span><span class="token attr-name">spring.cloud.config.uri</span><span class="token punctuation">=</span><span class="token attr-value">http://localhost:8899/</span><span class="token comment" spellcheck="true"># ä½¿ç”¨å“ªä¸ªç¯å¢ƒçš„é…ç½®</span><span class="token attr-name">spring.cloud.config.profile</span><span class="token punctuation">=</span><span class="token attr-value">dev</span><span class="token comment" spellcheck="true"># å½“å‰æœåŠ¡çš„åç§° å’Œ spring.application.nameå¯¹åº”å³å¯</span><span class="token attr-name">spring.cloud.config.name</span><span class="token punctuation">=</span><span class="token attr-value">${spring.application.name}</span><span class="token comment" spellcheck="true"># è¯»å–æŒ‡å®šåˆ†æ”¯é…ç½®</span><span class="token attr-name">spring.cloud.config.label</span><span class="token punctuation">=</span><span class="token attr-value">master</span></code></pre><blockquote><p>ä¸Šé¢è¿™äº›ä¸spring-cloudç›¸å…³çš„å±æ€§å¿…é¡»é…ç½®åœ¨bootstrap.propertiesä¸­ï¼Œconfigéƒ¨åˆ†å†…å®¹æ‰èƒ½è¢«æ­£ç¡®åŠ è½½ã€‚å› ä¸ºconfigçš„ç›¸å…³é…ç½®ä¼šå…ˆäºapplication.propertiesï¼Œè€Œbootstrap.propertiesçš„åŠ è½½ä¹Ÿæ˜¯å…ˆäºapplication.propertiesã€‚</p></blockquote><h4 id="å¯åŠ¨ç±»"><a href="#å¯åŠ¨ç±»" class="headerlink" title="å¯åŠ¨ç±»"></a>å¯åŠ¨ç±»</h4><ul><li>æ— éœ€å˜æ›´</li></ul><h4 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h4><p>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œè¿˜æ˜¯ä½¿ç”¨æ¥å£è®¿é—®å½¢å¼ï¼Œæ–°å»ºConfigApi</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>producer<span class="token punctuation">.</span>api<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Value<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>GetMapping<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RequestMapping<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RestController<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019-03-17. */</span><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/api/config"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigApi</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * è¿™é‡Œkey å°±æ˜¯è‡ªå®šä¹‰åœ¨é…ç½®ä¸­å¿ƒä¸­çš„key     */</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${sharplook.instance}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String instance<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>å¯åŠ¨service-produceræœåŠ¡ï¼Œè®¿é—®</p><pre><code>http://localhost:8080/api/config/</code></pre><p>è¿”å›</p><pre><code>sharplook-dev</code></pre><ul><li>ä¿®æ”¹<code>spring.cloud.config.profile=pro</code>é…ç½®ï¼Œé‡å¯æœåŠ¡åï¼Œè®¿é—®æ¥å£ï¼Œè¿”ç°è¿”å›ç»“æœå°±æ˜¯æˆ‘ä»¬åœ¨configä¸­çš„é…ç½®</li><li>ä¿®æ”¹é…ç½®ä¸­å¿ƒçš„gitä¸­çš„é…ç½®ï¼Œæ¨é€åˆ°gitä»¥åï¼Œå†æ¬¡è¯·æ±‚æœåŠ¡ï¼Œå°±èƒ½çœ‹åˆ°æ–°çš„å˜æ›´é…ç½®ã€‚</li></ul><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><ol><li>é…ç½®ä¸­å¿ƒæ˜¯å¾®æœåŠ¡åŸºç¡€æ¶æ„ä¸­ä¸å¯æˆ–ç¼ºçš„æ ¸å¿ƒç»„ä»¶ï¼Œç°ä»£å¾®æœåŠ¡æ¶æ„å’Œäº‘åŸç”Ÿç¯å¢ƒï¼Œå¯¹åº”ç”¨é…ç½®ç®¡ç†æå‡ºäº†æ›´é«˜çš„è¦æ±‚ã€‚</li><li>é…ç½®ä¸­å¿ƒæœ‰ä¼—å¤šçš„åº”ç”¨åœºæ™¯ï¼Œé…ç½®ä¸­å¿ƒ+åŠŸèƒ½å¼€å…³æ˜¯DevOpsæœ€ä½³å®è·µã€‚ç”¨å¥½é…ç½®ä¸­å¿ƒï¼Œå®ƒèƒ½å¸®åŠ©æŠ€æœ¯ç»„ç»‡å®ç°æŒç»­äº¤ä»˜å’ŒDevOpsæ–‡åŒ–è½¬å‹ã€‚</li><li>Spring Cloud Configç›¸å¯¹æ¥è¯´è¿˜æ˜¯è¾¾ä¸åˆ°ç”Ÿäº§çº§åˆ«ï¼Œç›®å‰æ¥çœ‹æºç¨‹å¼€æºçš„<a href="https://github.com/ctripcorp/apollo">Apollo</a>é…ç½®ä¸­å¿ƒï¼Œä¼ä¸šçº§åŠŸèƒ½å®Œå–„ï¼Œç»è¿‡å¤§è§„æ¨¡ç”Ÿäº§éªŒè¯ï¼Œç¤¾åŒºæ´»è·ƒåº¦é«˜ï¼Œæ˜¯å¼€æºé…ç½®ä¸­å¿ƒäº§å“çš„é¦–é€‰ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœåŠ¡ç½‘å…³ Zuul</title>
      <link href="2019/04/04/spring-cloud-gateway-zuul/"/>
      <url>2019/04/04/spring-cloud-gateway-zuul/</url>
      
        <content type="html"><![CDATA[<h1 id="æœåŠ¡ç½‘å…³-Zuul"><a href="#æœåŠ¡ç½‘å…³-Zuul" class="headerlink" title="æœåŠ¡ç½‘å…³ Zuul"></a>æœåŠ¡ç½‘å…³ Zuul</h1><p>Eurekaç”¨äºæœåŠ¡çš„æ³¨å†Œäºå‘ç°ï¼ŒFeignæ”¯æŒæœåŠ¡çš„è°ƒç”¨ä»¥åŠå‡è¡¡è´Ÿè½½ï¼ŒHystrixå¤„ç†æœåŠ¡çš„ç†”æ–­é˜²æ­¢æ•…éšœæ‰©æ•£ã€‚</p><p>ä½†æ˜¯å¤–éƒ¨çš„åº”ç”¨å¦‚ä½•æ¥è®¿é—®å†…éƒ¨å„ç§å„æ ·çš„å¾®æœåŠ¡å‘¢ï¼Ÿåœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œåç«¯æœåŠ¡å¾€å¾€ä¸ç›´æ¥å¼€æ”¾ç»™è°ƒç”¨ç«¯ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªAPIç½‘å…³æ ¹æ®è¯·æ±‚çš„urlï¼Œè·¯ç”±åˆ°ç›¸åº”çš„æœåŠ¡ã€‚å½“æ·»åŠ APIç½‘å…³åï¼Œåœ¨ç¬¬ä¸‰æ–¹è°ƒç”¨ç«¯å’ŒæœåŠ¡æä¾›æ–¹ä¹‹é—´å°±åˆ›å»ºäº†ä¸€é¢å¢™ï¼Œè¿™é¢å¢™ç›´æ¥ä¸è°ƒç”¨æ–¹é€šä¿¡è¿›è¡Œæƒé™æ§åˆ¶ï¼Œåå°†è¯·æ±‚å‡è¡¡åˆ†å‘ç»™åå°æœåŠ¡ç«¯ã€‚</p><h2 id="Spring-Cloud-Zuul"><a href="#Spring-Cloud-Zuul" class="headerlink" title="Spring Cloud Zuul"></a>Spring Cloud Zuul</h2><h3 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h3><pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>life-cloud-example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.xiaozhangge<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.0.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">></span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>cloud-zuul<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-zuul<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">></span></span></code></pre><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">life-cloud-zuul</span><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8888</span><span class="token attr-name">eureka.instance.prefer-ip-address</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span class="token attr-name">eureka.client.service-url.defaultZone</span><span class="token punctuation">=</span><span class="token attr-value">http://localhost:8761/eureka/</span><span class="token comment" spellcheck="true"># è¡¨ç¤ºè®¿é—®xiaozhanggeéƒ½ä¼šè·³è½¬åˆ° https://xiaomozhang.github.io/</span><span class="token attr-name">zuul.routes.xiaozhangge.path</span><span class="token punctuation">=</span><span class="token attr-value">/xiaozhangge/*</span><span class="token attr-name">zuul.routes.xiaozhangge.url</span><span class="token punctuation">=</span><span class="token attr-value">https://xiaomozhang.github.io/</span></code></pre><h3 id="å¯åŠ¨ç±»"><a href="#å¯åŠ¨ç±»" class="headerlink" title="å¯åŠ¨ç±»"></a>å¯åŠ¨ç±»</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>zuul<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>SpringApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>SpringBootApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>eureka<span class="token punctuation">.</span>EnableEurekaClient<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>EnableZuulProxy<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>EnableZuulServer<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * &lt;p> * Created by xiaozhangge on 2019-03-16. */</span><span class="token annotation punctuation">@EnableZuulProxy</span><span class="token annotation punctuation">@EnableEurekaClient</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZuulApplication</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>ZuulApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ä¾æ¬¡å¯åŠ¨cloud-eurekaã€cloud-zuul</p><h3 id="å¾®æœåŠ¡æ•´åˆ"><a href="#å¾®æœåŠ¡æ•´åˆ" class="headerlink" title="å¾®æœåŠ¡æ•´åˆ"></a>å¾®æœåŠ¡æ•´åˆ</h3><p>é€šè¿‡urlæ˜ å°„çš„æ–¹å¼æ¥å®ç°zuulçš„è½¬å‘æœ‰å±€é™æ€§ï¼Œæ¯”å¦‚æ¯å¢åŠ ä¸€ä¸ªæœåŠ¡å°±éœ€è¦é…ç½®ä¸€æ¡å†…å®¹ï¼Œå¦å¤–åç«¯çš„æœåŠ¡å¦‚æœæ˜¯åŠ¨æ€æ¥æä¾›ï¼Œå°±ä¸èƒ½é‡‡ç”¨è¿™ç§æ–¹æ¡ˆæ¥é…ç½®äº†ã€‚å®é™…ä¸Šåœ¨å®ç°å¾®æœåŠ¡æ¶æ„æ—¶ï¼ŒæœåŠ¡åä¸æœåŠ¡å®ä¾‹åœ°å€çš„å…³ç³»åœ¨eureka serverä¸­å·²ç»å­˜åœ¨äº†ï¼Œæ‰€ä»¥åªéœ€è¦å°†Zuulæ³¨å†Œåˆ°eureka serverä¸Šå»å‘ç°å…¶ä»–æœåŠ¡ï¼Œå°±å¯ä»¥å®ç°å¯¹serviceIdçš„æ˜ å°„ã€‚</p><h4 id="é…ç½®æ–‡ä»¶-1"><a href="#é…ç½®æ–‡ä»¶-1" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">life-cloud-zuul</span><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8888</span><span class="token attr-name">eureka.instance.prefer-ip-address</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span class="token attr-name">eureka.client.service-url.defaultZone</span><span class="token punctuation">=</span><span class="token attr-value">http://localhost:8761/eureka/</span><span class="token comment" spellcheck="true"># è¡¨ç¤ºè®¿é—®xiaozhangge éƒ½ä¼šè·³è½¬åˆ° https://xiaomozhang.github.io/</span><span class="token attr-name">zuul.routes.xiaozhangge.path</span><span class="token punctuation">=</span><span class="token attr-value">/xiaozhangge/**</span><span class="token attr-name">zuul.routes.xiaozhangge.url</span><span class="token punctuation">=</span><span class="token attr-value">https://xiaomozhang.github.io/</span><span class="token comment" spellcheck="true"># æ·»åŠ å¾®æœåŠ¡è·¯ç”±åœ°å€</span><span class="token attr-name">zuul.routes.producer.path</span><span class="token punctuation">=</span><span class="token attr-value">/producer/**</span><span class="token attr-name">zuul.routes.producer.service-id</span><span class="token punctuation">=</span><span class="token attr-value">life-example-producer</span></code></pre><h4 id="å¯åŠ¨æœåŠ¡æä¾›è€…"><a href="#å¯åŠ¨æœåŠ¡æä¾›è€…" class="headerlink" title="å¯åŠ¨æœåŠ¡æä¾›è€…"></a>å¯åŠ¨æœåŠ¡æä¾›è€…</h4><pre class=" language-shell"><code class="language-shell">java -jar service-producer-0.0.1.jar --server.port=8080 --service.instance.name=è¿™æ˜¯æœåŠ¡å™¨1java -jar service-producer-0.0.1.jar --server.port=8081 --service.instance.name=è¿™æ˜¯æœåŠ¡å™¨2java -jar service-producer-0.0.1.jar --server.port=8082 --service.instance.name=è¿™æ˜¯æœåŠ¡å™¨3</code></pre><p>è®¿é—®</p><pre class=" language-html"><code class="language-html">http://localhost:8888/producer/api/index?name=ç»´å°¼ç†Š</code></pre><p>ä¼šå‘ç°è‡ªåŠ¨è´Ÿè½½å‡è¡¡ï¼Œå°†æ¯ä¸ªè¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡ï¼Œè‡³æ­¤ï¼Œæ•´ä¸ªzuulå’Œå¾®æœåŠ¡æ•´åˆä¹Ÿå°±å®Œæˆäº†ã€‚</p><h2 id="spring-cloud-gateway"><a href="#spring-cloud-gateway" class="headerlink" title="spring cloud gateway"></a>spring cloud gateway</h2><p><a href="http://cxytiandi.com/article">çŒ¿å¤©åœ°spring cloud gatewayç³»åˆ—æ•™ç¨‹</a></p>]]></content>
      
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœåŠ¡æä¾›è°ƒç”¨ä¸ç†”æ–­</title>
      <link href="2019/04/01/spring-cloud-feign/"/>
      <url>2019/04/01/spring-cloud-feign/</url>
      
        <content type="html"><![CDATA[<h1 id="æœåŠ¡æä¾›è°ƒç”¨ä¸ç†”æ–­"><a href="#æœåŠ¡æä¾›è°ƒç”¨ä¸ç†”æ–­" class="headerlink" title="æœåŠ¡æä¾›è°ƒç”¨ä¸ç†”æ–­"></a>æœåŠ¡æä¾›è°ƒç”¨ä¸ç†”æ–­</h1><p>ä¹‹å‰æˆ‘ä»¬ä»‹ç»äº†eurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æ­å»ºï¼Œè¿™ç¯‡æ–‡ç« ä»‹ç»ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨eurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œæ­å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡ç«¯æ³¨å†ŒæœåŠ¡ï¼Œå®¢æˆ·ç«¯å»è°ƒç”¨æœåŠ¡ä½¿ç”¨çš„æ¡ˆä¾‹ã€‚</p><p>éœ€è¦æœ‰ä¸‰ä¸ªè§’è‰²ï¼šæœåŠ¡æ³¨å†Œä¸­å¿ƒã€æœåŠ¡æä¾›è€…ã€æœåŠ¡æ¶ˆè´¹è€…ï¼Œå…¶ä¸­æœåŠ¡æ³¨å†Œä¸­å¿ƒå°±æ˜¯æˆ‘ä»¬ä¸Šä¸€ç¯‡çš„eurekaå•æœºç‰ˆå¯åŠ¨æ—¢å¯ï¼Œæµç¨‹æ˜¯é¦–å…ˆå¯åŠ¨æ³¨å†Œä¸­å¿ƒï¼ŒæœåŠ¡æä¾›è€…ç”Ÿäº§æœåŠ¡å¹¶æ³¨å†Œåˆ°æœåŠ¡ä¸­å¿ƒä¸­ï¼Œæ¶ˆè´¹è€…ä»æœåŠ¡ä¸­å¿ƒä¸­è·å–æœåŠ¡å¹¶æ‰§è¡Œã€‚</p><h2 id="æœåŠ¡æä¾›"><a href="#æœåŠ¡æä¾›" class="headerlink" title="æœåŠ¡æä¾›"></a>æœåŠ¡æä¾›</h2><p>æˆ‘ä»¬å‡è®¾æœåŠ¡æä¾›è€…æœ‰ä¸€ä¸ªhelloæ–¹æ³•ï¼Œå¯ä»¥æ ¹æ®ä¼ å…¥çš„å‚æ•°ï¼Œæä¾›è¾“å‡ºâ€œhello xxxâ€çš„æœåŠ¡</p><h3 id="pomé…ç½®"><a href="#pomé…ç½®" class="headerlink" title="pomé…ç½®"></a>pomé…ç½®</h3><p>åˆ›å»ºä¸€ä¸ªspringbooté¡¹ç›®ï¼Œpom.xmlä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼Œæ³¨:æ—§ç‰ˆçš„spring cloudå’Œæœ€æ–°ç‰ˆçš„artifactIdä¸å¤ªä¸€æ ·</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-hystrix<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>application.propertiesé…ç½®å¦‚ä¸‹ï¼š</p><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">life-example-producer</span><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8080</span><span class="token attr-name">eureka.instance.prefer-ip-address</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span class="token attr-name">eureka.client.service-url.defaultZone</span><span class="token punctuation">=</span><span class="token attr-value">http://localhost:8761/eureka/</span><span class="token comment" spellcheck="true"># è¿™ä¸ªé…ç½®æ˜¯ä¸ºäº†åé¢æµ‹è¯•è´Ÿè½½å‡è¡¡</span><span class="token attr-name">service.instance.name</span><span class="token punctuation">=</span><span class="token attr-value">è¿™æ˜¯æœåŠ¡å™¨1</span></code></pre><h3 id="å¯åŠ¨ç±»"><a href="#å¯åŠ¨ç±»" class="headerlink" title="å¯åŠ¨ç±»"></a>å¯åŠ¨ç±»</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>producer<span class="token punctuation">;</span><span class="token keyword">import</span> feign<span class="token punctuation">.</span>Retryer<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>SpringApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>SpringBootApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>eureka<span class="token punctuation">.</span>EnableEurekaClient<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>hystrix<span class="token punctuation">.</span>EnableHystrix<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019-03-16. */</span><span class="token annotation punctuation">@EnableHystrix</span><span class="token annotation punctuation">@EnableEurekaClient</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProducerApplication</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>ProducerApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> Retryer <span class="token function">feignRetryer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// new Retryer.Default(100,TimeUnit.SECONDS.toMillis(1),5);//é»˜è®¤æ˜¯5æ¬¡</span>        <span class="token keyword">return</span> Retryer<span class="token punctuation">.</span>NEVER_RETRY<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>producer<span class="token punctuation">.</span>api<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Value<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>GetMapping<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RequestMapping<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RestController<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>UUID<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019-03-16. */</span><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/api"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexApi</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${service.instance.name}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String instanceName<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/index"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">index</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> String<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s hello %s - %s"</span><span class="token punctuation">,</span> instanceName<span class="token punctuation">,</span> name<span class="token punctuation">,</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ·»åŠ @EnableEurekaClientæ³¨è§£åï¼Œé¡¹ç›®å°±å…·æœ‰äº†æœåŠ¡æ³¨å†Œçš„åŠŸèƒ½ã€‚å¯åŠ¨å·¥ç¨‹åï¼Œå°±å¯ä»¥åœ¨æ³¨å†Œä¸­å¿ƒçš„é¡µé¢çœ‹åˆ°service-produceræœåŠ¡ã€‚</p><p><img src="/images/fegin-hystrix/fegin-producer.png" alt="img"></p><p>åˆ°æ­¤æœåŠ¡æä¾›è€…é…ç½®å°±å®Œæˆäº†ã€‚</p><h2 id="æœåŠ¡è°ƒç”¨"><a href="#æœåŠ¡è°ƒç”¨" class="headerlink" title="æœåŠ¡è°ƒç”¨"></a>æœåŠ¡è°ƒç”¨</h2><h3 id="pomé…ç½®-1"><a href="#pomé…ç½®-1" class="headerlink" title="pomé…ç½®"></a>pomé…ç½®</h3><p>å’ŒæœåŠ¡æä¾›è€…ä¸€è‡´</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-hystrix<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><h3 id="é…ç½®æ–‡ä»¶-1"><a href="#é…ç½®æ–‡ä»¶-1" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>application.propertiesé…ç½®å¦‚ä¸‹ï¼š</p><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">life-example-consumer</span><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8081</span><span class="token attr-name">eureka.instance.prefer-ip-address</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span class="token attr-name">eureka.client.service-url.defaultZone</span><span class="token punctuation">=</span><span class="token attr-value">http://localhost:8761/eureka/</span><span class="token comment" spellcheck="true"># å¼€å¯ç†”æ–­</span><span class="token attr-name">feign.hystrix.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span></code></pre><h3 id="å¯åŠ¨ç±»-1"><a href="#å¯åŠ¨ç±»-1" class="headerlink" title="å¯åŠ¨ç±»"></a>å¯åŠ¨ç±»</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>consumer<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>SpringApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>SpringBootApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>eureka<span class="token punctuation">.</span>EnableEurekaClient<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>hystrix<span class="token punctuation">.</span>EnableHystrix<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>hystrix<span class="token punctuation">.</span>dashboard<span class="token punctuation">.</span>EnableHystrixDashboard<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span>EnableFeignClients<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019-03-16. */</span><span class="token annotation punctuation">@EnableHystrix</span><span class="token annotation punctuation">@EnableFeignClients</span><span class="token annotation punctuation">@EnableEurekaClient</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableHystrixDashboard</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerApplication</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>ConsumerApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼Web Serviceå®¢æˆ·ç«¯ã€‚ä½¿ç”¨Feignèƒ½è®©ç¼–å†™Web Serviceå®¢æˆ·ç«¯æ›´åŠ ç®€å•, å®ƒçš„ä½¿ç”¨æ–¹æ³•æ˜¯å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç„¶ååœ¨ä¸Šé¢æ·»åŠ æ³¨è§£ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒJAX-RSæ ‡å‡†çš„æ³¨è§£ã€‚Feignä¹Ÿæ”¯æŒå¯æ‹”æ’å¼çš„ç¼–ç å™¨å’Œè§£ç å™¨ã€‚Spring Cloudå¯¹Feignè¿›è¡Œäº†å°è£…ï¼Œä½¿å…¶æ”¯æŒäº†Spring MVCæ ‡å‡†æ³¨è§£å’ŒHttpMessageConvertersã€‚Feignå¯ä»¥ä¸Eurekaå’ŒRibbonç»„åˆä½¿ç”¨ä»¥æ”¯æŒè´Ÿè½½å‡è¡¡ã€‚</p><h3 id="feignè°ƒç”¨å®ç°"><a href="#feignè°ƒç”¨å®ç°" class="headerlink" title="feignè°ƒç”¨å®ç°"></a>feignè°ƒç”¨å®ç°</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>feign<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>configure<span class="token punctuation">.</span>FeignConfig<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>feign<span class="token punctuation">.</span>fallback<span class="token punctuation">.</span>ProducerFallback<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span>FeignClient<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Component<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RequestMapping<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RequestMethod<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RequestParam<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * value = æœåŠ¡æä¾›è€…çš„ spring.application.name * fallback = ç†”æ–­é™çº§å¤„ç†ç±» * configuration = ç†”æ–­é™çº§é…ç½® * &lt;p> * Created by xiaozhangge on 2019-03-16. */</span><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"life-example-producer"</span><span class="token punctuation">,</span> fallback <span class="token operator">=</span> ProducerFallback<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> configuration <span class="token operator">=</span> FeignConfig<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ProducerService</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * è°ƒç”¨çš„è¿œç¨‹æ–¹æ³•è·¯ç”±åœ°å€éœ€è¦å’ŒæœåŠ¡æä¾›è€…çš„ä¸€è‡´ï¼Œå¹¶ä¸”ä¸è¦ä½¿ç”¨GetMappingä¹‹ç±»çš„ç®€åŒ–æ–¹æ³•     *     * @param name     * @return     */</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/api/index"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> RequestMethod<span class="token punctuation">.</span>GET<span class="token punctuation">)</span>    String <span class="token function">index</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> String name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="æ¶ˆè´¹è€…è°ƒç”¨è¿œç¨‹æœåŠ¡"><a href="#æ¶ˆè´¹è€…è°ƒç”¨è¿œç¨‹æœåŠ¡" class="headerlink" title="æ¶ˆè´¹è€…è°ƒç”¨è¿œç¨‹æœåŠ¡"></a>æ¶ˆè´¹è€…è°ƒç”¨è¿œç¨‹æœåŠ¡</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>api<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>feign<span class="token punctuation">.</span>ProducerService<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RequestMapping<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RestController<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019-03-16. */</span><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/api/consumer"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexApi</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> ProducerService producerService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/index"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">index</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> producerService<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>åˆ°æ­¤ï¼Œæœ€ç®€å•çš„ä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸è°ƒç”¨çš„ä¾‹å­å°±å®Œæˆäº†ã€‚</p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><h3 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h3><p>ä¾æ¬¡å¯åŠ¨cloud-eurekaã€service-producerã€service-consumerä¸‰ä¸ªé¡¹ç›®ï¼Œå¹¶ä¸”æŸ¥çœ‹eurekaæ³¨å†Œæƒ…å†µ</p><p><img src="/images/fegin-hystrix/fegin-eureka.png" alt="img"></p><h3 id="æµ‹è¯•æœåŠ¡æä¾›è€…"><a href="#æµ‹è¯•æœåŠ¡æä¾›è€…" class="headerlink" title="æµ‹è¯•æœåŠ¡æä¾›è€…"></a>æµ‹è¯•æœåŠ¡æä¾›è€…</h3><p>æµè§ˆå™¨è¾“å…¥æœåŠ¡æä¾›è€…è·¯ç”±åœ°å€æŸ¥çœ‹æ˜¯å¦æ­£å¸¸</p><pre class=" language-html"><code class="language-html">http://localhost:8080/api/index?name=sharplook</code></pre><p>è¿”å›ç»“æœ</p><pre class=" language-json"><code class="language-json">hello sharplook - 7359bd06<span class="token number">-8471</span>-4a5d-aa04-7b25b7c13ddb</code></pre><p>è¯´æ˜service-produceræ­£å¸¸å¯åŠ¨ï¼Œæä¾›çš„æœåŠ¡ä¹Ÿæ­£å¸¸ã€‚</p><h3 id="æµ‹è¯•æœåŠ¡è°ƒç”¨è€…"><a href="#æµ‹è¯•æœåŠ¡è°ƒç”¨è€…" class="headerlink" title="æµ‹è¯•æœåŠ¡è°ƒç”¨è€…"></a>æµ‹è¯•æœåŠ¡è°ƒç”¨è€…</h3><p>æµè§ˆå™¨è¾“å…¥è°ƒç”¨è€…è·¯ç”±åœ°å€ï¼Œå¹¶ä¼ é€’ç›¸åº”çš„å‚æ•°</p><pre class=" language-html"><code class="language-html">http://localhost:8081/api/consumer/index?name=é˜¿ç‰›</code></pre><p>è¿”å›ç»“æœ</p><pre class=" language-json"><code class="language-json">hello é˜¿ç‰› - f012cf85-9a04-4ae0-b879-42fa860d5015</code></pre><p>è¯´æ˜å®¢æˆ·ç«¯å·²ç»æˆåŠŸçš„é€šè¿‡feignè°ƒç”¨äº†è¿œç¨‹æœåŠ¡ï¼Œå¹¶ä¸”å°†ç»“æœè¿”å›åˆ°äº†æµè§ˆå™¨ã€‚</p><h3 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h3><p>å‰é¢åœ¨æœåŠ¡æä¾›è€…çš„application.propertiesæ–‡ä»¶ä¸­é…ç½®äº†ä¸€ä¸ªservice.instance.nameå±æ€§ï¼Œç°åœ¨è®²ç¨‹åºæ‰“åŒ…ï¼Œç„¶åè¾“å…¥ä¸åŒçš„instanceåç§°ï¼Œç”¨æ¥æ¨¡æ‹Ÿå¤šä¸ªæœåŠ¡å™¨</p><p>ä¾æ¬¡å¯åŠ¨å¤šä¸ªservice-producerå®ä¾‹ï¼Œä½¿ç”¨ä¸åŒçš„ç«¯å£ä»¥åŠè‡ªå®šä¹‰çš„service.instance.name</p><pre class=" language-shell"><code class="language-shell">java -jar service-producer-0.0.1.jar --server.port=8080 --service.instance.name=è¿™æ˜¯æœåŠ¡å™¨1java -jar service-producer-0.0.1.jar --server.port=8081 --service.instance.name=è¿™æ˜¯æœåŠ¡å™¨2java -jar service-producer-0.0.1.jar --server.port=8082 --service.instance.name=è¿™æ˜¯æœåŠ¡å™¨3</code></pre><p>å¯åŠ¨å®Œæˆåï¼Œä¼šçœ‹åˆ°eurekaä¸­æœ‰å¤šä¸ªæœåŠ¡æä¾›è€…</p><p><img src="/images/fegin-hystrix/fegin-muilt-producer.png" alt="img"></p><p>ç„¶åæ¬¡ä½¿ç”¨æœåŠ¡æ¶ˆè´¹è€…å»è°ƒç”¨</p><pre><code>http://localhost:8081/api/consumer/index?name=é˜¿ç‰›</code></pre><p>ç¬¬ä¸€æ¬¡è¿”å›ç»“æœï¼š</p><pre><code>è¿™æ˜¯æœåŠ¡å™¨1 hello é˜¿ç‰› - c280ad85-8475-464e-9856-151c70b8970d</code></pre><p>ç¬¬äºŒæ¬¡è¿”å›ç»“æœï¼š</p><pre><code>è¿™æ˜¯æœåŠ¡å™¨2 hello é˜¿ç‰› - 4e798f0a-7fda-4063-bb33-bbaaad106f05</code></pre><p>ç¬¬ä¸‰æ¬¡è¿”å›ç»“æœï¼š</p><pre><code>è¿™æ˜¯æœåŠ¡å™¨3 hello é˜¿ç‰› - a318c789-9765-4119-a991-b77c72a19ba3</code></pre><p>ä¸æ–­çš„è¿›è¡Œæµ‹è¯•ä¸‹å»ä¼šå‘ç°ä¸¤ç§ç»“æœäº¤æ›¿å‡ºç°ï¼Œè¯´æ˜ä¸¤ä¸ªæœåŠ¡ä¸­å¿ƒè‡ªåŠ¨æä¾›äº†æœåŠ¡å‡è¡¡è´Ÿè½½çš„åŠŸèƒ½ã€‚å¦‚æœæˆ‘ä»¬å°†æœåŠ¡æä¾›è€…çš„æ•°é‡åœ¨æé«˜ä¸ºNä¸ªï¼Œæµ‹è¯•ç»“æœä¸€æ ·ï¼Œè¯·æ±‚ä¼šè‡ªåŠ¨è½®è¯¢åˆ°æ¯ä¸ªæœåŠ¡ç«¯æ¥å¤„ç†ã€‚</p><h2 id="æœåŠ¡ç†”æ–­"><a href="#æœåŠ¡ç†”æ–­" class="headerlink" title="æœåŠ¡ç†”æ–­"></a>æœåŠ¡ç†”æ–­</h2><h3 id="ç†”æ–­å™¨"><a href="#ç†”æ–­å™¨" class="headerlink" title="ç†”æ–­å™¨"></a>ç†”æ–­å™¨</h3><h4 id="é›ªå´©æ•ˆåº”"><a href="#é›ªå´©æ•ˆåº”" class="headerlink" title="é›ªå´©æ•ˆåº”"></a>é›ªå´©æ•ˆåº”</h4><p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­é€šå¸¸ä¼šæœ‰å¤šä¸ªæœåŠ¡å±‚è°ƒç”¨ï¼ŒåŸºç¡€æœåŠ¡çš„æ•…éšœå¯èƒ½ä¼šå¯¼è‡´çº§è”æ•…éšœï¼Œè¿›è€Œé€ æˆæ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨çš„æƒ…å†µï¼Œè¿™ç§ç°è±¡è¢«ç§°ä¸ºæœåŠ¡é›ªå´©æ•ˆåº”ã€‚æœåŠ¡é›ªå´©æ•ˆåº”æ˜¯ä¸€ç§å› â€œæœåŠ¡æä¾›è€…â€çš„ä¸å¯ç”¨å¯¼è‡´â€œæœåŠ¡æ¶ˆè´¹è€…â€çš„ä¸å¯ç”¨,å¹¶å°†ä¸å¯ç”¨é€æ¸æ”¾å¤§çš„è¿‡ç¨‹ã€‚</p><p>å¦‚æœä¸‹å›¾æ‰€ç¤ºï¼šAä½œä¸ºæœåŠ¡æä¾›è€…ï¼ŒBä¸ºAçš„æœåŠ¡æ¶ˆè´¹è€…ï¼ŒCå’ŒDæ˜¯Bçš„æœåŠ¡æ¶ˆè´¹è€…ã€‚Aä¸å¯ç”¨å¼•èµ·äº†Bçš„ä¸å¯ç”¨ï¼Œå¹¶å°†ä¸å¯ç”¨åƒæ»šé›ªçƒä¸€æ ·æ”¾å¤§åˆ°Cå’ŒDæ—¶ï¼Œé›ªå´©æ•ˆåº”å°±å½¢æˆäº†ã€‚</p><p><img src="/images/fegin-hystrix/hystrix-1.png" alt="img"></p><h4 id="ç†”æ–­å™¨ï¼ˆCircuitBreakerï¼‰"><a href="#ç†”æ–­å™¨ï¼ˆCircuitBreakerï¼‰" class="headerlink" title="ç†”æ–­å™¨ï¼ˆCircuitBreakerï¼‰"></a>ç†”æ–­å™¨ï¼ˆCircuitBreakerï¼‰</h4><p>ç†”æ–­å™¨çš„åŸç†å¾ˆç®€å•ï¼Œå¦‚åŒç”µåŠ›è¿‡è½½ä¿æŠ¤å™¨ã€‚å®ƒå¯ä»¥å®ç°å¿«é€Ÿå¤±è´¥ï¼Œå¦‚æœå®ƒåœ¨ä¸€æ®µæ—¶é—´å†…ä¾¦æµ‹åˆ°è®¸å¤šç±»ä¼¼çš„é”™è¯¯ï¼Œä¼šå¼ºè¿«å…¶ä»¥åçš„å¤šä¸ªè°ƒç”¨å¿«é€Ÿå¤±è´¥ï¼Œä¸å†è®¿é—®è¿œç¨‹æœåŠ¡å™¨ï¼Œä»è€Œé˜²æ­¢åº”ç”¨ç¨‹åºä¸æ–­åœ°å°è¯•æ‰§è¡Œå¯èƒ½ä¼šå¤±è´¥çš„æ“ä½œï¼Œä½¿å¾—åº”ç”¨ç¨‹åºç»§ç»­æ‰§è¡Œè€Œä¸ç”¨ç­‰å¾…ä¿®æ­£é”™è¯¯ï¼Œæˆ–è€…æµªè´¹CPUæ—¶é—´å»ç­‰åˆ°é•¿æ—¶é—´çš„è¶…æ—¶äº§ç”Ÿã€‚ç†”æ–­å™¨ä¹Ÿå¯ä»¥ä½¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿè¯Šæ–­é”™è¯¯æ˜¯å¦å·²ç»ä¿®æ­£ï¼Œå¦‚æœå·²ç»ä¿®æ­£ï¼Œåº”ç”¨ç¨‹åºä¼šå†æ¬¡å°è¯•è°ƒç”¨æ“ä½œã€‚</p><p>ç†”æ–­å™¨æ¨¡å¼å°±åƒæ˜¯é‚£äº›å®¹æ˜“å¯¼è‡´é”™è¯¯çš„æ“ä½œçš„ä¸€ç§ä»£ç†ã€‚è¿™ç§ä»£ç†èƒ½å¤Ÿè®°å½•æœ€è¿‘è°ƒç”¨å‘ç”Ÿé”™è¯¯çš„æ¬¡æ•°ï¼Œç„¶åå†³å®šä½¿ç”¨å…è®¸æ“ä½œç»§ç»­ï¼Œæˆ–è€…ç«‹å³è¿”å›é”™è¯¯ã€‚ ç†”æ–­å™¨å¼€å…³ç›¸äº’è½¬æ¢çš„é€»è¾‘å¦‚ä¸‹å›¾ï¼š</p><p><img src="/images/fegin-hystrix/hystrix-2.png" alt="img"></p><p>ç†”æ–­å™¨å°±æ˜¯ä¿æŠ¤æœåŠ¡é«˜å¯ç”¨çš„æœ€åä¸€é“é˜²çº¿ã€‚</p><h4 id="Hystrixç‰¹æ€§"><a href="#Hystrixç‰¹æ€§" class="headerlink" title="Hystrixç‰¹æ€§"></a>Hystrixç‰¹æ€§</h4><p><strong>1.æ–­è·¯å™¨æœºåˆ¶</strong></p><p>æ–­è·¯å™¨å¾ˆå¥½ç†è§£, å½“Hystrix Commandè¯·æ±‚åç«¯æœåŠ¡å¤±è´¥æ•°é‡è¶…è¿‡ä¸€å®šæ¯”ä¾‹(é»˜è®¤50%), æ–­è·¯å™¨ä¼šåˆ‡æ¢åˆ°å¼€è·¯çŠ¶æ€(Open). è¿™æ—¶æ‰€æœ‰è¯·æ±‚ä¼šç›´æ¥å¤±è´¥è€Œä¸ä¼šå‘é€åˆ°åç«¯æœåŠ¡. æ–­è·¯å™¨ä¿æŒåœ¨å¼€è·¯çŠ¶æ€ä¸€æ®µæ—¶é—´å(é»˜è®¤5ç§’), è‡ªåŠ¨åˆ‡æ¢åˆ°åŠå¼€è·¯çŠ¶æ€(HALF-OPEN). è¿™æ—¶ä¼šåˆ¤æ–­ä¸‹ä¸€æ¬¡è¯·æ±‚çš„è¿”å›æƒ…å†µ, å¦‚æœè¯·æ±‚æˆåŠŸ, æ–­è·¯å™¨åˆ‡å›é—­è·¯çŠ¶æ€(CLOSED), å¦åˆ™é‡æ–°åˆ‡æ¢åˆ°å¼€è·¯çŠ¶æ€(OPEN). Hystrixçš„æ–­è·¯å™¨å°±åƒæˆ‘ä»¬å®¶åº­ç”µè·¯ä¸­çš„ä¿é™©ä¸, ä¸€æ—¦åç«¯æœåŠ¡ä¸å¯ç”¨, æ–­è·¯å™¨ä¼šç›´æ¥åˆ‡æ–­è¯·æ±‚é“¾, é¿å…å‘é€å¤§é‡æ— æ•ˆè¯·æ±‚å½±å“ç³»ç»Ÿååé‡, å¹¶ä¸”æ–­è·¯å™¨æœ‰è‡ªæˆ‘æ£€æµ‹å¹¶æ¢å¤çš„èƒ½åŠ›.</p><p><strong>2.Fallback</strong></p><p>Fallbackç›¸å½“äºæ˜¯é™çº§æ“ä½œ. å¯¹äºæŸ¥è¯¢æ“ä½œ, æˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªfallbackæ–¹æ³•, å½“è¯·æ±‚åç«¯æœåŠ¡å‡ºç°å¼‚å¸¸çš„æ—¶å€™, å¯ä»¥ä½¿ç”¨fallbackæ–¹æ³•è¿”å›çš„å€¼. fallbackæ–¹æ³•çš„è¿”å›å€¼ä¸€èˆ¬æ˜¯è®¾ç½®çš„é»˜è®¤å€¼æˆ–è€…æ¥è‡ªç¼“å­˜.</p><p><strong>3.èµ„æºéš”ç¦»</strong></p><p>åœ¨Hystrixä¸­, ä¸»è¦é€šè¿‡çº¿ç¨‹æ± æ¥å®ç°èµ„æºéš”ç¦». é€šå¸¸åœ¨ä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬ä¼šæ ¹æ®è°ƒç”¨çš„è¿œç¨‹æœåŠ¡åˆ’åˆ†å‡ºå¤šä¸ªçº¿ç¨‹æ± . ä¾‹å¦‚è°ƒç”¨äº§å“æœåŠ¡çš„Commandæ”¾å…¥Açº¿ç¨‹æ± , è°ƒç”¨è´¦æˆ·æœåŠ¡çš„Commandæ”¾å…¥Bçº¿ç¨‹æ± . è¿™æ ·åšçš„ä¸»è¦ä¼˜ç‚¹æ˜¯è¿è¡Œç¯å¢ƒè¢«éš”ç¦»å¼€äº†. è¿™æ ·å°±ç®—è°ƒç”¨æœåŠ¡çš„ä»£ç å­˜åœ¨bugæˆ–è€…ç”±äºå…¶ä»–åŸå› å¯¼è‡´è‡ªå·±æ‰€åœ¨çº¿ç¨‹æ± è¢«è€—å°½æ—¶, ä¸ä¼šå¯¹ç³»ç»Ÿçš„å…¶ä»–æœåŠ¡é€ æˆå½±å“. ä½†æ˜¯å¸¦æ¥çš„ä»£ä»·å°±æ˜¯ç»´æŠ¤å¤šä¸ªçº¿ç¨‹æ± ä¼šå¯¹ç³»ç»Ÿå¸¦æ¥é¢å¤–çš„æ€§èƒ½å¼€é”€. å¦‚æœæ˜¯å¯¹æ€§èƒ½æœ‰ä¸¥æ ¼è¦æ±‚è€Œä¸”ç¡®ä¿¡è‡ªå·±è°ƒç”¨æœåŠ¡çš„å®¢æˆ·ç«¯ä»£ç ä¸ä¼šå‡ºé—®é¢˜çš„è¯, å¯ä»¥ä½¿ç”¨Hystrixçš„ä¿¡å·æ¨¡å¼(Semaphores)æ¥éš”ç¦»èµ„æº.</p><h3 id="Feign-Hystrix"><a href="#Feign-Hystrix" class="headerlink" title="Feign Hystrix"></a>Feign Hystrix</h3><p>å› ä¸ºç†”æ–­åªæ˜¯ä½œç”¨åœ¨æœåŠ¡è°ƒç”¨è¿™ä¸€ç«¯ï¼Œå› æ­¤æˆ‘ä»¬æ ¹æ®ä¸Šä¸€ç¯‡çš„ç¤ºä¾‹ä»£ç åªéœ€è¦æ”¹åŠ¨service-consumeré¡¹ç›®ç›¸å…³ä»£ç å°±å¯ä»¥ã€‚å› ä¸ºï¼ŒFeignä¸­å·²ç»ä¾èµ–äº†Hystrixæ‰€ä»¥åœ¨mavené…ç½®ä¸Šä¸ç”¨åšä»»ä½•æ”¹åŠ¨ã€‚</p><h4 id="é…ç½®æ–‡ä»¶-2"><a href="#é…ç½®æ–‡ä»¶-2" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">feign.hystrix.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span></code></pre><h4 id="ç†”æ–­é™çº§å¤„ç†ç±»"><a href="#ç†”æ–­é™çº§å¤„ç†ç±»" class="headerlink" title="ç†”æ–­é™çº§å¤„ç†ç±»"></a>ç†”æ–­é™çº§å¤„ç†ç±»</h4><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>feign<span class="token punctuation">.</span>fallback<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>feign<span class="token punctuation">.</span>ProducerService<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Component<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019-03-16. */</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProducerFallback</span> <span class="token keyword">implements</span> <span class="token class-name">ProducerService</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">index</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> String<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"life-example-producer æœåŠ¡ä¸å¯ç”¨ param:%s"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="fallbackå±æ€§"><a href="#fallbackå±æ€§" class="headerlink" title="fallbackå±æ€§"></a>fallbackå±æ€§</h4><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>feign<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>configure<span class="token punctuation">.</span>FeignConfig<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>feign<span class="token punctuation">.</span>fallback<span class="token punctuation">.</span>ProducerFallback<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span>FeignClient<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Component<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RequestMapping<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RequestMethod<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RequestParam<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * value = æœåŠ¡æä¾›è€…çš„ spring.application.name * fallback = ç†”æ–­é™çº§å¤„ç†ç±» * configuration = ç†”æ–­é™çº§é…ç½® * &lt;p> * Created by xiaozhangge on 2019-03-16. */</span><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"life-example-producer"</span><span class="token punctuation">,</span> fallback <span class="token operator">=</span> ProducerFallback<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> configuration <span class="token operator">=</span> FeignConfig<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ProducerService</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * è°ƒç”¨çš„è¿œç¨‹æ–¹æ³•è·¯ç”±åœ°å€éœ€è¦å’ŒæœåŠ¡æä¾›è€…çš„ä¸€è‡´ï¼Œå¹¶ä¸”ä¸è¦ä½¿ç”¨GetMappingä¹‹ç±»çš„ç®€åŒ–æ–¹æ³•     *     * @param name     * @return     */</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/api/index"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> RequestMethod<span class="token punctuation">.</span>GET<span class="token punctuation">)</span>    String <span class="token function">index</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> String name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>ä¾æ¬¡å¯åŠ¨cloud-eurekaã€service-producerã€service-consumerä¸‰ä¸ªé¡¹ç›®ï¼Œæ‰‹åŠ¨åœæ‰æœåŠ¡æŸ¥çœ‹ç†”æ–­ç»“æœ</p>]]></content>
      
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL å¯¼å‡ºè¡¨ç»“æ„å’Œè¡¨æ•°æ® mysqldumpç”¨æ³•</title>
      <link href="2019/03/22/mysql-note-mysqldump/"/>
      <url>2019/03/22/mysql-note-mysqldump/</url>
      
        <content type="html"><![CDATA[<p>å‘½ä»¤è¡Œä¸‹å…·ä½“ç”¨æ³•å¦‚ä¸‹ï¼š</p><p>mysqldump -uç”¨æˆ¶å -på¯†ç  -d æ•°æ®åº“å è¡¨å &gt; è„šæœ¬å;</p><h3 id="å¯¼å‡ºæ•´ä¸ªæ•°æ®åº“ç»“æ„å’Œæ•°æ®"><a href="#å¯¼å‡ºæ•´ä¸ªæ•°æ®åº“ç»“æ„å’Œæ•°æ®" class="headerlink" title="å¯¼å‡ºæ•´ä¸ªæ•°æ®åº“ç»“æ„å’Œæ•°æ®"></a>å¯¼å‡ºæ•´ä¸ªæ•°æ®åº“ç»“æ„å’Œæ•°æ®</h3><pre class=" language-shell"><code class="language-shell">mysqldump -h localhost -uroot -p123456 database > dump.sql</code></pre><h3 id="å¯¼å‡ºå•ä¸ªæ•°æ®è¡¨ç»“æ„å’Œæ•°æ®"><a href="#å¯¼å‡ºå•ä¸ªæ•°æ®è¡¨ç»“æ„å’Œæ•°æ®" class="headerlink" title="å¯¼å‡ºå•ä¸ªæ•°æ®è¡¨ç»“æ„å’Œæ•°æ®"></a>å¯¼å‡ºå•ä¸ªæ•°æ®è¡¨ç»“æ„å’Œæ•°æ®</h3><pre class=" language-shell"><code class="language-shell">mysqldump -h localhost -uroot -p123456  database table > dump.sql</code></pre><h3 id="å¯¼å‡ºæ•´ä¸ªæ•°æ®åº“ç»“æ„ï¼ˆä¸åŒ…å«æ•°æ®ï¼‰"><a href="#å¯¼å‡ºæ•´ä¸ªæ•°æ®åº“ç»“æ„ï¼ˆä¸åŒ…å«æ•°æ®ï¼‰" class="headerlink" title="å¯¼å‡ºæ•´ä¸ªæ•°æ®åº“ç»“æ„ï¼ˆä¸åŒ…å«æ•°æ®ï¼‰"></a>å¯¼å‡ºæ•´ä¸ªæ•°æ®åº“ç»“æ„ï¼ˆä¸åŒ…å«æ•°æ®ï¼‰</h3><pre class=" language-shell"><code class="language-shell">mysqldump -h localhost -uroot -p123456  -d database > dump.sql</code></pre><h3 id="å¯¼å‡ºå•ä¸ªæ•°æ®è¡¨ç»“æ„ï¼ˆä¸åŒ…å«æ•°æ®ï¼‰"><a href="#å¯¼å‡ºå•ä¸ªæ•°æ®è¡¨ç»“æ„ï¼ˆä¸åŒ…å«æ•°æ®ï¼‰" class="headerlink" title="å¯¼å‡ºå•ä¸ªæ•°æ®è¡¨ç»“æ„ï¼ˆä¸åŒ…å«æ•°æ®ï¼‰"></a>å¯¼å‡ºå•ä¸ªæ•°æ®è¡¨ç»“æ„ï¼ˆä¸åŒ…å«æ•°æ®ï¼‰</h3><pre class=" language-shell"><code class="language-shell">mysqldump -h localhost -uroot -p123456  -d database table > dump.sql</code></pre>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Boot æ•´åˆMyBatis-Plusä½¿ç”¨å¤šæ•°æ®æº</title>
      <link href="2019/03/19/spring-boot-mybatisplus-multiple-datasource/"/>
      <url>2019/03/19/spring-boot-mybatisplus-multiple-datasource/</url>
      
        <content type="html"><![CDATA[<p>é¡¹ç›®ä¸­ä½¿ç”¨åˆ°äº†MySQLæ•°æ®åº“å­˜å‚¨é…ç½®æ•°æ®ï¼ŒVerticaä¸­å­˜å‚¨æŒ‡æ ‡æ•°æ®ï¼Œè¿™æ ·å°±æœ‰ä¸¤ä¸ªåŸºäºjdbcçš„æ•°æ®æºï¼Œæ‰€ä»¥éœ€è¦åšåˆ°åŠ¨æ€é…ç½®ä¸åˆ‡æ¢ï¼Œå¹¶ä¸”é¡¹ç›®é‡‡ç”¨äº†<a href="https://mp.baomidou.com/">mybatis-plus</a>ä½œä¸ºormæ¡†æ¶ï¼Œæ‰€ä»¥ä½¿ç”¨mybatis-plusé…ç½®å¤šæ•°æ®æºï¼Œå¹¶ä¸”é…ç½®hikariè¿æ¥æ± ï¼Œè¿™ä¹Ÿæ˜¯Spring Boot-2.xè‡ªå¸¦çš„è¿æ¥æ± ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªé…ç½®æ€è·¯ä¸æ–¹æ¡ˆï¼Œä»…ä¾›å‚è€ƒã€‚é€šè¿‡æŸ¥çœ‹mybatis-plusçš„æºç å‘ç°ï¼Œè¯¥æ¡†æ¶ç›®å‰è¿æ¥Verticaæ—¶ä¼šæç¤ºä¸€ä¸ªè­¦å‘Šâš ï¸ è¡¨ç¤ºä¸æ”¯æŒè¯¥æ•°æ®åº“ï¼Œå®é™…ä½¿ç”¨æ—¶å¯ä»¥ç›´æ¥ä½¿ç”¨mybatisæ‰§è¡Œsqlçš„åŠŸèƒ½å³å¯ã€‚</p><pre><code>2019-03-19 17:36:20.877  WARN 14103 --- [  restartedMain] c.b.m.extension.toolkit.JdbcUtils        : The jdbcUrl is jdbc:vertica://192.168.21.188:5433/vertica20190122001, Mybatis Plus Cannot Read Database type or The Database's Not Supported!</code></pre><p>å…³äºMySQLå’ŒVerticaçš„å»ºåº“å»ºè¡¨è¿™è¾¹å°±ä¸æ”¾äº†ï¼Œç›´æ¥è´´ä¸Šæ ¸å¿ƒä»£ç ã€‚</p><h2 id="pom-é…ç½®"><a href="#pom-é…ç½®" class="headerlink" title="pom é…ç½®"></a>pom é…ç½®</h2><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>${mybatisplus.spring.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- jdbc driver è¿™æ˜¯æ˜¯å®˜ç½‘ä¸‹è½½ï¼Œè‡ªå·±ä¼ åˆ°å†…ç½‘æœåŠ¡å™¨çš„jdbcé©±åŠ¨ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.xiaozhangge.vertica<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>vertica-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>9.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span></code></pre><h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> example<span class="token punctuation">-</span>dynamic<span class="token punctuation">-</span>datasource  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>    <span class="token key atrule">mysql</span><span class="token punctuation">:</span>      <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver      <span class="token key atrule">hikari</span><span class="token punctuation">:</span>        <span class="token key atrule">auto-commit</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>        <span class="token key atrule">connection-test-query</span><span class="token punctuation">:</span> SELECT 1        <span class="token key atrule">connection-timeout</span><span class="token punctuation">:</span> <span class="token number">30000</span>        <span class="token key atrule">idle-timeout</span><span class="token punctuation">:</span> <span class="token number">30000</span>        <span class="token key atrule">max-lifetime</span><span class="token punctuation">:</span> <span class="token number">1800000</span>        <span class="token key atrule">maximum-pool-size</span><span class="token punctuation">:</span> <span class="token number">15</span>        <span class="token key atrule">minimum-idle</span><span class="token punctuation">:</span> <span class="token number">5</span>        <span class="token key atrule">pool-name</span><span class="token punctuation">:</span> MySQLHikariCP      <span class="token key atrule">password</span><span class="token punctuation">:</span> Root@123      <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource      <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.21.111<span class="token punctuation">:</span>3306/life<span class="token punctuation">-</span>test<span class="token punctuation">?</span>characterEncoding=utf8<span class="token important">&amp;useSSL</span>=false      <span class="token key atrule">username</span><span class="token punctuation">:</span> root    <span class="token key atrule">vertica</span><span class="token punctuation">:</span>      <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.vertica.jdbc.Driver      <span class="token key atrule">hikari</span><span class="token punctuation">:</span>        <span class="token key atrule">auto-commit</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>        <span class="token key atrule">connection-test-query</span><span class="token punctuation">:</span> SELECT 1        <span class="token key atrule">connection-timeout</span><span class="token punctuation">:</span> <span class="token number">30000</span>        <span class="token key atrule">idle-timeout</span><span class="token punctuation">:</span> <span class="token number">30000</span>        <span class="token key atrule">max-lifetime</span><span class="token punctuation">:</span> <span class="token number">1800000</span>        <span class="token key atrule">maximum-pool-size</span><span class="token punctuation">:</span> <span class="token number">15</span>        <span class="token key atrule">minimum-idle</span><span class="token punctuation">:</span> <span class="token number">5</span>        <span class="token key atrule">pool-name</span><span class="token punctuation">:</span> VerticaHikariCP      <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>      <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource      <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>vertica<span class="token punctuation">:</span>//192.168.21.188<span class="token punctuation">:</span>5433/vertica20190122001      <span class="token key atrule">username</span><span class="token punctuation">:</span> dbadmin<span class="token key atrule">logging</span><span class="token punctuation">:</span>  <span class="token key atrule">home</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>user.dir<span class="token punctuation">}</span>/logs<span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>    <span class="token key atrule">map-underscore-to-camel-case</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> com.xiaozhangge.entity</code></pre><h2 id="HikariCP-é…ç½®"><a href="#HikariCP-é…ç½®" class="headerlink" title="HikariCP é…ç½®"></a>HikariCP é…ç½®</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>config<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>Data<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019-03-20. */</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HikariConfig</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String poolName<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> autoCommit<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">long</span> connectionTimeout<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">long</span> idleTimeout<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">long</span> maxLifetime<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> minimumIdle<span class="token punctuation">;</span>    <span class="token keyword">private</span> String connectionTestQuery<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="MySQLæ•°æ®æºé…ç½®"><a href="#MySQLæ•°æ®æºé…ç½®" class="headerlink" title="MySQLæ•°æ®æºé…ç½®"></a>MySQLæ•°æ®æºé…ç½®</h2><h3 id="è¿æ¥æ± é…ç½®"><a href="#è¿æ¥æ± é…ç½®" class="headerlink" title="è¿æ¥æ± é…ç½®"></a>è¿æ¥æ± é…ç½®</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>config<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>Data<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>EqualsAndHashCode<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span>ConfigurationProperties<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019-03-20. */</span><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EqualsAndHashCode</span><span class="token punctuation">(</span>callSuper <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"spring.datasource.mysql.hikari"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HikariMySQLConfig</span> <span class="token keyword">extends</span> <span class="token class-name">HikariConfig</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><h3 id="DataSourceé…ç½®"><a href="#DataSourceé…ç½®" class="headerlink" title="DataSourceé…ç½®"></a>DataSourceé…ç½®</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>datasource<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>MybatisSqlSessionFactoryBean<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>configure<span class="token punctuation">.</span>HikariMySQLConfig<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>zaxxer<span class="token punctuation">.</span>hikari<span class="token punctuation">.</span>HikariDataSource<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>SqlSessionFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>SqlSessionTemplate<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>MapperScan<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Qualifier<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span>ConfigurationProperties<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>DataSourceBuilder<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>DataSourceTransactionManager<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>DataSource<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019-03-19. */</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">"com.xiaozhangge.mapper.mysql"</span><span class="token punctuation">,</span> sqlSessionTemplateRef <span class="token operator">=</span> <span class="token string">"mysqlSqlSessionTemplate"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySQLDataSourceConfigure</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> HikariMySQLConfig mysqlConfig<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">MySQLDataSourceConfigure</span><span class="token punctuation">(</span>HikariMySQLConfig mysqlConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>mysqlConfig <span class="token operator">=</span> mysqlConfig<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"mysqlDataSource"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">"spring.datasource.mysql"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> DataSource <span class="token function">mysql</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        DataSource dataSource <span class="token operator">=</span> DataSourceBuilder<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        HikariDataSource hikariDataSource <span class="token operator">=</span> null<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>dataSource <span class="token keyword">instanceof</span> <span class="token class-name">HikariDataSource</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// è¿æ¥æ± é…ç½®</span>            hikariDataSource <span class="token operator">=</span> <span class="token punctuation">(</span>HikariDataSource<span class="token punctuation">)</span> dataSource<span class="token punctuation">;</span>            hikariDataSource<span class="token punctuation">.</span><span class="token function">setPoolName</span><span class="token punctuation">(</span>mysqlConfig<span class="token punctuation">.</span><span class="token function">getPoolName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            hikariDataSource<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span>mysqlConfig<span class="token punctuation">.</span><span class="token function">isAutoCommit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            hikariDataSource<span class="token punctuation">.</span><span class="token function">setConnectionTestQuery</span><span class="token punctuation">(</span>mysqlConfig<span class="token punctuation">.</span><span class="token function">getConnectionTestQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            hikariDataSource<span class="token punctuation">.</span><span class="token function">setIdleTimeout</span><span class="token punctuation">(</span>mysqlConfig<span class="token punctuation">.</span><span class="token function">getIdleTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            hikariDataSource<span class="token punctuation">.</span><span class="token function">setConnectionTimeout</span><span class="token punctuation">(</span>mysqlConfig<span class="token punctuation">.</span><span class="token function">getConnectionTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            hikariDataSource<span class="token punctuation">.</span><span class="token function">setMaximumPoolSize</span><span class="token punctuation">(</span>mysqlConfig<span class="token punctuation">.</span><span class="token function">getMaximumPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            hikariDataSource<span class="token punctuation">.</span><span class="token function">setMaxLifetime</span><span class="token punctuation">(</span>mysqlConfig<span class="token punctuation">.</span><span class="token function">getMaxLifetime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            hikariDataSource<span class="token punctuation">.</span><span class="token function">setMinimumIdle</span><span class="token punctuation">(</span>mysqlConfig<span class="token punctuation">.</span><span class="token function">getMinimumIdle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> hikariDataSource <span class="token operator">==</span> null <span class="token operator">?</span> dataSource <span class="token operator">:</span> hikariDataSource<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"mysqlSqlSessionFactory"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> SqlSessionFactory <span class="token function">mysqlSqlSessionFactory</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"mysqlDataSource"</span><span class="token punctuation">)</span> DataSource dataSource<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// MyBatis-Plusä½¿ç”¨MybatisSqlSessionFactoryBean  MyBatisç›´æ¥ä½¿ç”¨SqlSessionFactoryBean</span>        MybatisSqlSessionFactoryBean bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MybatisSqlSessionFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// ç»™MyBatis-Plusæ³¨å…¥æ•°æ®æº</span>        bean<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> bean<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"mysqlTransactionManager"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> DataSourceTransactionManager <span class="token function">mysqlTransactionManager</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"mysqlDataSource"</span><span class="token punctuation">)</span> DataSource dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceTransactionManager</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"mysqlSqlSessionTemplate"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> SqlSessionTemplate <span class="token function">mysqlSqlSessionTemplate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"mysqlSqlSessionFactory"</span><span class="token punctuation">)</span> SqlSessionFactory sqlSessionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionTemplate</span><span class="token punctuation">(</span>sqlSessionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="Verticaæ•°æ®æºé…ç½®"><a href="#Verticaæ•°æ®æºé…ç½®" class="headerlink" title="Verticaæ•°æ®æºé…ç½®"></a>Verticaæ•°æ®æºé…ç½®</h2><h3 id="è¿æ¥æ± é…ç½®-1"><a href="#è¿æ¥æ± é…ç½®-1" class="headerlink" title="è¿æ¥æ± é…ç½®"></a>è¿æ¥æ± é…ç½®</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>config<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>Data<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>EqualsAndHashCode<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span>ConfigurationProperties<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019-03-20. */</span><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EqualsAndHashCode</span><span class="token punctuation">(</span>callSuper <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"spring.datasource.vertica.hikari"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HikariVerticaConfig</span> <span class="token keyword">extends</span> <span class="token class-name">HikariConfig</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><h3 id="DataSourceé…ç½®-1"><a href="#DataSourceé…ç½®-1" class="headerlink" title="DataSourceé…ç½®"></a>DataSourceé…ç½®</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>datasource<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>MybatisSqlSessionFactoryBean<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>configure<span class="token punctuation">.</span>HikariVerticaConfig<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>zaxxer<span class="token punctuation">.</span>hikari<span class="token punctuation">.</span>HikariDataSource<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>SqlSessionFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>SqlSessionTemplate<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>MapperScan<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Qualifier<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span>ConfigurationProperties<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>DataSourceBuilder<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>DataSourceTransactionManager<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>DataSource<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019-03-19. */</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">"com.xiaozhangge.mapper.vertica"</span><span class="token punctuation">,</span> sqlSessionTemplateRef <span class="token operator">=</span> <span class="token string">"verticaSqlSessionTemplate"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VerticaDataSourceConfigure</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> HikariVerticaConfig verticaConfig<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">VerticaDataSourceConfigure</span><span class="token punctuation">(</span>HikariVerticaConfig verticaConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>verticaConfig <span class="token operator">=</span> verticaConfig<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"verticaDataSource"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">"spring.datasource.vertica"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> DataSource <span class="token function">vertica</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        DataSource dataSource <span class="token operator">=</span> DataSourceBuilder<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        HikariDataSource hikariDataSource <span class="token operator">=</span> null<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>dataSource <span class="token keyword">instanceof</span> <span class="token class-name">HikariDataSource</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// è¿æ¥æ± é…ç½®</span>            hikariDataSource <span class="token operator">=</span> <span class="token punctuation">(</span>HikariDataSource<span class="token punctuation">)</span> dataSource<span class="token punctuation">;</span>            hikariDataSource<span class="token punctuation">.</span><span class="token function">setPoolName</span><span class="token punctuation">(</span>verticaConfig<span class="token punctuation">.</span><span class="token function">getPoolName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            hikariDataSource<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span>verticaConfig<span class="token punctuation">.</span><span class="token function">isAutoCommit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            hikariDataSource<span class="token punctuation">.</span><span class="token function">setConnectionTestQuery</span><span class="token punctuation">(</span>verticaConfig<span class="token punctuation">.</span><span class="token function">getConnectionTestQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            hikariDataSource<span class="token punctuation">.</span><span class="token function">setIdleTimeout</span><span class="token punctuation">(</span>verticaConfig<span class="token punctuation">.</span><span class="token function">getIdleTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            hikariDataSource<span class="token punctuation">.</span><span class="token function">setConnectionTimeout</span><span class="token punctuation">(</span>verticaConfig<span class="token punctuation">.</span><span class="token function">getConnectionTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            hikariDataSource<span class="token punctuation">.</span><span class="token function">setMaximumPoolSize</span><span class="token punctuation">(</span>verticaConfig<span class="token punctuation">.</span><span class="token function">getMaximumPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            hikariDataSource<span class="token punctuation">.</span><span class="token function">setMaxLifetime</span><span class="token punctuation">(</span>verticaConfig<span class="token punctuation">.</span><span class="token function">getMaxLifetime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            hikariDataSource<span class="token punctuation">.</span><span class="token function">setMinimumIdle</span><span class="token punctuation">(</span>verticaConfig<span class="token punctuation">.</span><span class="token function">getMinimumIdle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> hikariDataSource <span class="token operator">==</span> null <span class="token operator">?</span> dataSource <span class="token operator">:</span> hikariDataSource<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"verticaSqlSessionFactory"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> SqlSessionFactory <span class="token function">verticaSqlSessionFactory</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"verticaDataSource"</span><span class="token punctuation">)</span> DataSource dataSource<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// MyBatis-Plusä½¿ç”¨MybatisSqlSessionFactoryBean  MyBatisç›´æ¥ä½¿ç”¨SqlSessionFactoryBean</span>        MybatisSqlSessionFactoryBean bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MybatisSqlSessionFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// ç»™MyBatis-Plusæ³¨å…¥æ•°æ®æº</span>        bean<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> bean<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"verticaTransactionManager"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> DataSourceTransactionManager <span class="token function">verticaTransactionManager</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"verticaDataSource"</span><span class="token punctuation">)</span> DataSource dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceTransactionManager</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"verticaSqlSessionTemplate"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> SqlSessionTemplate <span class="token function">verticaSqlSessionTemplate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"verticaSqlSessionFactory"</span><span class="token punctuation">)</span> SqlSessionFactory sqlSessionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionTemplate</span><span class="token punctuation">(</span>sqlSessionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="Mapper"><a href="#Mapper" class="headerlink" title="Mapper"></a>Mapper</h2><h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>mysql<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>BaseMapper<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>SysUser<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span>Insert<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span>Param<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span>Select<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Repository<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019-03-19. */</span><span class="token annotation punctuation">@Repository</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SysUserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token operator">&lt;</span>SysUser<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">"insert into sys_user values(#{x.id},#{x.name},#{x.birthday})"</span><span class="token punctuation">)</span>    <span class="token keyword">boolean</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"x"</span><span class="token punctuation">)</span> SysUser user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from sys_user"</span><span class="token punctuation">)</span>    List<span class="token operator">&lt;</span>SysUser<span class="token operator">></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="Vertica"><a href="#Vertica" class="headerlink" title="Vertica"></a>Vertica</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>vertica<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>BaseMapper<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>User<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span>Select<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Repository<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019-03-15. */</span><span class="token annotation punctuation">@Repository</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token operator">&lt;</span>User<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from public.user"</span><span class="token punctuation">)</span>    List<span class="token operator">&lt;</span>User<span class="token operator">></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å¯ä»¥å‘ç°åªè¦æ•°æ®æºé…ç½®æˆåŠŸä»¥åï¼Œä¸¤è€…å·²ç»æ²¡æœ‰ä»»ä½•åŒºåˆ«äº†ï¼Œå°±å¯ä»¥åƒæ­£å¸¸å†™ä»£ç ä¸€æ ·ï¼Œéœ€è¦æ³¨æ„çš„å°±æ˜¯ä¸åŒæ•°æ®åº“çš„mapperéœ€è¦æ”¾åœ¨æŒ‡å®šçš„åŒ…ä¸‹é¢ï¼Œå¦åˆ™springå®¹å™¨æ— æ³•æ‰«æã€‚</p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>ä¸ºäº†æ–¹ä¾¿ï¼Œç›´æ¥å°±åœ¨é¡¹ç›®å¯åŠ¨ä»¥åæŸ¥è¯¢ä¸¤ä¸ªæ•°æ®åº“çš„æ•°æ®å°±å¥½äº†</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>SysUser<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>User<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>SysUserMapper<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>vertica<span class="token punctuation">.</span>UserMapper<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>util<span class="token punctuation">.</span>IdHelper<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>CommandLineRunner<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>SpringApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>SpringBootApplication<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalDateTime<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019-03-15. */</span><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicDataSourceApplication</span> <span class="token keyword">implements</span> <span class="token class-name">CommandLineRunner</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> UserMapper userMapper<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> SysUserMapper sysUserMapper<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>DynamicDataSourceApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>IdHelper<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"é˜¿ç‰›-"</span> <span class="token operator">+</span> IdHelper<span class="token punctuation">.</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"description-"</span> <span class="token operator">+</span> IdHelper<span class="token punctuation">.</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// ä½¿ç”¨è‡ªå®šä¹‰çš„æŸ¥è¯¢æ–¹æ³•</span>        List<span class="token operator">&lt;</span>User<span class="token operator">></span> list <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"insert result:{} list.size:{}"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">boolean</span> b <span class="token operator">=</span> sysUserMapper<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SysUser</span><span class="token punctuation">(</span>IdHelper<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"é˜¿ç‰›-"</span> <span class="token operator">+</span> IdHelper<span class="token punctuation">.</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// ä½¿ç”¨MyBatis-Plusæä¾›çš„æŸ¥è¯¢æ–¹æ³•</span>        List<span class="token operator">&lt;</span>SysUser<span class="token operator">></span> users <span class="token operator">=</span> sysUserMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"insert result:{} list.size:{}"</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> users<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        users<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>x <span class="token operator">-</span><span class="token operator">></span> log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>é¡¹ç›®å¯åŠ¨ä»¥åï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°åˆå§‹åŒ–äº†å¤šä¸ªæ•°æ®æºçš„æ—¥å¿—</p><pre><code>  .   ____          _            __ _ _ /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \ \\/  ___)| |_)| | | | | || (_| |  ) ) ) )  '  |____| .__|_| |_|_| |_\__, | / / / / =========|_|==============|___/=/_/_/_/ :: Spring Boot ::        (v2.1.3.RELEASE)2019-03-20 10:33:18.233  INFO 21123 --- [  restartedMain] c.xiaozhangge.DynamicDataSourceApplication  : Starting DynamicDataSourceApplication on xiaozhangge.local with PID 21123 (/Users/xiaozhangge/share/life-example/example-dynamic-datasource/target/classes started by xiaozhangge in /Users/xiaozhangge/share/life-example)2019-03-20 10:33:18.237  INFO 21123 --- [  restartedMain] c.xiaozhangge.DynamicDataSourceApplication  : No active profile set, falling back to default profiles: default2019-03-20 10:33:18.360  INFO 21123 --- [  restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable2019-03-20 10:33:18.360  INFO 21123 --- [  restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'2019-03-20 10:33:20.341  INFO 21123 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)2019-03-20 10:33:20.374  INFO 21123 --- [  restartedMain] o.apache.catalina.core.StandardService   : Starting service [Tomcat]2019-03-20 10:33:20.375  INFO 21123 --- [  restartedMain] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.16]2019-03-20 10:33:20.391  INFO 21123 --- [  restartedMain] o.a.catalina.core.AprLifecycleListener   : The APR based Apache Tomcat Native library which allows optimal performance in production environments was not found on the java.library.path: [/Users/xiaozhangge/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.]2019-03-20 10:33:20.497  INFO 21123 --- [  restartedMain] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext2019-03-20 10:33:20.497  INFO 21123 --- [  restartedMain] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 2136 ms _ _   |_  _ _|_. ___ _ |    _ | | |\/|_)(_| | |_\  |_)||_|_\      /               |                                 3.0.6 2019-03-20 10:33:20.751  INFO 21123 --- [  restartedMain] com.zaxxer.hikari.HikariDataSource       : VerticaHikariCP - Starting...2019-03-20 10:33:21.449  INFO 21123 --- [  restartedMain] com.zaxxer.hikari.pool.PoolBase          : VerticaHikariCP - Driver does not support get/set network timeout for connections. (com.vertica.jdbc.VerticaJdbc4ConnectionImpl.getNetworkTimeout()I)2019-03-20 10:33:21.672  INFO 21123 --- [  restartedMain] com.zaxxer.hikari.HikariDataSource       : VerticaHikariCP - Start completed.2019-03-20 10:33:21.683  WARN 21123 --- [  restartedMain] c.b.m.extension.toolkit.JdbcUtils        : The jdbcUrl is jdbc:vertica://192.168.21.188:5433/vertica20190122001, Mybatis Plus Cannot Read Database type or The Database's Not Supported! _ _   |_  _ _|_. ___ _ |    _ | | |\/|_)(_| | |_\  |_)||_|_\      /               |                                 3.0.6 2019-03-20 10:33:21.865  INFO 21123 --- [  restartedMain] com.zaxxer.hikari.HikariDataSource       : MySQLHikariCP - Starting...2019-03-20 10:33:23.201  INFO 21123 --- [  restartedMain] com.zaxxer.hikari.HikariDataSource       : MySQLHikariCP - Start completed.2019-03-20 10:33:23.516  INFO 21123 --- [  restartedMain] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService 'applicationTaskExecutor'2019-03-20 10:33:23.804  INFO 21123 --- [  restartedMain] o.s.b.d.a.OptionalLiveReloadServer       : LiveReload server is running on port 357292019-03-20 10:33:23.887  INFO 21123 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''2019-03-20 10:33:23.892  INFO 21123 --- [  restartedMain] c.xiaozhangge.DynamicDataSourceApplication  : Started DynamicDataSourceApplication in 6.41 seconds (JVM running for 7.001)</code></pre><p>ä»¥ä¸Šå®Œæ•´<a href="https://github.com/xiaomozhang/personal-life-example">ä»£ç </a></p>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Cloud Eureka æ³¨å†Œä¸­å¿ƒ</title>
      <link href="2019/03/17/spring-cloud-eureka/"/>
      <url>2019/03/17/spring-cloud-eureka/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯Spring-Cloud"><a href="#ä»€ä¹ˆæ˜¯Spring-Cloud" class="headerlink" title="ä»€ä¹ˆæ˜¯Spring Cloud"></a>ä»€ä¹ˆæ˜¯Spring Cloud</h1><p>Spring Cloudæ˜¯ä¸€ç³»åˆ—æ¡†æ¶çš„æœ‰åºé›†åˆã€‚å®ƒåˆ©ç”¨Spring Bootçš„å¼€å‘ä¾¿åˆ©æ€§å·§å¦™åœ°ç®€åŒ–äº†åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€è®¾æ–½çš„å¼€å‘ï¼Œå¦‚æœåŠ¡å‘ç°æ³¨å†Œã€é…ç½®ä¸­å¿ƒã€æ¶ˆæ¯æ€»çº¿ã€è´Ÿè½½å‡è¡¡ã€æ–­è·¯å™¨ã€æ•°æ®ç›‘æ§ç­‰ï¼Œéƒ½å¯ä»¥ç”¨Spring Bootçš„å¼€å‘é£æ ¼åšåˆ°ä¸€é”®å¯åŠ¨å’Œéƒ¨ç½²ã€‚Springå¹¶æ²¡æœ‰é‡å¤åˆ¶é€ è½®å­ï¼Œå®ƒåªæ˜¯å°†ç›®å‰å„å®¶å…¬å¸å¼€å‘çš„æ¯”è¾ƒæˆç†Ÿã€ç»å¾—èµ·å®é™…è€ƒéªŒçš„æœåŠ¡æ¡†æ¶ç»„åˆèµ·æ¥ï¼Œé€šè¿‡Spring Booté£æ ¼è¿›è¡Œå†å°è£…å±è”½æ‰äº†å¤æ‚çš„é…ç½®å’Œå®ç°åŸç†ï¼Œæœ€ç»ˆç»™å¼€å‘è€…ç•™å‡ºäº†ä¸€å¥—ç®€å•æ˜“æ‡‚ã€æ˜“éƒ¨ç½²å’Œæ˜“ç»´æŠ¤çš„åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘å·¥å…·åŒ…ã€‚</p><p>ä¸‹å›¾æ˜¯ä¸€ä¸ªåŸºæœ¬çš„Spring Cloudç»„ä»¶æ¶æ„ï¼Œæ ¸å¿ƒç»„ä»¶æœ‰Eurekaã€Zuulã€Ribbonã€Feginã€Hystrixç­‰ç­‰ã€‚æ¥ä¸‹æ¥å°†ä»‹ç»ç¬¬ä¸€ä¸ªEurekaç»„ä»¶</p><p><img src="/images/spring-cloud-framework.jpg" alt="å›¾ç‰‡æ¥æºäºç½‘ç»œï¼Œä¾µåˆ "></p><h1 id="Eurekaæ³¨å†Œä¸­å¿ƒ"><a href="#Eurekaæ³¨å†Œä¸­å¿ƒ" class="headerlink" title="Eurekaæ³¨å†Œä¸­å¿ƒ"></a>Eurekaæ³¨å†Œä¸­å¿ƒ</h1><p>æ³¨å†Œä¸­å¿ƒï¼Œç®¡ç†å„ç§æœåŠ¡åŠŸèƒ½åŒ…æ‹¬æœåŠ¡çš„æ³¨å†Œã€å‘ç°ã€ç†”æ–­ã€è´Ÿè½½ã€é™çº§ç­‰ï¼Œæ¯”å¦‚dubbo adminåå°çš„å„ç§åŠŸèƒ½ã€‚æœ‰äº†æœåŠ¡ä¸­å¿ƒä¹‹åï¼Œä»»ä½•ä¸€ä¸ªæœåŠ¡éƒ½ä¸èƒ½ç›´æ¥å»æ‰ç”¨ï¼Œéƒ½éœ€è¦é€šè¿‡æœåŠ¡ä¸­å¿ƒæ¥è°ƒç”¨ã€‚é€šè¿‡æœåŠ¡ä¸­å¿ƒæ¥è·å–æœåŠ¡ä½ ä¸éœ€è¦å…³æ³¨ä½ è°ƒç”¨çš„é¡¹ç›®IPåœ°å€ï¼Œç”±å‡ å°æœåŠ¡å™¨ç»„æˆï¼Œæ¯æ¬¡ç›´æ¥å»æœåŠ¡ä¸­å¿ƒè·å–å¯ä»¥ä½¿ç”¨çš„æœåŠ¡å»è°ƒç”¨æ—¢å¯ã€‚</p><p>Eurekaæ˜¯Netflixå¼€æºçš„ä¸€æ¬¾æä¾›æœåŠ¡æ³¨å†Œå’Œå‘ç°çš„äº§å“ï¼Œå®ƒæä¾›äº†å®Œæ•´çš„Service Registryå’ŒService Discoveryå®ç°ã€‚ä¹Ÿæ˜¯Spring Cloudä½“ç³»ä¸­æœ€é‡è¦æœ€æ ¸å¿ƒçš„ç»„ä»¶ä¹‹ä¸€ã€‚</p><p>å®˜æ–¹ä»‹ç»:</p><blockquote><p>Eureka is a REST (Representational State Transfer) based service that is primarily used in the AWS cloud for locating services for the purpose of load balancing and failover of middle-tier servers.</p><p>Eureka æ˜¯ä¸€ä¸ªåŸºäº REST çš„æœåŠ¡ï¼Œä¸»è¦åœ¨ AWS äº‘ä¸­ä½¿ç”¨, å®šä½æœåŠ¡æ¥è¿›è¡Œä¸­é—´å±‚æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»ã€‚</p></blockquote><p>ç”¨ä¸€å¼ å›¾ç®€å•è¯´æ˜:</p><p><img src="/images/eureka/eureka-architecture-overview.png" alt="å›¾ç‰‡æ¥æºäºç½‘ç»œï¼Œä¾µåˆ "></p><p>ä¸Šå›¾ç®€è¦æè¿°äº†Eurekaçš„åŸºæœ¬æ¶æ„ï¼Œç”±3ä¸ªè§’è‰²ç»„æˆï¼š</p><p>1ã€Eureka Server</p><ul><li>æä¾›æœåŠ¡æ³¨å†Œå’Œå‘ç°</li></ul><p>2ã€Service Provider</p><ul><li>æœåŠ¡æä¾›æ–¹</li><li>å°†è‡ªèº«æœåŠ¡æ³¨å†Œåˆ°Eurekaï¼Œä»è€Œä½¿æœåŠ¡æ¶ˆè´¹æ–¹èƒ½å¤Ÿæ‰¾åˆ°</li></ul><p>3ã€Service Consumer</p><ul><li>æœåŠ¡æ¶ˆè´¹æ–¹</li><li>ä»Eurekaè·å–æ³¨å†ŒæœåŠ¡åˆ—è¡¨ï¼Œä»è€Œèƒ½å¤Ÿæ¶ˆè´¹æœåŠ¡</li></ul><h2 id="Eureka-Server"><a href="#Eureka-Server" class="headerlink" title="Eureka Server"></a>Eureka Server</h2><p>æˆ‘ä»¬å¯ä»¥ç”¨Spring  initialize æ„å»ºä¸€ä¸ªåŸºæœ¬çš„mavené¡¹ç›®ï¼ŒåŸºäºSpring Cloud Greenwich.SR1 ç„¶åè‡ªå·±æ·»åŠ ç›¸åº”çš„ä¾èµ–</p><h3 id="pomä¾èµ–"><a href="#pomä¾èµ–" class="headerlink" title="pomä¾èµ–"></a>pomä¾èµ–</h3><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>${spring-cloud.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">></span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">></span></span>                        <span class="token comment" spellcheck="true">&lt;!-- é»˜è®¤goalã€‚åœ¨mvn packageä¹‹åï¼Œå†æ¬¡æ‰“åŒ…å¯æ‰§è¡Œçš„jar/warï¼ŒåŒæ—¶ä¿ç•™mvn packageç”Ÿæˆçš„jar/warä¸º.origin --></span>                        <span class="token comment" spellcheck="true">&lt;!-- https://docs.spring.io/spring-boot/docs/current/maven-plugin/repackage-mojo.html --></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">></span></span>repackage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span></code></pre><h3 id="å¯åŠ¨ç±»"><a href="#å¯åŠ¨ç±»" class="headerlink" title="å¯åŠ¨ç±»"></a>å¯åŠ¨ç±»</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>eureka<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>SpringApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>SpringBootApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>eureka<span class="token punctuation">.</span>server<span class="token punctuation">.</span>EnableEurekaServer<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * æ·»åŠ å¯åŠ¨ä»£ç ä¸­æ·»åŠ @EnableEurekaServeræ³¨è§£ * Created by xiaozhangge on 2019-03-15. */</span><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@EnableEurekaServer</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EurekaServerApplication</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>EurekaServerApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="application-properties-é…ç½®"><a href="#application-properties-é…ç½®" class="headerlink" title="application.properties é…ç½®"></a>application.properties é…ç½®</h3><p>eurekaä½¿ç”¨8761ç«¯å£</p><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">personal-life-cloud-eureka</span><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8761</span><span class="token attr-name">eureka.instance.hostname</span><span class="token punctuation">=</span><span class="token attr-value">localhost</span><span class="token comment" spellcheck="true"># å®ä¾‹åç§°æ˜¾ç¤ºIP</span><span class="token attr-name">eureka.instance.prefer-ip-address</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span class="token comment" spellcheck="true"># å¥åº·æ£€æŸ¥</span><span class="token attr-name">eureka.server.enable-self-preservation</span><span class="token punctuation">=</span><span class="token attr-value">false</span><span class="token comment" spellcheck="true"># æ¸…ç†é—´éš”</span><span class="token attr-name">eureka.server.eviction-interval-timer-in-ms</span><span class="token punctuation">=</span><span class="token attr-value">6000</span><span class="token comment" spellcheck="true"># è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°Eureka Serverï¼Œé»˜è®¤ä¸ºtrueã€‚</span><span class="token attr-name">eureka.client.register-with-eureka</span><span class="token punctuation">=</span><span class="token attr-value">false</span><span class="token comment" spellcheck="true"># è¡¨ç¤ºæ˜¯å¦ä»Eureka Serverè·å–æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚</span><span class="token attr-name">eureka.client.fetch-registry</span><span class="token punctuation">=</span><span class="token attr-value">false</span><span class="token comment" spellcheck="true"># eurekaæœåŠ¡åœ°å€ å¤šä¸ªåœ°å€å¯ä½¿ç”¨ , åˆ†éš”ã€‚</span><span class="token attr-name">eureka.client.service-url.defaultZone</span><span class="token punctuation">=</span><span class="token attr-value">http://${eureka.instance.hostname}:${server.port}/eureka/</span></code></pre><p>ç„¶åå¯åŠ¨é¡¹ç›®ï¼Œè®¿é—®</p><pre><code>http://localhost:8761/</code></pre><p><img src="/images/eureka/eureka-instance.png" alt="img"></p><h2 id="Eureka-é«˜å¯ç”¨"><a href="#Eureka-é«˜å¯ç”¨" class="headerlink" title="Eureka é«˜å¯ç”¨"></a>Eureka é«˜å¯ç”¨</h2><p>æ³¨å†Œä¸­å¿ƒè¿™ä¹ˆå…³é”®çš„æœåŠ¡ï¼Œå¦‚æœæ˜¯å•ç‚¹è¯ï¼Œé‡åˆ°æ•…éšœå°±æ˜¯æ¯ç­æ€§çš„ã€‚åœ¨ç”Ÿäº§ä¸­æˆ‘ä»¬å¯èƒ½éœ€è¦ä¸‰å°æˆ–è€…å¤§äºä¸‰å°çš„æ³¨å†Œä¸­å¿ƒæ¥ä¿è¯æœåŠ¡çš„ç¨³å®šæ€§ï¼Œåœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒæ˜¯æœ€é‡è¦çš„åŸºç¡€éƒ¨åˆ†ï¼Œç†åº”éšæ—¶å¤„äºå¯ä»¥æä¾›æœåŠ¡çš„çŠ¶æ€ã€‚ä¸ºäº†ç»´æŒå…¶å¯ç”¨æ€§ï¼Œä½¿ç”¨é›†ç¾¤æ˜¯å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚Eurekaé€šè¿‡äº’ç›¸æ³¨å†Œçš„æ–¹å¼æ¥å®ç°é«˜å¯ç”¨çš„éƒ¨ç½²ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†Eureke Serveré…ç½®å…¶ä»–å¯ç”¨çš„serviceUrlå°±èƒ½å®ç°é«˜å¯ç”¨éƒ¨ç½²ã€‚</p><h3 id="ä¿®æ”¹hostsæ–‡ä»¶"><a href="#ä¿®æ”¹hostsæ–‡ä»¶" class="headerlink" title="ä¿®æ”¹hostsæ–‡ä»¶"></a>ä¿®æ”¹hostsæ–‡ä»¶</h3><p>hostsæ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹<code>vim /etc/hosts</code></p><pre class=" language-shell"><code class="language-shell">127.0.0.1 peer1  127.0.0.1 peer2  127.0.0.1 peer3  </code></pre><h3 id="ä¿®æ”¹propertiesæ–‡ä»¶"><a href="#ä¿®æ”¹propertiesæ–‡ä»¶" class="headerlink" title="ä¿®æ”¹propertiesæ–‡ä»¶"></a>ä¿®æ”¹propertiesæ–‡ä»¶</h3><ul><li>åˆ›å»º application-peer1.properties å°†serviceUrlæŒ‡å‘peer2ã€peer3</li></ul><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">life-cloud-eureka</span><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8761</span><span class="token attr-name">eureka.instance.hostname</span><span class="token punctuation">=</span><span class="token attr-value">peer1</span><span class="token comment" spellcheck="true"># å®ä¾‹åç§°æ˜¾ç¤ºIP</span><span class="token attr-name">eureka.instance.prefer-ip-address</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span class="token comment" spellcheck="true"># å¥åº·æ£€æŸ¥</span><span class="token attr-name">eureka.server.enable-self-preservation</span><span class="token punctuation">=</span><span class="token attr-value">false</span><span class="token comment" spellcheck="true"># æ¸…ç†é—´éš”</span><span class="token attr-name">eureka.server.eviction-interval-timer-in-ms</span><span class="token punctuation">=</span><span class="token attr-value">6000</span><span class="token comment" spellcheck="true"># è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°Eureka Serverï¼Œé»˜è®¤ä¸ºtrueã€‚</span><span class="token attr-name">eureka.client.register-with-eureka</span><span class="token punctuation">=</span><span class="token attr-value">false</span><span class="token comment" spellcheck="true"># è¡¨ç¤ºæ˜¯å¦ä»Eureka Serverè·å–æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚</span><span class="token attr-name">eureka.client.fetch-registry</span><span class="token punctuation">=</span><span class="token attr-value">false</span><span class="token comment" spellcheck="true"># eurekaæœåŠ¡åœ°å€ å¤šä¸ªåœ°å€å¯ä½¿ç”¨ , åˆ†éš”ã€‚</span><span class="token attr-name">eureka.client.service-url.defaultZone</span><span class="token punctuation">=</span><span class="token attr-value">http://peer2:8762/eureka/,http://peer3:8763/eureka/</span></code></pre><ul><li>åˆ›å»º application-peer2.properties å°†serviceUrlæŒ‡å‘peer1ã€peer3</li></ul><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">life-cloud-eureka</span><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8762</span><span class="token attr-name">eureka.instance.hostname</span><span class="token punctuation">=</span><span class="token attr-value">peer2</span><span class="token comment" spellcheck="true"># å®ä¾‹åç§°æ˜¾ç¤ºIP</span><span class="token attr-name">eureka.instance.prefer-ip-address</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span class="token comment" spellcheck="true"># å¥åº·æ£€æŸ¥</span><span class="token attr-name">eureka.server.enable-self-preservation</span><span class="token punctuation">=</span><span class="token attr-value">false</span><span class="token comment" spellcheck="true"># æ¸…ç†é—´éš”</span><span class="token attr-name">eureka.server.eviction-interval-timer-in-ms</span><span class="token punctuation">=</span><span class="token attr-value">6000</span><span class="token comment" spellcheck="true"># è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°Eureka Serverï¼Œé»˜è®¤ä¸ºtrueã€‚</span><span class="token attr-name">eureka.client.register-with-eureka</span><span class="token punctuation">=</span><span class="token attr-value">false</span><span class="token comment" spellcheck="true"># è¡¨ç¤ºæ˜¯å¦ä»Eureka Serverè·å–æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚</span><span class="token attr-name">eureka.client.fetch-registry</span><span class="token punctuation">=</span><span class="token attr-value">false</span><span class="token comment" spellcheck="true"># eurekaæœåŠ¡åœ°å€ å¤šä¸ªåœ°å€å¯ä½¿ç”¨ , åˆ†éš”ã€‚</span><span class="token attr-name">eureka.client.service-url.defaultZone</span><span class="token punctuation">=</span><span class="token attr-value">http://peer1:8761/eureka/,http://peer3:8763/eureka/</span></code></pre><ul><li>åˆ›å»º application-peer3.properties å°†serviceUrlæŒ‡å‘peer1ã€peer2</li></ul><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">life-cloud-eureka</span><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8763</span><span class="token attr-name">eureka.instance.hostname</span><span class="token punctuation">=</span><span class="token attr-value">peer3</span><span class="token comment" spellcheck="true"># å®ä¾‹åç§°æ˜¾ç¤ºIP</span><span class="token attr-name">eureka.instance.prefer-ip-address</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span class="token comment" spellcheck="true"># å¥åº·æ£€æŸ¥</span><span class="token attr-name">eureka.server.enable-self-preservation</span><span class="token punctuation">=</span><span class="token attr-value">false</span><span class="token comment" spellcheck="true"># æ¸…ç†é—´éš”</span><span class="token attr-name">eureka.server.eviction-interval-timer-in-ms</span><span class="token punctuation">=</span><span class="token attr-value">6000</span><span class="token comment" spellcheck="true"># è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°Eureka Serverï¼Œé»˜è®¤ä¸ºtrueã€‚</span><span class="token attr-name">eureka.client.register-with-eureka</span><span class="token punctuation">=</span><span class="token attr-value">false</span><span class="token comment" spellcheck="true"># è¡¨ç¤ºæ˜¯å¦ä»Eureka Serverè·å–æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚</span><span class="token attr-name">eureka.client.fetch-registry</span><span class="token punctuation">=</span><span class="token attr-value">false</span><span class="token comment" spellcheck="true"># eurekaæœåŠ¡åœ°å€ å¤šä¸ªåœ°å€å¯ä½¿ç”¨ , åˆ†éš”ã€‚</span><span class="token attr-name">eureka.client.service-url.defaultZone</span><span class="token punctuation">=</span><span class="token attr-value">http://peer1:8761/eureka/,http://peer2:8762/eureka/</span></code></pre><h3 id="æ‰“åŒ…ä¾æ¬¡å¯åŠ¨"><a href="#æ‰“åŒ…ä¾æ¬¡å¯åŠ¨" class="headerlink" title="æ‰“åŒ…ä¾æ¬¡å¯åŠ¨"></a>æ‰“åŒ…ä¾æ¬¡å¯åŠ¨</h3><pre class=" language-shell"><code class="language-shell">mvn clean package</code></pre><ul><li>ä¾æ¬¡å¯åŠ¨</li></ul><pre class=" language-shell"><code class="language-shell">java -jar cloud-eureka-0.0.1.jar --spring.profiles.active=peer1java -jar cloud-eureka-0.0.1.jar --spring.profiles.active=peer2java -jar cloud-eureka-0.0.1.jar --spring.profiles.active=peer3</code></pre><p>å¯åŠ¨å®Œæˆåï¼Œæµè§ˆå™¨è¾“å…¥ï¼š<a href="http://localhost:8762/">http://localhost:8762/</a> æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p><p><img src="/images/eureka/eureka-cluster.png" alt="img"></p><p>å¯ä»¥åœ¨peer2ä¸­çœ‹åˆ°äº†peer1ã€peer3çš„ç›¸å…³çš„å‰¯æœ¬ä¿¡æ¯ã€‚è‡³æ­¤eurekaé›†ç¾¤ä¹Ÿå·²ç»å®Œæˆäº†ã€‚</p><p>ä»¥ä¸Šå®Œæ•´ä»£ç <a href="https://github.com/xiaomozhang/personal-life-cloud-example">github</a></p>]]></content>
      
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL å¸¸ç”¨è¯­å¥</title>
      <link href="2019/03/14/mysql-note-01/"/>
      <url>2019/03/14/mysql-note-01/</url>
      
        <content type="html"><![CDATA[<h1 id="MySQL-å¸¸ç”¨è¯­å¥"><a href="#MySQL-å¸¸ç”¨è¯­å¥" class="headerlink" title="MySQL å¸¸ç”¨è¯­å¥"></a>MySQL å¸¸ç”¨è¯­å¥</h1><p><a href="http://www.powerxing.com/sql-join/">sql-join</a><br><a href="https://mp.weixin.qq.com/s?__biz=MzAwOTE3NDY5OA==&amp;mid=2647906520&amp;idx=2&amp;sn=e1da610a41a0692721d3756f9e1583bb&amp;chksm=8344d31db4335a0bf5164b6c57c7e49f6a89f0538d778b156450bbaceba55e6a47abcebf2dd1&amp;mpshare=1&amp;scene=1&amp;srcid=0128OHhJN5V4SPLdlN1uN4lb#rd">mysqlå¸¸ç”¨sqlè¯­å¥æ€»ç»“</a></p><h2 id="ä¿®æ”¹æ›¿æ¢å­—æ®µä¸­çš„æŸä¸€ä¸ªå€¼"><a href="#ä¿®æ”¹æ›¿æ¢å­—æ®µä¸­çš„æŸä¸€ä¸ªå€¼" class="headerlink" title="ä¿®æ”¹æ›¿æ¢å­—æ®µä¸­çš„æŸä¸€ä¸ªå€¼"></a>ä¿®æ”¹æ›¿æ¢å­—æ®µä¸­çš„æŸä¸€ä¸ªå€¼</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">update</span> dictionary <span class="token keyword">set</span> content<span class="token operator">=</span>REPLACE<span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">'è°­'</span><span class="token punctuation">,</span> <span class="token string">'è°ˆ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class=" language-sql"><code class="language-sql"><span class="token keyword">update</span> recipes <span class="token keyword">set</span> item_image<span class="token operator">=</span>REPLACE<span class="token punctuation">(</span>item_image<span class="token punctuation">,</span>'http:<span class="token comment" spellcheck="true">//app-file.botu.com:9000','http://app-file.botu.com:9000/BOTU')</span><span class="token keyword">where</span> id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> rec<span class="token punctuation">.</span>id <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> id <span class="token keyword">from</span> recipes r <span class="token keyword">where</span>  <span class="token keyword">binary</span> r<span class="token punctuation">.</span>item_image <span class="token operator">not</span> <span class="token operator">like</span> <span class="token string">'%BOTU%'</span><span class="token punctuation">)</span> rec<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="æ¸…ç©ºè¡¨æ•°æ®"><a href="#æ¸…ç©ºè¡¨æ•°æ®" class="headerlink" title="æ¸…ç©ºè¡¨æ•°æ®"></a>æ¸…ç©ºè¡¨æ•°æ®</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">truncate</span> <span class="token keyword">table</span> dictionary<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">-- æ¸…ç©ºè‡ªå¢ä¸»é”®</span><span class="token keyword">delete</span> <span class="token keyword">from</span> dictionary<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">-- ä¸æ¸…ç©ºè‡ªå¢ä¸»é”®</span></code></pre><h2 id="NULLæŸ¥è¯¢"><a href="#NULLæŸ¥è¯¢" class="headerlink" title="NULLæŸ¥è¯¢"></a>NULLæŸ¥è¯¢</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tmp <span class="token keyword">where</span> name <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tmp <span class="token keyword">where</span> name <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">;</span></code></pre><h2 id="æ ¹æ®è¡¨ç»“æ„ç”Ÿæˆå®ä½“å¯¹åº”å­—æ®µ"><a href="#æ ¹æ®è¡¨ç»“æ„ç”Ÿæˆå®ä½“å¯¹åº”å­—æ®µ" class="headerlink" title="æ ¹æ®è¡¨ç»“æ„ç”Ÿæˆå®ä½“å¯¹åº”å­—æ®µ"></a>æ ¹æ®è¡¨ç»“æ„ç”Ÿæˆå®ä½“å¯¹åº”å­—æ®µ</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span>    CONCAT_WS<span class="token punctuation">(</span>        <span class="token string">''</span><span class="token punctuation">,</span>        '<span class="token comment" spellcheck="true">/**         *',         COLUMN_COMMENT,         '         */</span>         <span class="token variable">@TableField</span><span class="token punctuation">(</span><span class="token string">"',column_name,'"</span><span class="token punctuation">)</span>         <span class="token variable">@JSONField</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"',column_name,'"</span><span class="token punctuation">)</span>         private <span class="token string">',        CASE DATA_TYPE    WHEN '</span><span class="token keyword">varchar</span><span class="token string">' THEN        '</span>String <span class="token string">'    WHEN '</span><span class="token keyword">bigint</span><span class="token string">' THEN        '</span>Long <span class="token string">'    WHEN '</span><span class="token keyword">longtext</span><span class="token string">' THEN        '</span>String <span class="token string">'    WHEN '</span><span class="token keyword">datetime</span><span class="token string">' THEN        '</span><span class="token keyword">Date</span> <span class="token string">'    WHEN '</span><span class="token keyword">int</span><span class="token string">' THEN        '</span><span class="token keyword">Integer</span> <span class="token string">'    WHEN '</span><span class="token keyword">decimal</span><span class="token string">' THEN        '</span>BigDecimal <span class="token string">'    WHEN '</span><span class="token keyword">double</span><span class="token string">' THEN        '</span><span class="token keyword">Double</span> <span class="token string">'    WHEN '</span><span class="token keyword">timestamp</span><span class="token string">' THEN        '</span><span class="token keyword">Timestamp</span> <span class="token string">'    WHEN '</span><span class="token keyword">longblob</span><span class="token string">' THEN        '</span>Byte<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token string">'    WHEN '</span><span class="token keyword">tinyint</span><span class="token string">' THEN        '</span><span class="token keyword">Integer</span> <span class="token string">'    WHEN '</span><span class="token keyword">text</span><span class="token string">' THEN        '</span>String <span class="token string">'    WHEN '</span>char<span class="token string">' THEN        '</span>Char <span class="token string">'    WHEN '</span><span class="token keyword">date</span><span class="token string">' THEN        '</span><span class="token keyword">Date</span> <span class="token string">'    WHEN '</span><span class="token keyword">float</span><span class="token string">' THEN        '</span><span class="token keyword">Float</span> <span class="token string">'    WHEN '</span><span class="token keyword">varbinary</span><span class="token string">' THEN        '</span>Byte<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token string">'    WHEN '</span><span class="token keyword">mediumtext</span><span class="token string">' THEN        '</span>String <span class="token string">'    WHEN '</span><span class="token keyword">enum</span><span class="token string">' THEN        '</span>String <span class="token string">'    WHEN '</span><span class="token keyword">blob</span><span class="token string">' THEN        '</span>Byte<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token string">'    WHEN '</span><span class="token keyword">set</span><span class="token string">' THEN        '</span>String <span class="token string">'    WHEN '</span>time<span class="token string">' THEN        '</span>Time <span class="token string">'    WHEN '</span><span class="token keyword">smallint</span><span class="token string">' THEN        '</span><span class="token keyword">Integer</span> <span class="token string">'    WHEN '</span><span class="token keyword">tinytext</span><span class="token string">' THEN        '</span>String <span class="token string">'    WHEN '</span><span class="token keyword">binary</span><span class="token string">' THEN        '</span>Byte<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token string">'    WHEN '</span><span class="token keyword">bit</span><span class="token string">' THEN        '</span><span class="token keyword">Boolean</span> <span class="token string">'    END,    column_name,    '</span><span class="token punctuation">;</span><span class="token string">'    )FROM    information_schema.`COLUMNS`WHERE    TABLE_SCHEMA = '</span>life_health<span class="token string">'AND TABLE_NAME = '</span>health_exp'<span class="token punctuation">;</span> </code></pre><h2 id="è¡¨æ“ä½œ"><a href="#è¡¨æ“ä½œ" class="headerlink" title="è¡¨æ“ä½œ"></a>è¡¨æ“ä½œ</h2><h3 id="å¢åŠ ä¸ä¿®æ”¹åˆ—"><a href="#å¢åŠ ä¸ä¿®æ”¹åˆ—" class="headerlink" title="å¢åŠ ä¸ä¿®æ”¹åˆ—"></a>å¢åŠ ä¸ä¿®æ”¹åˆ—</h3><pre class=" language-sql"><code class="language-sql"><span class="token keyword">Alter</span> <span class="token keyword">table</span> è¡¨å <span class="token keyword">add</span> åˆ—åç§° åˆ—ç±»å‹ åˆ—å‚æ•°<span class="token punctuation">;</span> <span class="token punctuation">[</span>åŠ çš„åˆ—åœ¨è¡¨çš„æœ€å<span class="token punctuation">]</span>ä¾‹: <span class="token keyword">alter</span> <span class="token keyword">table</span> m1 <span class="token keyword">add</span> birth <span class="token keyword">date</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">'0000-00-00'</span><span class="token punctuation">;</span><span class="token keyword">Alter</span> <span class="token keyword">table</span> è¡¨å <span class="token keyword">add</span> åˆ—åç§° åˆ—ç±»å‹ åˆ—å‚æ•° <span class="token keyword">after</span> æŸåˆ—<span class="token punctuation">;</span> <span class="token punctuation">[</span>æŠŠæ–°åˆ—åŠ åœ¨æŸåˆ—å<span class="token punctuation">]</span>ä¾‹: <span class="token keyword">alter</span> <span class="token keyword">table</span> m1 <span class="token keyword">add</span> gender char<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">''</span> <span class="token keyword">after</span> username<span class="token punctuation">;</span><span class="token keyword">Alter</span> <span class="token keyword">table</span> è¡¨å <span class="token keyword">add</span> åˆ—åç§° åˆ—ç±»å‹ åˆ—å‚æ•° <span class="token keyword">first</span><span class="token punctuation">;</span> <span class="token punctuation">[</span>æŠŠæ–°åˆ—åŠ åœ¨æœ€å‰é¢<span class="token punctuation">]</span>ä¾‹: <span class="token keyword">alter</span> <span class="token keyword">table</span> m1 <span class="token keyword">add</span> pid <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span> <span class="token keyword">first</span><span class="token punctuation">;</span></code></pre><h3 id="åˆ é™¤åˆ—"><a href="#åˆ é™¤åˆ—" class="headerlink" title="åˆ é™¤åˆ—"></a>åˆ é™¤åˆ—</h3><pre class=" language-sql"><code class="language-sql"><span class="token keyword">Alter</span> <span class="token keyword">table</span> è¡¨å <span class="token keyword">drop</span> åˆ—å<span class="token punctuation">;</span></code></pre><h3 id="ä¿®æ”¹åˆ—ç±»å‹"><a href="#ä¿®æ”¹åˆ—ç±»å‹" class="headerlink" title="ä¿®æ”¹åˆ—ç±»å‹"></a>ä¿®æ”¹åˆ—ç±»å‹</h3><pre class=" language-sql"><code class="language-sql"><span class="token keyword">Alter</span> <span class="token keyword">table</span> è¡¨å <span class="token keyword">modify</span> åˆ—å æ–°ç±»å‹ æ–°å‚æ•°<span class="token punctuation">;</span> <span class="token punctuation">(</span>ä¸èƒ½ä¿®æ”¹åˆ—å<span class="token punctuation">)</span><span class="token punctuation">;</span>ä¾‹:<span class="token keyword">alter</span> <span class="token keyword">table</span> m1 <span class="token keyword">modify</span> gender char<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">;</span></code></pre><h3 id="ä¿®æ”¹åˆ—ååŠåˆ—ç±»å‹"><a href="#ä¿®æ”¹åˆ—ååŠåˆ—ç±»å‹" class="headerlink" title="ä¿®æ”¹åˆ—ååŠåˆ—ç±»å‹"></a>ä¿®æ”¹åˆ—ååŠåˆ—ç±»å‹</h3><pre class=" language-sql"><code class="language-sql"><span class="token keyword">Alter</span> <span class="token keyword">table</span> è¡¨å change æ—§åˆ—å æ–°åˆ—å æ–°ç±»å‹ æ–°å‚æ•°<span class="token punctuation">;</span>ä¾‹:<span class="token keyword">alter</span> <span class="token keyword">table</span> m1 change id uid <span class="token keyword">int</span> unsigned<span class="token punctuation">;</span></code></pre><h3 id="æ”¹è¡¨å"><a href="#æ”¹è¡¨å" class="headerlink" title="æ”¹è¡¨å"></a>æ”¹è¡¨å</h3><pre class=" language-sql"><code class="language-sql"><span class="token keyword">rename</span> <span class="token keyword">table</span> regist3 <span class="token keyword">to</span> reg3<span class="token punctuation">;</span></code></pre><h3 id="åˆ é™¤è¡¨"><a href="#åˆ é™¤è¡¨" class="headerlink" title="åˆ é™¤è¡¨"></a>åˆ é™¤è¡¨</h3><pre class=" language-sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>dictionary<span class="token punctuation">`</span><span class="token punctuation">;</span></code></pre><h3 id="å¸¸ç”¨æŸ¥è¯¢"><a href="#å¸¸ç”¨æŸ¥è¯¢" class="headerlink" title="å¸¸ç”¨æŸ¥è¯¢"></a>å¸¸ç”¨æŸ¥è¯¢</h3><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> sensitive_word_condition <span class="token number">a</span> <span class="token keyword">WHERE</span> <span class="token number">a</span><span class="token punctuation">.</span>count <span class="token operator">&lt;</span> <span class="token number">11</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">a</span><span class="token punctuation">.</span>count <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span></code></pre><h1 id="MySQL-5-7æŸ¥è¯¢ä¸€æ®µæ—¶é—´å†…æœ€åä¸€æ¡æ•°æ®"><a href="#MySQL-5-7æŸ¥è¯¢ä¸€æ®µæ—¶é—´å†…æœ€åä¸€æ¡æ•°æ®" class="headerlink" title="MySQL 5.7æŸ¥è¯¢ä¸€æ®µæ—¶é—´å†…æœ€åä¸€æ¡æ•°æ®"></a>MySQL 5.7æŸ¥è¯¢ä¸€æ®µæ—¶é—´å†…æœ€åä¸€æ¡æ•°æ®</h1><p>mysql å‡çº§åˆ°5.7ä¹‹åï¼Œå­˜å‚¨å¼•æ“åšäº†ä¸€äº›ä¼˜åŒ–ï¼Œä¹‹å‰æˆ‘ä»¬ä½¿ç”¨çš„ å…ˆorder by å† group by çš„æ–¹å¼å–æœ€åä¸€æ¡æ•°æ®çš„æŸ¥è¯¢ï¼Œä¼šå‡ºç°å–çš„ä¸æ˜¯æœ€åä¸€æ¡è®°å½•çš„é—®é¢˜</p><p>ä¸ºäº†å®ç°åŸæœ‰æŸ¥è¯¢é€»è¾‘ï¼Œè¯·åœ¨å­æŸ¥è¯¢åé¢ï¼ŒåŠ ä¸Šlimit 9223372036854775807<br>å…¶ä¸­ï¼Œ9223372036854775807ä¸ºbigintçš„æœ€å¤§å€¼</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span>    <span class="token operator">*</span><span class="token keyword">FROM</span>    <span class="token punctuation">(</span>        <span class="token keyword">SELECT</span>            <span class="token number">e</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>            DATE_FORMAT<span class="token punctuation">(</span><span class="token punctuation">`</span>update_date<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> edt        <span class="token keyword">FROM</span>            health_exp <span class="token number">e</span>        <span class="token keyword">WHERE</span>            update_date <span class="token operator">BETWEEN</span> <span class="token string">'2018-02-01'</span>        <span class="token operator">AND</span> <span class="token string">'2018-02-06 23:23:59'</span>        <span class="token operator">AND</span> user_id <span class="token operator">=</span> <span class="token string">'2baef230bad144e89296c2c51fa2b680'</span>        <span class="token keyword">ORDER</span> <span class="token keyword">BY</span>            update_date <span class="token keyword">DESC</span>        <span class="token keyword">LIMIT</span> <span class="token number">9223372036854775807</span>    <span class="token punctuation">)</span> t<span class="token keyword">GROUP</span> <span class="token keyword">BY</span>    t<span class="token punctuation">.</span>edt<span class="token punctuation">;</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vertica åˆ†æå‡½æ•°</title>
      <link href="2019/03/14/vertica-03/"/>
      <url>2019/03/14/vertica-03/</url>
      
        <content type="html"><![CDATA[<p>åˆ†æå‡½æ•°ä½œä¸º SQL è¨€è¯­çš„ä¸€ç§æ‰©å±•å·²ç»è¢«çº³å…¥äº†ç¾å›½å›½å®¶æ ‡å‡†åŒ–ç»„ç»‡SQL å§”å‘˜ä¼šçš„SQL è§„èŒƒè¯´æ˜ä¹¦ä¸­ã€‚æ‰€ä»¥ä¸åŒæ•°æ®åº“å‚å•†æ”¯æŒçš„åˆ†æå‡½æ•°å…¶è¯­æ³•ç»“æ„å’Œå‡½æ•°åç§°ä¹ŸåŸºæœ¬ä¸€è‡´ã€‚è¿™é‡Œä»…ä»‹ç»Verticaçš„çš„åˆ†æå‡½æ•°è¯­æ³•å’Œå‡½æ•°ä½œç”¨ï¼Œåº”ç”¨å‡½æ•°ç›¸å…³ä¾‹å­ç•¥ã€‚</p><h1 id="åˆ†æå‡½æ•°è¯­æ³•"><a href="#åˆ†æå‡½æ•°è¯­æ³•" class="headerlink" title="åˆ†æå‡½æ•°è¯­æ³•"></a>åˆ†æå‡½æ•°è¯­æ³•</h1><pre class=" language-sql"><code class="language-sql">ANALYTIC_FUNCTIONï¼ˆargument<span class="token number">-1</span>ï¼Œ<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>ï¼Œargument<span class="token operator">-</span>nï¼‰<span class="token keyword">OVER</span>ï¼ˆ<span class="token punctuation">[</span>window_partition_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>window_order_clause<span class="token punctuation">]</span> <span class="token punctuation">[</span>window_frame_clauseï¼‰</code></pre><h2 id="å¸¸è§å‡½æ•°ç”¨é€”å’Œæè¿°"><a href="#å¸¸è§å‡½æ•°ç”¨é€”å’Œæè¿°" class="headerlink" title="å¸¸è§å‡½æ•°ç”¨é€”å’Œæè¿°"></a>å¸¸è§å‡½æ•°ç”¨é€”å’Œæè¿°</h2><table><thead><tr><th>å’Œ</th><th>è¯¥å‡½æ•°è®¡ç®—ç»„ä¸­è¡¨è¾¾å¼çš„ç´¯ç§¯å’Œ</th></tr></thead><tbody><tr><td>MIN</td><td>åœ¨ä¸€ä¸ªç»„ä¸­çš„æ•°æ®çª—å£ä¸­æŸ¥æ‰¾è¡¨è¾¾å¼çš„æœ€å°å€¼</td></tr><tr><td>MAX</td><td>åœ¨ä¸€ä¸ªç»„ä¸­çš„æ•°æ®çª—å£ä¸­æŸ¥æ‰¾è¡¨è¾¾å¼çš„æœ€å¤§å€¼</td></tr><tr><td>AVG</td><td>ç”¨äºè®¡ç®—ä¸€ä¸ªç»„å’Œæ•°æ®çª—å£å†…è¡¨è¾¾å¼çš„å¹³å‡å€¼ã€‚</td></tr><tr><td>è®¡æ•°</td><td>å¯¹ä¸€ç»„å†…å‘ç”Ÿçš„äº‹æƒ…è¿›è¡Œç´¯ç§¯è®¡æ•°</td></tr><tr><td>ç§©</td><td>æ ¹æ®ORDER BYå­å¥ä¸­è¡¨è¾¾å¼çš„å€¼ï¼Œä»æŸ¥è¯¢è¿”å›çš„æ¯ä¸€è¡Œï¼Œè®¡ç®—å®ƒä»¬ä¸å…¶å®ƒè¡Œçš„ç›¸å¯¹ä½ç½®</td></tr><tr><td>DENSE_RANK</td><td>æ ¹æ®ORDER BYå­å¥ä¸­è¡¨è¾¾å¼çš„å€¼ï¼Œä»æŸ¥è¯¢è¿”å›çš„æ¯ä¸€è¡Œï¼Œè®¡ç®—å®ƒä»¬ä¸å…¶å®ƒè¡Œçš„ç›¸å¯¹ä½ç½®</td></tr><tr><td>FIRST_VALUE</td><td>è¿”å›ç»„<a href="https://www.baidu.com/s?wd=%E4%B8%AD%E6%95%B0%E6%8D%AE&amp;tn=24004469_oem_dg&amp;rsv_dl=gh_pl_sl_csd">ä¸­æ•°æ®</a>çª—å£çš„ç¬¬ä¸€ä¸ªå€¼</td></tr><tr><td>LAST_VALUE</td><td>è¿”å›ç»„ä¸­æ•°æ®çª—å£çš„æœ€åä¸€ä¸ªå€¼ã€‚</td></tr><tr><td>è½å</td><td>å¯ä»¥è®¿é—®ç»“æœé›†ä¸­çš„å…¶å®ƒè¡Œè€Œä¸ç”¨è¿›è¡Œè‡ªè¿æ¥</td></tr><tr><td>é“…</td><td>LEADä¸LAGç›¸åï¼ŒLEADå¯ä»¥è®¿é—®ç»„ä¸­å½“å‰è¡Œä¹‹åçš„è¡Œ</td></tr><tr><td>ROW_NUMBER</td><td>è¿”å›æœ‰åºç»„ä¸­ä¸€è¡Œçš„åç§»é‡ï¼Œä»è€Œå¯ç”¨äºæŒ‰ç‰¹å®šæ ‡å‡†æ’åºçš„è¡Œå·</td></tr><tr><td>STDDEV</td><td>è®¡ç®—å½“å‰è¡Œå…³äºç»„çš„æ ‡å‡†åç¦»</td></tr><tr><td>STDDEV_POP</td><td>è¯¥å‡½æ•°è®¡ç®—æ€»ä½“æ ‡å‡†åç¦»ï¼Œå¹¶è¿”å›æ€»ä½“å˜é‡çš„å¹³æ–¹æ ¹</td></tr><tr><td>STDDEV_SAMP</td><td>è¯¥å‡½æ•°è®¡ç®—ç´¯ç§¯æ ·æœ¬æ ‡å‡†åç¦»ï¼Œå¹¶è¿”å›æ€»ä½“å˜é‡çš„å¹³æ–¹æ ¹</td></tr><tr><td>VAR_POP</td><td>è¯¥å‡½æ•°è¿”å›éç©ºé›†åˆçš„æ€»ä½“å˜é‡ï¼ˆå¿½ç•¥nullï¼‰</td></tr><tr><td>VAR_SAMP</td><td>è¯¥å‡½æ•°è¿”å›éç©ºé›†åˆçš„æ ·æœ¬å˜é‡ï¼ˆå¿½ç•¥nullï¼‰</td></tr><tr><td>æ–¹å·®</td><td>å¦‚æœè¡¨è¾¾å¼<a href="https://www.baidu.com/s?wd=%E4%B8%AD%E8%A1%8C&amp;tn=24004469_oem_dg&amp;rsv_dl=gh_pl_sl_csd">ä¸­è¡Œ</a>æ•°ä¸º1ï¼Œåˆ™è¿”å›0ï¼Œå¦‚æœè¡¨è¾¾å¼ä¸­è¡Œæ•°å¤§äº1ï¼Œåˆ™è¿”å›VAR_SAMP</td></tr><tr><td>CUME_DIST</td><td>è®¡ç®—ä¸€è¡Œåœ¨ç»„ä¸­çš„ç›¸å¯¹ä½ç½®</td></tr><tr><td>NTILE</td><td>å°†ä¸€ä¸ªç»„åˆ†ä¸ºâ€œè¡¨è¾¾å¼â€çš„æ•£åˆ—è¡¨ç¤º</td></tr><tr><td>PERCENT_RANK</td><td>å’ŒCUME_DISTï¼ˆç´¯ç§¯åˆ†é…ï¼‰å‡½æ•°ç±»ä¼¼</td></tr><tr><td>PERCENTILE_DISC</td><td>è¿”å›ä¸€ä¸ªä¸è¾“å…¥çš„åˆ†å¸ƒç™¾åˆ†æ¯”å€¼ç›¸å¯¹åº”çš„æ•°æ®å€¼</td></tr><tr><td>PERCENTILE_CONT</td><td>è¿”å›ä¸€ä¸ªä¸è¾“å…¥çš„åˆ†å¸ƒç™¾åˆ†æ¯”å€¼ç›¸å¯¹åº”çš„æ•°æ®å€¼</td></tr><tr><td>MEDIAN</td><td>åœ¨ä¸€ä¸ªç»„ä¸­çš„æ•°æ®çª—å£ä¸­æŸ¥æ‰¾æœ€å°å€¼ä¸æœ€å¤§å€¼çš„å¹³å‡å€¼</td></tr></tbody></table><h1 id="å‚æ•°-1ï¼Œâ€¦ï¼Œå‚æ•°-n"><a href="#å‚æ•°-1ï¼Œâ€¦ï¼Œå‚æ•°-n" class="headerlink" title="å‚æ•°-1ï¼Œâ€¦ï¼Œå‚æ•°-n"></a>å‚æ•°-1ï¼Œâ€¦ï¼Œå‚æ•°-n</h1><p>åˆ†æå‡½æ•°çš„å‚æ•°</p><h1 id="window-partition-clause"><a href="#window-partition-clause" class="headerlink" title="window_partition_clause"></a>window_partition_clause</h1><p>æ ¹æ®åˆ’åˆ†è¡¨è¾¾å¼è®¾ç½®çš„è§„åˆ™ï¼Œ PARTITION BY ï¼ˆæŒ‰â€¦ åˆ’åˆ†ï¼‰å°†ä¸€ä¸ªç»“æœé€»è¾‘åˆ†æˆÃ‘ ä¸ªåˆ†ç»„åˆ’åˆ†è¡¨è¾¾å¼ã€‚åœ¨æ­¤â€œ åˆ’åˆ†â€ å’Œâ€œ åˆ†ç»„â€ ç”¨ä½œåŒä¹‰è¯ã€‚åˆ†æå‡½æ•°ç‹¬ç«‹åº”ç”¨äºå„ä¸ªåˆ†ç»„ï¼Œå¹¶åœ¨åº”ç”¨æ—¶é‡ç½®ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">OVER</span>ï¼ˆ<span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> expression <span class="token punctuation">[</span>ï¼Œ<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>ï¼‰</code></pre><h1 id="window-order-clause"><a href="#window-order-clause" class="headerlink" title="window_order_clause"></a>window_order_clause</h1><p>ORDER BY ï¼ˆæŒ‰â€¦ æ’åºï¼‰è¯­å¥è§„å®šäº†æ¯ä¸ªåˆ†ç»„ï¼ˆåˆ’åˆ†ï¼‰çš„æ•°æ®å¦‚ä½•æ’åºã€‚è¿™äº›å¿…ç„¶å½±å“åˆ†æå‡½æ•°çš„ç»“æœã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">OVER</span>ï¼ˆ<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> expression <span class="token punctuation">[</span>{<span class="token keyword">ASC</span> <span class="token operator">|</span> <span class="token keyword">DESC</span>}<span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span>NULLS {<span class="token keyword">FIRST</span> <span class="token operator">|</span> <span class="token keyword">LAST</span> <span class="token operator">|</span> AUTO}<span class="token punctuation">]</span> <span class="token punctuation">[</span>ï¼Œexpression <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>ï¼‰</code></pre><h1 id="window-frame-clause"><a href="#window-frame-clause" class="headerlink" title="window_frame_clause"></a>window_frame_clause</h1><p>çª—å£ç”Ÿæˆè¯­å¥ç”¨ä»¥å®šä¹‰æ»‘åŠ¨æˆ–å›ºå®šæ•°æ®çª—å£ï¼Œåˆ†æå‡½æ•°åœ¨åˆ†ç»„å†…è¿›è¡Œåˆ†æã€‚è¯¥è¯­å¥èƒ½å¤Ÿå¯¹åˆ†ç»„ä¸­ä»»æ„å®šä¹‰çš„æ»‘åŠ¨æˆ–å›ºå®šçª—å£è¿›è¡Œè®¡ç®—ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Vertica </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vertica </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vertica åŸºæœ¬æ“ä½œè¯­å¥</title>
      <link href="2019/03/14/vertica-02/"/>
      <url>2019/03/14/vertica-02/</url>
      
        <content type="html"><![CDATA[<h1 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h1><p>åŸºäºåˆ—å­˜å‚¨çš„æ•°æ®åº“ï¼Œç›¸å¯¹äºä¼ ç»Ÿçš„åŸºäºè¡Œçš„æ•°æ®åº“ï¼Œå®ƒæ›´é€‚åˆåœ¨æ•°æ®ä»“åº“å­˜å‚¨æ–¹é¢å‘æŒ¥ç‰¹é•¿ã€‚åŸºäºåˆ—å­˜å‚¨çš„æ•°æ®åº“çš„ä¼˜ç‚¹ï¼š</p><ul><li>å¯¹äºèšé›†æ“ä½œï¼Œæ¯”å¦‚æ±‚sumï¼Œæ˜æ˜¾åŸºäºåˆ—å­˜å‚¨çš„è¦æ¯”åŸºäºè¡Œå­˜å‚¨çš„å¿«ï¼›</li><li>å¯¹äºupdateæ“ä½œï¼Œä¸é¡»æ¥è§¦å…¶ä»–åˆ—å€¼ï¼›</li><li>åŸºäºè¡Œå­˜å‚¨çš„æ•°æ®åº“åœ¨æŸ¥è¯¢æ¯è¡Œè®°å½•çš„å¤šä¸ªåˆ—å€¼æ›´é«˜æ•ˆçš„æ¡ä»¶æ˜¯ï¼Œrow-sizeæ¯”è¾ƒå°ï¼Œè¿™æ ·ä¸€æ¬¡ç£ç›˜è¯»å–å°±å¯ä»¥è·å–æ•´è¡Œï¼›</li><li>åŸºäºè¡Œå­˜å‚¨çš„æ•°æ®åº“åœ¨insertä¸€è¡Œçš„æ—¶å€™ç›¸å¯¹æ›´é«˜æ•ˆï¼Œæ¯•ç«Ÿå¯ä¸€æ¬¡å†™å…¥ä¸€ä¸ªè¿ç»­ç©ºé—´ï¼Œå³ä¸€æ¬¡single disk seekã€‚</li></ul><p>ä»å®é™…æƒ…å†µä¸Šæ¥çœ‹ï¼ŒåŸºäºè¡Œå­˜å‚¨çš„æ•°æ®åº“æ›´é€‚åˆOLTPï¼ˆè”æœºäº‹åŠ¡å¤„ç†ç³»ç»Ÿï¼‰ï¼ŒåŸºäºåˆ—å­˜å‚¨çš„æ•°æ®åº“æ›´é€‚åˆOLAPï¼ˆè”æœºåˆ†æå¤„ç†ç³»ç»Ÿï¼‰ï¼Œæ¯”å¦‚æ•°æ®ä»“åº“ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒåŒä¸€åˆ—å¿…å®šæ˜¯åŒä¸€ç±»å‹å¤§å°ï¼ŒåŸºäºåˆ—å­˜å‚¨çš„æ•°æ®åº“æ›´å®¹æ˜“ä½¿ç”¨é«˜æ•ˆçš„å­˜å‚¨æ–¹å¼ï¼Œä¸ä¹‹ç›¸å¯¹ï¼ŒåŸºäºè¡Œå­˜å‚¨çš„æ•°æ®åº“åˆ™åªèƒ½é‡‡ç”¨éšæœºæ–¹å¼å¤„ç†åˆ—å€¼äº†ã€‚</p><p>Verticaæ•°æ®åº“çš„è®¾è®¡ç‰¹ç‚¹æ˜¯ï¼š</p><ul><li>å®ƒæ˜¯åŸºäºåˆ—çš„å­˜å‚¨ç»“æ„ï¼Œæé«˜äº†è¿ç»­çš„recordå¤„ç†çš„æ€§èƒ½ï¼Œä½†æ˜¯åœ¨ä¸€èˆ¬äº‹åŠ¡ä¸­å¢åŠ äº†å¯¹å•ç‹¬recordè¿›è¡Œupdateå’Œdeleteçš„å¼€é”€ï¼›</li><li>â€œå•ç‹¬â€æ›´æ–°ï¼ˆout-of-place updatesï¼‰å’Œæ··åˆå­˜å‚¨ç»“æ„ï¼Œæé«˜äº†æŸ¥è¯¢ã€æ’å…¥çš„æ€§èƒ½ï¼Œä½†å¢åŠ äº†updateå’Œdeleteçš„å¼€é”€ï¼›</li><li>å‹ç¼©ï¼Œå‡å°‘å­˜å‚¨å¼€é”€å’ŒIOå¸¦å®½å¼€é”€ï¼›</li><li>å®Œå…¨æ— å…±äº«æ¶æ„ï¼Œé™ä½å¯¹å…±äº«èµ„æºçš„ç³»ç»Ÿç«äº‰ã€‚</li></ul><p>Verticaæ•°æ®åº“è¿è¡Œåœ¨åŸºäºLinuxçš„ç½‘æ ¼æœåŠ¡å™¨ä¸Šï¼Œç›®å‰åº”ç”¨äºAmazon Elastic Compute Cloudçš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€‚</p><h1 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h1><h2 id="è¿›å…¥-vsql-ç¯å¢ƒ"><a href="#è¿›å…¥-vsql-ç¯å¢ƒ" class="headerlink" title="è¿›å…¥ vsql ç¯å¢ƒ"></a>è¿›å…¥ vsql ç¯å¢ƒ</h2><pre class=" language-shell"><code class="language-shell">vsql -U dbadmin -w 123456</code></pre><h2 id="æŸ¥çœ‹å¸®åŠ©"><a href="#æŸ¥çœ‹å¸®åŠ©" class="headerlink" title="æŸ¥çœ‹å¸®åŠ©"></a>æŸ¥çœ‹å¸®åŠ©</h2><pre class=" language-shell"><code class="language-shell">dbadmin=> \h</code></pre><h2 id="åˆ‡æ¢verticaç”¨æˆ·ï¼Œç”¨äºåˆ›å»ºdatabase"><a href="#åˆ‡æ¢verticaç”¨æˆ·ï¼Œç”¨äºåˆ›å»ºdatabase" class="headerlink" title="åˆ‡æ¢verticaç”¨æˆ·ï¼Œç”¨äºåˆ›å»ºdatabase"></a>åˆ‡æ¢verticaç”¨æˆ·ï¼Œç”¨äºåˆ›å»ºdatabase</h2><pre class=" language-shell"><code class="language-shell"># åˆ‡æ¢ç”¨æˆ·su - dbadmin# è¿›å…¥verticaç®¡ç†å·¥å…·/opt/vertica/bin/admintools</code></pre><p><a href="https://www.vertica.com/docs/9.2.x/HTML/Content/Authoring/AdministratorsGuide/AdminTools/CreatingADatabase.htm">åˆ›å»ºæ•°æ®åº“</a></p><h1 id="ç”¨æˆ·ä¸schemaæŸ¥è¯¢"><a href="#ç”¨æˆ·ä¸schemaæŸ¥è¯¢" class="headerlink" title="ç”¨æˆ·ä¸schemaæŸ¥è¯¢"></a>ç”¨æˆ·ä¸schemaæŸ¥è¯¢</h1><h2 id="æŸ¥è¯¢ç”¨æˆ·"><a href="#æŸ¥è¯¢ç”¨æˆ·" class="headerlink" title="æŸ¥è¯¢ç”¨æˆ·"></a>æŸ¥è¯¢ç”¨æˆ·</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> v_catalog<span class="token punctuation">.</span>users<span class="token punctuation">;</span></code></pre><h2 id="æŸ¥è¯¢schema"><a href="#æŸ¥è¯¢schema" class="headerlink" title="æŸ¥è¯¢schema"></a>æŸ¥è¯¢schema</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> schemata<span class="token punctuation">;</span></code></pre><h2 id="æŸä¸ªschemaå¿…é¡»é™„å±äºæŸä¸ªç”¨æˆ·ï¼ˆuserï¼‰ï¼ŒæŸ¥è¯¢ç”¨æˆ·å’Œschemaä¿¡æ¯"><a href="#æŸä¸ªschemaå¿…é¡»é™„å±äºæŸä¸ªç”¨æˆ·ï¼ˆuserï¼‰ï¼ŒæŸ¥è¯¢ç”¨æˆ·å’Œschemaä¿¡æ¯" class="headerlink" title="æŸä¸ªschemaå¿…é¡»é™„å±äºæŸä¸ªç”¨æˆ·ï¼ˆuserï¼‰ï¼ŒæŸ¥è¯¢ç”¨æˆ·å’Œschemaä¿¡æ¯"></a>æŸä¸ªschemaå¿…é¡»é™„å±äºæŸä¸ªç”¨æˆ·ï¼ˆuserï¼‰ï¼ŒæŸ¥è¯¢ç”¨æˆ·å’Œschemaä¿¡æ¯</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> u<span class="token punctuation">.</span>user_name<span class="token punctuation">,</span> s<span class="token punctuation">.</span>schema_name<span class="token keyword">FROM</span> users u <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> schemata s <span class="token keyword">ON</span> u<span class="token punctuation">.</span>user_name <span class="token operator">=</span> s<span class="token punctuation">.</span>schema_owner<span class="token punctuation">;</span></code></pre><h1 id="åˆ›å»ºç”¨æˆ·å’Œschema"><a href="#åˆ›å»ºç”¨æˆ·å’Œschema" class="headerlink" title="åˆ›å»ºç”¨æˆ·å’Œschema"></a>åˆ›å»ºç”¨æˆ·å’Œschema</h1><h2 id="åˆ›å»ºä¸€ä¸ªç”¨æˆ·"><a href="#åˆ›å»ºä¸€ä¸ªç”¨æˆ·" class="headerlink" title="åˆ›å»ºä¸€ä¸ªç”¨æˆ·"></a>åˆ›å»ºä¸€ä¸ªç”¨æˆ·</h2><pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true"># username:dev_test password:test</span><span class="token keyword">create</span> <span class="token keyword">user</span> dev_test identified <span class="token keyword">by</span> <span class="token string">'test'</span><span class="token punctuation">;</span></code></pre><h2 id="åŸºäºæŸä¸ªç”¨æˆ·åˆ›å»ºschema"><a href="#åŸºäºæŸä¸ªç”¨æˆ·åˆ›å»ºschema" class="headerlink" title="åŸºäºæŸä¸ªç”¨æˆ·åˆ›å»ºschema"></a>åŸºäºæŸä¸ªç”¨æˆ·åˆ›å»ºschema</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">schema</span> <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exists</span> test <span class="token keyword">authorization</span> dev_test<span class="token punctuation">;</span></code></pre><h2 id="é‡å‘½å-å¤‡ä»½"><a href="#é‡å‘½å-å¤‡ä»½" class="headerlink" title="é‡å‘½å(å¤‡ä»½)"></a>é‡å‘½å(å¤‡ä»½)</h2><p>datanameæ•°æ®åº“ä¸º dataname_bak</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">schema</span> dataname <span class="token keyword">rename</span> <span class="token keyword">to</span> dataname_bak<span class="token punctuation">;</span></code></pre><h2 id="åˆ é™¤-schema-dataname"><a href="#åˆ é™¤-schema-dataname" class="headerlink" title="åˆ é™¤ schema(dataname)"></a>åˆ é™¤ schema(dataname)</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">schema</span> dataname <span class="token keyword">cascade</span><span class="token punctuation">;</span>    </code></pre><h2 id="åˆ›å»ºè¡¨"><a href="#åˆ›å»ºè¡¨" class="headerlink" title="åˆ›å»ºè¡¨"></a>åˆ›å»ºè¡¨</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test<span class="token punctuation">.</span><span class="token string">"user"</span> <span class="token punctuation">(</span>    id <span class="token keyword">Integer</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    name <span class="token keyword">Varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    description <span class="token keyword">Varchar</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h1 id="èµ‹æƒ"><a href="#èµ‹æƒ" class="headerlink" title="èµ‹æƒ"></a>èµ‹æƒ</h1><h2 id="ä¸€ä¸ªschemaä¸Šçš„æƒé™èµ‹ç»™å¦ä¸€ä¸ªç”¨æˆ·"><a href="#ä¸€ä¸ªschemaä¸Šçš„æƒé™èµ‹ç»™å¦ä¸€ä¸ªç”¨æˆ·" class="headerlink" title="ä¸€ä¸ªschemaä¸Šçš„æƒé™èµ‹ç»™å¦ä¸€ä¸ªç”¨æˆ·"></a>ä¸€ä¸ªschemaä¸Šçš„æƒé™èµ‹ç»™å¦ä¸€ä¸ªç”¨æˆ·</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">USAGE</span> <span class="token keyword">ON</span> <span class="token keyword">SCHEMA</span> dbname_dw <span class="token keyword">TO</span> dev_test<span class="token punctuation">;</span></code></pre><h2 id="æŠŠå¯¹æŸä¸ªè¡¨çš„æ“ä½œçš„æƒé™èµ‹ç»™å¦ä¸€ä¸ªç”¨æˆ·"><a href="#æŠŠå¯¹æŸä¸ªè¡¨çš„æ“ä½œçš„æƒé™èµ‹ç»™å¦ä¸€ä¸ªç”¨æˆ·" class="headerlink" title="æŠŠå¯¹æŸä¸ªè¡¨çš„æ“ä½œçš„æƒé™èµ‹ç»™å¦ä¸€ä¸ªç”¨æˆ·"></a>æŠŠå¯¹æŸä¸ªè¡¨çš„æ“ä½œçš„æƒé™èµ‹ç»™å¦ä¸€ä¸ªç”¨æˆ·</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">ON</span> <span class="token keyword">TABLE</span> tw_re_pm_cell_all_cell_h <span class="token keyword">to</span> dev_test<span class="token punctuation">;</span></code></pre><h2 id="ä»æŸä¸ªç”¨æˆ·æ”¶å›å¯¹æŸä¸ªschemaçš„ä½¿ç”¨æƒé™"><a href="#ä»æŸä¸ªç”¨æˆ·æ”¶å›å¯¹æŸä¸ªschemaçš„ä½¿ç”¨æƒé™" class="headerlink" title="ä»æŸä¸ªç”¨æˆ·æ”¶å›å¯¹æŸä¸ªschemaçš„ä½¿ç”¨æƒé™"></a>ä»æŸä¸ªç”¨æˆ·æ”¶å›å¯¹æŸä¸ªschemaçš„ä½¿ç”¨æƒé™</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">revoke</span> <span class="token keyword">all</span> <span class="token keyword">on</span> <span class="token keyword">SCHEMA</span> dbname_dw <span class="token keyword">from</span> dev_test<span class="token punctuation">;</span></code></pre><h2 id="ä»æŸä¸ªç”¨æˆ·æ”¶å›å¯¹æŸä¸ªè¡¨çš„ä½¿ç”¨æƒé™"><a href="#ä»æŸä¸ªç”¨æˆ·æ”¶å›å¯¹æŸä¸ªè¡¨çš„ä½¿ç”¨æƒé™" class="headerlink" title="ä»æŸä¸ªç”¨æˆ·æ”¶å›å¯¹æŸä¸ªè¡¨çš„ä½¿ç”¨æƒé™"></a>ä»æŸä¸ªç”¨æˆ·æ”¶å›å¯¹æŸä¸ªè¡¨çš„ä½¿ç”¨æƒé™</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">revoke</span> <span class="token keyword">all</span> <span class="token keyword">on</span> <span class="token keyword">table</span> fct_flux_se_flux_flow_whole_ana_d <span class="token keyword">from</span> dev_test<span class="token punctuation">;</span></code></pre><h1 id="åºåˆ—"><a href="#åºåˆ—" class="headerlink" title="åºåˆ—"></a>åºåˆ—</h1><h2 id="æŸ¥è¯¢ç³»ç»Ÿä¸­çš„åºåˆ—"><a href="#æŸ¥è¯¢ç³»ç»Ÿä¸­çš„åºåˆ—" class="headerlink" title="æŸ¥è¯¢ç³»ç»Ÿä¸­çš„åºåˆ—"></a>æŸ¥è¯¢ç³»ç»Ÿä¸­çš„åºåˆ—</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sequences<span class="token punctuation">;</span></code></pre><h2 id="åˆ›å»ºåºåˆ—"><a href="#åˆ›å»ºåºåˆ—" class="headerlink" title="åˆ›å»ºåºåˆ—"></a>åˆ›å»ºåºåˆ—</h2><pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true"># ç®€å•è¯­æ³•ï¼š</span><span class="token keyword">CREATE</span> SEQUENCE my_seq MAXVALUE <span class="token number">5000</span> <span class="token keyword">START</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"># æ ‡å‡†è¯­æ³•ï¼š</span><span class="token keyword">CREATE</span> SEQUENCE <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">db</span><span class="token operator">-</span>name<span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token keyword">schema</span><span class="token punctuation">.</span><span class="token punctuation">]</span>sequence_name                    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span> INCREMENT <span class="token punctuation">[</span> <span class="token keyword">BY</span> <span class="token punctuation">]</span> positive_or_negative <span class="token punctuation">]</span>                    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span> MINVALUE minvalue <span class="token operator">|</span> <span class="token keyword">NO</span> MINVALUE <span class="token punctuation">]</span>                    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span> MAXVALUE maxvalue <span class="token operator">|</span> <span class="token keyword">NO</span> MAXVALUE <span class="token punctuation">]</span>                    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span> <span class="token keyword">START</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token punctuation">]</span> <span class="token keyword">start</span> <span class="token punctuation">]</span>                    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span> CACHE cache <span class="token punctuation">]</span>                    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span> CYCLE <span class="token operator">|</span> <span class="token keyword">NO</span> CYCLE <span class="token punctuation">]</span></code></pre><h2 id="ä½¿ç”¨åºåˆ—"><a href="#ä½¿ç”¨åºåˆ—" class="headerlink" title="ä½¿ç”¨åºåˆ—"></a>ä½¿ç”¨åºåˆ—</h2><pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true"># ä¸€ä¸ªæ–°åˆ›å»ºè¿˜æ²¡æœ‰ä½¿ç”¨è¿‡çš„åºåˆ—ï¼Œå¿…é¡»é¦–å…ˆæ‰§è¡ŒNEXTVALï¼Œç„¶åæ‰èƒ½æ‰§è¡ŒCURRVALã€‚</span><span class="token keyword">SELECT</span> NEXTVAL<span class="token punctuation">(</span><span class="token string">'my_seq'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> CURRVAL<span class="token punctuation">(</span><span class="token string">'my_seq'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>åœ¨INSERTè¯­å¥é‡Œä½¿ç”¨åºåˆ—</li></ul><pre class=" language-sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customer <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'Hawkins'</span> <span class="token punctuation">,</span><span class="token string">'John'</span><span class="token punctuation">,</span> <span class="token number">072753</span><span class="token punctuation">,</span> NEXTVAL<span class="token punctuation">(</span><span class="token string">'my_seq'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>åœ¨INSERTè¯­å¥é‡ŒæŠŠåºåˆ—ä½œä¸ºé»˜è®¤å€¼ï¼š</li></ul><pre class=" language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> customer2<span class="token punctuation">(</span>ID <span class="token keyword">INTEGER</span> <span class="token keyword">DEFAULT</span> NEXTVAL<span class="token punctuation">(</span><span class="token string">'my_seq'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                   lname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                   fname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                   membership_card <span class="token keyword">INTEGER</span>                                  <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customer2 <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">,</span><span class="token string">'Carr'</span><span class="token punctuation">,</span> <span class="token string">'Mary'</span><span class="token punctuation">,</span> <span class="token number">87432</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>åˆ é™¤åºåˆ—</li></ul><pre class=" language-sql"><code class="language-sql"><span class="token keyword">DROP</span> SEQUENCE seq_name<span class="token punctuation">;</span></code></pre><h1 id="Verticaåˆ›å»ºå¤–éƒ¨è¡¨"><a href="#Verticaåˆ›å»ºå¤–éƒ¨è¡¨" class="headerlink" title="Verticaåˆ›å»ºå¤–éƒ¨è¡¨"></a>Verticaåˆ›å»ºå¤–éƒ¨è¡¨</h1><pre class=" language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> EXTERNAL <span class="token keyword">TABLE</span> ext1 <span class="token punctuation">(</span>x <span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> COPY <span class="token keyword">FROM</span> <span class="token string">'/tmp/ext1.dat'</span> <span class="token keyword">DELIMITER</span> <span class="token string">','</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> EXTERNAL <span class="token keyword">TABLE</span> ext1 <span class="token punctuation">(</span>x <span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> COPY <span class="token keyword">FROM</span> <span class="token string">'/tmp/ext1.dat.bz2'</span> BZIP <span class="token keyword">DELIMITER</span> <span class="token string">','</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> EXTERNAL <span class="token keyword">TABLE</span> ext1 <span class="token punctuation">(</span>x <span class="token keyword">integer</span><span class="token punctuation">,</span> y <span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> COPY <span class="token punctuation">(</span>x <span class="token keyword">as</span> <span class="token string">'5'</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token string">'/tmp/ext1.dat.bz2'</span> BZIP <span class="token keyword">DELIMITER</span> <span class="token string">','</span><span class="token punctuation">;</span></code></pre><h1 id="copyæ‰§è¡Œé”™è¯¯åçš„Verticaçš„é”™è¯¯æ—¥å¿—"><a href="#copyæ‰§è¡Œé”™è¯¯åçš„Verticaçš„é”™è¯¯æ—¥å¿—" class="headerlink" title="copyæ‰§è¡Œé”™è¯¯åçš„Verticaçš„é”™è¯¯æ—¥å¿—"></a>copyæ‰§è¡Œé”™è¯¯åçš„Verticaçš„é”™è¯¯æ—¥å¿—</h1><pre class=" language-shell"><code class="language-shell">/database/dbname/dbname/v_dbname_node0002_catalog/CopyErrorLogs</code></pre><h1 id="ä»verticaæ•°æ®çš„è¡¨ä¸­å¯¼å‡ºæ•°æ®åˆ°æ•°æ®æ–‡ä»¶"><a href="#ä»verticaæ•°æ®çš„è¡¨ä¸­å¯¼å‡ºæ•°æ®åˆ°æ•°æ®æ–‡ä»¶" class="headerlink" title="ä»verticaæ•°æ®çš„è¡¨ä¸­å¯¼å‡ºæ•°æ®åˆ°æ•°æ®æ–‡ä»¶"></a>ä»verticaæ•°æ®çš„è¡¨ä¸­å¯¼å‡ºæ•°æ®åˆ°æ•°æ®æ–‡ä»¶</h1><pre class=" language-shell"><code class="language-shell">echo `vsql -d dbname -U dbadmin -Atq -w Zongfen_12 -c "select * from test.dim_flow_direction order by flow_type_code"> /database/datastage/export/dim_all/test`</code></pre><h1 id="é€šè¿‡æ•°æ®æ–‡ä»¶å‘verticaæ•°æ®åº“é‡ŒåŠ è½½æ•°æ®"><a href="#é€šè¿‡æ•°æ®æ–‡ä»¶å‘verticaæ•°æ®åº“é‡ŒåŠ è½½æ•°æ®" class="headerlink" title="é€šè¿‡æ•°æ®æ–‡ä»¶å‘verticaæ•°æ®åº“é‡ŒåŠ è½½æ•°æ®"></a>é€šè¿‡æ•°æ®æ–‡ä»¶å‘verticaæ•°æ®åº“é‡ŒåŠ è½½æ•°æ®</h1><pre class=" language-shell"><code class="language-shell">copy test.fct_flux_se_bus_res_ana_d from '/database/imp_file/fct_flux_se_bus_res_ana_d' on v_dbname_node0002 delimiter '|';</code></pre><h1 id="ä¿®æ”¹å­—æ®µ"><a href="#ä¿®æ”¹å­—æ®µ" class="headerlink" title="ä¿®æ”¹å­—æ®µ"></a>ä¿®æ”¹å­—æ®µ</h1><h2 id="ä¿®æ”¹å­—æ®µä¸ºéç©º"><a href="#ä¿®æ”¹å­—æ®µä¸ºéç©º" class="headerlink" title="ä¿®æ”¹å­—æ®µä¸ºéç©º"></a>ä¿®æ”¹å­—æ®µä¸ºéç©º</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> test<span class="token punctuation">.</span>fct_fournet_wlanap_equp_ana_d <span class="token keyword">alter</span> <span class="token keyword">column</span> day_id <span class="token keyword">set</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">;</span></code></pre><h2 id="æ›´æ”¹å­—æ®µæ•°æ®ç±»å‹"><a href="#æ›´æ”¹å­—æ®µæ•°æ®ç±»å‹" class="headerlink" title="æ›´æ”¹å­—æ®µæ•°æ®ç±»å‹"></a>æ›´æ”¹å­—æ®µæ•°æ®ç±»å‹</h2><p>å¯¹äºæ•°å€¼ç±»å‹ï¼štypesâ€“INTEGER, INT, BIGINT, TINYINT, INT8, SMALLINT, and all NUMERIC values of scale &lt;=18 and precision 0 ä¹‹é—´æ˜¯å¯ä»¥äº’ç›¸è½¬åŒ–çš„ã€‚æ­¤å¤–ï¼Œnumericç±»å‹çš„ç²¾åº¦ï¼ˆprecisionï¼‰æ˜¯æ— æ³•æ›´æ”¹çš„ï¼Œä½†æ˜¯é•¿åº¦(scale)æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œï¼ˆ0-18ï¼‰ä¹‹é—´å¯ä»¥äº’ä¿®æ”¹ï¼Œï¼ˆ19-37ï¼‰ä¹‹é—´å¯ä»¥äº’ä¿®æ”¹ã€‚</p><pre class=" language-sql"><code class="language-sql"> <span class="token keyword">alter</span> <span class="token keyword">table</span> test<span class="token punctuation">.</span>dim_micro_area_gsm <span class="token keyword">alter</span> <span class="token keyword">column</span> cell_id <span class="token keyword">set</span> <span class="token keyword">data</span> <span class="token keyword">type</span> <span class="token keyword">numeric</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><h2 id="ç»™è¡¨å¢åŠ å­—æ®µ"><a href="#ç»™è¡¨å¢åŠ å­—æ®µ" class="headerlink" title="ç»™è¡¨å¢åŠ å­—æ®µ"></a>ç»™è¡¨å¢åŠ å­—æ®µ</h2><pre class=" language-sql"><code class="language-sql"> <span class="token keyword">alter</span> <span class="token keyword">table</span> test<span class="token punctuation">.</span>DIM_DETAIL_SVCTYPE <span class="token keyword">add</span> <span class="token keyword">column</span> if_app <span class="token keyword">numeric</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="åˆ é™¤è¡¨å­—æ®µ"><a href="#åˆ é™¤è¡¨å­—æ®µ" class="headerlink" title="åˆ é™¤è¡¨å­—æ®µ"></a>åˆ é™¤è¡¨å­—æ®µ</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> test<span class="token punctuation">.</span>DIM_DETAIL_SVCTYPE <span class="token keyword">drop</span> <span class="token keyword">column</span> if_app<span class="token punctuation">;</span></code></pre><h1 id="æ•°æ®åº“è¡¨ä¹‹é—´å¯¼æ•°æ®"><a href="#æ•°æ®åº“è¡¨ä¹‹é—´å¯¼æ•°æ®" class="headerlink" title="æ•°æ®åº“è¡¨ä¹‹é—´å¯¼æ•°æ®"></a>æ•°æ®åº“è¡¨ä¹‹é—´å¯¼æ•°æ®</h1><pre class=" language-shell"><code class="language-shell">CONNECT TO VERTICA dbname USER dbadmin PASSWORD 'dbname' ON '192.168.1.1',5433;export TO VERTICA dbname.test.FCT_TNES_GN_NET_M FROM test.FCT_TNES_GN_NET_M;</code></pre><h1 id="ä¿®æ”¹æ™®é€šè¡¨ä¸ºåˆ†åŒºè¡¨"><a href="#ä¿®æ”¹æ™®é€šè¡¨ä¸ºåˆ†åŒºè¡¨" class="headerlink" title="ä¿®æ”¹æ™®é€šè¡¨ä¸ºåˆ†åŒºè¡¨"></a>ä¿®æ”¹æ™®é€šè¡¨ä¸ºåˆ†åŒºè¡¨</h1><pre class=" language-sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> test<span class="token punctuation">.</span>fct_fournet_wlanap_equp_ana_d <span class="token keyword">partition</span> <span class="token keyword">by</span> day_id<span class="token punctuation">;</span></code></pre><h1 id="ä¿®æ”¹è¡¨å"><a href="#ä¿®æ”¹è¡¨å" class="headerlink" title="ä¿®æ”¹è¡¨å"></a>ä¿®æ”¹è¡¨å</h1><pre class=" language-sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> test<span class="token punctuation">.</span>fct_fournet_wlanap_equp_ana_d_x <span class="token keyword">rename</span> <span class="token keyword">to</span> fct_fournet_wlanap_equp_ana_d<span class="token punctuation">;</span></code></pre><h1 id="ä¿®æ”¹è¡¨æ‰€å±çš„ç”¨æˆ·"><a href="#ä¿®æ”¹è¡¨æ‰€å±çš„ç”¨æˆ·" class="headerlink" title="ä¿®æ”¹è¡¨æ‰€å±çš„ç”¨æˆ·"></a>ä¿®æ”¹è¡¨æ‰€å±çš„ç”¨æˆ·</h1><pre class=" language-sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> test<span class="token punctuation">.</span>fct_fournet_wlanap_equp_ana_d owner <span class="token keyword">to</span> dev_test</code></pre><h1 id="æŸ¥è¯¢è¡¨"><a href="#æŸ¥è¯¢è¡¨" class="headerlink" title="æŸ¥è¯¢è¡¨"></a>æŸ¥è¯¢è¡¨</h1><pre class=" language-sql"><code class="language-sql"><span class="token keyword">tables</span></code></pre><h1 id="projections"><a href="#projections" class="headerlink" title="projections"></a>projections</h1><pre class=" language-sql"><code class="language-sql">projections<span class="token comment" spellcheck="true"># æŸ¥è¯¢è¡¨å¯¹åº”çš„projection</span><span class="token keyword">SELECT</span> owner_name<span class="token punctuation">,</span> anchor_table_name<span class="token punctuation">,</span> projection_name  <span class="token keyword">FROM</span> projections <span class="token keyword">WHERE</span> projection_basename <span class="token operator">=</span> <span class="token string">'DIM_CFG_LEVEL'</span><span class="token punctuation">;</span></code></pre><h1 id="æŸ¥è¯¢åˆ—"><a href="#æŸ¥è¯¢åˆ—" class="headerlink" title="æŸ¥è¯¢åˆ—"></a>æŸ¥è¯¢åˆ—</h1><pre class=" language-sql"><code class="language-sql"><span class="token keyword">columns</span></code></pre><h1 id="æŸ¥è¯¢æ³¨é‡Š"><a href="#æŸ¥è¯¢æ³¨é‡Š" class="headerlink" title="æŸ¥è¯¢æ³¨é‡Š"></a>æŸ¥è¯¢æ³¨é‡Š</h1><pre class=" language-sql"><code class="language-sql">comments<span class="token comment" spellcheck="true"># æŸ¥è¯¢è¡¨çš„åˆ—å¯¹åº”çš„æ³¨é‡Š</span><span class="token keyword">SELECT</span> t3<span class="token punctuation">.</span>anchor_table_name <span class="token keyword">AS</span> Table_name<span class="token punctuation">,</span>       SUBSTR <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>object_name<span class="token punctuation">,</span> INSTR <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>object_name<span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Column_name<span class="token punctuation">,</span>       t1<span class="token punctuation">.</span><span class="token keyword">comment</span> <span class="token keyword">AS</span> <span class="token keyword">comment</span><span class="token keyword">FROM</span> comments t1<span class="token punctuation">,</span> projections t3 <span class="token keyword">WHERE</span>  SUBSTR <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>object_name<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> INSTR <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>object_name<span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span>              t3<span class="token punctuation">.</span>projection_name       <span class="token operator">AND</span> t1<span class="token punctuation">.</span>object_type <span class="token operator">=</span> <span class="token string">'COLUMN'</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> t3<span class="token punctuation">.</span>anchor_table_name<span class="token punctuation">;</span></code></pre><h1 id="å…¶ä»–æ“ä½œ"><a href="#å…¶ä»–æ“ä½œ" class="headerlink" title="å…¶ä»–æ“ä½œ"></a>å…¶ä»–æ“ä½œ</h1><h2 id="å››èˆäº”å…¥ã€å¹¶ä¸”ä¿ç•™ä¸¤ä½å°æ•°"><a href="#å››èˆäº”å…¥ã€å¹¶ä¸”ä¿ç•™ä¸¤ä½å°æ•°" class="headerlink" title="å››èˆäº”å…¥ã€å¹¶ä¸”ä¿ç•™ä¸¤ä½å°æ•°"></a>å››èˆäº”å…¥ã€å¹¶ä¸”ä¿ç•™ä¸¤ä½å°æ•°</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> TRIM <span class="token punctuation">(</span>TO_CHAR <span class="token punctuation">(</span><span class="token function">ROUND</span> <span class="token punctuation">(</span><span class="token number">3.456</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'999999999999999999.00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>       TRIM <span class="token punctuation">(</span>TO_CHAR <span class="token punctuation">(</span><span class="token function">ROUND</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'999999999999999999.00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>       TRIM <span class="token punctuation">(</span>TO_CHAR <span class="token punctuation">(</span><span class="token function">ROUND</span> <span class="token punctuation">(</span><span class="token number">3.00</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'999999999999999999.00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>       TRIM <span class="token punctuation">(</span>TO_CHAR <span class="token punctuation">(</span><span class="token function">ROUND</span> <span class="token punctuation">(</span><span class="token number">323542.101</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'999999999999999999.00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>       TRIM <span class="token punctuation">(</span>TO_CHAR <span class="token punctuation">(</span><span class="token function">ROUND</span> <span class="token punctuation">(</span><span class="token number">3.1067</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'999999999999999999.00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h2 id="äº§ç”Ÿéšæœºæ•°"><a href="#äº§ç”Ÿéšæœºæ•°" class="headerlink" title="äº§ç”Ÿéšæœºæ•°"></a>äº§ç”Ÿéšæœºæ•°</h2><ul><li>RANDOM()</li></ul><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> RANDOM<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>RANDOMINT</li></ul><pre class=" language-sql"><code class="language-sql">RANDOMINT <span class="token punctuation">(</span> N <span class="token punctuation">)</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Vertica </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vertica </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vertica ç®€ä»‹</title>
      <link href="2019/03/14/vertica-01/"/>
      <url>2019/03/14/vertica-01/</url>
      
        <content type="html"><![CDATA[<p>Verticaæ˜¯ä¸€æ¬¾åŸºäºåˆ—å­˜å‚¨çš„<a href="https://baike.baidu.com/item/MPP">MPP</a> ï¼ˆmassively parallel processingï¼‰æ¶æ„çš„æ•°æ®åº“ã€‚å®ƒå¯ä»¥æ”¯æŒå­˜æ”¾å¤šè‡³PBï¼ˆPetabyteï¼‰çº§åˆ«çš„ç»“æ„åŒ–æ•°æ®ã€‚Verticaæ˜¯ç”±å…³ç³»æ•°æ®åº“å¤§å¸ˆMichael Stonebraker(2014 å¹´<a href="https://baike.baidu.com/item/%E5%9B%BE%E7%81%B5%E5%A5%96/324645">å›¾çµå¥–</a>è·å¾—è€…)æ‰€åˆ›å»ºï¼Œäº2011å¹´è¢«<a href="https://baike.baidu.com/item/%E6%83%A0%E6%99%AE/275141">æƒ æ™®</a>æ”¶è´­å¹¶æˆä¸ºå…¶æ ¸å¿ƒå¤§æ•°æ®å¹³å°è½¯ä»¶ã€‚</p><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>Verticaæ˜¯ä¸€æ¬¾åŸºäºåˆ—å­˜å‚¨çš„<a href="https://baike.baidu.com/item/MPP">MPP</a>ï¼ˆmassively parallel processingï¼‰æ¶æ„çš„æ•°æ®åº“ã€‚ å®ƒå¯ä»¥æ”¯æŒå­˜æ”¾å¤šè‡³PBï¼ˆPetabyteï¼‰çº§åˆ«çš„ç»“æ„åŒ–æ•°æ®ã€‚Verticaæ˜¯ç”±å…³ç³»æ•°æ®åº“å¤§å¸ˆMichael Stonebraker(2014 å¹´<a href="https://baike.baidu.com/item/%E5%9B%BE%E7%81%B5%E5%A5%96">å›¾çµå¥–</a>è·å¾—è€…)æ‰€åˆ›å»ºï¼Œäº2011å¹´è¢«æƒ æ™®æ”¶è´­å¹¶æˆä¸ºå…¶æ ¸å¿ƒå¤§æ•°æ®å¹³å°è½¯ä»¶ã€‚</p><p>Vertica é‡‡ç”¨æ— å…±äº«çš„MPP æ¶æ„ï¼ŒåŸºäºå·¥ä¸šæ ‡å‡†çš„<a href="https://baike.baidu.com/item/x86">x86</a> æœåŠ¡å™¨ï¼Œæ‹¥æœ‰é«˜å¯æ‰©å±•æ€§ã€‚Vertica é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹100%å¯¹ç­‰ï¼Œé›†ç¾¤ä¸­æ²¡æœ‰ä¸»èŠ‚ç‚¹æˆ–å…¶ä»–å…±äº«èµ„æºã€‚é€šè¿‡å¢åŠ èŠ‚ç‚¹ï¼Œå°±å¯ä»¥çº¿æ€§åœ°æ‰©å±•é›†ç¾¤çš„è®¡ç®—èƒ½åŠ›å’Œæ•°æ®å¤„ç†å®¹é‡ã€‚</p><p>Vertica æ˜¯çœŸæ­£çš„çº¯åˆ—å¼æ•°æ®åº“ï¼Œä¼˜åŒ–å™¨å’Œæ‰§è¡Œå¼•æ“å¯ä»¥å¿½ç•¥è¡¨ä¸­ä¸æŸ¥è¯¢æ— å…³çš„åˆ—ã€‚Vertica ä¸ä»…ä»…æŒ‰åˆ—å¼å­˜å‚¨æ•°æ®ï¼Œè¿˜ä¸»åŠ¨åœ°æ ¹æ®åˆ—æ•°æ®çš„ç‰¹ç‚¹å’ŒæŸ¥è¯¢çš„è¦æ±‚é€‰ç”¨æœ€ä½³çš„ç®—æ³•å¯¹æ•°æ®è¿›è¡Œæ’åºå’Œç¼–ç å‹ç¼©ï¼Œè¿™å°±æå¤§åœ°é™ä½ç£ç›˜I/O æ¶ˆè€—ã€‚åŒæ—¶ï¼ŒVertica çš„æ‰§è¡Œå¼•æ“å’Œä¼˜åŒ–å™¨ä¹Ÿæ˜¯åŸºäºåˆ—å¼æ•°æ®åº“è®¾è®¡çš„ï¼Œç¼–ç å‹ç¼©è¿‡çš„åˆ—æ•°æ®åœ¨Vertica çš„æ‰§è¡Œå¼•æ“ä¸­è¿›è¡Œè¿‡æ»¤ã€å…³è”ã€åˆ†ç»„ç­‰æ“ä½œæ—¶ä¸éœ€è¦è§£åç¼–ç ï¼Œä»è€Œå¤§å¤§é™ä½äº†<a href="https://baike.baidu.com/item/CPU/120556">CPU</a> å’Œ<a href="https://baike.baidu.com/item/%E5%86%85%E5%AD%98">å†…å­˜</a>æ¶ˆè€—ã€‚</p><p>Vertica å……åˆ†åˆ©ç”¨åˆ—å¼å­˜å‚¨çš„ä¼˜ç‚¹ï¼Œåœ¨ä¿æŒå¯¹å‰ç«¯åº”ç”¨é€æ˜çš„å‰æä¸‹ï¼ŒæŠŠæ•°æ®åœ¨é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹è¿›è¡Œå‡åŒ€åˆ†å¸ƒçš„åŒæ—¶ï¼Œè¿˜åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šå¯¹åŒä¸€ä»½æ•°æ®ç»´æŠ¤äº†å¤šä¸ªæ‹·è´ï¼Œç¡®ä¿ä»»æ„ä¸€ä¸ªæ‰©å‡ ä¸ªèŠ‚ç‚¹å‡ºç°æ•…éšœæˆ–è¿›å…¥ç»´ä¿®çŠ¶æ€éƒ½ä¸ä¼šå½±å“é›†ç¾¤çš„å¥åº·çŠ¶æ€ã€‚è¿™ä½¿å¾—Vertica æ‹¥æœ‰ç±»ä¼¼ç£ç›˜RAID ä¸€æ ·é«˜å¯é æ€§ã€‚</p><p>æ— å…±äº«çš„MPP æ¶æ„å’ŒçœŸæ­£çš„åˆ—å¼æ•°æ®åº“ç‰¹æ€§ï¼Œä½¿Vertica æ‹¥æœ‰é«˜æ€§èƒ½ã€é«˜æ‰©å±•æ€§ã€é«˜å‹ç¼©ç‡ã€é«˜å¥å£®æ€§çš„ç‰¹ç‚¹ã€‚ä¸ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆç›¸æ¯”ï¼ŒVertica å¯ä»¥ä»¥30%çš„æˆæœ¬ï¼Œå®ç°50 å€-1000 å€çš„æ€§èƒ½æé«˜ã€‚</p><h2 id="è½¯ä»¶ä¼˜åŠ¿"><a href="#è½¯ä»¶ä¼˜åŠ¿" class="headerlink" title="è½¯ä»¶ä¼˜åŠ¿"></a>è½¯ä»¶ä¼˜åŠ¿</h2><p>ä½œä¸ºå…¨æ–°æ¶æ„çš„å®æ—¶åˆ†æå¹³å°ï¼ŒVertica æœ‰å¾ˆå¤šçš„åˆ›æ–°ï¼Œç‰¹ç‚¹åŒ…æ‹¬ï¼š</p><p><strong>åˆ—å¼å­˜å‚¨å’Œè®¡ç®—</strong></p><p>é€šè¿‡åˆ—å¼è®¡ç®—å’Œå¼ºå¤§çš„ä¸»åŠ¨æ•°æ®å‹ç¼©ï¼Œå¤§å¹…é™ä½æˆæœ¬é«˜æ˜‚çš„ç£ç›˜ <a href="https://baike.baidu.com/item/I%2FO/84718">I/O</a>ï¼ˆä¸»è¦æ˜¯ä¼ ç»Ÿçš„ä»¥è¡Œä¸ºå­˜å‚¨å•ä½çš„<a href="https://baike.baidu.com/item/SQL">SQL</a> æ•°æ®åº“ä½¿ç”¨ï¼‰ï¼Œæ‰§è¡ŒæŸ¥è¯¢çš„é€Ÿåº¦å¯æå‡ 50 åˆ° 1000å€ï¼Œå­˜å‚¨æˆæœ¬æœ€é«˜å‰Šå‡ 90%ã€‚</p><p><strong>â€œæ¨ªå‘æ‰©å±•å¼â€å¤§è§„æ¨¡å¹¶è¡Œå¤„ç† (MPP)</strong></p><p>åŸºäºæ— å…±äº«çš„MPP æ¶æ„ï¼Œæ”¯æŒåœ¨çº¿æ·»åŠ æ•°é‡ä¸é™çš„X86 å·¥ä¸šæ ‡å‡†æœåŠ¡å™¨ï¼Œå¯æ ¹æ®éœ€æ±‚ä»»æ„æ‰©å±•è§£å†³æ–¹æ¡ˆã€‚</p><p><strong>å®æ—¶åˆ†æ</strong></p><p>é€šè¿‡å†…å­˜ä¸ç£ç›˜æ··åˆå­˜å‚¨æ¶æ„ï¼Œä»¥åŠåŸç”Ÿæ”¯æŒkafka æ¶ˆæ¯ç³»ç»Ÿçš„è¿æ¥ï¼Œæ”¯æŒæ•°æ®å®æ—¶è£…è½½å’Œç§’çº§åˆ†æã€‚</p><p><strong>æ•°æ®åº“å†…éƒ¨åˆ†æåº“</strong></p><p>å¼€ç®±å³ç”¨çš„æ•°æ®åº“å†…æ—¶åºæ’å€¼å’Œå…³è”ã€äº‹ä»¶çª—å£å’Œä¼šè¯å¤„ç†ã€æ¨¡å¼åŒ¹é…ã€ç©ºé—´åœ°ç†åˆ†æã€æ–‡æœ¬æƒ…æ„Ÿåˆ†æç­‰é«˜çº§åˆ†æï¼Œä»¥åŠå¹¿ä¹‰çº¿æ€§å›å½’ã€é€»è¾‘å›å½’ã€K-Meansèšç±»ã€æœ´ç´ è´å¶æ–¯åˆ†ç±»ç­‰å¸¸ç”¨æœºå™¨å­¦ä¹ å’Œé¢„æµ‹åˆ†æåŠŸèƒ½ã€‚æ‚¨ä¹Ÿå¯ä»¥è·å–å¼€æºåˆ†æåº“ï¼ŒåŒ…æ‹¬æºè‡ª CRANï¼ˆç»¼åˆ R å­˜æ¡£ç½‘ç»œï¼‰çš„ä¼—å¤šåˆ†æåŠŸèƒ½åŒ…ã€‚</p><p><strong>å®Œæ•´çš„å…³ç³»æ•°æ®åº“å’ŒSQL æ ‡å‡†æ”¯æŒ</strong></p><p>Vertica æ”¯æŒå…³ç³»æ•°æ®åº“äº‹åŠ¡å¤„ç†å’ŒACID è§„èŒƒï¼Œæ”¯æŒSQL-92/SQL-99/SQL-2003 æ ‡å‡†ï¼Œæä¾›ODBCã€JDBCã€ADO.NET æ¥å£è§„èŒƒé©±åŠ¨ï¼Œå®Œå…¨å…¼å®¹ä¼ ç»Ÿå…³ç³»æ•°æ®åº“çš„å¼€å‘ã€ä½¿ç”¨å’Œç®¡ç†ä¹ æƒ¯ï¼Œå¯ä»¥è½»æ¾ä¸ç°æœ‰çš„ETL å’ŒæŠ¥è¡¨å·¥å…·é›†æˆï¼Œä¿æŠ¤å®¢æˆ·å·²æœ‰çš„æŠ•èµ„ã€‚</p><p><strong>å¯æ‰©å±•çš„æ•°æ®åº“å†…éƒ¨åˆ†ææ¡†æ¶</strong></p><p>é‡‡ç”¨é¢å‘ç”¨æˆ·å®šä¹‰çš„è¿‡ç¨‹å¼åˆ†æçš„å¼ºå¤§å¼€å‘æ¡†æ¶ï¼Œå®ç°äº†å¯¹äºæ•°æ®åº“å†…éƒ¨å¤„ç†çš„å¼€æ”¾å¼è®¿é—®ã€‚é™¤äº†ä½¿ç”¨å†…ç½®çš„ SQL åˆ†æå’Œèšåˆå‡½æ•°å¤–ï¼Œè¿˜å¯å€ŸåŠ© C++/Java/Rè¯­è¨€è½¯ä»¶å¼€å‘äººå‘˜å¥—ä»¶ (SDK) å®šä¹‰è‡ªå·±çš„å®šåˆ¶å‡½æ•°ã€‚SDK åŠŸèƒ½å¯ä¿è¯æ²™ç›’å®‰å…¨ï¼Œå¹¶ä½¿å‡½æ•°èƒ½å¤Ÿå¹¶è¡Œè¿è¡Œä»¥åŠ å¿«è¿è¡Œé€Ÿåº¦ã€‚</p><p><strong>åŸç”Ÿæ”¯æŒHadoop</strong></p><p>Vertica å¯ä»¥ä½œä¸ºSQL åˆ†æå¼•æ“ç›´æ¥éƒ¨ç½²åˆ°Hadoop é›†ç¾¤ä¸­ï¼Œç›´æ¥å­˜å–HDFSä¸Šçš„æ•°æ®ï¼›ä¹Ÿå¯ä»¥é€šè¿‡æ ‡å‡†SQL ç›´æ¥è®¿é—®Hive ç­‰ç®¡ç†çš„æ•°æ®ï¼Œå¹¶ä¸Vertica ç®¡ç†çš„æ•°æ®è¿›è¡Œå…³è”åˆ†æï¼›å¦å¤–Vertica è¿˜æä¾›åº”ç”¨ç¼–ç¨‹æ¥å£ (API)æ”¯æŒä¸MapReduceã€Pig ç­‰æ¡†æ¶æ„å»ºç»“æ„åŒ–ã€åŠç»“æ„åŒ–å’Œéç»“æ„åŒ–æ·±åº¦èåˆçš„å¤§æ•°æ®åˆ†æåº”ç”¨ã€‚</p><p><strong>è‡ªåŠ¨å®ç°é«˜å¯ç”¨æ€§</strong></p><p>ä¸é—´æ–­è¿è¡Œï¼Œå¹¶å…·æœ‰æ•°æ®å¤åˆ¶ã€æ•…éšœè½¬ç§»å’Œæ¢å¤åŠŸèƒ½ï¼›Vertica è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–ï¼Œå¹¶ä¸”å¯¹ä¸šåŠ¡å’Œè¿è¥å›¢é˜Ÿå®Œå…¨é€æ˜ã€‚</p><p><strong>è‡ªåŠ¨ä¼˜åŒ–å’Œæ€§èƒ½ç®¡ç†</strong></p><p>é€šè¿‡å¼ºå¤§çš„ API é›†åˆæ¥ç›‘æ§ç³»ç»Ÿçš„èµ„æºã€åå°è¿›ç¨‹ã€å·¥ä½œè´Ÿè½½åŠæ€§èƒ½ï¼Œé€šè¿‡å·¥ä½œè´Ÿè½½åˆ†æå’Œæ•°æ®åº“è®¾è®¡å™¨è‡ªåŠ¨ä¼˜åŒ–æ•°æ®åº“ï¼Œç®€åŒ–ç³»ç»Ÿç®¡ç†ã€‚</p><p>ä»¥ä¸Šæ‘˜è‡ªç™¾åº¦ç™¾ç§‘ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Vertica </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vertica </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac ä¿®æ”¹MySQLç¼–ç é›†</title>
      <link href="2019/03/09/mac-change-character-set/"/>
      <url>2019/03/09/mac-change-character-set/</url>
      
        <content type="html"><![CDATA[<p>å‰ä¸¤å¤©å› ä¸ºCiscoçš„VPNåäº†ï¼Œä¸€ç›´ç”¨ä¸äº†ï¼Œæ‰€ä»¥é‡æ–°è¿˜åŸäº†Macï¼Œé‡æ–°å®‰è£…äº†æ‰€æœ‰çš„è½¯ä»¶ï¼Œå…¶ä¸­å°±æœ‰MySQL-5.7.25ã€‚ä¹‹å‰å®‰è£…ä»¥åä¹Ÿæ˜¯ç¬¬ä¸€æ—¶é—´è®¾ç½®äº†MySQLçš„ç¼–ç ä¸ºutf8ï¼Œè¿™æ¬¡æ–°å®‰è£…ä¹Ÿå†æ¬¡è®°å½•ä¸€ä¸‹ä¿®æ”¹æ­¥éª¤</p><h2 id="æŸ¥çœ‹Mac-å®‰è£…MySQLä»¥åçš„é»˜è®¤ç¼–ç "><a href="#æŸ¥çœ‹Mac-å®‰è£…MySQLä»¥åçš„é»˜è®¤ç¼–ç " class="headerlink" title="æŸ¥çœ‹Mac å®‰è£…MySQLä»¥åçš„é»˜è®¤ç¼–ç "></a>æŸ¥çœ‹Mac å®‰è£…MySQLä»¥åçš„é»˜è®¤ç¼–ç </h2><pre class=" language-shell"><code class="language-shell">SHOW VARIABLES LIKE 'character_set_%';# ç»“æœcharacter_set_client    utf8mb4character_set_connection    utf8mb4character_set_database    latin1 ## è¿™é‡Œæ˜¯é»˜è®¤ç¼–ç character_set_filesystem    binarycharacter_set_results    utf8mb4character_set_server    latin1  ## è¿™é‡Œæ˜¯é»˜è®¤ç¼–ç character_set_system    utf8character_sets_dir    /usr/local/mysql-5.7.25-macos10.14-x86_64/share/charsets/</code></pre><h2 id="æ–°å»ºmy-cnfæ–‡ä»¶"><a href="#æ–°å»ºmy-cnfæ–‡ä»¶" class="headerlink" title="æ–°å»ºmy.cnfæ–‡ä»¶"></a>æ–°å»ºmy.cnfæ–‡ä»¶</h2><pre class=" language-shell"><code class="language-shell">[client]default-character-set=utf8[mysqld]collation-server = utf8_unicode_ciinit-connect='SET NAMES utf8'character-set-server = utf8[mysql]default-character-set=utf8</code></pre><h2 id="ç§»åŠ¨åˆ°-etc-ç›®å½•"><a href="#ç§»åŠ¨åˆ°-etc-ç›®å½•" class="headerlink" title="ç§»åŠ¨åˆ° /etc ç›®å½•"></a>ç§»åŠ¨åˆ° /etc ç›®å½•</h2><p>ç§»åŠ¨my.cnfæ–‡ä»¶åˆ°/etcç›®å½•ï¼Œéœ€è¦rootæƒé™</p><pre class=" language-shell"><code class="language-shell">sudo mv my.cnf /etc/</code></pre><h2 id="é‡å¯MySQLï¼Œå†æ¬¡æŸ¥çœ‹ç¼–ç "><a href="#é‡å¯MySQLï¼Œå†æ¬¡æŸ¥çœ‹ç¼–ç " class="headerlink" title="é‡å¯MySQLï¼Œå†æ¬¡æŸ¥çœ‹ç¼–ç "></a>é‡å¯MySQLï¼Œå†æ¬¡æŸ¥çœ‹ç¼–ç </h2><pre class=" language-shell"><code class="language-shell">SHOW VARIABLES LIKE 'character_set_%';# ç»“æœcharacter_set_client    utf8mb4character_set_connection    utf8mb4character_set_database    utf8 ## è¿™é‡Œæ˜¯ä¿®æ”¹ä»¥åçš„character_set_filesystem    binarycharacter_set_results    utf8mb4character_set_server    utf8 ## è¿™é‡Œæ˜¯ä¿®æ”¹ä»¥åçš„character_set_system    utf8character_sets_dir    /usr/local/mysql-5.7.25-macos10.14-x86_64/share/charsets/</code></pre>]]></content>
      
      
      <categories>
          
          <category> MacBook </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Elasticsearch å¿«é€Ÿä¸Šæ‰‹</title>
      <link href="2019/03/09/elasticsearch-rest-api/"/>
      <url>2019/03/09/elasticsearch-rest-api/</url>
      
        <content type="html"><![CDATA[<h1 id="Elasticsearch-å¿«é€Ÿä¸Šæ‰‹"><a href="#Elasticsearch-å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="Elasticsearch å¿«é€Ÿä¸Šæ‰‹"></a>Elasticsearch å¿«é€Ÿä¸Šæ‰‹</h1><blockquote><p>æ³¨ï¼šæœ¬æ–‡æ¡£ä¸­é™¤æ— ç‰¹åˆ«è¯´æ˜ï¼Œè¯·æ±‚æ–¹å¼å‡ä¸º<code>GET</code>ã€‚æ‰€æœ‰çš„è¯·æ±‚å‡åœ¨<code>Sense</code>ä¸­æµ‹è¯•é€šè¿‡</p></blockquote><p>éµå¾ªçš„æ ¼å¼ä¸º</p><pre><code>curl -X&lt;REST Verb&gt; &lt;Node&gt;:&lt;Port&gt;/&lt;Index&gt;/&lt;Type&gt;/&lt;ID&gt;</code></pre><h3 id="é›†ç¾¤å¥åº·æŸ¥çœ‹"><a href="#é›†ç¾¤å¥åº·æŸ¥çœ‹" class="headerlink" title="é›†ç¾¤å¥åº·æŸ¥çœ‹"></a>é›†ç¾¤å¥åº·æŸ¥çœ‹</h3><ul><li><a href="http://127.0.0.1:9200/_cat/health?v">http://127.0.0.1:9200/_cat/health?v</a></li></ul><pre><code>epoch      timestamp cluster       status node.total node.data shards pri relo init unassign pending_tasks 1441940569 11:02:49  elasticsearch yellow          1         1      7   7    0    0        7             0 </code></pre><ul><li><a href="http://127.0.0.1:9200/_cat/nodes?v">http://127.0.0.1:9200/_cat/nodes?v</a></li></ul><pre><code>host ip            heap.percent ram.percent load node.role master name     acer 169.254.9.202           32          52      d         *      Mys-Tech</code></pre><h3 id="åˆ—å‡ºæ‰€æœ‰çš„indices"><a href="#åˆ—å‡ºæ‰€æœ‰çš„indices" class="headerlink" title="åˆ—å‡ºæ‰€æœ‰çš„indices"></a>åˆ—å‡ºæ‰€æœ‰çš„indices</h3><ul><li><a href="http://127.0.0.1:9200/_cat/indices?v">http://127.0.0.1:9200/_cat/indices?v</a></li></ul><pre><code>health status index              pri rep docs.count docs.deleted store.size pri.store.size yellow open   .marvel-2015.09.11   1   1       3233            0     10.5mb         10.5mb yellow open   .marvel-2015.09.10   1   1       1996            0      3.9mb          3.9mb yellow open   news                 5   1       3455            0     17.8mb         17.8mb </code></pre><h3 id="åˆ›å»ºç´¢å¼•"><a href="#åˆ›å»ºç´¢å¼•" class="headerlink" title="åˆ›å»ºç´¢å¼•"></a>åˆ›å»ºç´¢å¼•</h3><p>ä½¿ç”¨<code>PUT</code>è¯·æ±‚åˆ›å»ºä¸€ä¸ªcountriesçš„ç´¢å¼•</p><pre><code>curl -XPUT http://127.0.0.1:9200/countries?pretty</code></pre><p>è¾“å‡º:</p><pre><code>{   "acknowledged": true}</code></pre><p>æŸ¥çœ‹ç´¢å¼•åˆ—è¡¨</p><pre><code>curl -XGET http://127.0.0.1:9200/_cat/indices?v</code></pre><p>è¾“å‡º:</p><pre><code>health status index              pri rep docs.count docs.deleted store.size pri.store.size yellow open   countries              5   1          0            0       575b           575b yellow open   .marvel-2015.09.11   1   1       3436            0     11.4mb         11.4mb yellow open   .marvel-2015.09.10   1   1       1996            0      3.9mb          3.9mb yellow open   news                 5   1       3455            0     17.8mb         17.8mb </code></pre><h3 id="ç´¢å¼•æ–‡æ¡£"><a href="#ç´¢å¼•æ–‡æ¡£" class="headerlink" title="ç´¢å¼•æ–‡æ¡£"></a>ç´¢å¼•æ–‡æ¡£</h3><ul><li>ä½¿ç”¨è‡ªå®šä¹‰idç´¢å¼•æ–‡æ¡£</li></ul><p>ä½¿ç”¨<code>PUT</code>è¯·æ±‚åˆ›å»ºä¸€ä¸ªç´¢å¼•ä¸º<code>countries</code>ç±»å‹ä¸º<code>country</code>çš„æ–‡æ¡£ã€‚å…¶æ–‡æ¡£ç¼–å·ä¸º<code>1</code>ï¼Œæ–‡æ¡£å†…å®¹åŒ…å«<code>name</code>å’Œ<code>capital</code></p><pre><code>curl -XPUT http://127.0.0.1:9200/countries/country/1?pretty -d '{  "name": "ä¸­å›½",  "capital": "åŒ—äº¬"}'</code></pre><p>è¾“å‡º:</p><pre><code>{   "_index": "countries",   "_type": "country",   "_id": "1",   "_version": 1,   "created": true}</code></pre><ul><li>ä½¿ç”¨ç³»ç»Ÿåˆ†é…çš„idç´¢å¼•æ–‡æ¡£</li></ul><pre><code>curl -XPOST http://127.0.0.1:9200/countries/country?pretty -d '{  "name": "éŸ©å›½",  "capital": "é¦–å°”"}'</code></pre><p>æ³¨æ„ï¼šä½¿ç”¨ç³»ç»Ÿåˆ†é…çš„idæ—¶ä½¿ç”¨<code>POST</code>æ–¹å¼æäº¤æ–‡æ¡£ï¼Œä¸”åœ¨<code>ç´¢å¼•\ç±»å‹</code>urlæ ¼å¼ä¸­ä¸å†æœ‰id</p><p>è¾“å‡º:</p><pre><code>{   "_index": "countries",   "_type": "country",   "_id": "AU-6awteDgxJZYVN-E5I",   "_version": 1,   "created": true}</code></pre><h3 id="æŸ¥è¯¢æ–‡æ¡£"><a href="#æŸ¥è¯¢æ–‡æ¡£" class="headerlink" title="æŸ¥è¯¢æ–‡æ¡£"></a>æŸ¥è¯¢æ–‡æ¡£</h3><p>ä½¿ç”¨è‡ªå®šä¹‰idæŸ¥è¯¢æ–‡æ¡£</p><pre><code>curl -XGET http://127.0.0.1:9200/countries/country/1?pretty</code></pre><p>è¾“å‡º:</p><pre><code>{   "_index": "countries",   "_type": "country",   "_id": "1",   "_version": 1,   "found": true,   "_source": {      "name": "ä¸­å›½",      "capital": "åŒ—äº¬"   }}</code></pre><p>ä½¿ç”¨ç³»ç»Ÿåˆ†é…çš„idæŸ¥è¯¢</p><pre><code>GET http://127.0.0.1:9200/countries/country/AU-6awteDgxJZYVN-E5I?pretty</code></pre><p>è¾“å‡º:</p><pre><code>{   "_index": "countries",   "_type": "country",   "_id": "AU-6awteDgxJZYVN-E5I",   "_version": 1,   "found": true,   "_source": {      "name": "éŸ©å›½",      "capital": "é¦–å°”"   }}</code></pre><h3 id="æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯"><a href="#æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯"></a>æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯</h3><pre><code>GET http://127.0.0.1:9200/countries/</code></pre><p>è¾“å‡º:</p><pre><code>{   "countries": {      "aliases": {},      "mappings": {         "country": {            "properties": {               "capital": {                  "type": "string"               },               "name": {                  "type": "string"               }            }         }      },      "settings": {         "index": {            "creation_date": "1441941497754",            "uuid": "UaoQ_WCATaiy5w736cjw2A",            "number_of_replicas": "1",            "number_of_shards": "5",            "version": {               "created": "1070199"            }         }      },      "warmers": {}   }}</code></pre><h3 id="åˆ é™¤ç´¢å¼•"><a href="#åˆ é™¤ç´¢å¼•" class="headerlink" title="åˆ é™¤ç´¢å¼•"></a>åˆ é™¤ç´¢å¼•</h3><p>åˆ é™¤<code>myindex</code>ç´¢å¼•</p><pre><code>DELETE http://127.0.0.1:9200/myindex/?pretty</code></pre><p>è¾“å‡º:</p><pre><code>{   "acknowledged": true}</code></pre><h3 id="ç´¢å¼•æˆ–æ›¿æ¢ä¸€ä¸ªæ–‡æ¡£"><a href="#ç´¢å¼•æˆ–æ›¿æ¢ä¸€ä¸ªæ–‡æ¡£" class="headerlink" title="ç´¢å¼•æˆ–æ›¿æ¢ä¸€ä¸ªæ–‡æ¡£"></a>ç´¢å¼•æˆ–æ›¿æ¢ä¸€ä¸ªæ–‡æ¡£</h3><p>æ ¹æ®æ–‡æ¡£idç´¢å¼•æˆ–æ›¿æ¢æ–‡æ¡£ï¼Œè‹¥å­˜åœ¨åˆ™ä¿®æ”¹æ›¿æ¢ï¼Œå¦åˆ™ç´¢å¼•è¯¥æ–‡æ¡£ã€‚</p><ul><li>ä½¿ç”¨å·²å­˜åœ¨çš„id</li></ul><p>ä¿®æ”¹æ–‡æ¡£idä¸º1çš„å›½å®¶ä¿¡æ¯ã€‚</p><pre><code>PUT 'http://127.0.0.1:9200/countries/country/1?pretty'{    "name": "æ—¥æœ¬",    "capital": "ä¸œäº¬"}</code></pre><p>æŸ¥è¯¢å…¶æ˜¯å¦å·²ä¿®æ”¹</p><pre><code>GET http://127.0.0.1:9200/countries/country/1?pretty</code></pre><p>è¾“å‡º:</p><pre><code>{   "_index": "countries",   "_type": "country",   "_id": "1",   "_version": 2,   "found": true,   "_source": {      "name": "æ—¥æœ¬",      "capital": "ä¸œäº¬"   }}</code></pre><p>å¯è§å›½å®¶ä¿¡æ¯å·²ç”±<code>ä¸­å›½</code>å˜ä¸º<code>æ—¥æœ¬</code>ï¼Œå…¶é¦–éƒ½ä¿¡æ¯ä¹Ÿå‘ç”Ÿäº†å˜åŒ–</p><ul><li>ä½¿ç”¨ä¸å­˜åœ¨çš„idåˆ™æ˜¯ç´¢å¼•æ–‡æ¡£</li></ul><pre><code>PUT http://127.0.0.1:9200/countries/country/2?pretty{    "name": "æ¾³å¤§åˆ©äºš",    "capital": "æ‚‰å°¼"}</code></pre><p>è¾“å‡º:</p><pre><code>{   "_index": "countries",   "_type": "country",   "_id": "2",   "_version": 1,   "created": true}</code></pre><h3 id="ä¿®æ”¹æ–‡æ¡£"><a href="#ä¿®æ”¹æ–‡æ¡£" class="headerlink" title="ä¿®æ”¹æ–‡æ¡£"></a>ä¿®æ”¹æ–‡æ¡£</h3><ul><li>æŒ‰docæ–¹å¼æ›´æ–°æ–‡æ¡£</li></ul><p>ä»¥<code>doc</code>æ–¹å¼ä¿®æ”¹æ–‡æ¡£idä¸º1çš„æ–‡æ¡£</p><pre><code>POST http://127.0.0.1:9200/countries/country/1/_update?pretty{  "doc": { "name": "ç¾å›½","capital": "åç››é¡¿"}}</code></pre><p>å…¶ä¸­<code>doc</code>æ˜¯å›ºå®šå†™æ³•,å…¶å†…å®¹ä¸ºè¦ä¿®æ”¹çš„æ–‡æ¡£å†…å®¹</p><ul><li>æŒ‰scriptæ–¹å¼æ›´æ–°æ–‡æ¡£</li></ul><p>ä»¥<code>script</code>æ–¹å¼ä¿®æ”¹æ–‡æ¡£idä¸º1çš„æ–‡æ¡£</p><pre><code>POST http://127.0.0.1:9200/countries/country/1/_update?pretty{  "script": "ctx._source.name=\"åŠ æ‹¿å¤§\";ctx._source.capital=\"æ¸¥å¤ªå\""}</code></pre><h3 id="åˆ é™¤æ–‡æ¡£"><a href="#åˆ é™¤æ–‡æ¡£" class="headerlink" title="åˆ é™¤æ–‡æ¡£"></a>åˆ é™¤æ–‡æ¡£</h3><ul><li>æŒ‰æ–‡æ¡£idåˆ é™¤</li></ul><pre><code>DELETE http://127.0.0.1:9200/countries/country/1?pretty</code></pre><p>è¾“å‡ºï¼š</p><pre><code>{   "found": true,   "_index": "countries",   "_type": "country",   "_id": "1",   "_version": 6}</code></pre><ul><li>æ ¹æ®æŸ¥è¯¢ç»“æœåˆ é™¤</li></ul><pre><code>DELETE http://127.0.0.1:9200/countries/country/_query?pretty{    "query": { "match": { "name": "ç¾å›½" } }}</code></pre><p>è¾“å‡ºï¼š</p><pre><code>{   "_indices": {      "countries": {         "_shards": {            "total": 5,            "successful": 5,            "failed": 0         }      }   }}</code></pre><p>æŸ¥è¯¢æ˜¯å¦è¿˜æœ‰nameä¸ºç¾å›½çš„æ–‡æ¡£</p><pre><code>GET http://127.0.0.1:9200/countries/country/_query{    "query": { "match_all": { "name": "ç¾å›½" } }}</code></pre><h3 id="æ‰¹é‡å¤„ç†"><a href="#æ‰¹é‡å¤„ç†" class="headerlink" title="æ‰¹é‡å¤„ç†"></a>æ‰¹é‡å¤„ç†</h3><p>_bulk api</p><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html</a></p><p>éµå¾ªæ ¼å¼</p><p>/_bulk, /{index}/_bulk, {index}/{type}/_bulk</p><pre><code>action_and_meta_data\noptional_source\naction_and_meta_data\noptional_source\n</code></pre><p>æ”¯æŒçš„actionæœ‰<code>index</code>, <code>create</code>, <code>delete</code>, <code>update</code></p><p><code>index</code>å’Œ<code>create</code>åœ¨ä¸‹ä¸€è¡Œè·Ÿä¸Šè¦ç´¢å¼•çš„doc<br><code>delete</code>åˆ™ä¸éœ€è¦<br><code>update</code>åœ¨ä¸‹ä¸€è¡Œè·Ÿä¸Š<code>doc</code>æˆ–<code>script</code></p><ul><li>æ‰¹é‡ç´¢å¼•æ–‡æ¡£</li></ul><pre><code>POST http://127.0.0.1:9200/countries/country/_bulk?pretty{"index":{"_id":"1"}}{"name": "ä¸­å›½","capital": "åŒ—äº¬"}{"index":{"_id":"2"}}{"name": "ç¾å›½","capital": "åç››é¡¿"}{"index":{"_id":"3"}}{"name": "æ—¥æœ¬","capital": "ä¸œäº¬"}{"index":{"_id":"4"}}{"name": "æ¾³å¤§åˆ©äºš","capital": "æ‚‰å°¼"}{"index":{"_id":"5"}}{"name": "å°åº¦","capital": "æ–°å¾·é‡Œ"}{"index":{"_id":"6"}}{"name": "éŸ©å›½","capital": "é¦–å°”"}</code></pre><p>ä»¥ä¸Šè¯·æ±‚å°†ä¼šæ‰¹é‡ç´¢å¼•6ä¸ªæ–‡æ¡£ã€‚</p><p>è¾“å‡ºï¼š</p><pre><code>{   "took": 4,   "errors": false,   "items": [      {         "index": {            "_index": "countries",            "_type": "country",            "_id": "1",            "_version": 1,            "status": 201         }      },      {         "index": {            "_index": "countries",            "_type": "country",            "_id": "2",            "_version": 2,            "status": 200         }      },      {         "index": {            "_index": "countries",            "_type": "country",            "_id": "3",            "_version": 1,            "status": 201         }      },      {         "index": {            "_index": "countries",            "_type": "country",            "_id": "4",            "_version": 1,            "status": 201         }      },      {         "index": {            "_index": "countries",            "_type": "country",            "_id": "5",            "_version": 1,            "status": 201         }      },      {         "index": {            "_index": "countries",            "_type": "country",            "_id": "6",            "_version": 1,            "status": 201         }      }   ]}</code></pre><ul><li>æ‰¹é‡æ‰§è¡Œï¼Œå«indexã€createã€deleteã€update</li></ul><pre><code>POST http://127.0.0.1:9200/countries/country/_bulk?pretty{"index":{"_id":"7"}}{"name": "æ–°åŠ å¡","capital": "æ¸¥å¤ªå"}{"create":{"_id":"8"}}{"name": "å¾·å›½","capital": "æŸæ—"}{"update":{"_id":"1"}}{"doc": {"name": "æ³•å›½","capital": "å·´é»" }}{"update":{"_id":"3"}}{"script": "ctx._source.name = \"æ³•å›½\";ctx._source.capital = \"å·´é»\""}{"delete":{"_id":"2"}}</code></pre><p>è¾“å‡ºï¼š</p><pre><code>{   "took": 40,   "errors": false,   "items": [      {         "index": {            "_index": "countries",            "_type": "country",            "_id": "7",            "_version": 1,            "status": 201         }      },      {         "create": {            "_index": "countries",            "_type": "country",            "_id": "8",            "_version": 1,            "status": 201         }      },      {         "update": {            "_index": "countries",            "_type": "country",            "_id": "1",            "_version": 2,            "status": 200         }      },      {         "update": {            "_index": "countries",            "_type": "country",            "_id": "3",            "_version": 2,            "status": 200         }      },      {         "delete": {            "_index": "countries",            "_type": "country",            "_id": "2",            "_version": 3,            "status": 200,            "found": true         }      }   ]}</code></pre><ul><li>å¯¼å…¥æ•°æ®</li></ul><p>countries.json</p><pre><code>{"index":{"_id":"1"}}{"name": "æ–°åŠ å¡","capital": "æ¸¥å¤ªå"}{"index":{"_id":"2"}}{"name": "éŸ©å›½","capital": "é¦–å°”"}{"index":{"_id":"3"}}{"name": "æœé²œ","capital": "å¹³å£¤"}{"index":{"_id":"4"}}{"name": "æ—¥æœ¬","capital": "ä¸œäº¬"}{"index":{"_id":"5"}}{"name": "é©¬æ¥è¥¿äºš","capital": "å‰éš†å¡"}</code></pre><p>ä½¿ç”¨curlçš„<code>--data-binary</code>å‚æ•°å¯¼å…¥æ•°æ®</p><pre><code>curl XPOST http://127.0.0.1:9200/countries/country/_bulk?pretty --data-binary @countries.json</code></pre><p>æˆ–è€…ä½¿ç”¨postmanå¯¼å…¥</p><pre><code>http://127.0.0.1:9200/countries/country/_bulk?pretty{"index":{"_id":"1"}}{"name": "æ–°åŠ å¡","capital": "æ¸¥å¤ªå"}{"index":{"_id":"2"}}{"name": "éŸ©å›½","capital": "é¦–å°”"}{"index":{"_id":"3"}}{"name": "æœé²œ","capital": "å¹³å£¤"}{"index":{"_id":"4"}}{"name": "æ—¥æœ¬","capital": "ä¸œäº¬"}{"index":{"_id":"5"}}{"name": "é©¬æ¥è¥¿äºš","capital": "å‰éš†å¡"}</code></pre><h3 id="search-api"><a href="#search-api" class="headerlink" title="search api"></a>search api</h3><ul><li>GETæ–¹å¼æœç´¢(queryString)</li></ul><pre><code>GET http://127.0.0.1:9200/countries/_search?q=*&amp;pretty</code></pre><p>æ³¨:<code>q=*</code>å°†åŒ¹é…ç´¢å¼•ä¸­çš„æ‰€æœ‰æ–‡æ¡£</p><p>è¾“å‡º:</p><pre><code>{   "took": 1,   "timed_out": false,   "_shards": {      "total": 5,      "successful": 5,      "failed": 0   },   "hits": {      "total": 10,      "max_score": 1,      "hits": [         {            "_index": "countries",            "_type": "country",            "_id": "4",            "_score": 1,            "_source": {               "name": "æ—¥æœ¬",               "capital": "ä¸œäº¬"            }         },         {            "_index": "countries",            "_type": "country",            "_id": "_query",            "_score": 1,            "_source": {               "query": {                  "match_all": {                     "name": "ç¾å›½"                  }               }            }         },         {            "_index": "countries",            "_type": "country",            "_id": "5",            "_score": 1,            "_source": {               "name": "å°åº¦",               "capital": "æ–°å¾·é‡Œ"            }         },         {            "_index": "countries",            "_type": "country",            "_id": "6",            "_score": 1,            "_source": {               "name": "éŸ©å›½",               "capital": "é¦–å°”"            }         },         {            "_index": "countries",            "_type": "country",            "_id": "1",            "_score": 1,            "_source": {               "name": "æ–°åŠ å¡",               "capital": "æ¸¥å¤ªå"            }         },         {            "_index": "countries",            "_type": "country",            "_id": "7",            "_score": 1,            "_source": {               "name": "æ–°åŠ å¡",               "capital": "æ¸¥å¤ªå"            }         },         {            "_index": "countries",            "_type": "country",            "_id": "2",            "_score": 1,            "_source": {               "name": "éŸ©å›½",               "capital": "é¦–å°”"            }         },         {            "_index": "countries",            "_type": "country",            "_id": "AU-6awteDgxJZYVN-E5I",            "_score": 1,            "_source": {               "name": "éŸ©å›½",               "capital": "é¦–å°”"            }         },         {            "_index": "countries",            "_type": "country",            "_id": "8",            "_score": 1,            "_source": {               "name": "å¾·å›½",               "capital": "æŸæ—"            }         },         {            "_index": "countries",            "_type": "country",            "_id": "3",            "_score": 1,            "_source": {               "name": "æœé²œ",               "capital": "å¹³å£¤"            }         }      ]   }}</code></pre><ul><li>POSTæ–¹å¼æœç´¢(å«è¯·æ±‚ä½“query)</li></ul><pre><code>POST http://127.0.0.1:9200/countries/_search?pretty{    "query": {        "match_all": {}    }}</code></pre><p>è¾“å‡º:</p><pre><code>{   "took": 1,   "timed_out": false,   "_shards": {      "total": 5,      "successful": 5,      "failed": 0   },   "hits": {      "total": 10,      "max_score": 1,      "hits": [         {            "_index": "countries",            "_type": "country",            "_id": "4",            "_score": 1,            "_source": {               "name": "æ—¥æœ¬",               "capital": "ä¸œäº¬"            }         },         {            "_index": "countries",            "_type": "country",            "_id": "_query",            "_score": 1,            "_source": {               "query": {                  "match_all": {                     "name": "ç¾å›½"                  }               }            }         },         {            "_index": "countries",            "_type": "country",            "_id": "5",            "_score": 1,            "_source": {               "name": "å°åº¦",               "capital": "æ–°å¾·é‡Œ"            }         },         {            "_index": "countries",            "_type": "country",            "_id": "6",            "_score": 1,            "_source": {               "name": "éŸ©å›½",               "capital": "é¦–å°”"            }         },         {            "_index": "countries",            "_type": "country",            "_id": "1",            "_score": 1,            "_source": {               "name": "æ–°åŠ å¡",               "capital": "æ¸¥å¤ªå"            }         },         {            "_index": "countries",            "_type": "country",            "_id": "7",            "_score": 1,            "_source": {               "name": "æ–°åŠ å¡",               "capital": "æ¸¥å¤ªå"            }         },         {            "_index": "countries",            "_type": "country",            "_id": "2",            "_score": 1,            "_source": {               "name": "éŸ©å›½",               "capital": "é¦–å°”"            }         },         {            "_index": "countries",            "_type": "country",            "_id": "AU-6awteDgxJZYVN-E5I",            "_score": 1,            "_source": {               "name": "éŸ©å›½",               "capital": "é¦–å°”"            }         },         {            "_index": "countries",            "_type": "country",            "_id": "8",            "_score": 1,            "_source": {               "name": "å¾·å›½",               "capital": "æŸæ—"            }         },         {            "_index": "countries",            "_type": "country",            "_id": "3",            "_score": 1,            "_source": {               "name": "æœé²œ",               "capital": "å¹³å£¤"            }         }      ]   }}</code></pre><ul><li>é™å®šè¿”å›æ¡ç›®</li></ul><pre><code>POST http://127.0.0.1:9200/countries/_search?pretty{    "query": {        "match_all": {}    },    "size": 1}</code></pre><p><code>size</code>æ§åˆ¶è¿”å›æ¡ç›®ï¼Œé»˜è®¤ä¸º10</p><p>è¾“å‡º:</p><pre><code>{   "took": 1,   "timed_out": false,   "_shards": {      "total": 5,      "successful": 5,      "failed": 0   },   "hits": {      "total": 10,      "max_score": 1,      "hits": [         {            "_index": "countries",            "_type": "country",            "_id": "4",            "_score": 1,            "_source": {               "name": "æ—¥æœ¬",               "capital": "ä¸œäº¬"            }         }      ]   }}</code></pre><ul><li>åˆ†é¡µ(form,size)</li></ul><pre><code>POST http://127.0.0.1:9200/countries/_search?pretty{    "query": {        "match_all": {}    },    "from": 2,    "size": 2}</code></pre><p>ä½¿ç”¨<code>from</code>å’Œ<code>size</code>æ¥ç¿»é¡µã€‚å…¶ä¸­<code>form</code>é»˜è®¤ä¸º<code>0</code>,<code>size</code>é»˜è®¤ä¸º<code>10</code></p><ul><li>æ’åº(sort)</li></ul><pre><code>POST http://127.0.0.1:9200/countries/_search?pretty{    "query": {        "match_all": {}    },    "sort": [       {          "name": {             "order": "desc"          }       }    ]}</code></pre><p>å…¶ä¸­<code>name</code>ä¸ºæ’åºå­—æ®µ</p><h3 id="é™å®šè¿”å›å­—æ®µ"><a href="#é™å®šè¿”å›å­—æ®µ" class="headerlink" title="é™å®šè¿”å›å­—æ®µ"></a>é™å®šè¿”å›å­—æ®µ</h3><pre><code>POST http://127.0.0.1:9200/countries/_search?pretty{    "query": {        "match_all": {}    },    "_source": ["name"]}</code></pre><p>ä½¿ç”¨<code>_source</code>æ¥é™å®šè¿”å›çš„å­—æ®µã€‚è¿™é‡Œåªè¿”å›<code>name</code></p><h3 id="é«˜çº§æŸ¥è¯¢"><a href="#é«˜çº§æŸ¥è¯¢" class="headerlink" title="é«˜çº§æŸ¥è¯¢"></a>é«˜çº§æŸ¥è¯¢</h3><ul><li>match_phrase</li></ul><pre><code>POST http://127.0.0.1:9200/countries/_search?pretty{    "query": {        "match_phrase": {           "name": "éŸ©å›½"        }    }}</code></pre><ul><li>must</li></ul><pre><code>POST http://127.0.0.1:9200/countries/_search?pretty{    "query": {        "bool": {            "must": [               {"match": {                  "name": "æ—¥æœ¬"               }},               {"match": {                  "capital": "ä¸œäº¬"               }}            ]        }    }}</code></pre><ul><li>should</li></ul><pre><code>POST http://127.0.0.1:9200/countries/_search?pretty{    "query": {        "bool": {            "should": [               {"match": {                  "name": "æ—¥æœ¬"               }},               {"match": {                  "name": "éŸ©å›½"               }}            ]        }    }}</code></pre><ul><li><p>must_not</p><pre><code>POST http://127.0.0.1:9200/countries/_search?pretty{  "query": {      "bool": {          "must_not": [             {"match": {                "name": "æ—¥æœ¬"             }},             {"match": {                "name": "éŸ©å›½"             }}          ]      }  }}</code></pre></li><li><p>filter</p></li></ul><pre><code>POST http://127.0.0.1:9200/countries/_search?pretty{    "query": {        "match_all": {}    },    "filter": {        "term": {           "capital": "ä¸œäº¬"        }    }}</code></pre><ul><li>èšåˆ(aggs)</li></ul><pre><code>POST http://127.0.0.1:9200/countries/_search?pretty{  "size": 0,  "aggs": {    "group_by_name": {      "terms": {        "field": "name"      }    }  }}</code></pre><p>æŒ‰<code>name</code>ç»Ÿè®¡åˆ†ç»„æ–‡æ¡£æ•°</p><p>è¾“å‡º:</p><pre><code>{   "took": 1,   "timed_out": false,   "_shards": {      "total": 5,      "successful": 5,      "failed": 0   },   "hits": {      "total": 10,      "max_score": 0,      "hits": []   },   "aggregations": {      "group_by_name": {         "doc_count_error_upper_bound": 0,         "sum_other_doc_count": 0,         "buckets": [            {               "key": "éŸ©å›½",               "doc_count": 3            },            {               "key": "æ–°åŠ å¡",               "doc_count": 2            },            {               "key": "å°åº¦",               "doc_count": 1            },            {               "key": "å¾·å›½",               "doc_count": 1            },            {               "key": "æ—¥æœ¬",               "doc_count": 1            },            {               "key": "æœé²œ",               "doc_count": 1            }         ]      }   }}</code></pre><h3 id="é«˜äº®æŸ¥è¯¢-highlight"><a href="#é«˜äº®æŸ¥è¯¢-highlight" class="headerlink" title="é«˜äº®æŸ¥è¯¢(highlight)"></a>é«˜äº®æŸ¥è¯¢(highlight)</h3><pre><code>POST http://127.0.0.1:9200/news/_search?q=æå…‹å¼º{    "query" : {        match_all:{}    },    "highlight" : {        "pre_tags" : ["&lt;font color='red'&gt;", "&lt;b&gt;", "&lt;em&gt;"],        "post_tags" : ["&lt;/font&gt;", "&lt;b&gt;", "&lt;/em&gt;"],        "fields" : [            {"title" : {}},            {"content" : {                "fragment_size" : 350,                "number_of_fragments" : 3,                "no_match_size": 150            }}        ]    }}</code></pre><pre><code>POST http://127.0.0.1:9200/news/_search?q=æå…‹å¼º{    "query" : {        match_all:{}    },    "highlight" : {        "pre_tags" : ["&lt;font color='red'&gt;&lt;b&gt;&lt;em&gt;"],        "post_tags" : ["&lt;/font&gt;&lt;b&gt;&lt;/em&gt;"],        "fields" : [            {"title" : {}},            {"content" : {                "fragment_size" : 350,                "number_of_fragments" : 3,                "no_match_size": 150            }}        ]    }}</code></pre><h3 id="åˆ é™¤ç´¢å¼•-1"><a href="#åˆ é™¤ç´¢å¼•-1" class="headerlink" title="åˆ é™¤ç´¢å¼•"></a>åˆ é™¤ç´¢å¼•</h3><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-delete-index.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-delete-index.html</a></p><pre><code>DELETE http://127.0.0.1:9200/news</code></pre><h3 id="åˆ›å»ºç´¢å¼•-1"><a href="#åˆ›å»ºç´¢å¼•-1" class="headerlink" title="åˆ›å»ºç´¢å¼•"></a>åˆ›å»ºç´¢å¼•</h3><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-create-index.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-create-index.html</a></p><pre><code>PUT http://127.0.0.1:9200/news</code></pre><h3 id="åˆ›å»ºæˆ–ä¿®æ”¹mapping"><a href="#åˆ›å»ºæˆ–ä¿®æ”¹mapping" class="headerlink" title="åˆ›å»ºæˆ–ä¿®æ”¹mapping"></a>åˆ›å»ºæˆ–ä¿®æ”¹mapping</h3><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-put-mapping.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-put-mapping.html</a></p><pre><code>PUT /{index}/_mapping/{type}</code></pre><pre><code>PUT http://127.0.0.1:9200/news/_mapping/article{  "article": {    "properties": {      "pubdate": {        "type": "date",        "format": "dateOptionalTime"      },      "author": {        "type": "string"      },      "content": {        "type": "string"      },      "id": {        "type": "long"      },      "source": {        "type": "string"      },      "title": {        "type": "string"      },      "url": {        "type": "string"      }    }  }}</code></pre><h3 id="æŸ¥çœ‹mapping"><a href="#æŸ¥çœ‹mapping" class="headerlink" title="æŸ¥çœ‹mapping"></a>æŸ¥çœ‹mapping</h3><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-get-mapping.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-get-mapping.html</a></p><pre><code>GET http://127.0.0.1:9200/_all/_mappingGET http://127.0.0.1:9200/_mapping</code></pre><pre><code>GET http://127.0.0.1:9200/news/_mapping/article</code></pre><p>è¾“å‡º:</p><pre><code>{  "news": {    "mappings": {      "article": {        "properties": {          "author": {            "type": "string"          },          "content": {            "type": "string"          },          "id": {            "type": "long"          },          "pubdate": {            "type": "date",            "store": true,            "format": "yyyy-MM-dd HH:mm:ss"          },          "source": {            "type": "string"          },          "title": {            "type": "string"          },          "url": {            "type": "string"          }        }      }    }  }}</code></pre><h3 id="åˆ é™¤mapping"><a href="#åˆ é™¤mapping" class="headerlink" title="åˆ é™¤mapping"></a>åˆ é™¤mapping</h3><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-delete-mapping.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-delete-mapping.html</a></p><pre><code>[DELETE] /{index}/{type}[DELETE] /{index}/{type}/_mapping[DELETE] /{index}/_mapping/{type}</code></pre><pre><code>DELETE http://127.0.0.1:9200/news/_mapping/article</code></pre><p>æ–‡ç« è½¬è‡ª:<a href="https://github.com/ameizi/elasticsearch-jest-example/blob/master/elasticsearch%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B.md"><strong>elasticsearchå¿«é€Ÿä¸Šæ‰‹.md</strong></a></p>]]></content>
      
      
      <categories>
          
          <category> elasticsearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> elasticsearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8 stream-å®æˆ˜</title>
      <link href="2019/03/06/java8-stream-drill/"/>
      <url>2019/03/06/java8-stream-drill/</url>
      
        <content type="html"><![CDATA[<p>Java8åœ¨æ—¥å¸¸ç¼–ç ä¸­æ„Ÿè§¦æœ€æ·±çš„æ— éå°±æ˜¯steamå’Œlambdaè¡¨è¾¾å¼ä»¥åŠæ–°çš„æ—¶é—´apiï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œé›†åˆå¤„ç†ä¸€ç›´æ˜¯ä¸å¤ªæ–¹ä¾¿ä¸”æ€§èƒ½è¾ƒä½ï¼Œç¬¬äºŒä¸ªæ˜¯æ—¶é—´apiä¸å¥½ç”¨ï¼Œä¸€èˆ¬é…åˆjoda-timeè¿™ä¸ªåº“é…åˆä½¿ç”¨ï¼Œä¸‹é¢ä»‹ç»ä¸€äº›åœ¨Java8ä¸­å¸¸ç”¨çš„streamå¤„ç†</p><h2 id="Listè½¬æ¢æˆMap"><a href="#Listè½¬æ¢æˆMap" class="headerlink" title="Listè½¬æ¢æˆMap"></a>Listè½¬æ¢æˆMap</h2><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**  * toMap å¦‚æœé›†åˆä¸­é‡å¤çš„key å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ Duplicate key...  * apply1ã€apply2çš„IDéƒ½ä¸º1 æ—¢m1,m2çš„IDéƒ½ä¸º1  * å¯ä»¥ç”¨(m1,m2)->m1 æ¥è®¾ç½® å¦‚æœæœ‰é‡å¤çš„key ä¿ç•™m1 èˆå¼ƒm2  */</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Model<span class="token operator">></span> modelMap <span class="token operator">=</span> modelList                <span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span>Model<span class="token operator">:</span><span class="token operator">:</span>getId<span class="token punctuation">,</span> x <span class="token operator">-</span><span class="token operator">></span> x<span class="token punctuation">,</span> <span class="token punctuation">(</span>m1<span class="token punctuation">,</span> m2<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> m1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="groupByä»¥åæ±‚æœ€å¤§å€¼æˆ–è€…æœ€å°å€¼"><a href="#groupByä»¥åæ±‚æœ€å¤§å€¼æˆ–è€…æœ€å°å€¼" class="headerlink" title="groupByä»¥åæ±‚æœ€å¤§å€¼æˆ–è€…æœ€å°å€¼"></a>groupByä»¥åæ±‚æœ€å¤§å€¼æˆ–è€…æœ€å°å€¼</h2><p><a href="http://www.java2s.com/Tutorials/Java_Streams/Example/Group/Get_max_value_in_each_group.htm">http://www.java2s.com/Tutorials/Java_Streams/Example/Group/Get_max_value_in_each_group.htm</a></p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token keyword">class</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>    String hostname<span class="token punctuation">;</span>    String ip<span class="token punctuation">;</span>    <span class="token keyword">int</span> num<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    List<span class="token operator">&lt;</span>Model<span class="token operator">></span> models <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_11"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.0"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_11"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.1"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_11"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.2"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_11"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.3"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_11"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.2"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_12"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.3"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_12"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.6"</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_12"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.7"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_12"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.8"</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_12"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.9"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_13"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.10"</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_13"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.11"</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_13"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.11"</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_13"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.12"</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_13"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.11"</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_13"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.15"</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_16"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.16"</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_16"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.17"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_16"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.18"</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_16"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.19"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_16"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.20"</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_16"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.21"</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    models<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">"vm_11_16"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.22"</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Model<span class="token operator">></span> map <span class="token operator">=</span> models    <span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span>model <span class="token operator">-</span><span class="token operator">></span> model<span class="token punctuation">.</span><span class="token function">getHostname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"_"</span> <span class="token operator">+</span> model<span class="token punctuation">.</span><span class="token function">getIp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    Function<span class="token punctuation">.</span><span class="token function">identity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">(</span>Model d1<span class="token punctuation">,</span> Model d2<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> d1<span class="token punctuation">.</span><span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> d2<span class="token punctuation">.</span><span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> d1 <span class="token operator">:</span> d2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"map:{}"</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="Scalaä¸­ä½¿ç”¨groupæ±‚å‡ºæœ€å¤§å€¼æˆ–è€…æœ€å°å€¼"><a href="#Scalaä¸­ä½¿ç”¨groupæ±‚å‡ºæœ€å¤§å€¼æˆ–è€…æœ€å°å€¼" class="headerlink" title="Scalaä¸­ä½¿ç”¨groupæ±‚å‡ºæœ€å¤§å€¼æˆ–è€…æœ€å°å€¼"></a>Scalaä¸­ä½¿ç”¨groupæ±‚å‡ºæœ€å¤§å€¼æˆ–è€…æœ€å°å€¼</h2><pre class=" language-scala"><code class="language-scala"><span class="token keyword">object</span> CollectionApp <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> log <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>getClass<span class="token punctuation">)</span>    <span class="token keyword">import</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>JavaConverters<span class="token punctuation">.</span>_    <span class="token keyword">val</span> models<span class="token operator">:</span> util<span class="token punctuation">.</span>List<span class="token punctuation">[</span>Model<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> util<span class="token punctuation">.</span>ArrayList<span class="token punctuation">[</span>Model<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_11"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.0"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_11"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.1"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_11"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.2"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_11"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.3"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_11"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.2"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_12"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.3"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_12"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.6"</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_12"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.7"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_12"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.8"</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_12"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.9"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_13"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.10"</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_13"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.11"</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_13"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.11"</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_13"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.12"</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_13"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.11"</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_13"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.15"</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_16"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.16"</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_16"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.17"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_16"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.18"</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_16"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.19"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_16"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.20"</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_16"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.21"</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    models<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Model<span class="token punctuation">(</span><span class="token string">"vm_11_16"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.22"</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> list <span class="token operator">=</span> models<span class="token punctuation">.</span>asScala    <span class="token keyword">val</span> res <span class="token operator">=</span> list<span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span>x <span class="token keyword">=></span> x<span class="token punctuation">.</span>hostname <span class="token operator">+</span> x<span class="token punctuation">.</span>ip<span class="token punctuation">)</span><span class="token punctuation">.</span>map <span class="token punctuation">{</span>      <span class="token keyword">case</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">=></span>        <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">.</span>map<span class="token punctuation">(</span>_<span class="token punctuation">.</span>order<span class="token punctuation">)</span><span class="token punctuation">.</span>min<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span>s<span class="token string">"$res"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">case</span> <span class="token keyword">class</span> Model<span class="token punctuation">(</span>hostname<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> ip<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> order<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span></code></pre><h2 id="æ‰¹å¤„ç†"><a href="#æ‰¹å¤„ç†" class="headerlink" title="æ‰¹å¤„ç†"></a>æ‰¹å¤„ç†</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>iogogog<span class="token punctuation">.</span>util<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>collections4<span class="token punctuation">.</span>CollectionUtils<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>ArrayList<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Collection<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Iterator<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019-03-09. */</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BatchProcess</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span>Collection<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> totalList<span class="token punctuation">,</span> <span class="token keyword">int</span> batchSize<span class="token punctuation">,</span> BatchProcessListener batchProcessListener<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>CollectionUtils<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>totalList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>batchProcessListener <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"æ²¡æœ‰æ‰¹å¤„ç†ç›‘å¬å™¨!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        Iterator<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> iterator <span class="token operator">=</span> totalList<span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        List<span class="token operator">&lt;</span>Object<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            Object next <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> batchSize <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> i <span class="token operator">==</span> <span class="token punctuation">(</span>totalList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// process</span>                batchProcessListener<span class="token punctuation">.</span><span class="token function">onProcess</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"batchSize:{} processSize:{} "</span><span class="token punctuation">,</span> batchSize<span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                list<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            i<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BatchProcessListener</span> <span class="token punctuation">{</span>        <span class="token keyword">void</span> <span class="token function">onProcess</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> list<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java8 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Boot ä½¿ç”¨logbackç®¡ç†æ—¥å¿—</title>
      <link href="2019/03/02/spring-boot-logback/"/>
      <url>2019/03/02/spring-boot-logback/</url>
      
        <content type="html"><![CDATA[<p>Spring Bootåœ¨æ‰€æœ‰å†…éƒ¨æ—¥å¿—ä¸­ä½¿ç”¨<a href="http://commons.apache.org/proper/commons-logging/">Commons Logging</a>ï¼Œä½†æ˜¯é»˜è®¤é…ç½®ä¹Ÿæä¾›äº†å¯¹å¸¸ç”¨æ—¥å¿—çš„æ”¯æŒï¼Œå¦‚ï¼š<a href="http://docs.oracle.com/javase/7/docs/api/java/util/logging/package-summary.html">Java Util Logging</a>ï¼Œ<a href="http://logging.apache.org/log4j/">Log4J</a>, <a href="http://logging.apache.org/log4j/">Log4J2</a>å’Œ<a href="http://logback.qos.ch/">Logback</a>ã€‚æ¯ç§Loggeréƒ½å¯ä»¥é€šè¿‡é…ç½®ä½¿ç”¨æ§åˆ¶å°æˆ–è€…æ–‡ä»¶è¾“å‡ºæ—¥å¿—å†…å®¹ã€‚</p><p>ä¸‹é¢è®°å½•ä¸€ä¸‹spring bootä¸­å¦‚ä½•æŒ‰ç…§æ—¥å¿—ç­‰çº§æ‹†åˆ†ï¼Œè¾“å‡ºåˆ°ä¸åŒæ–‡ä»¶å¹¶åšå½’æ¡£å¤„ç†</p><pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span> <span class="token attr-name">scan</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">scanPeriod</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2000<span class="token punctuation">"</span></span> <span class="token attr-name">debug</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--    scan:    å½“æ­¤å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œé…ç½®æ–‡ä»¶å¦‚æœå‘ç”Ÿæ”¹å˜ï¼Œå°†ä¼šè¢«é‡æ–°åŠ è½½ï¼Œé»˜è®¤å€¼ä¸ºtrueã€‚ï¼ˆè¿™ä¸ªåŠŸèƒ½å¯ä»¥åœ¨ä¸é‡å¯è¿è¡Œç¯å¢ƒä¸‹ï¼Œè°ƒæ•´æ‰“å°æ—¥å¿—çš„ç»†èŠ‚ï¼Œæ–¹ä¾¿å®šä½é—®é¢˜ï¼‰    scanPeriod:    è®¾ç½®ç›‘æµ‹é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰ä¿®æ”¹çš„æ—¶é—´é—´éš”ï¼Œå¦‚æœæ²¡æœ‰ç»™å‡ºæ—¶é—´å•ä½ï¼Œé»˜è®¤å•ä½æ˜¯æ¯«ç§’ã€‚å½“scanä¸ºtrueæ—¶ï¼Œæ­¤å±æ€§ç”Ÿæ•ˆã€‚é»˜è®¤çš„æ—¶é—´é—´éš”ä¸º1åˆ†é’Ÿã€‚    debug:    å½“æ­¤å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œå°†æ‰“å°å‡ºlogbackå†…éƒ¨æ—¥å¿—ä¿¡æ¯ï¼Œå®æ—¶æŸ¥çœ‹logbackè¿è¡ŒçŠ¶æ€ã€‚é»˜è®¤å€¼ä¸ºfalseã€‚    Logger å¯ä»¥è¢«åˆ†é…çº§åˆ«ã€‚çº§åˆ«åŒ…æ‹¬ï¼šTRACEã€DEBUGã€INFOã€WARN å’Œ ERROR    çº§åˆ«æ’åºä¸ºï¼š TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR    --></span>    <span class="token comment" spellcheck="true">&lt;!-- springProperty å¯ä»¥è¯»å–application.propertiesæ–‡ä»¶ä¸­çš„å±æ€§å€¼ï¼Œåªæœ‰å½“logbackæ–‡ä»¶åä¸ºlogback-springæ—¶ï¼Œè¯¥é…ç½®æ‰ä¼šç”Ÿæ•ˆ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProperty</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>context<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app.name<span class="token punctuation">"</span></span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>spring.application.name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProperty</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>context<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>log.home<span class="token punctuation">"</span></span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>logging.home<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment" spellcheck="true">&lt;!-- é…ç½®æ˜¯logbacké»˜è®¤çš„ --></span>    <span class="token comment" spellcheck="true">&lt;!--&lt;property name="log.home" value="${user.dir}/logs"/>--></span>    <span class="token comment" spellcheck="true">&lt;!-- %mè¾“å‡ºçš„ä¿¡æ¯,%pæ—¥å¿—çº§åˆ«,%tçº¿ç¨‹å,%dæ—¥æœŸ,%cç±»çš„å…¨å,%iç´¢å¼•ã€ä»æ•°å­—0å¼€å§‹é€’å¢ã€‘,,, --></span>    <span class="token comment" spellcheck="true">&lt;!-- appenderæ˜¯configurationçš„å­èŠ‚ç‚¹ï¼Œæ˜¯è´Ÿè´£å†™æ—¥å¿—çš„ç»„ä»¶ã€‚ --></span>    <span class="token comment" spellcheck="true">&lt;!-- ConsoleAppenderï¼šæŠŠæ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å° --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>STDOUT<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%date{ISO8601} [%thread] %-5level [${app.name}] [%logger{50}] [%file:%line] - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- æ§åˆ¶å°ä¹Ÿè¦ä½¿ç”¨UTF-8ï¼Œä¸è¦ä½¿ç”¨GBKï¼Œå¦åˆ™ä¼šä¸­æ–‡ä¹±ç  --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- info level --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file_info<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">></span></span>${log.home}/${app.name}.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%date{ISO8601} [%thread] %-5level [${app.name}] [%logger{50}] [%file:%line] - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>INFO<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">></span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">></span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>${log.home}/${app.name}.info.%d{yyyy-MM-dd}.%i.zip<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- å¦‚æœæŒ‰å¤©æ¥å›æ»šï¼Œåˆ™æœ€å¤§ä¿å­˜æ—¶é—´ä¸º10å¤©ï¼Œ10å¤©ä¹‹å‰çš„éƒ½å°†è¢«æ¸…ç†æ‰ --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- æ—¥å¿—æ€»ä¿å­˜é‡ä¸º500MB --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalSizeCap</span><span class="token punctuation">></span></span>500MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalSizeCap</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--æ–‡ä»¶è¾¾åˆ°æœ€å¤§50MBæ—¶ä¼šè¢«å‹ç¼©å’Œåˆ‡å‰² --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span>                    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token comment" spellcheck="true">&lt;!--æ–‡ä»¶è¾¾åˆ° æœ€å¤§50MBæ—¶ä¼šè¢«å‹ç¼©å’Œåˆ‡å‰² --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>50MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--&lt;maxFileSize>50MB&lt;/maxFileSize>--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- debug level --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file_debug<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">></span></span>${log.home}/${app.name}.debug.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%date{ISO8601} [%thread] %-5level [${app.name}] [%logger{50}] [%file:%line] - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>DEBUG<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">></span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">></span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>${log.home}/${app.name}.debug.%d{yyyy-MM-dd}.%i.zip<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- å¦‚æœæŒ‰å¤©æ¥å›æ»šï¼Œåˆ™æœ€å¤§ä¿å­˜æ—¶é—´ä¸º10å¤©ï¼Œ10å¤©ä¹‹å‰çš„éƒ½å°†è¢«æ¸…ç†æ‰ --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- æ—¥å¿—æ€»ä¿å­˜é‡ä¸º500MB --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalSizeCap</span><span class="token punctuation">></span></span>500MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalSizeCap</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--æ–‡ä»¶è¾¾åˆ°æœ€å¤§50MBæ—¶ä¼šè¢«å‹ç¼©å’Œåˆ‡å‰² --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span>                    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token comment" spellcheck="true">&lt;!--æ–‡ä»¶è¾¾åˆ° æœ€å¤§50MBæ—¶ä¼šè¢«å‹ç¼©å’Œåˆ‡å‰² --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>50MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--&lt;maxFileSize>50MB&lt;/maxFileSize>--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- warn level --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file_warn<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">></span></span>${log.home}/${app.name}.warn.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%date{ISO8601} [%thread] %-5level [${app.name}] [%logger{100}] [%file:%line] - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>WARN<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">></span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">></span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>${log.home}/${app.name}.warn.%d{yyyy-MM-dd}.%i.zip<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- å¦‚æœæŒ‰å¤©æ¥å›æ»šï¼Œåˆ™æœ€å¤§ä¿å­˜æ—¶é—´ä¸º10å¤©ï¼Œ10å¤©ä¹‹å‰çš„éƒ½å°†è¢«æ¸…ç†æ‰ --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- æ—¥å¿—æ€»ä¿å­˜é‡ä¸º500MB --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalSizeCap</span><span class="token punctuation">></span></span>500MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalSizeCap</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--æ–‡ä»¶è¾¾åˆ°æœ€å¤§50MBæ—¶ä¼šè¢«å‹ç¼©å’Œåˆ‡å‰² --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span>                    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token comment" spellcheck="true">&lt;!--æ–‡ä»¶è¾¾åˆ° æœ€å¤§50MBæ—¶ä¼šè¢«å‹ç¼©å’Œåˆ‡å‰² --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>50MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--&lt;maxFileSize>50MB&lt;/maxFileSize>--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- error level --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file_error<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">></span></span>${log.home}/${app.name}.error.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%date{ISO8601} [%thread] %-5level [${app.name}] [%logger{100}] [%file:%line] - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>ERROR<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">></span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">></span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>${log.home}/${app.name}.error.%d{yyyy-MM-dd}.%i.zip<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- å¦‚æœæŒ‰å¤©æ¥å›æ»šï¼Œåˆ™æœ€å¤§ä¿å­˜æ—¶é—´ä¸º10å¤©ï¼Œ10å¤©ä¹‹å‰çš„éƒ½å°†è¢«æ¸…ç†æ‰ --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- æ—¥å¿—æ€»ä¿å­˜é‡ä¸º500MB --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalSizeCap</span><span class="token punctuation">></span></span>500MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalSizeCap</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--æ–‡ä»¶è¾¾åˆ°æœ€å¤§50MBæ—¶ä¼šè¢«å‹ç¼©å’Œåˆ‡å‰² --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span>                    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token comment" spellcheck="true">&lt;!--æ–‡ä»¶è¾¾åˆ° æœ€å¤§50MBæ—¶ä¼šè¢«å‹ç¼©å’Œåˆ‡å‰² --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>50MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!--&lt;maxFileSize>50MB&lt;/maxFileSize>--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- level Options: ERROR, WARN, INFO, DEBUG --></span>    <span class="token comment" spellcheck="true">&lt;!--    loggerï¼šæ—¥å¿—æ‰€å¤„çš„åŒ…æˆ–è€…å…·ä½“çš„ç±»    levelï¼šæ—¥å¿—æ‰“å°çº§åˆ«    --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.zaxxer.hikari<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>WARN<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.example.LogbackApplication<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- Options: ERROR, WARN, INFO, DEBUG --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>STDOUT<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file_debug<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file_info<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file_warn<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file_error<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Apache CollectionUtils å¸¸ç”¨æ–¹æ³•æ€»ç»“</title>
      <link href="2019/03/01/apache-common-collection-utils/"/>
      <url>2019/03/01/apache-common-collection-utils/</url>
      
        <content type="html"><![CDATA[<p>CollectionUtilsåœ¨çœŸå®é¡¹ç›®ä¸­ï¼Œæ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„å·¥å…·ç±»ï¼Œä½¿ç”¨éå¸¸é¢‘ç¹ã€‚å®ƒå¯ä»¥ä½¿ä»£ç æ›´åŠ ç®€æ´å’Œå®‰å…¨ã€‚</p><h1 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h1><ul><li>maven</li></ul><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- https://mvnrepository.com/artifact/commons-collections/commons-collections --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>commons-collections<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>commons-collections<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><ul><li>gradle</li></ul><pre class=" language-groovy"><code class="language-groovy"><span class="token comment" spellcheck="true">// https://mvnrepository.com/artifact/commons-collections/commons-collections</span>compile group<span class="token punctuation">:</span> <span class="token string">'commons-collections'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'commons-collections'</span><span class="token punctuation">,</span> version<span class="token punctuation">:</span> <span class="token string">'3.2.1'</span></code></pre><h1 id="å¸¸ç”¨æ–¹æ³•"><a href="#å¸¸ç”¨æ–¹æ³•" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h1><h3 id="éç©ºåˆ¤æ–­"><a href="#éç©ºåˆ¤æ–­" class="headerlink" title="éç©ºåˆ¤æ–­"></a>éç©ºåˆ¤æ–­</h3><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// åˆ¤æ–­é›†åˆæ˜¯å¦ä¸ºç©º:</span>CollectionUtils<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token boolean">true</span>CollectionUtils<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token boolean">true</span>ã€€ã€€CollectionUtils<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token punctuation">,</span>b<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token comment" spellcheck="true">// åˆ¤æ–­é›†åˆæ˜¯å¦ä¸ä¸ºç©º:</span>CollectionUtils<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token boolean">false</span>CollectionUtils<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token boolean">false</span>CollectionUtils<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token punctuation">,</span>b<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token boolean">true</span></code></pre><h3 id="å¹¶é›†ã€äº¤é›†ã€äº¤é›†çš„è¡¥é›†ã€å·®é›†"><a href="#å¹¶é›†ã€äº¤é›†ã€äº¤é›†çš„è¡¥é›†ã€å·®é›†" class="headerlink" title="å¹¶é›†ã€äº¤é›†ã€äº¤é›†çš„è¡¥é›†ã€å·®é›†"></a>å¹¶é›†ã€äº¤é›†ã€äº¤é›†çš„è¡¥é›†ã€å·®é›†</h3><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    List<span class="token operator">&lt;</span>String<span class="token operator">></span> list1 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">,</span> <span class="token string">"e"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    List<span class="token operator">&lt;</span>String<span class="token operator">></span> list2 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"f"</span><span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"e"</span><span class="token punctuation">,</span> <span class="token string">"g"</span><span class="token punctuation">,</span><span class="token string">"z"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å¹¶é›†</span>    Collection union <span class="token operator">=</span> CollectionUtils<span class="token punctuation">.</span><span class="token function">union</span><span class="token punctuation">(</span>list1<span class="token punctuation">,</span> list2<span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"union:{}"</span><span class="token punctuation">,</span> union<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// äº¤é›†</span>    Collection intersection <span class="token operator">=</span> CollectionUtils<span class="token punctuation">.</span><span class="token function">intersection</span><span class="token punctuation">(</span>list1<span class="token punctuation">,</span> list2<span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"intersection:{}"</span><span class="token punctuation">,</span> intersection<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// äº¤é›†çš„è¡¥é›†ï¼ˆæå–ï¼‰</span>    Collection disjunction <span class="token operator">=</span> CollectionUtils<span class="token punctuation">.</span><span class="token function">disjunction</span><span class="token punctuation">(</span>list1<span class="token punctuation">,</span> list2<span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"disjunction:{}"</span><span class="token punctuation">,</span> disjunction<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å·®é›†ï¼ˆæ‰£é™¤ï¼‰list1æ‰£é™¤list2</span>    Collection subtract <span class="token operator">=</span> CollectionUtils<span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span>list1<span class="token punctuation">,</span> list2<span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"subtract:{}"</span><span class="token punctuation">,</span> subtract<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ç»“æœ</span>union<span class="token operator">:</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> C<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">,</span> z<span class="token punctuation">]</span>intersection<span class="token operator">:</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span> e<span class="token punctuation">]</span>disjunction<span class="token operator">:</span><span class="token punctuation">[</span>b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> C<span class="token punctuation">,</span> d<span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">,</span> z<span class="token punctuation">]</span>subtract<span class="token operator">:</span><span class="token punctuation">[</span>b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">]</span></code></pre><h3 id="åˆ¤æ–­ç›¸ç­‰"><a href="#åˆ¤æ–­ç›¸ç­‰" class="headerlink" title="åˆ¤æ–­ç›¸ç­‰"></a>åˆ¤æ–­ç›¸ç­‰</h3><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testEqual</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    List<span class="token operator">&lt;</span>String<span class="token operator">></span> list1 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">,</span> <span class="token string">"e"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    List<span class="token operator">&lt;</span>String<span class="token operator">></span> list2 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"f"</span><span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"e"</span><span class="token punctuation">,</span> <span class="token string">"g"</span><span class="token punctuation">,</span> <span class="token string">"z"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// æ¯”è¾ƒå€¼ false</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"isEqualCollection:{}"</span><span class="token punctuation">,</span> CollectionUtils<span class="token punctuation">.</span><span class="token function">isEqualCollection</span><span class="token punctuation">(</span>list1<span class="token punctuation">,</span> list2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> list3 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> list4 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// æ¯”è¾ƒå€¼ true</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"isEqualCollection:{}"</span><span class="token punctuation">,</span> CollectionUtils<span class="token punctuation">.</span><span class="token function">isEqualCollection</span><span class="token punctuation">(</span>list3<span class="token punctuation">,</span> list4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Data</span>    <span class="token annotation punctuation">@NoArgsConstructor</span>    <span class="token annotation punctuation">@AllArgsConstructor</span>    <span class="token annotation punctuation">@EqualsAndHashCode</span><span class="token punctuation">(</span>callSuper <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token keyword">class</span> <span class="token class-name">Boy</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>    String name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    List<span class="token operator">&lt;</span>Person<span class="token operator">></span> boy1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    boy1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Boy</span><span class="token punctuation">(</span><span class="token string">"é˜¿ç‰›"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    List<span class="token operator">&lt;</span>Person<span class="token operator">></span> boy2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    boy2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Boy</span><span class="token punctuation">(</span><span class="token string">"é˜¿ç‰›"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// æ¯”è¾ƒé›†åˆä¸­ä¸åŒå¯¹è±¡ false</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"isEqualCollection:{}"</span><span class="token punctuation">,</span> CollectionUtils<span class="token punctuation">.</span><span class="token function">isEqualCollection</span><span class="token punctuation">(</span>boy1<span class="token punctuation">,</span> boy2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Boy boy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Boy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    List<span class="token operator">&lt;</span>Boy<span class="token operator">></span> boy3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    boy3<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>boy<span class="token punctuation">)</span><span class="token punctuation">;</span>    List<span class="token operator">&lt;</span>Boy<span class="token operator">></span> boy4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    boy4<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>boy<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// æ¯”è¾ƒé›†åˆä¸­ç›¸åŒå¯¹è±¡ true</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"isEqualCollection:{}"</span><span class="token punctuation">,</span> CollectionUtils<span class="token punctuation">.</span><span class="token function">isEqualCollection</span><span class="token punctuation">(</span>boy3<span class="token punctuation">,</span> boy4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="ä¸å¯å˜é›†åˆ"><a href="#ä¸å¯å˜é›†åˆ" class="headerlink" title="ä¸å¯å˜é›†åˆ"></a>ä¸å¯å˜é›†åˆ</h3><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUnmodifiable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    Collection<span class="token operator">&lt;</span>String<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// æŠ“æ¢ä¸ºä¸å¯å˜é›†åˆï¼Œæ·»åŠ æ•°æ®ä¼šæŠ¥é”™</span>    Collection<span class="token operator">&lt;</span>String<span class="token operator">></span> collection <span class="token operator">=</span> CollectionUtils<span class="token punctuation">.</span><span class="token function">unmodifiableCollection</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>    collection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    collection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    collection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"collection:{}"</span><span class="token punctuation">,</span> collection<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// Collections.unmodifiableCollectionå¯ä»¥å¾—åˆ°ä¸€ä¸ªé›†åˆçš„é•œåƒï¼Œå®ƒçš„è¿”å›ç»“æœæ˜¯ä¸å¯ç›´æ¥è¢«æ”¹å˜ï¼Œå¦åˆ™ä¼šæç¤ºé”™è¯¯</span>java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>UnsupportedOperationExceptionat org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>collections<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>UnmodifiableCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>UnmodifiableCollection<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">75</span><span class="token punctuation">)</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Comparableå’ŒComparatorçš„åŒºåˆ«</title>
      <link href="2019/02/17/chinese-sort/"/>
      <url>2019/02/17/chinese-sort/</url>
      
        <content type="html"><![CDATA[<h2 id="Comparable"><a href="#Comparable" class="headerlink" title="Comparable"></a><strong>Comparable</strong></h2><p>Comparableå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ª<strong>å†…æ¯”è¾ƒå™¨</strong>ï¼Œå®ç°äº†Comparableæ¥å£çš„ç±»æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯è¿™äº›ç±»æ˜¯å¯ä»¥å’Œè‡ªå·±æ¯”è¾ƒçš„ï¼Œè‡³äºå…·ä½“å’Œå¦ä¸€ä¸ªå®ç°äº†Comparableæ¥å£çš„ç±»å¦‚ä½•æ¯”è¾ƒï¼Œåˆ™ä¾èµ–compareToæ–¹æ³•çš„å®ç°ï¼ŒcompareToæ–¹æ³•ä¹Ÿè¢«ç§°ä¸º<strong>è‡ªç„¶æ¯”è¾ƒæ–¹æ³•</strong>ã€‚å¦‚æœå¼€å‘è€…addè¿›å…¥ä¸€ä¸ªCollectionçš„å¯¹è±¡æƒ³è¦Collectionsçš„sortæ–¹æ³•å¸®ä½ è‡ªåŠ¨è¿›è¡Œæ’åºçš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å¿…é¡»å®ç°Comparableæ¥å£ã€‚compareToæ–¹æ³•çš„è¿”å›å€¼æ˜¯intï¼Œæœ‰ä¸‰ç§æƒ…å†µï¼š</p><p>1ã€æ¯”è¾ƒè€…å¤§äºè¢«æ¯”è¾ƒè€…ï¼ˆä¹Ÿå°±æ˜¯compareToæ–¹æ³•é‡Œé¢çš„å¯¹è±¡ï¼‰ï¼Œé‚£ä¹ˆè¿”å›æ­£æ•´æ•°</p><p>2ã€æ¯”è¾ƒè€…ç­‰äºè¢«æ¯”è¾ƒè€…ï¼Œé‚£ä¹ˆè¿”å›0</p><p>3ã€æ¯”è¾ƒè€…å°äºè¢«æ¯”è¾ƒè€…ï¼Œé‚£ä¹ˆè¿”å›è´Ÿæ•´æ•°</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Domain</span> <span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token operator">&lt;</span>Domain<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String str<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">Domain</span><span class="token punctuation">(</span>String str<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>str <span class="token operator">=</span> str<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span>Domain domain<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>str<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>domain<span class="token punctuation">.</span>str<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>str<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>domain<span class="token punctuation">.</span>str<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">else</span>            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">getStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> str<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Domain d1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Domain</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Domain d2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Domain</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Domain d3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Domain</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Domain d4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Domain</span><span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>d1<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>d2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>d1<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>d3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>d1<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>d4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// è¾“å‡ºç»“æœ</span><span class="token number">0</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span></code></pre><h2 id="Comparator"><a href="#Comparator" class="headerlink" title="Comparator"></a>Comparator</h2><p>Comparatorå¯ä»¥è®¤ä¸ºæ˜¯æ˜¯ä¸€ä¸ª<strong>å¤–æ¯”è¾ƒå™¨</strong>ï¼Œä¸ªäººè®¤ä¸ºæœ‰ä¸¤ç§æƒ…å†µå¯ä»¥ä½¿ç”¨å®ç°Comparatoræ¥å£çš„æ–¹å¼ï¼š</p><p>1ã€ä¸€ä¸ªå¯¹è±¡ä¸æ”¯æŒè‡ªå·±å’Œè‡ªå·±æ¯”è¾ƒï¼ˆæ²¡æœ‰å®ç°Comparableæ¥å£ï¼‰ï¼Œä½†æ˜¯åˆæƒ³å¯¹ä¸¤ä¸ªå¯¹è±¡è¿›è¡Œæ¯”è¾ƒ</p><p>2ã€ä¸€ä¸ªå¯¹è±¡å®ç°äº†Comparableæ¥å£ï¼Œä½†æ˜¯å¼€å‘è€…è®¤ä¸ºcompareToæ–¹æ³•ä¸­çš„æ¯”è¾ƒæ–¹å¼å¹¶ä¸æ˜¯è‡ªå·±æƒ³è¦çš„é‚£ç§æ¯”è¾ƒæ–¹å¼</p><p>Comparatoræ¥å£é‡Œé¢æœ‰ä¸€ä¸ªcompareæ–¹æ³•ï¼Œæ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°T o1å’ŒT o2ï¼Œæ˜¯æ³›å‹çš„è¡¨ç¤ºæ–¹å¼ï¼Œåˆ†åˆ«è¡¨ç¤ºå¾…æ¯”è¾ƒçš„ä¸¤ä¸ªå¯¹è±¡ï¼Œæ–¹æ³•è¿”å›å€¼å’ŒComparableæ¥å£ä¸€æ ·æ˜¯intï¼Œæœ‰ä¸‰ç§æƒ…å†µï¼š</p><p>1ã€o1å¤§äºo2ï¼Œè¿”å›æ­£æ•´æ•°</p><p>2ã€o1ç­‰äºo2ï¼Œè¿”å›0</p><p>3ã€o1å°äºo3ï¼Œè¿”å›è´Ÿæ•´æ•°</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DomainComparator</span> <span class="token keyword">implements</span> <span class="token class-name">Comparator</span><span class="token operator">&lt;</span>Domain<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span>Domain domain1<span class="token punctuation">,</span> Domain domain2<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>domain1<span class="token punctuation">.</span><span class="token function">getStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>domain2<span class="token punctuation">.</span><span class="token function">getStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>domain1<span class="token punctuation">.</span><span class="token function">getStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>domain2<span class="token punctuation">.</span><span class="token function">getStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">else</span>            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Domain d1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Domain</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Domain d2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Domain</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Domain d3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Domain</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Domain d4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Domain</span><span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    DomainComparator dc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DomainComparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dc<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> d2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dc<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> d3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dc<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> d4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// è¾“å‡ºç»“æœ</span><span class="token number">0</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span></code></pre><p>å› ä¸ºæ³›å‹æŒ‡å®šæ­»äº†ï¼Œæ‰€ä»¥å®ç°Comparatoræ¥å£çš„å®ç°ç±»åªèƒ½æ˜¯ä¸¤ä¸ªç›¸åŒçš„å¯¹è±¡ï¼ˆä¸èƒ½ä¸€ä¸ªDomainã€ä¸€ä¸ªStringï¼‰è¿›è¡Œæ¯”è¾ƒäº†ï¼Œå› æ­¤å®ç°Comparatoræ¥å£çš„å®ç°ç±»ä¸€èˆ¬éƒ½ä¼šä»¥â€å¾…æ¯”è¾ƒçš„å®ä½“ç±»+Comparatorâ€æ¥å‘½å</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>1ã€å¦‚æœå®ç°ç±»æ²¡æœ‰å®ç°Comparableæ¥å£ï¼Œåˆæƒ³å¯¹ä¸¤ä¸ªç±»è¿›è¡Œæ¯”è¾ƒï¼ˆæˆ–è€…å®ç°ç±»å®ç°äº†Comparableæ¥å£ï¼Œä½†æ˜¯å¯¹compareToæ–¹æ³•å†…çš„æ¯”è¾ƒç®—æ³•ä¸æ»¡æ„ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥å®ç°Comparatoræ¥å£ï¼Œè‡ªå®šä¹‰ä¸€ä¸ªæ¯”è¾ƒå™¨ï¼Œå†™æ¯”è¾ƒç®—æ³•</p><p>2ã€å®ç°Comparableæ¥å£çš„æ–¹å¼æ¯”å®ç°Comparatoræ¥å£çš„è€¦åˆæ€§ è¦å¼ºä¸€äº›ï¼Œå¦‚æœè¦ä¿®æ”¹æ¯”è¾ƒç®—æ³•ï¼Œè¦ä¿®æ”¹Comparableæ¥å£çš„å®ç°ç±»ï¼Œè€Œå®ç°Comparatorçš„ç±»æ˜¯åœ¨å¤–éƒ¨è¿›è¡Œæ¯”è¾ƒçš„ï¼Œä¸éœ€è¦å¯¹å®ç°ç±»æœ‰ä»»ä½•ä¿® æ”¹ã€‚ä»è¿™ä¸ªè§’åº¦è¯´ï¼Œå…¶å®æœ‰äº›ä¸å¤ªå¥½ï¼Œå°¤å…¶åœ¨æˆ‘ä»¬å°†å®ç°ç±»çš„.classæ–‡ä»¶æ‰“æˆä¸€ä¸ª.jaræ–‡ä»¶æä¾›ç»™å¼€å‘è€…ä½¿ç”¨çš„æ—¶å€™ã€‚å®é™…ä¸Šå®ç°Comparator æ¥å£çš„æ–¹å¼åé¢ä¼šå†™åˆ°å°±æ˜¯ä¸€ç§å…¸å‹çš„<strong>ç­–ç•¥æ¨¡å¼</strong>ã€‚</p><h2 id="ä¸­æ–‡å®ç°æ’åº"><a href="#ä¸­æ–‡å®ç°æ’åº" class="headerlink" title="ä¸­æ–‡å®ç°æ’åº"></a>ä¸­æ–‡å®ç°æ’åº</h2><h4 id="treeMap-æ–¹å¼"><a href="#treeMap-æ–¹å¼" class="headerlink" title="treeMap æ–¹å¼"></a>treeMap æ–¹å¼</h4><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@org</span><span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    CollatorComparator comparator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CollatorComparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    TreeMap<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> sortMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>comparator<span class="token punctuation">)</span><span class="token punctuation">;</span>    sortMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"å¹¿å·"</span><span class="token punctuation">,</span> <span class="token string">"500"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    sortMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"å®‰å¾½"</span><span class="token punctuation">,</span> <span class="token string">"100000000000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    sortMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"ä¸­å±±"</span><span class="token punctuation">,</span> <span class="token string">"9000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    sortMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"æ½®å·"</span><span class="token punctuation">,</span> <span class="token string">"8000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//æ³¨æ„ï¼šæ¯æ¬¡å¯¹TreeMapè¿›è¡Œput()æ—¶ï¼ŒTreeMapéƒ½ä¼šè‡ªåŠ¨è°ƒç”¨å®ƒçš„compare(key,Entry.key)</span>    <span class="token comment" spellcheck="true">//æŒ‰ç…§keyè¿›è¡Œæ’åº</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sortMap<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">CollatorComparator</span> <span class="token keyword">implements</span> <span class="token class-name">Comparator</span><span class="token operator">&lt;</span>Object<span class="token operator">></span> <span class="token punctuation">{</span>    Collator collator <span class="token operator">=</span> Collator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span>Object element1<span class="token punctuation">,</span> Object element2<span class="token punctuation">)</span> <span class="token punctuation">{</span>        CollationKey key1 <span class="token operator">=</span> collator<span class="token punctuation">.</span><span class="token function">getCollationKey</span><span class="token punctuation">(</span>element1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        CollationKey key2 <span class="token operator">=</span> collator<span class="token punctuation">.</span><span class="token function">getCollationKey</span><span class="token punctuation">(</span>element2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> key1<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>key2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="Comparator-æ–¹å¼"><a href="#Comparator-æ–¹å¼" class="headerlink" title="Comparator æ–¹å¼"></a>Comparator æ–¹å¼</h4><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@org</span><span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    Comparator<span class="token operator">&lt;</span>Object<span class="token operator">></span> com <span class="token operator">=</span> Collator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Locale<span class="token punctuation">.</span>CHINA<span class="token punctuation">)</span><span class="token punctuation">;</span>    String<span class="token punctuation">[</span><span class="token punctuation">]</span> newArray <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"ä¸­å±±"</span><span class="token punctuation">,</span> <span class="token string">"æ±•å¤´"</span><span class="token punctuation">,</span> <span class="token string">"å¹¿å·"</span><span class="token punctuation">,</span> <span class="token string">"$"</span><span class="token punctuation">,</span> <span class="token string">"å®‰åº†"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"é˜³æ±Ÿ"</span><span class="token punctuation">,</span> <span class="token string">"z"</span><span class="token punctuation">,</span> <span class="token string">"å—äº¬"</span><span class="token punctuation">,</span> <span class="token string">"æ­¦æ±‰"</span><span class="token punctuation">,</span> <span class="token string">"åŒ—äº¬"</span><span class="token punctuation">,</span> <span class="token string">"å®‰é˜³"</span><span class="token punctuation">,</span> <span class="token string">"åŒ—æ–¹"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    List<span class="token operator">&lt;</span>String<span class="token operator">></span> list <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>newArray<span class="token punctuation">)</span><span class="token punctuation">;</span>    list<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>com<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>String i <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8 æ–°ç‰¹æ€§-Optionalç±»</title>
      <link href="2019/02/13/java8-optional/"/>
      <url>2019/02/13/java8-optional/</url>
      
        <content type="html"><![CDATA[<p>åœ¨Streamæµå¼æ•°æ®å¤„ç†çš„æ–‡ç« ä¸­æåˆ°äº†<code>Optional</code>ç±»ï¼Œè¿™æ˜¯Java 8æ–°å¢çš„ä¸€ä¸ªç±»ï¼Œç”¨ä»¥è§£å†³ç¨‹åºä¸­å¸¸è§çš„<code>NullPointerException</code>å¼‚å¸¸é—®é¢˜ã€‚æœ¬ç¯‡æ–‡ç« å°†è¯¦ç»†ä»‹ç»<code>Optional</code>ç±»ï¼Œä»¥åŠå¦‚ä½•ç”¨å®ƒæ¶ˆé™¤ä»£ç ä¸­çš„<code>null</code>æ£€æŸ¥ã€‚</p><h2 id="é¿å…ä½¿ç”¨nullæ£€æŸ¥"><a href="#é¿å…ä½¿ç”¨nullæ£€æŸ¥" class="headerlink" title="é¿å…ä½¿ç”¨nullæ£€æŸ¥"></a>é¿å…ä½¿ç”¨<code>null</code>æ£€æŸ¥</h2><p>ä½œä¸ºJavaå¼€å‘äººå‘˜ï¼Œå‡ ä¹æ‰€æœ‰äººéƒ½é‡åˆ°è¿‡<code>NullPointerException</code>å¼‚å¸¸ï¼Œå¤§å¤šæ•°äººé‡åˆ°<code>NullPointerException</code>å¼‚å¸¸æ—¶éƒ½ä¼šåœ¨å¼‚å¸¸å‡ºç°çš„åœ°æ–¹åŠ ä¸Š<code>if</code>ä»£ç å—æ¥åˆ¤æ–­å€¼ä¸ä¸ºç©ºï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bindUserToRole</span><span class="token punctuation">(</span>User user<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>        String roleId <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getRoleId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>roleId <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            Role role <span class="token operator">=</span> roleDao<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>roleId<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>role <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>                role<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                roleDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¿™æ˜¯æ¯”è¾ƒæ™®éçš„åšæ³•ï¼Œä¸ºäº†é¿å…å‡ºç°<code>NullPointerException</code>å¼‚å¸¸ï¼Œæ‰‹åŠ¨å¯¹å¯èƒ½ä¸º<code>null</code>å€¼è¿›è¡Œäº†å¤„ç†ï¼Œä¸è¿‡ä»£ç çœ‹èµ·æ¥éå¸¸ç³Ÿç³•ï¼Œä¸šåŠ¡é€»è¾‘è¢«æ·¹æ²¡åœ¨<code>if</code>é€»è¾‘åˆ¤æ–­ä¸­ï¼Œä¹Ÿè®¸ä¸‹é¢çš„ä»£ç çœ‹èµ·æ¥å¯è¯»æ€§ç¨å¥½ä¸€äº›ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> String <span class="token function">bindUserToRole</span><span class="token punctuation">(</span>User user<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    String roleId <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getRoleId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>roleId <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    Role <span class="token operator">=</span> roleDao<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>roleId<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>role <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>        role<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        roleDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ä¸Šé¢çš„ä»£ç é¿å…äº†æ·±å±‚çš„<code>if</code>è¯­å¥åµŒå¥—ï¼Œä½†æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œæ–¹æ³•å†…æœ‰ä¸‰ä¸ªä¸åŒçš„è¿”å›ç‚¹ï¼Œå‡ºé”™åè°ƒè¯•ä¹Ÿä¸å®¹æ˜“ï¼Œå› ä¸ºä½ ä¸çŸ¥é“æ˜¯é‚£ä¸ªå€¼å¯¼è‡´äº†<code>NullPointerException</code>å¼‚å¸¸ã€‚</p><p>åŸºäºä¸Šé¢çš„åŸå› ï¼ŒJava 8ä¸­å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ç±»<code>Optional</code>ï¼Œç”¨ä»¥é¿å…ä½¿ç”¨<code>null</code>å€¼å¼•å‘çš„ç§ç§é—®é¢˜ã€‚</p><h2 id="Optionalç±»"><a href="#Optionalç±»" class="headerlink" title="Optionalç±»"></a><code>Optional</code>ç±»</h2><p><code>java.util.Optional&lt;T&gt;</code>ç±»æ˜¯ä¸€ä¸ªå°è£…äº†<code>Optional</code>å€¼çš„å®¹å™¨å¯¹è±¡ï¼Œ<code>Optional</code>å€¼å¯ä»¥ä¸º<code>null</code>ï¼Œå¦‚æœå€¼å­˜åœ¨ï¼Œè°ƒç”¨<code>isPresent()</code>æ–¹æ³•è¿”å›<code>true</code>ï¼Œè°ƒç”¨<code>get()</code>æ–¹æ³•å¯ä»¥è·å–å€¼ã€‚</p><h3 id="åˆ›å»ºOptionalå¯¹è±¡"><a href="#åˆ›å»ºOptionalå¯¹è±¡" class="headerlink" title="åˆ›å»ºOptionalå¯¹è±¡"></a>åˆ›å»º<code>Optional</code>å¯¹è±¡</h3><p><code>Optional</code>ç±»æä¾›ç±»ä¸‰ä¸ªæ–¹æ³•ç”¨äºå®ä¾‹åŒ–ä¸€ä¸ª<code>Optional</code>å¯¹è±¡ï¼Œå®ƒä»¬åˆ†åˆ«ä¸º<code>empty()</code>ã€<code>of()</code>ã€<code>ofNullable()</code>ï¼Œè¿™ä¸‰ä¸ªæ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ã€‚</p><hr><p><code>empty()</code>æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªæ²¡æœ‰å€¼çš„<code>Optional</code>å¯¹è±¡ï¼š</p><pre class=" language-java"><code class="language-java">Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> emptyOpt <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>empty()</code>æ–¹æ³•åˆ›å»ºçš„å¯¹è±¡æ²¡æœ‰å€¼ï¼Œå¦‚æœå¯¹<code>emptyOpt</code>å˜é‡è°ƒç”¨<code>isPresent()</code>æ–¹æ³•ä¼šè¿”å›<code>false</code>ï¼Œè°ƒç”¨<code>get()</code>æ–¹æ³•æŠ›å‡º<code>NullPointerException</code>å¼‚å¸¸ã€‚</p><hr><p><code>of()</code>æ–¹æ³•ä½¿ç”¨ä¸€ä¸ªéç©ºçš„å€¼åˆ›å»º<code>Optional</code>å¯¹è±¡ï¼š</p><pre class=" language-java"><code class="language-java">String str <span class="token operator">=</span> <span class="token string">"Hello World"</span><span class="token punctuation">;</span>Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> notNullOpt <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><hr><p><code>ofNullable()</code>æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå¯ä»¥ä¸º<code>null</code>çš„å€¼ï¼š</p><pre class=" language-java"><code class="language-java">Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> nullableOpt <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å¦‚æœ<code>str</code>çš„å€¼ä¸º<code>null</code>ï¼Œå¾—åˆ°çš„<code>nullableOpt</code>æ˜¯ä¸€ä¸ªæ²¡æœ‰å€¼çš„<code>Optional</code>å¯¹è±¡ã€‚</p><h3 id="æå–Optionalå¯¹è±¡ä¸­çš„å€¼"><a href="#æå–Optionalå¯¹è±¡ä¸­çš„å€¼" class="headerlink" title="æå–Optionalå¯¹è±¡ä¸­çš„å€¼"></a>æå–<code>Optional</code>å¯¹è±¡ä¸­çš„å€¼</h3><p>å¦‚æœæˆ‘ä»¬è¦è·å–<code>User</code>å¯¹è±¡ä¸­çš„<code>roleId</code>å±æ€§å€¼ï¼Œå¸¸è§çš„æ–¹å¼æ˜¯ç›´æ¥è·å–ï¼š</p><pre class=" language-java"><code class="language-java">String roleId <span class="token operator">=</span> null<span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    roleId <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getRoleId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ä½¿ç”¨<code>Optional</code>ä¸­æä¾›çš„<code>map()</code>æ–¹æ³•å¯ä»¥ä»¥æ›´ç®€å•çš„æ–¹å¼å®ç°ï¼š</p><pre class=" language-java"><code class="language-java">Optional<span class="token operator">&lt;</span>User<span class="token operator">></span> userOpt <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> roleIdOpt <span class="token operator">=</span> userOpt<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getRoleId<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="ä½¿ç”¨orElse-æ–¹æ³•è·å–å€¼"><a href="#ä½¿ç”¨orElse-æ–¹æ³•è·å–å€¼" class="headerlink" title="ä½¿ç”¨orElse()æ–¹æ³•è·å–å€¼"></a>ä½¿ç”¨<code>orElse()</code>æ–¹æ³•è·å–å€¼</h3><p><code>Optional</code>ç±»è¿˜åŒ…å«å…¶ä»–æ–¹æ³•ç”¨äºè·å–å€¼ï¼Œè¿™äº›æ–¹æ³•åˆ†åˆ«ä¸ºï¼š</p><ul><li><code>orElse()</code>ï¼šå¦‚æœæœ‰å€¼å°±è¿”å›ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªç»™å®šçš„å€¼ä½œä¸ºé»˜è®¤å€¼ï¼›</li><li><code>orElseGet()</code>ï¼šä¸<code>orElse()</code>æ–¹æ³•ä½œç”¨ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºç”Ÿæˆé»˜è®¤å€¼çš„æ–¹å¼ä¸åŒã€‚è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª<code>Supplier&lt;? extends T&gt;</code>å‡½æ•°å¼æ¥å£å‚æ•°ï¼Œç”¨äºç”Ÿæˆé»˜è®¤å€¼ï¼›</li><li><code>orElseThrow()</code>ï¼šä¸å‰é¢ä»‹ç»çš„<code>get()</code>æ–¹æ³•ç±»ä¼¼ï¼Œå½“å€¼ä¸º<code>null</code>æ—¶è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šæŠ›å‡º<code>NullPointerException</code>å¼‚å¸¸ï¼ŒåŒºåˆ«åœ¨äºè¯¥æ–¹æ³•å¯ä»¥æŒ‡å®šæŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ã€‚</li></ul><p>ä¸‹é¢æ¥çœ‹çœ‹è¿™ä¸‰ä¸ªæ–¹æ³•çš„å…·ä½“ç”¨æ³•ï¼š</p><pre class=" language-java"><code class="language-java">String str <span class="token operator">=</span> <span class="token string">"Hello World"</span><span class="token punctuation">;</span>Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> strOpt <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>String orElseResult <span class="token operator">=</span> strOpt<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">"Hello Shanghai"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>String orElseGet <span class="token operator">=</span> strOpt<span class="token punctuation">.</span><span class="token function">orElseGet</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"Hello Shanghai"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>String orElseThrow <span class="token operator">=</span> strOpt<span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span>        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Argument 'str' cannot be null or blank."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ­¤å¤–ï¼Œ<code>Optional</code>ç±»è¿˜æä¾›äº†ä¸€ä¸ª<code>ifPresent()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ª<code>Consumer&lt;? super T&gt;</code>å‡½æ•°å¼æ¥å£ï¼Œä¸€èˆ¬ç”¨äºå°†ä¿¡æ¯æ‰“å°åˆ°æ§åˆ¶å°ï¼š</p><pre class=" language-java"><code class="language-java">Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> strOpt <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>strOpt<span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="ä½¿ç”¨filter-æ–¹æ³•è¿‡æ»¤"><a href="#ä½¿ç”¨filter-æ–¹æ³•è¿‡æ»¤" class="headerlink" title="ä½¿ç”¨filter()æ–¹æ³•è¿‡æ»¤"></a>ä½¿ç”¨<code>filter()</code>æ–¹æ³•è¿‡æ»¤</h3><p><code>filter()</code>æ–¹æ³•å¯ç”¨äºåˆ¤æ–­<code>Optional</code>å¯¹è±¡æ˜¯å¦æ»¡è¶³ç»™å®šæ¡ä»¶ï¼Œä¸€èˆ¬ç”¨äºæ¡ä»¶è¿‡æ»¤ï¼š</p><pre class=" language-java"><code class="language-java">Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> optional <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"lw900925@163.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>optional <span class="token operator">=</span> optional<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>str <span class="token operator">-</span><span class="token operator">></span> str<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"164"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå¦‚æœ<code>filter()</code>æ–¹æ³•ä¸­çš„Lambdaè¡¨è¾¾å¼æˆç«‹ï¼Œ<code>filter()</code>æ–¹æ³•ä¼šè¿”å›å½“å‰<code>Optional</code>å¯¹è±¡å€¼ï¼Œå¦åˆ™ï¼Œè¿”å›ä¸€ä¸ªå€¼ä¸ºç©ºçš„<code>Optional</code>å¯¹è±¡ã€‚</p><h2 id="å¦‚ä½•æ­£ç¡®ä½¿ç”¨Optional"><a href="#å¦‚ä½•æ­£ç¡®ä½¿ç”¨Optional" class="headerlink" title="å¦‚ä½•æ­£ç¡®ä½¿ç”¨Optional"></a>å¦‚ä½•æ­£ç¡®ä½¿ç”¨<code>Optional</code></h2><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œ<code>Optional</code>ç±»å¯ä»¥ä¼˜é›…çš„é¿å…<code>NullPointerException</code>å¸¦æ¥çš„å„ç§é—®é¢˜ï¼Œä¸è¿‡ï¼Œä½ æ˜¯å¦çœŸæ­£æŒæ¡äº†<code>Optional</code>çš„ç”¨æ³•ï¼Ÿå‡è®¾ä½ è¯•å›¾ä½¿ç”¨<code>Optional</code>æ¥é¿å…å¯èƒ½å‡ºç°çš„<code>NullPointerException</code>å¼‚å¸¸ï¼Œç¼–å†™äº†å¦‚ä¸‹ä»£ç ï¼š</p><pre class=" language-java"><code class="language-java">Optional<span class="token operator">&lt;</span>User<span class="token operator">></span> userOpt <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>userOpt<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    User user <span class="token operator">=</span> userOpt<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// do something...</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// do something...</span><span class="token punctuation">}</span></code></pre><p>å¦ç™½è¯´ï¼Œä¸Šé¢çš„ä»£ç ä¸æˆ‘ä»¬ä¹‹å‰çš„ä½¿ç”¨<code>if</code>è¯­å¥åˆ¤æ–­ç©ºå€¼æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œæ²¡æœ‰èµ·åˆ°<code>Optional</code>çš„æ­£çœŸä½œç”¨ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// do something...</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// do something...</span><span class="token punctuation">}</span></code></pre><p>å½“æˆ‘ä»¬ä»ä¹‹å‰ç‰ˆæœ¬åˆ‡æ¢åˆ°Java 8çš„æ—¶å€™ï¼Œä¸åº”è¯¥è¿˜æŒ‰ç…§ä¹‹å‰çš„æ€ç»´æ–¹å¼å¤„ç†<code>null</code>å€¼ï¼ŒJava 8æå€¡å‡½æ•°å¼ç¼–ç¨‹ï¼Œæ–°å¢çš„è®¸å¤šAPIéƒ½å¯ä»¥ç”¨å‡½æ•°å¼ç¼–ç¨‹è¡¨ç¤ºï¼Œ<code>Optional</code>ç±»ä¹Ÿæ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚è¿™é‡Œæœ‰å‡ æ¡å…³äº<code>Optional</code>ä½¿ç”¨çš„å»ºè®®ï¼š</p><ol><li>å°½é‡é¿å…åœ¨ç¨‹åºä¸­ç›´æ¥è°ƒç”¨<code>Optional</code>å¯¹è±¡çš„<code>get()</code>å’Œ<code>isPresent()</code>æ–¹æ³•ï¼›</li><li>é¿å…ä½¿ç”¨<code>Optional</code>ç±»å‹å£°æ˜å®ä½“ç±»çš„å±æ€§ï¼›</li></ol><p>ç¬¬ä¸€æ¡å»ºè®®ä¸­ç›´æ¥è°ƒç”¨<code>get()</code>æ–¹æ³•æ˜¯å¾ˆå±é™©çš„åšæ³•ï¼Œå¦‚æœ<code>Optional</code>çš„å€¼ä¸ºç©ºï¼Œé‚£ä¹ˆæ¯«æ— ç–‘é—®ä¼šæŠ›å‡º<code>NullPointerException</code>å¼‚å¸¸ï¼Œè€Œä¸ºäº†è°ƒç”¨<code>get()</code>æ–¹æ³•è€Œä½¿ç”¨<code>isPresent()</code>æ–¹æ³•ä½œä¸ºç©ºå€¼æ£€æŸ¥ï¼Œè¿™ç§åšæ³•ä¸ä¼ ç»Ÿçš„ç”¨<code>if</code>è¯­å¥å—åšç©ºå€¼æ£€æŸ¥æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚</p><p>ç¬¬äºŒæ¡å»ºè®®é¿å…ä½¿ç”¨<code>Optional</code>ä½œä¸ºå®ä½“ç±»çš„å±æ€§ï¼Œå®ƒåœ¨è®¾è®¡çš„æ—¶å€™å°±æ²¡æœ‰è€ƒè™‘è¿‡ç”¨æ¥ä½œä¸ºç±»çš„å±æ€§ï¼Œå¦‚æœä½ æŸ¥çœ‹<code>Optional</code>çš„æºä»£ç ï¼Œä½ ä¼šå‘ç°å®ƒæ²¡æœ‰å®ç°<code>java.io.Serializable</code>æ¥å£ï¼Œè¿™åœ¨æŸäº›æƒ…å†µä¸‹æ˜¯å¾ˆé‡è¦çš„ï¼ˆæ¯”å¦‚ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨äº†æŸäº›åºåˆ—åŒ–æ¡†æ¶ï¼‰ï¼Œä½¿ç”¨äº†<code>Optional</code>ä½œä¸ºå®ä½“ç±»çš„å±æ€§ï¼Œæ„å‘³ç€ä»–ä»¬ä¸èƒ½è¢«åºåˆ—åŒ–ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€äº›ä¾‹å­è®²è§£<code>Optional</code>çš„æ­£ç¡®ç”¨æ³•ï¼š</p><h3 id="æ­£ç¡®åˆ›å»ºOptionalå¯¹è±¡"><a href="#æ­£ç¡®åˆ›å»ºOptionalå¯¹è±¡" class="headerlink" title="æ­£ç¡®åˆ›å»ºOptionalå¯¹è±¡"></a>æ­£ç¡®åˆ›å»º<code>Optional</code>å¯¹è±¡</h3><p>ä¸Šé¢æåˆ°åˆ›å»º<code>Optional</code>å¯¹è±¡æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼Œ<code>empty()</code>æ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«è¦è¯´æ˜çš„ã€‚ä¸»è¦æ˜¯<code>of()</code>å’Œ<code>ofNullable()</code>æ–¹æ³•ã€‚å½“ä½ å¾ˆç¡®å®šä¸€ä¸ªå¯¹è±¡ä¸å¯èƒ½ä¸º<code>null</code>çš„æ—¶å€™ï¼Œåº”è¯¥ä½¿ç”¨<code>of()</code>æ–¹æ³•ï¼Œå¦åˆ™ï¼Œå°½å¯èƒ½ä½¿ç”¨<code>ofNullable()</code>æ–¹æ³•ï¼Œæ¯”å¦‚ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span>Role role<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// å½“Optionalçš„å€¼é€šè¿‡å¸¸é‡è·å¾—æˆ–è€…é€šè¿‡å…³é”®å­—newåˆå§‹åŒ–ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨of()æ–¹æ³•</span>    Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> strOpt <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Optional<span class="token operator">&lt;</span>User<span class="token operator">></span> userOpt <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// æ–¹æ³•å‚æ•°ä¸­roleå€¼ä¸ç¡®å®šæ˜¯å¦ä¸ºnullï¼Œä½¿ç”¨ofNullable()æ–¹æ³•åˆ›å»º</span>    Optional<span class="token operator">&lt;</span>Role<span class="token operator">></span> roleOpt <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="orElse-æ–¹æ³•çš„ä½¿ç”¨"><a href="#orElse-æ–¹æ³•çš„ä½¿ç”¨" class="headerlink" title="orElse()æ–¹æ³•çš„ä½¿ç”¨"></a><code>orElse()</code>æ–¹æ³•çš„ä½¿ç”¨</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">return</span> str <span class="token operator">!=</span> null <span class="token operator">?</span> str <span class="token operator">:</span> <span class="token string">"Hello World"</span></code></pre><p>ä¸Šé¢çš„ä»£ç è¡¨ç¤ºåˆ¤æ–­å­—ç¬¦ä¸²<code>str</code>æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºå°±è¿”å›ï¼Œå¦åˆ™ï¼Œè¿”å›ä¸€ä¸ªå¸¸é‡ã€‚ä½¿ç”¨<code>Optional</code>ç±»å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">return</span> strOpt<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span></code></pre><h3 id="ç®€åŒ–if-else"><a href="#ç®€åŒ–if-else" class="headerlink" title="ç®€åŒ–if-else"></a>ç®€åŒ–<code>if-else</code></h3><pre class=" language-java"><code class="language-java">User user <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    String userName <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>userName <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> userName<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> null<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ä¸Šé¢çš„ä»£ç å¯ä»¥ç®€åŒ–æˆï¼š</p><pre class=" language-java"><code class="language-java">User user <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>Optional<span class="token operator">&lt;</span>User<span class="token operator">></span> userOpt <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getUserName<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>String<span class="token operator">:</span><span class="token operator">:</span>toUpperCase<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ€»ç»“ä¸€ä¸‹ï¼Œæ–°çš„<code>Optional</code>ç±»è®©æˆ‘ä»¬å¯ä»¥ä»¥å‡½æ•°å¼ç¼–ç¨‹çš„æ–¹å¼å¤„ç†<code>null</code>å€¼ï¼ŒæŠ›å¼ƒäº†Java 8ä¹‹å‰éœ€è¦åµŒå¥—å¤§é‡<code>if-else</code>ä»£ç å—ï¼Œä½¿ä»£ç å¯è¯»æ€§æœ‰äº†å¾ˆå¤§çš„æé«˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java8 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8 æ–°ç‰¹æ€§-lambdaè¡¨è¾¾å¼</title>
      <link href="2019/02/13/java8-lambda-expression/"/>
      <url>2019/02/13/java8-lambda-expression/</url>
      
        <content type="html"><![CDATA[<p>2014å¹´3æœˆå‘å¸ƒçš„Java 8ï¼Œæœ‰å¯èƒ½æ˜¯Javaç‰ˆæœ¬æ›´æ–°ä¸­å˜åŒ–æœ€å¤§çš„ä¸€æ¬¡ã€‚æ–°çš„Java 8ä¸ºå¼€å‘è€…å¸¦æ¥äº†è®¸å¤šé‡é‡çº§çš„æ–°ç‰¹æ€§ï¼ŒåŒ…æ‹¬Lambdaè¡¨è¾¾å¼ï¼Œæµå¼æ•°æ®å¤„ç†ï¼Œæ–°çš„<code>Optional</code>ç±»ï¼Œæ–°çš„æ—¥æœŸå’Œæ—¶é—´APIç­‰ã€‚è¿™äº›æ–°ç‰¹æ€§ç»™Javaå¼€å‘è€…å¸¦æ¥äº†ç¦éŸ³ï¼Œç‰¹åˆ«æ˜¯Lambdaè¡¨è¾¾å¼çš„æ”¯æŒï¼Œä½¿ç¨‹åºè®¾è®¡æ›´åŠ ç®€åŒ–ã€‚æœ¬ç¯‡æ–‡ç« å°†è®¨è®ºè¡Œä¸ºå‚æ•°åŒ–ï¼ŒLambdaè¡¨è¾¾å¼ï¼Œå‡½æ•°å¼æ¥å£ç­‰ç‰¹æ€§ã€‚</p><h2 id="è¡Œä¸ºå‚æ•°åŒ–"><a href="#è¡Œä¸ºå‚æ•°åŒ–" class="headerlink" title="è¡Œä¸ºå‚æ•°åŒ–"></a>è¡Œä¸ºå‚æ•°åŒ–</h2><p>åœ¨è½¯ä»¶å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå¼€å‘äººå‘˜å¯èƒ½ä¼šé‡åˆ°é¢‘ç¹çš„éœ€æ±‚å˜æ›´ï¼Œä½¿ä»–ä»¬ä¸æ–­åœ°ä¿®æ”¹ç¨‹åºä»¥åº”å¯¹è¿™äº›å˜åŒ–çš„éœ€æ±‚ï¼Œå¯¼è‡´é¡¹ç›®è¿›åº¦ç¼“æ…¢ç”šè‡³é¡¹ç›®å»¶æœŸã€‚è¡Œä¸ºå‚æ•°åŒ–å°±æ˜¯ä¸€ç§å¯ä»¥å¸®åŠ©ä½ åº”å¯¹é¢‘ç¹éœ€æ±‚å˜æ›´çš„å¼€å‘æ¨¡å¼ï¼Œç®€å•çš„è¯´ï¼Œå°±æ˜¯é¢„å…ˆå®šä¹‰ä¸€ä¸ªä»£ç å—è€Œä¸å»æ‰§è¡Œå®ƒï¼ŒæŠŠå®ƒå½“åšå‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™æ ·ï¼Œè¿™ä¸ªæ–¹æ³•çš„è¡Œä¸ºå°±è¢«è¿™æ®µä»£ç å—å‚æ•°åŒ–äº†ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è®²è§£è¡Œä¸ºå‚æ•°åŒ–çš„ä½¿ç”¨ã€‚å‡è®¾æˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ªå›¾ä¹¦ç®¡ç†ç³»ç»Ÿï¼Œéœ€æ±‚æ˜¯è¦å¯¹å›¾ä¹¦çš„ä½œè€…è¿›è¡Œè¿‡æ»¤ï¼Œç­›é€‰å‡ºæŒ‡å®šä½œè€…çš„ä¹¦ç±ã€‚æ¯”è¾ƒå¸¸è§çš„åšæ³•å°±æ˜¯ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼ŒæŠŠä½œè€…å½“æˆæ–¹æ³•çš„å‚æ•°ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> List<span class="token operator">&lt;</span>Book<span class="token operator">></span> <span class="token function">filterByAuthor</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>Book<span class="token operator">></span> books<span class="token punctuation">,</span> String author<span class="token punctuation">)</span> <span class="token punctuation">{</span>    List<span class="token operator">&lt;</span>Book<span class="token operator">></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>Book book <span class="token operator">:</span> books<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>author<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span><span class="token function">getAuthor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> result<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ç°åœ¨å®¢æˆ·éœ€è¦å˜æ›´éœ€æ±‚ï¼Œæ·»åŠ è¿‡æ»¤æ¡ä»¶ï¼ŒæŒ‰ç…§å‡ºç‰ˆç¤¾è¿‡æ»¤ï¼Œäºæ˜¯æˆ‘ä»¬ä¸å¾—ä¸å†æ¬¡ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> List<span class="token operator">&lt;</span>Book<span class="token operator">></span> <span class="token function">filterByPublisher</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>Book<span class="token operator">></span> books<span class="token punctuation">,</span> String publisher<span class="token punctuation">)</span> <span class="token punctuation">{</span>    List<span class="token operator">&lt;</span>Book<span class="token operator">></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>Book book <span class="token operator">:</span> books<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>publisher<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span><span class="token function">getPublisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> result<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ä¸¤ä¸ªæ–¹æ³•é™¤äº†åç§°ä¹‹å¤–ï¼Œå†…éƒ¨çš„å®ç°é€»è¾‘å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯<code>if</code>åˆ¤æ–­æ¡ä»¶ï¼Œå‰è€…åˆ¤æ–­çš„æ˜¯ä½œè€…ï¼Œåè€…åˆ¤æ–­çš„æ˜¯å‡ºç‰ˆç¤¾ã€‚å¦‚æœç°åœ¨å®¢æˆ·åˆè¦å¢åŠ éœ€æ±‚ï¼Œéœ€è¦æŒ‰ç…§å›¾ä¹¦çš„å”®ä»·è¿‡æ»¤ï¼Œæ˜¯ä¸æ˜¯éœ€è¦å†æ¬¡å°†ä¸Šé¢çš„æ–¹æ³•å¤åˆ¶ä¸€éï¼Œå°†<code>if</code>åˆ¤æ–­æ¡ä»¶æ”¹ä¸ºå”®ä»·ï¼Ÿ No! è¿™ç§åšæ³•è¿èƒŒäº†DRYï¼ˆDonâ€™t Repeat Yourselfï¼Œä¸è¦é‡å¤è‡ªå·±ï¼‰åŸåˆ™ï¼Œè€Œä¸”ä¸åˆ©äºåæœŸç»´æŠ¤ï¼Œå¦‚æœéœ€è¦æ”¹å˜æ–¹æ³•å†…éƒ¨éå†æ–¹å¼æ¥æé«˜æ€§èƒ½ï¼Œæ„å‘³ç€æ¯ä¸ª<code>filterByXxx()</code>æ–¹æ³•éƒ½éœ€è¦ä¿®æ”¹ï¼Œå·¥ä½œé‡å¤ªå¤§ã€‚</p><p>ä¸€ç§å¯è¡Œçš„åŠæ³•æ˜¯å¯¹è¿‡æ»¤çš„æ¡ä»¶åšæ›´é«˜å±‚çš„æŠ½è±¡ï¼Œè¿‡æ»¤çš„æ¡ä»¶æ— éå°±æ˜¯å›¾ä¹¦çš„æŸäº›å±æ€§ï¼ˆæ¯”å¦‚ä»·æ ¼ã€å‡ºç‰ˆç¤¾ã€å‡ºç‰ˆæ—¥æœŸã€ä½œè€…ç­‰ï¼‰ï¼Œå¯ä»¥å£°æ˜ä¸€ä¸ªæ¥å£ç”¨äºå¯¹è¿‡æ»¤æ¡ä»¶å»ºæ¨¡ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BookPredicate</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span>Book book<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p><code>BookPredicate</code>æ¥å£åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•<code>test()</code>ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª<code>Book</code>ç±»å‹å‚æ•°ï¼Œè¿”å›ä¸€ä¸ª<code>boolean</code>å€¼ï¼Œå¯ä»¥ç”¨å®ƒæ¥è¡¨ç¤ºå›¾ä¹¦çš„ä¸åŒè¿‡æ»¤æ¡ä»¶ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹ä¹‹å‰çš„è¿‡æ»¤æ–¹æ³•è¿›è¡Œé‡æ„ï¼Œå°†<code>filterByXxx()</code>æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æ¢æˆä¸Šé¢å®šä¹‰çš„æ¥å£ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> List<span class="token operator">&lt;</span>Book<span class="token operator">></span> <span class="token function">filter</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>Book<span class="token operator">></span> books<span class="token punctuation">,</span> BookPredicate bookPredicate<span class="token punctuation">)</span> <span class="token punctuation">{</span>    List<span class="token operator">&lt;</span>Book<span class="token operator">></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>Book book <span class="token operator">:</span> books<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>bookPredicate<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> result<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å°†è¿‡æ»¤çš„æ¡ä»¶æ¢æˆ<code>BookPredicate</code>çš„å®ç°ç±»ï¼Œè¿™é‡Œé‡‡ç”¨äº†å†…éƒ¨ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// æ ¹æ®ä½œè€…è¿‡æ»¤</span><span class="token keyword">final</span> String author <span class="token operator">=</span> <span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">;</span>List<span class="token operator">&lt;</span>Book<span class="token operator">></span> result <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>books<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BookPredicate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span>Book book<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> author<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span><span class="token function">getAuthor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ ¹æ®å›¾ä¹¦ä»·æ ¼è¿‡æ»¤</span><span class="token keyword">final</span> <span class="token keyword">double</span> price <span class="token operator">=</span> <span class="token number">100.00D</span><span class="token punctuation">;</span>List<span class="token operator">&lt;</span>Book<span class="token operator">></span> result <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>books<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BookPredicate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span>Book book<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> price <span class="token operator">></span> book<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>é‡æ„å‰åæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿæˆ‘ä»¬å°†æ–¹æ³•ä¸­çš„<code>if</code>åˆ¤æ–­æ¡ä»¶æ¢æˆäº†<code>BookPredicate</code>æ¥å£å®šä¹‰çš„<code>test()</code>æ–¹æ³•ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦æ»¡è¶³è¿‡æ»¤æ¡ä»¶ï¼Œå°†å›¾ä¹¦è¿‡æ»¤çš„é€»è¾‘äº¤ç»™äº†<code>BookPredicate</code>æ¥å£çš„å®ç°ç±»ï¼Œè€Œä¸æ˜¯åœ¨<code>filter()</code>æ–¹æ³•å†…éƒ¨å®ç°è¿‡æ»¤ï¼Œè€Œ<code>BookPredicate</code>æ¥å£åˆæ˜¯<code>filter()</code>æ–¹æ³•çš„å‚æ•°ã€‚ä»¥ä¸Šçš„æ­¥éª¤ï¼Œå°±æ˜¯å°†è¡Œä¸ºå‚æ•°åŒ–ï¼Œä¹Ÿå°±æ˜¯å°†å›¾ä¹¦è¿‡æ»¤çš„è¡Œä¸ºï¼ˆ<code>BookPredicate</code>æ¥å£çš„å®ç°ç±»ï¼‰å½“åš<code>filter()</code>æ–¹æ³•çš„å‚æ•°ã€‚ç°åœ¨ï¼Œå¯ä»¥åˆ æ‰æ‰€æœ‰<code>filterByXxx()</code>çš„æ–¹æ³•ï¼Œåªä¿ç•™<code>filter()</code>æ–¹æ³•ï¼Œå°±ç®—åæœŸæ•°æ®è§„æ¨¡å¾ˆåºå¤§ï¼Œéœ€è¦æ”¹å˜é›†åˆçš„éå†æ–¹å¼æ¥æé«˜æ€§èƒ½ï¼Œåªéœ€è¦åœ¨<code>filter()</code>æ–¹æ³•å†…éƒ¨åšå‡ºç›¸åº”çš„ä¿®æ”¹ï¼Œè€Œä¸ç”¨å»ä¿®æ”¹å…¶ä»–ä¸šåŠ¡ä»£ç ã€‚</p><p>ä¸è¿‡ï¼Œ<code>BookPredicate</code>æ¥å£åªæ˜¯é’ˆå¯¹å›¾ä¹¦çš„è¿‡æ»¤ï¼Œå¦‚æœéœ€è¦å¯¹å…¶ä»–å¯¹è±¡é›†åˆæ’åºï¼ˆå¦‚ï¼šç”¨æˆ·ï¼‰ï¼Œåˆå¾—é‡æ–°ç”³æ˜ä¸€ä¸ªæ¥å£ã€‚æœ‰ä¸€ä¸ªåŠæ³•å°±æ˜¯å¯ä»¥ç”¨Javaçš„æ³›å‹å¯¹å®ƒåšè¿›ä¸€æ­¥çš„æŠ½è±¡ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Predicate</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ç°åœ¨ä½ å¯ä»¥æŠŠ<code>filter()</code>æ–¹æ³•ç”¨åœ¨ä»»ä½•å¯¹è±¡çš„è¿‡æ»¤ä¸­ã€‚</p><h2 id="Lambdaè¡¨è¾¾å¼"><a href="#Lambdaè¡¨è¾¾å¼" class="headerlink" title="Lambdaè¡¨è¾¾å¼"></a>Lambdaè¡¨è¾¾å¼</h2><p>è™½ç„¶æˆ‘ä»¬å¯¹<code>filter()</code>æ–¹æ³•è¿›è¡Œé‡æ„ï¼Œå¹¶æŠ½è±¡äº†<code>Predicate</code>æ¥å£ä½œä¸ºè¿‡æ»¤çš„æ¡ä»¶ï¼Œä½†å®é™…ä¸Šè¿˜éœ€è¦ç¼–å†™å¾ˆå¤šå†…éƒ¨ç±»æ¥å®ç°<code>Predicate</code>æ¥å£ã€‚ä½¿ç”¨å†…éƒ¨ç±»çš„æ–¹å¼å®ç°<code>Predicate</code>æ¥å£æœ‰å¾ˆå¤šç¼ºç‚¹ï¼šé¦–å…ˆæ˜¯ä»£ç æ˜¾å¾—è‡ƒè‚¿ä¸å ªï¼Œå¯è¯»æ€§å·®ï¼›å…¶æ¬¡ï¼Œå¦‚æœæŸä¸ªå±€éƒ¨å˜é‡è¢«å†…éƒ¨ç±»ä½¿ç”¨ï¼Œè¿™ä¸ªå˜é‡å¿…é¡»ä½¿ç”¨<code>final</code>å…³é”®å­—ä¿®é¥°ã€‚åœ¨Java 8ä¸­ï¼Œä½¿ç”¨Lambdaè¡¨è¾¾å¼å¯ä»¥å¯¹å†…éƒ¨ç±»è¿›ä¸€æ­¥ç®€åŒ–ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// æ ¹æ®ä½œè€…è¿‡æ»¤</span>List<span class="token operator">&lt;</span>Book<span class="token operator">></span> result <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>books<span class="token punctuation">,</span> book <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span><span class="token function">getAuthor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ ¹æ®å›¾ä¹¦ä»·æ ¼è¿‡æ»¤</span>List<span class="token operator">&lt;</span>Book<span class="token operator">></span> result <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>books<span class="token punctuation">,</span> book <span class="token operator">-</span><span class="token operator">></span> <span class="token number">100</span> <span class="token operator">></span> book<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä½¿ç”¨Lambdaä»…ä»…ç”¨ä¸€è¡Œä»£ç å°±å¯¹å†…éƒ¨ç±»è¿›è¡Œäº†è½¬åŒ–ï¼Œè€Œä¸”ä»£ç å˜å¾—æ›´åŠ æ¸…æ™°å¯è¯»ã€‚å…¶ä¸­<code>book -&gt; "å¼ ä¸‰".equals(book.getAuthor())</code>å’Œ<code>book -&gt; 100 &gt; book.getPrice()</code>å°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦ç ”ç©¶çš„Lambdaè¡¨è¾¾å¼ã€‚</p><h3 id="Lambdaè¡¨è¾¾å¼æ˜¯ä»€ä¹ˆ"><a href="#Lambdaè¡¨è¾¾å¼æ˜¯ä»€ä¹ˆ" class="headerlink" title="Lambdaè¡¨è¾¾å¼æ˜¯ä»€ä¹ˆ"></a>Lambdaè¡¨è¾¾å¼æ˜¯ä»€ä¹ˆ</h3><p>Lambdaè¡¨è¾¾å¼ï¼ˆlambda expressionï¼‰æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œç”±æ•°å­¦ä¸­çš„Î»æ¼”ç®—è€Œå¾—åã€‚åœ¨Java 8ä¸­å¯ä»¥æŠŠLambdaè¡¨è¾¾å¼ç†è§£ä¸ºåŒ¿åå‡½æ•°ï¼Œå®ƒæ²¡æœ‰åç§°ï¼Œä½†æ˜¯æœ‰å‚æ•°åˆ—è¡¨ã€å‡½æ•°ä¸»ä½“ã€è¿”å›ç±»å‹ç­‰ã€‚</p><p>Lambdaè¡¨è¾¾å¼çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token punctuation">(</span>parameters<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span> statements<span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Lambdaè¡¨è¾¾å¼ï¼Ÿå‰é¢ä½ ä¹Ÿçœ‹åˆ°äº†ï¼Œåœ¨Javaä¸­ä½¿ç”¨å†…éƒ¨ç±»æ˜¾å¾—ååˆ†å†—é•¿ï¼Œè¦ç¼–å†™å¾ˆå¤šæ ·æ¿ä»£ç ï¼ŒLambdaè¡¨è¾¾å¼æ­£æ˜¯ä¸ºäº†ç®€åŒ–è¿™äº›æ­¥éª¤å‡ºç°çš„ï¼Œå®ƒä½¿ä»£ç å˜å¾—æ¸…æ™°æ˜“æ‡‚ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨Lambdaè¡¨è¾¾å¼"><a href="#å¦‚ä½•ä½¿ç”¨Lambdaè¡¨è¾¾å¼" class="headerlink" title="å¦‚ä½•ä½¿ç”¨Lambdaè¡¨è¾¾å¼"></a>å¦‚ä½•ä½¿ç”¨Lambdaè¡¨è¾¾å¼</h3><p>Lambdaè¡¨è¾¾å¼æ˜¯ä¸ºäº†ç®€åŒ–å†…éƒ¨ç±»çš„ï¼Œä½ å¯ä»¥æŠŠå®ƒå½“æˆæ˜¯å†…éƒ¨ç±»çš„ä¸€ç§ç®€å†™æ–¹å¼ï¼Œåªè¦æ˜¯æœ‰å†…éƒ¨ç±»çš„ä»£ç å—ï¼Œéƒ½å¯ä»¥è½¬åŒ–æˆLambdaè¡¨è¾¾å¼ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// Comparatoræ’åº</span>List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> list <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>list<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Comparator</span><span class="token operator">&lt;</span>Integer<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span>Integer o1<span class="token punctuation">,</span> Integer o2<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> o1<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>o2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ä½¿ç”¨Lambdaè¡¨è¾¾å¼ç®€åŒ–</span>list<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>o1<span class="token punctuation">,</span> o2<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> o1<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>o2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Runnableä»£ç å—</span>Thread thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello Man!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ä½¿ç”¨Lambdaè¡¨è¾¾å¼ç®€åŒ–</span>Thread thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello Man!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å¯ä»¥çœ‹å‡ºï¼Œåªè¦æ˜¯å†…éƒ¨ç±»çš„ä»£ç å—ï¼Œå°±å¯ä»¥ä½¿ç”¨Lambdaè¡¨è¾¾å¼ç®€åŒ–ï¼Œå¹¶ä¸”ç®€åŒ–åçš„ä»£ç æ¸…æ™°æ˜“æ‡‚ã€‚ç”šè‡³ï¼Œ<code>Comparator</code>æ’åºçš„Lambdaè¡¨è¾¾å¼è¿˜å¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–ï¼š</p><pre class=" language-java"><code class="language-java">list<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>Integer<span class="token operator">:</span><span class="token operator">:</span>compareTo<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è¿™ç§å†™æ³•è¢«ç§°ä¸º <strong>æ–¹æ³•å¼•ç”¨</strong>ï¼Œæ–¹æ³•å¼•ç”¨æ˜¯Lambdaè¡¨è¾¾å¼çš„ç®€ä¾¿å†™æ³•ã€‚å¦‚æœä½ çš„Lambdaè¡¨è¾¾å¼åªæ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæœ€å¥½ä½¿ç”¨åç§°è°ƒç”¨ï¼Œè€Œä¸æ˜¯æè¿°å¦‚ä½•è°ƒç”¨ï¼Œè¿™æ ·å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€‚</p><p>æ–¹æ³•å¼•ç”¨ä½¿ç”¨<code>::</code>åˆ†éš”ç¬¦ï¼Œåˆ†éš”ç¬¦çš„å‰åŠéƒ¨åˆ†è¡¨ç¤ºå¼•ç”¨ç±»å‹ï¼Œåé¢åŠéƒ¨åˆ†è¡¨ç¤ºå¼•ç”¨çš„æ–¹æ³•åç§°ã€‚ä¾‹å¦‚ï¼š<code>Integer::compareTo</code>è¡¨ç¤ºå¼•ç”¨ç±»å‹ä¸º<code>Integer</code>ï¼Œå¼•ç”¨åç§°ä¸º<code>compareTo</code>çš„æ–¹æ³•ã€‚</p><p>ç±»ä¼¼ä½¿ç”¨æ–¹æ³•å¼•ç”¨çš„ä¾‹å­è¿˜æœ‰æ‰“å°é›†åˆä¸­çš„å…ƒç´ åˆ°æ§åˆ¶å°ä¸­ï¼š</p><pre class=" language-java"><code class="language-java">list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="å‡½æ•°å¼æ¥å£"><a href="#å‡½æ•°å¼æ¥å£" class="headerlink" title="å‡½æ•°å¼æ¥å£"></a>å‡½æ•°å¼æ¥å£</h2><p>å¦‚æœä½ çš„å¥½å¥‡å¿ƒä½¿ä½ ç¿»çœ‹<code>Runnable</code>æ¥å£æºä»£ç ï¼Œä½ ä¼šå‘ç°è¯¥æ¥å£è¢«ä¸€ä¸ª<code>@FunctionalInterface</code>çš„æ³¨è§£ä¿®é¥°ï¼Œè¿™æ˜¯Java 8ä¸­æ·»åŠ çš„æ–°æ³¨è§£ï¼Œç”¨äºè¡¨ç¤º <strong>å‡½æ•°å¼æ¥å£</strong>ã€‚</p><p>å‡½æ•°å¼æ¥å£åˆæ˜¯ä»€ä¹ˆé¬¼ï¼Ÿåœ¨Java 8ä¸­ï¼ŒæŠŠé‚£äº›ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ç§°ä¸ºå‡½æ•°å¼æ¥å£ã€‚å¦‚æœä¸€ä¸ªæ¥å£è¢«<code>@FunctionalInterface</code>æ³¨è§£æ ‡æ³¨ï¼Œè¡¨ç¤ºè¿™ä¸ªæ¥å£è¢«è®¾è®¡æˆå‡½æ•°å¼æ¥å£ï¼Œåªèƒ½æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå¦‚æœä½ æ·»åŠ å¤šä¸ªæŠ½è±¡æ–¹æ³•ï¼Œç¼–è¯‘æ—¶ä¼šæç¤ºâ€œMultiple non-overriding abstract methods found in interface XXXâ€ä¹‹ç±»çš„é”™è¯¯ã€‚</p><p>å‡½æ•°å¼æ–¹æ³•åˆèƒ½åšä»€ä¹ˆï¼ŸJava8å…è®¸ä½ ä»¥Lambdaè¡¨è¾¾å¼çš„æ–¹å¼ä¸ºå‡½æ•°å¼æ¥å£æä¾›å®ç°ï¼Œé€šä¿—çš„è¯´ï¼Œä½ å¯ä»¥å°†æ•´ä¸ªLambdaè¡¨è¾¾å¼ä½œä¸ºæ¥å£çš„å®ç°ç±»ã€‚</p><p>é™¤äº†<code>Runnable</code>ä¹‹å¤–ï¼ŒJava 8ä¸­å†…ç½®äº†è®¸å¤šå‡½æ•°å¼æ¥å£ä¾›å¼€å‘è€…ä½¿ç”¨ï¼Œè¿™äº›æ¥å£ä½äº<code>java.util.function</code>åŒ…ä¸­ï¼Œæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„<code>Predicate</code>æ¥å£ï¼Œå·²ç»è¢«åŒ…å«åœ¨è¿™ä¸ªåŒ…å†…ï¼Œä»–ä»¬åˆ†åˆ«ä¸º<code>Predicate</code>ã€<code>Consumer</code>å’Œ<code>Function</code>ï¼Œç”±äºæˆ‘ä»¬å·²ç»åœ¨ä¹‹å‰çš„å›¾ä¹¦è¿‡æ»¤çš„ä¾‹å­ä¸­ä»‹ç»äº†<code>Predicate</code>çš„ç”¨æ³•ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥ä¸»è¦ä»‹ç»<code>Consumer</code>å’Œ<code>Function</code>çš„ç”¨æ³•ã€‚</p><h3 id="Consumer"><a href="#Consumer" class="headerlink" title="Consumer"></a><code>Consumer</code></h3><p><code>java.util.function.Consumer&lt;T&gt;</code>å®šä¹‰äº†ä¸€ä¸ªåå«<code>accept()</code>çš„æŠ½è±¡æ–¹æ³•ï¼Œå®ƒæ¥å—æ³›å‹<code>T</code>çš„å¯¹è±¡ï¼Œæ²¡æœ‰è¿”å›ï¼ˆ<code>void</code>ï¼‰ã€‚å¦‚æœä½ éœ€è¦è®¿é—®ç±»å‹<code>T</code>çš„å¯¹è±¡ï¼Œå¹¶å¯¹å…¶æ‰§è¡ŒæŸäº›æ“ä½œï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¥å£ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ª<code>forEach()</code>æ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ªé›†åˆï¼Œå¹¶å¯¹é›†åˆä¸­æ¯ä¸ªå…ƒç´ æ‰§è¡Œæ“ä½œï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@FunctionalInterface</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Consumer</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token keyword">void</span> <span class="token function">forEach</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>T<span class="token operator">></span> list<span class="token punctuation">,</span> Consumer<span class="token operator">&lt;</span>T<span class="token operator">></span> consumer<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>T t<span class="token operator">:</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>        consumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    List<span class="token operator">&lt;</span>String<span class="token operator">></span> list <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"D"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">forEach</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> str <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// ä¹Ÿå¯ä»¥å†™æˆ</span>    <span class="token function">forEach</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="Function"><a href="#Function" class="headerlink" title="Function"></a><code>Function</code></h3><p><code>java.util.function.Function&lt;T, R&gt;</code>æ¥å£å®šä¹‰äº†ä¸€ä¸ªå«ä½œ<code>apply()</code>çš„æ–¹æ³•ï¼Œå®ƒæ¥å—ä¸€ä¸ªæ³›å‹<code>T</code>çš„å¯¹è±¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ³›å‹<code>R</code>çš„å¯¹è±¡ã€‚å¦‚æœä½ éœ€è¦å®šä¹‰ä¸€ä¸ªLambdaï¼Œå°†è¾“å…¥å¯¹è±¡çš„ä¿¡æ¯æ˜ å°„åˆ°è¾“å‡ºï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¥å£ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—ä¸€ä¸ªå›¾ä¹¦é›†åˆä¸­æ¯æœ¬ä¹¦çš„ä½œè€…åç§°æœ‰å‡ ä¸ªæ±‰å­—ï¼ˆå‡è®¾è¿™äº›ä¹¦çš„ä½œè€…éƒ½æ˜¯ä¸­å›½äººï¼‰ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@FunctionalInterface</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Function</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> R<span class="token operator">></span> <span class="token punctuation">{</span>    R <span class="token function">apply</span><span class="token punctuation">(</span>T t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>T<span class="token punctuation">,</span> R<span class="token operator">></span> List<span class="token operator">&lt;</span>R<span class="token operator">></span> <span class="token function">map</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>T<span class="token operator">></span> list<span class="token punctuation">,</span> Function<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> R<span class="token operator">></span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>    List<span class="token operator">&lt;</span>R<span class="token operator">></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>T s<span class="token operator">:</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>        result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> result<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    List<span class="token operator">&lt;</span>Book<span class="token operator">></span> books <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>        <span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">,</span> <span class="token number">99.00D</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token string">"æå››"</span><span class="token punctuation">,</span> <span class="token number">59.00D</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token string">"ç‹è€äº”"</span><span class="token punctuation">,</span> <span class="token number">59.00D</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> results <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>books<span class="token punctuation">,</span> book <span class="token operator">-</span><span class="token operator">></span> book<span class="token punctuation">.</span><span class="token function">getAuthor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ç°åœ¨ï¼Œåº”è¯¥å¯¹Lambdaè¡¨è¾¾å¼æœ‰ä¸€ä¸ªåˆæ­¥çš„äº†è§£äº†ï¼Œå¹¶ä¸”ï¼Œä½ å¯ä»¥ä½¿ç”¨Lambdaè¡¨è¾¾å¼æ¥é‡æ„ä½ çš„ä»£ç ï¼Œæé«˜ä»£ç å¯è¯»æ€§ï¼›ä½¿ç”¨è¡Œä¸ºå‚æ•°åŒ–æ¥è®¾è®¡ä½ çš„ç¨‹åºï¼Œè®©ç¨‹åºæ›´çµæ´»ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java8 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8 æ–°ç‰¹æ€§-æµå¤„ç†</title>
      <link href="2019/02/13/java8-stream-api/"/>
      <url>2019/02/13/java8-stream-api/</url>
      
        <content type="html"><![CDATA[<p>Java 8çš„å¦ä¸€ä¸ªæ–°ç‰¹æ€§â€”â€”Stream APIã€‚æ–°å¢çš„Stream APIä¸<code>InputStream</code>å’Œ<code>OutputStream</code>æ˜¯å®Œå…¨ä¸åŒçš„æ¦‚å¿µï¼ŒStream APIæ˜¯å¯¹Javaä¸­é›†åˆæ“ä½œçš„å¢å¼ºï¼Œå¯ä»¥åˆ©ç”¨å®ƒè¿›è¡Œå„ç§è¿‡æ»¤ã€æ’åºã€åˆ†ç»„ã€èšåˆç­‰æ“ä½œã€‚Stream APIé…åˆLambdaè¡¨è¾¾å¼å¯ä»¥åŠ å¤§çš„æé«˜ä»£ç å¯è¯»æ€§å’Œç¼–ç æ•ˆç‡ï¼ŒStream APIä¹Ÿæ”¯æŒå¹¶è¡Œæ“ä½œï¼Œæˆ‘ä»¬ä¸ç”¨å†èŠ±è´¹å¾ˆå¤šç²¾åŠ›æ¥ç¼–å†™å®¹æ˜“å‡ºé”™çš„å¤šçº¿ç¨‹ä»£ç äº†ï¼ŒStream APIå·²ç»æ›¿æˆ‘ä»¬åšå¥½äº†ï¼Œå¹¶ä¸”å……åˆ†åˆ©ç”¨å¤šæ ¸CPUçš„ä¼˜åŠ¿ã€‚å€ŸåŠ©Stream APIå’ŒLambdaï¼Œå¼€å‘äººå‘˜å¯ä»¥å¾ˆå®¹æ˜“çš„ç¼–å†™å‡ºé«˜æ€§èƒ½çš„å¹¶å‘å¤„ç†ç¨‹åºã€‚</p><h2 id="Stream-APIç®€ä»‹"><a href="#Stream-APIç®€ä»‹" class="headerlink" title="Stream APIç®€ä»‹"></a>Stream APIç®€ä»‹</h2><p>Stream APIæ˜¯Java 8ä¸­åŠ å…¥çš„ä¸€å¥—æ–°çš„APIï¼Œä¸»è¦ç”¨äºå¤„ç†é›†åˆæ“ä½œï¼Œä¸è¿‡å®ƒçš„å¤„ç†æ–¹å¼ä¸ä¼ ç»Ÿçš„æ–¹å¼ä¸åŒï¼Œç§°ä¸ºâ€œæ•°æ®æµå¤„ç†â€ã€‚æµï¼ˆStreamï¼‰ç±»ä¼¼äºå…³ç³»æ•°æ®åº“çš„æŸ¥è¯¢æ“ä½œï¼Œæ˜¯ä¸€ç§å£°æ˜å¼æ“ä½œã€‚æ¯”å¦‚è¦ä»æ•°æ®åº“ä¸­è·å–æ‰€æœ‰å¹´é¾„å¤§äº20å²çš„ç”¨æˆ·çš„åç§°ï¼Œå¹¶æŒ‰ç…§ç”¨æˆ·çš„åˆ›å»ºæ—¶é—´è¿›è¡Œæ’åºï¼Œç”¨ä¸€æ¡SQLè¯­å¥å°±å¯ä»¥æå®šï¼Œä¸è¿‡ä½¿ç”¨Javaç¨‹åºå®ç°å°±ä¼šæ˜¾å¾—æœ‰äº›ç¹çï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨æµï¼š</p><pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>String<span class="token operator">></span> userNames <span class="token operator">=</span>        users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>user <span class="token operator">-</span><span class="token operator">></span> user<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">20</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token function">comparing</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getCreationDate<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getUserName<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å¯ä»¥æŠŠæµè·Ÿé›†åˆåšä¸€ä¸ªæ¯”è¾ƒã€‚åœ¨Javaä¸­ï¼Œé›†åˆæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œæˆ–è€…è¯´æ˜¯ä¸€ç§å®¹å™¨ï¼Œç”¨äºå­˜æ”¾æ•°æ®ï¼Œæµä¸æ˜¯å®¹å™¨ï¼Œå®ƒä¸å…³å¿ƒæ•°æ®çš„å­˜æ”¾ï¼Œåªå…³æ³¨å¦‚ä½•å¤„ç†ã€‚å¯ä»¥æŠŠæµå½“åšæ˜¯Javaä¸­çš„<code>Iterator</code>ï¼Œä¸è¿‡å®ƒæ¯”<code>Iterator</code>å¼ºå¤§å¤šäº†ã€‚</p><p>æµä¸é›†åˆå¦ä¸€ä¸ªåŒºåˆ«åœ¨äºä»–ä»¬çš„éå†æ–¹å¼ï¼Œéå†é›†åˆé€šå¸¸ä½¿ç”¨<code>for-each</code>æ–¹å¼ï¼Œè¿™ç§æ–¹å¼ç§°ä¸º<strong>å¤–éƒ¨è¿­ä»£</strong>ï¼Œè€Œæµä½¿ç”¨<strong>å†…éƒ¨è¿­ä»£</strong>æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå¸®ä½ æŠŠè¿­ä»£çš„å·¥ä½œåšäº†ï¼Œä½ åªéœ€è¦ç»™å‡ºä¸€ä¸ªå‡½æ•°æ¥å‘Šè¯‰å®ƒæ¥ä¸‹æ¥è¦å¹²ä»€ä¹ˆï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// å¤–éƒ¨è¿­ä»£</span>List<span class="token operator">&lt;</span>String<span class="token operator">></span> list <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"D"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>String str <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// å†…éƒ¨è¿­ä»£</span>list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>åœ¨è¿™ä¸ªå¤§æ•°æ®çš„æ—¶ä»£ï¼Œæ•°æ®å˜å¾—è¶Šæ¥è¶Šå¤šæ ·åŒ–ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¼šé¢å¯¹æµ·é‡æ•°æ®ï¼Œå¹¶å¯¹å…¶åšä¸€äº›å¤æ‚çš„æ“ä½œï¼ˆæ¯”å¦‚ç»Ÿè®¡ï¼Œåˆ†ç»„ï¼‰ï¼Œä¾ç…§ä¼ ç»Ÿçš„éå†æ–¹å¼ï¼ˆ<code>for-each</code>ï¼‰ï¼Œæ¯æ¬¡åªèƒ½å¤„ç†é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”æ˜¯æŒ‰é¡ºåºå¤„ç†ï¼Œè¿™ç§æ–¹æ³•æ˜¯æå…¶ä½æ•ˆçš„ã€‚ä½ ä¹Ÿè®¸ä¼šæƒ³åˆ°å¹¶è¡Œå¤„ç†ï¼Œä½†æ˜¯ç¼–å†™å¤šçº¿ç¨‹ä»£ç å¹¶éæ˜“äº‹ï¼Œå¾ˆå®¹æ˜“å‡ºé”™å¹¶ä¸”ç»´æŠ¤å›°éš¾ã€‚ä¸è¿‡åœ¨Java 8ä¹‹åï¼Œä½ å¯ä»¥ä½¿ç”¨Stream APIæ¥è§£å†³è¿™ä¸€é—®é¢˜ã€‚</p><p>Stream APIå°†è¿­ä»£æ“ä½œå°è£…åˆ°äº†å†…éƒ¨ï¼Œå®ƒä¼šè‡ªåŠ¨çš„é€‰æ‹©æœ€ä¼˜çš„è¿­ä»£æ–¹å¼ï¼Œå¹¶ä¸”ä½¿ç”¨å¹¶è¡Œæ–¹å¼å¤„ç†æ—¶ï¼Œå°†é›†åˆåˆ†æˆå¤šæ®µï¼Œæ¯ä¸€æ®µåˆ†åˆ«ä½¿ç”¨ä¸åŒçš„çº¿ç¨‹å¤„ç†ï¼Œæœ€åå°†å¤„ç†ç»“æœåˆå¹¶è¾“å‡ºã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæµåªèƒ½éå†ä¸€æ¬¡ï¼Œéå†ç»“æŸåï¼Œè¿™ä¸ªæµå°±è¢«å…³é—­æ‰äº†ã€‚å¦‚æœè¦é‡æ–°éå†ï¼Œå¯ä»¥ä»æ•°æ®æºï¼ˆé›†åˆï¼‰ä¸­é‡æ–°è·å–ä¸€ä¸ªæµã€‚å¦‚æœä½ å¯¹ä¸€ä¸ªæµéå†ä¸¤æ¬¡ï¼Œå°±ä¼šæŠ›å‡º<code>java.lang.IllegalStateException</code>å¼‚å¸¸ï¼š</p><pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>String<span class="token operator">></span> list <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"D"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Stream<span class="token operator">&lt;</span>String<span class="token operator">></span> stream <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>stream<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>stream<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// è¿™é‡Œä¼šæŠ›å‡ºjava.lang.IllegalStateExceptionå¼‚å¸¸ï¼Œå› ä¸ºæµå·²ç»è¢«å…³é—­</span></code></pre><p>æµé€šå¸¸ç”±ä¸‰éƒ¨åˆ†æ„æˆï¼š</p><ol><li>æ•°æ®æºï¼šæ•°æ®æºä¸€èˆ¬ç”¨äºæµçš„è·å–ï¼Œæ¯”å¦‚æœ¬æ–‡å¼€å¤´é‚£ä¸ªè¿‡æ»¤ç”¨æˆ·çš„ä¾‹å­ä¸­<code>users.stream()</code>æ–¹æ³•ã€‚</li><li>ä¸­é—´å¤„ç†ï¼šä¸­é—´å¤„ç†åŒ…æ‹¬å¯¹æµä¸­å…ƒç´ çš„ä¸€ç³»åˆ—å¤„ç†ï¼Œå¦‚ï¼šè¿‡æ»¤ï¼ˆ<code>filter()</code>ï¼‰ï¼Œæ˜ å°„ï¼ˆ<code>map()</code>ï¼‰ï¼Œæ’åºï¼ˆ<code>sorted()</code>ï¼‰ã€‚</li><li>ç»ˆç«¯å¤„ç†ï¼šç»ˆç«¯å¤„ç†ä¼šç”Ÿæˆç»“æœï¼Œç»“æœå¯ä»¥æ˜¯ä»»ä½•ä¸æ˜¯æµå€¼ï¼Œå¦‚<code>List&lt;String&gt;</code>ï¼›ä¹Ÿå¯ä»¥ä¸è¿”å›ç»“æœï¼Œå¦‚<code>stream.forEach(System.out::println)</code>å°±æ˜¯å°†ç»“æœæ‰“å°åˆ°æ§åˆ¶å°ä¸­ï¼Œå¹¶æ²¡æœ‰è¿”å›ã€‚</li></ol><h2 id="åˆ›å»ºæµ"><a href="#åˆ›å»ºæµ" class="headerlink" title="åˆ›å»ºæµ"></a>åˆ›å»ºæµ</h2><p>åˆ›å»ºæµçš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œå…·ä½“å¯ä»¥åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p><h3 id="ç”±å€¼åˆ›å»ºæµ"><a href="#ç”±å€¼åˆ›å»ºæµ" class="headerlink" title="ç”±å€¼åˆ›å»ºæµ"></a>ç”±å€¼åˆ›å»ºæµ</h3><p>ä½¿ç”¨é™æ€æ–¹æ³•<code>Stream.of()</code>åˆ›å»ºæµï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå˜é•¿å‚æ•°ï¼š</p><pre class=" language-java"><code class="language-java">Stream<span class="token operator">&lt;</span>Stream<span class="token operator">></span> stream <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"D"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨é™æ€æ–¹æ³•<code>Stream.empty()</code>åˆ›å»ºä¸€ä¸ªç©ºçš„æµï¼š</p><pre class=" language-java"><code class="language-java">Stream<span class="token operator">&lt;</span>Stream<span class="token operator">></span> stream <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="ç”±æ•°ç»„åˆ›å»ºæµ"><a href="#ç”±æ•°ç»„åˆ›å»ºæµ" class="headerlink" title="ç”±æ•°ç»„åˆ›å»ºæµ"></a>ç”±æ•°ç»„åˆ›å»ºæµ</h3><p>ä½¿ç”¨é™æ€æ–¹æ³•<code>Arrays.stream()</code>ä»æ•°ç»„åˆ›å»ºä¸€ä¸ªæµï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªæ•°ç»„å‚æ•°ï¼š</p><pre class=" language-java"><code class="language-java">String<span class="token punctuation">[</span><span class="token punctuation">]</span> strs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"D"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>Stream<span class="token operator">&lt;</span>Stream<span class="token operator">></span> stream <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>strs<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="é€šè¿‡æ–‡ä»¶ç”Ÿæˆæµ"><a href="#é€šè¿‡æ–‡ä»¶ç”Ÿæˆæµ" class="headerlink" title="é€šè¿‡æ–‡ä»¶ç”Ÿæˆæµ"></a>é€šè¿‡æ–‡ä»¶ç”Ÿæˆæµ</h3><p>ä½¿ç”¨<code>java.nio.file.Files</code>ç±»ä¸­çš„å¾ˆå¤šé™æ€æ–¹æ³•éƒ½å¯ä»¥è·å–æµï¼Œæ¯”å¦‚<code>Files.lines()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ª<code>java.nio.file.Path</code>å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªç”±æ–‡ä»¶è¡Œæ„æˆçš„å­—ç¬¦ä¸²æµï¼š</p><pre class=" language-java"><code class="language-java">Stream<span class="token operator">&lt;</span>String<span class="token operator">></span> stream <span class="token operator">=</span> Files<span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"text.txt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Charset<span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="é€šè¿‡å‡½æ•°åˆ›å»ºæµ"><a href="#é€šè¿‡å‡½æ•°åˆ›å»ºæµ" class="headerlink" title="é€šè¿‡å‡½æ•°åˆ›å»ºæµ"></a>é€šè¿‡å‡½æ•°åˆ›å»ºæµ</h3><p><code>java.util.stream.Stream</code>ä¸­æœ‰ä¸¤ä¸ªé™æ€æ–¹æ³•ç”¨äºä»å‡½æ•°ç”Ÿæˆæµï¼Œä»–ä»¬åˆ†åˆ«æ˜¯<code>Stream.generate()</code>å’Œ<code>Stream.iterate()</code>ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// iteartor</span>Stream<span class="token punctuation">.</span><span class="token function">iterate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n <span class="token operator">-</span><span class="token operator">></span> n <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// generate</span>Stream<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"Hello Man!"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ç¬¬ä¸€ä¸ªæ–¹æ³•ä¼šæ‰“å°100ä»¥å†…çš„æ‰€æœ‰å¶æ•°ï¼Œç¬¬äºŒä¸ªæ–¹æ³•æ‰“å°10ä¸ª<code>Hello Man!</code>ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ç”Ÿæˆçš„æµéƒ½æ˜¯æ— é™æµï¼Œæ²¡æœ‰å›ºå®šå¤§å°ï¼Œå¯ä»¥æ— ç©·çš„è®¡ç®—ä¸‹å»ï¼Œåœ¨ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬ä½¿ç”¨äº†<code>limit()</code>æ¥é¿å…æ‰“å°æ— ç©·ä¸ªå€¼ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œ<code>iterate()</code>ç”¨äºç”Ÿæˆä¸€ç³»åˆ—å€¼ï¼Œæ¯”å¦‚ç”Ÿæˆä»¥å½“å‰æ—¶é—´å¼€å§‹ä¹‹åçš„10å¤©çš„æ—¥æœŸï¼š</p><pre class=" language-java"><code class="language-java">Stream<span class="token punctuation">.</span><span class="token function">iterate</span><span class="token punctuation">(</span>LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> date <span class="token operator">-</span><span class="token operator">></span> date<span class="token punctuation">.</span><span class="token function">plusDays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>generate()</code>æ–¹æ³•ç”¨äºç”Ÿæˆä¸€äº›éšæœºæ•°ï¼Œæ¯”å¦‚ç”Ÿæˆ10ä¸ªUUIDï¼š</p><pre class=" language-java"><code class="language-java">Stream<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="ä½¿ç”¨æµ"><a href="#ä½¿ç”¨æµ" class="headerlink" title="ä½¿ç”¨æµ"></a>ä½¿ç”¨æµ</h2><p><code>Stream</code>æ¥å£ä¸­åŒ…å«è®¸å¤šå¯¹æµæ“ä½œçš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•åˆ†åˆ«ä¸ºï¼š</p><ul><li><code>filter()</code>ï¼šå¯¹æµçš„å…ƒç´ è¿‡æ»¤</li><li><code>map()</code>ï¼šå°†æµçš„å…ƒç´ æ˜ å°„æˆå¦ä¸€ä¸ªç±»å‹</li><li><code>distinct()</code>ï¼šå»é™¤æµä¸­é‡å¤çš„å…ƒç´ </li><li><code>sorted()</code>ï¼šå¯¹æµçš„å…ƒç´ æ’åº</li><li><code>forEach()</code>ï¼šå¯¹æµä¸­çš„æ¯ä¸ªå…ƒç´ æ‰§è¡ŒæŸä¸ªæ“ä½œ</li><li><code>peek()</code>ï¼šä¸<code>forEach()</code>æ–¹æ³•æ•ˆæœç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ–°çš„æµï¼Œè€Œ<code>forEach()</code>æ— è¿”å›</li><li><code>limit()</code>ï¼šæˆªå–æµä¸­å‰é¢å‡ ä¸ªå…ƒç´ </li><li><code>skip()</code>ï¼šè·³è¿‡æµä¸­å‰é¢å‡ ä¸ªå…ƒç´ </li><li><code>toArray()</code>ï¼šå°†æµè½¬æ¢ä¸ºæ•°ç»„</li><li><code>reduce()</code>ï¼šå¯¹æµä¸­çš„å…ƒç´ å½’çº¦æ“ä½œï¼Œå°†æ¯ä¸ªå…ƒç´ åˆèµ·æ¥å½¢æˆä¸€ä¸ªæ–°çš„å€¼</li><li><code>collect()</code>ï¼šå¯¹æµçš„æ±‡æ€»æ“ä½œï¼Œæ¯”å¦‚è¾“å‡ºæˆ<code>List</code>é›†åˆ</li><li><code>anyMatch()</code>ï¼šåŒ¹é…æµä¸­çš„å…ƒç´ ï¼Œç±»ä¼¼çš„æ“ä½œè¿˜æœ‰<code>allMatch()</code>å’Œ<code>noneMatch()</code>æ–¹æ³•</li><li><code>findFirst()</code>ï¼šæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç±»ä¼¼çš„è¿˜æœ‰<code>findAny()</code>æ–¹æ³•</li><li><code>max()</code>ï¼šæ±‚æœ€å¤§å€¼</li><li><code>min()</code>ï¼šæ±‚æœ€å°å€¼</li><li><code>count()</code>ï¼šæ±‚æ€»æ•°</li></ul><p>ä¸‹é¢é€ä¸€ä»‹ç»è¿™äº›æ–¹æ³•çš„ç”¨æ³•ã€‚</p><h3 id="è¿‡æ»¤å’Œæ’åº"><a href="#è¿‡æ»¤å’Œæ’åº" class="headerlink" title="è¿‡æ»¤å’Œæ’åº"></a>è¿‡æ»¤å’Œæ’åº</h3><pre class=" language-java"><code class="language-java">Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>n <span class="token operator">-</span><span class="token operator">></span> n <span class="token operator">></span> <span class="token number">2</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true">// å¯¹å…ƒç´ è¿‡æ»¤ï¼Œä¿ç•™å¤§äº2çš„å…ƒç´ </span>    <span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>             <span class="token comment" spellcheck="true">// å»é‡ï¼Œç±»ä¼¼äºSQLè¯­å¥ä¸­çš„DISTINCT</span>    <span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                <span class="token comment" spellcheck="true">// è·³è¿‡å‰é¢1ä¸ªå…ƒç´ </span>    <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>               <span class="token comment" spellcheck="true">// è¿”å›å¼€å¤´2ä¸ªå…ƒç´ ï¼Œç±»ä¼¼äºSQLè¯­å¥ä¸­çš„SELECT TOP</span>    <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>               <span class="token comment" spellcheck="true">// å¯¹ç»“æœæ’åº</span>    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="æŸ¥æ‰¾å’ŒåŒ¹é…"><a href="#æŸ¥æ‰¾å’ŒåŒ¹é…" class="headerlink" title="æŸ¥æ‰¾å’ŒåŒ¹é…"></a>æŸ¥æ‰¾å’ŒåŒ¹é…</h3><p>Streamä¸­æä¾›çš„æŸ¥æ‰¾æ–¹æ³•æœ‰<code>anyMatch()</code>ã€<code>allMatch()</code>ã€<code>noneMatch()</code>ã€<code>findFirst()</code>ã€<code>findAny()</code>ï¼Œè¿™äº›æ–¹æ³•è¢«ç”¨æ¥æŸ¥æ‰¾æˆ–åŒ¹é…æŸäº›å…ƒç´ æ˜¯å¦ç¬¦åˆç»™å®šçš„æ¡ä»¶ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// æ£€æŸ¥æµä¸­çš„ä»»æ„å…ƒç´ æ˜¯å¦åŒ…å«å­—ç¬¦ä¸²"Java"</span><span class="token keyword">boolean</span> hasMatch <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Java"</span><span class="token punctuation">,</span> <span class="token string">"C#"</span><span class="token punctuation">,</span> <span class="token string">"PHP"</span><span class="token punctuation">,</span> <span class="token string">"C++"</span><span class="token punctuation">,</span> <span class="token string">"Python"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">anyMatch</span><span class="token punctuation">(</span>s <span class="token operator">-</span><span class="token operator">></span> s<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"Java"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ£€æŸ¥æµä¸­çš„æ‰€æœ‰å…ƒç´ æ˜¯å¦éƒ½åŒ…å«å­—ç¬¦ä¸²"#"</span><span class="token keyword">boolean</span> hasAllMatch <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Java"</span><span class="token punctuation">,</span> <span class="token string">"C#"</span><span class="token punctuation">,</span> <span class="token string">"PHP"</span><span class="token punctuation">,</span> <span class="token string">"C++"</span><span class="token punctuation">,</span> <span class="token string">"Python"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">allMatch</span><span class="token punctuation">(</span>s <span class="token operator">-</span><span class="token operator">></span> s<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"#"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ£€æŸ¥æµä¸­çš„ä»»æ„å…ƒç´ æ˜¯å¦æ²¡æœ‰ä»¥"C"å¼€å¤´çš„å­—ç¬¦ä¸²</span><span class="token keyword">boolean</span> hasNoneMatch <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Java"</span><span class="token punctuation">,</span> <span class="token string">"C#"</span><span class="token punctuation">,</span> <span class="token string">"PHP"</span><span class="token punctuation">,</span> <span class="token string">"C++"</span><span class="token punctuation">,</span> <span class="token string">"Python"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">noneMatch</span><span class="token punctuation">(</span>s <span class="token operator">-</span><span class="token operator">></span> s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"C"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æŸ¥æ‰¾å…ƒç´ </span>Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> element <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Java"</span><span class="token punctuation">,</span> <span class="token string">"C#"</span><span class="token punctuation">,</span> <span class="token string">"PHP"</span><span class="token punctuation">,</span> <span class="token string">"C++"</span><span class="token punctuation">,</span> <span class="token string">"Python"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-</span><span class="token operator">></span> s<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"C"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// .findFirst()     // æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå…ƒç´ </span>        <span class="token punctuation">.</span><span class="token function">findAny</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// æŸ¥æ‰¾ä»»æ„å…ƒç´ </span></code></pre><p>æ³¨æ„æœ€åä¸€è¡Œä»£ç çš„è¿”å›ç±»å‹ï¼Œæ˜¯ä¸€ä¸ª<code>Optional&lt;T&gt;</code>ç±»ï¼ˆ<code>java.util.Optional</code>ï¼‰ï¼Œå®ƒä¸€ä¸ªå®¹å™¨ç±»ï¼Œä»£è¡¨ä¸€ä¸ªå€¼å­˜åœ¨æˆ–ä¸å­˜åœ¨ã€‚ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ<code>findAny()</code>å¯èƒ½ä»€ä¹ˆå…ƒç´ éƒ½æ²¡æ‰¾åˆ°ã€‚Java 8çš„åº“è®¾è®¡äººå‘˜å¼•å…¥äº†<code>Optional&lt;T&gt;</code>ï¼Œè¿™æ ·å°±ä¸ç”¨è¿”å›ä¼—æ‰€å‘¨çŸ¥å®¹æ˜“å‡ºé—®é¢˜çš„nulläº†ã€‚æœ‰å…³<code>Optional&lt;T&gt;</code>ç±»çš„è¯¦ç»†ç”¨æ³•ï¼Œå°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»ã€‚</p><p>å®é™…ä¸Šæµ‹è¯•ç»“æœå‘ç°ï¼Œ<code>findFirst()</code>å’Œ<code>findAny()</code>è¿”å›çš„éƒ½æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆä¸¤è€…ä¹‹é—´åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿé€šè¿‡æŸ¥çœ‹javadocæè¿°ï¼Œå¤§è‡´æ„æ€æ˜¯<code>findAny()</code>æ˜¯ä¸ºäº†æé«˜å¹¶è¡Œæ“ä½œæ—¶çš„æ€§èƒ½ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«éœ€è¦ï¼Œè¿˜æ˜¯å»ºè®®ä½¿ç”¨<code>findAny()</code>æ–¹æ³•ã€‚</p><h3 id="å½’çº¦"><a href="#å½’çº¦" class="headerlink" title="å½’çº¦"></a>å½’çº¦</h3><p>å½’çº¦æ“ä½œå°±æ˜¯å°†æµä¸­çš„å…ƒç´ è¿›è¡Œåˆå¹¶ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„å€¼ï¼Œå¸¸è§çš„å½’çº¦æ“ä½œåŒ…æ‹¬æ±‚å’Œï¼Œæ±‚æœ€å¤§å€¼æˆ–æœ€å°å€¼ã€‚å½’çº¦æ“ä½œä¸€èˆ¬ä½¿ç”¨<code>reduce()</code>æ–¹æ³•ï¼Œä¸<code>map()</code>æ–¹æ³•æ­é…ä½¿ç”¨ï¼Œå¯ä»¥å¤„ç†ä¸€äº›å¾ˆå¤æ‚çš„å½’çº¦æ“ä½œã€‚</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// è·å–æµ</span>List<span class="token operator">&lt;</span>Book<span class="token operator">></span> books <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>       <span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token string">"Javaç¼–ç¨‹æ€æƒ³"</span><span class="token punctuation">,</span> <span class="token string">"Bruce Eckel"</span><span class="token punctuation">,</span> <span class="token string">"æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾"</span><span class="token punctuation">,</span> <span class="token number">108.00D</span><span class="token punctuation">)</span><span class="token punctuation">,</span>       <span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token string">"Java 8å®æˆ˜"</span><span class="token punctuation">,</span> <span class="token string">"Mario Fusco"</span><span class="token punctuation">,</span> <span class="token string">"äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾"</span><span class="token punctuation">,</span> <span class="token number">79.00D</span><span class="token punctuation">)</span><span class="token punctuation">,</span>       <span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token string">"MongoDBæƒå¨æŒ‡å—ï¼ˆç¬¬2ç‰ˆï¼‰"</span><span class="token punctuation">,</span> <span class="token string">"Kristina Chodorow"</span><span class="token punctuation">,</span> <span class="token string">"äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾"</span><span class="token punctuation">,</span> <span class="token number">69.00D</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è®¡ç®—æ‰€æœ‰å›¾ä¹¦çš„æ€»ä»·</span>Optional<span class="token operator">&lt;</span>Double<span class="token operator">></span> totalPrice <span class="token operator">=</span> books<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Book<span class="token operator">:</span><span class="token operator">:</span>getPrice<span class="token punctuation">)</span>       <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> m<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> n <span class="token operator">+</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ä»·æ ¼æœ€é«˜çš„å›¾ä¹¦</span>Optional<span class="token operator">&lt;</span>Book<span class="token operator">></span> expensive <span class="token operator">=</span> books<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>Comparator<span class="token punctuation">.</span><span class="token function">comparing</span><span class="token punctuation">(</span>Book<span class="token operator">:</span><span class="token operator">:</span>getPrice<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ä»·æ ¼æœ€ä½çš„å›¾ä¹¦</span>Optional<span class="token operator">&lt;</span>Book<span class="token operator">></span> cheapest <span class="token operator">=</span> books<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>Comparator<span class="token punctuation">.</span><span class="token function">comparing</span><span class="token punctuation">(</span>Book<span class="token operator">:</span><span class="token operator">:</span>getPrice<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è®¡ç®—æ€»æ•°</span><span class="token keyword">long</span> count <span class="token operator">=</span> books<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>åœ¨è®¡ç®—å›¾ä¹¦æ€»ä»·çš„æ—¶å€™é¦–å…ˆä½¿ç”¨<code>map()</code>æ–¹æ³•å¾—åˆ°æ‰€æœ‰å›¾ä¹¦ä»·æ ¼çš„æµï¼Œç„¶åå†ä½¿ç”¨<code>reduce()</code>æ–¹æ³•è¿›è¡Œå½’çº¦è®¡ç®—ã€‚ä¸<code>map()</code>æ–¹æ³•ç±»ä¼¼çš„è¿˜æœ‰ä¸€ä¸ª<code>flatMap()</code>ï¼Œ<code>flatMap()</code>æ–¹æ³•è®©ä½ æŠŠä¸€ä¸ªæµä¸­çš„æ¯ä¸ªå€¼éƒ½æ¢æˆå¦ä¸€ä¸ªæµï¼Œç„¶åæŠŠæ‰€æœ‰çš„æµè¿æ¥èµ·æ¥æˆä¸ºä¸€ä¸ªæ–°çš„æµã€‚çœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p><pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> result <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Hello Man"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">-</span><span class="token operator">></span> s<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä¸Šé¢ä»£ç è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ª<code>List&lt;String[]&gt;</code>ç±»å‹ï¼Œä¹Ÿå°±æ˜¯<code>[["H", "e", "l", "l", "o"], ["M", "a", "n"]]</code>è¿™ç§ç»“æ„ï¼Œè€Œæˆ‘ä»¬æƒ³è¦çš„åˆ°<code>["H", "e", "l", "l", "o", "M", "a", "n"]</code>è¿™ç§ç»“æ„ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨<code>flatMap()</code>æ–¹æ³•äº†ï¼š</p><pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>String<span class="token operator">></span> result <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Hello Man"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">-</span><span class="token operator">></span> s<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>Arrays<span class="token operator">:</span><span class="token operator">:</span>stream<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä½¿ç”¨<code>flatMap()</code>æ–¹æ³•çš„æ•ˆæœæ˜¯ï¼Œå„ä¸ªæ•°ç»„å¹¶ä¸æ˜¯åˆ†åˆ«æ˜ å°„æˆä¸€ä¸ªæµï¼Œè€Œæ˜¯æ˜ å°„æˆæµçš„å†…å®¹ã€‚æ‰€æœ‰ä½¿ç”¨<code>map(Arrays::stream)</code>æ—¶ç”Ÿæˆçš„å•ä¸ªæµéƒ½è¢«åˆå¹¶èµ·æ¥ï¼Œä¹Ÿå°±æ˜¯å¯¹æµæ‰å¹³åŒ–æ“ä½œã€‚</p><h2 id="æ•°æ®æ”¶é›†"><a href="#æ•°æ®æ”¶é›†" class="headerlink" title="æ•°æ®æ”¶é›†"></a>æ•°æ®æ”¶é›†</h2><p>å‰é¢ä¸¤éƒ¨åˆ†å†…å®¹åˆ†åˆ«ä¸ºæµå¼æ•°æ®å¤„ç†çš„å‰ä¸¤ä¸ªæ­¥éª¤ï¼šä»æ•°æ®æºåˆ›å»ºæµã€ä½¿ç”¨æµè¿›è¡Œä¸­é—´å¤„ç†ã€‚ä¸‹é¢æˆ‘ä»¬ä»‹ç»æµå¼æ•°æ®å¤„ç†çš„æœ€åä¸€ä¸ªæ­¥éª¤â€”â€”æ•°æ®æ”¶é›†ã€‚</p><p>æ•°æ®æ”¶é›†æ˜¯æµå¼æ•°æ®å¤„ç†çš„ç»ˆç«¯å¤„ç†ï¼Œä¸ä¸­é—´å¤„ç†ä¸åŒçš„æ˜¯ï¼Œç»ˆç«¯å¤„ç†ä¼šæ¶ˆè€—æµï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç»ˆç«¯å¤„ç†ä¹‹åï¼Œè¿™ä¸ªæµå°±ä¼šè¢«å…³é—­ï¼Œå¦‚æœå†è¿›è¡Œä¸­é—´å¤„ç†ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚æ•°æ®æ”¶é›†ä¸»è¦ä½¿ç”¨<code>collect</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¹Ÿå±äºå½’çº¦æ“ä½œï¼Œåƒ<code>reduce()</code>æ–¹æ³•é‚£æ ·å¯ä»¥æ¥æ”¶å„ç§åšæ³•ä½œä¸ºå‚æ•°ï¼Œå°†æµä¸­çš„å…ƒç´ ç´¯ç§¯æˆä¸€ä¸ªæ±‡æ€»ç»“æœï¼Œå…·ä½“çš„åšæ³•æ˜¯é€šè¿‡å®šä¹‰æ–°çš„<code>Collector</code>æ¥å£æ¥å®šä¹‰çš„ã€‚</p><p>åœ¨å‰é¢éƒ¨åˆ†çš„ä¾‹å­ä¸­ä½¿ç”¨æ”¶é›†å™¨ï¼ˆ<code>Collector</code>ï¼‰æ˜¯ç”±<code>java.util.stream.Collectors</code>å·¥å…·ç±»ä¸­çš„<code>toList()</code>æ–¹æ³•æä¾›ï¼Œ<code>Collectors</code>ç±»æä¾›äº†è®¸å¤šå¸¸ç”¨çš„æ–¹æ³•ç”¨äºå¤„ç†æ•°æ®æ”¶é›†ï¼Œå¸¸è§çš„æœ‰å½’çº¦ã€æ±‡æ€»ã€åˆ†ç»„ç­‰ã€‚</p><h3 id="å½’çº¦å’Œæ±‡æ€»"><a href="#å½’çº¦å’Œæ±‡æ€»" class="headerlink" title="å½’çº¦å’Œæ±‡æ€»"></a>å½’çº¦å’Œæ±‡æ€»</h3><p>æˆ‘ä»¬ä½¿ç”¨å‰é¢å½’çº¦æ“ä½œä¸­è®¡ç®—å›¾ä¹¦æ€»ä»·ï¼Œæœ€å¤§å€¼ï¼Œæœ€å°å€¼ï¼Œè¾“å…¥æ€»æ•°é‚£ä¸ªä¾‹å­æ¥çœ‹çœ‹æ”¶é›†å™¨å¦‚ä½•è¿›è¡Œä¸Šè¿°å½’çº¦æ“ä½œï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// æ±‚å’Œ</span><span class="token keyword">long</span> count <span class="token operator">=</span> books<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">counting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ä»·æ ¼æœ€é«˜çš„å›¾ä¹¦</span>Optional<span class="token operator">&lt;</span>Book<span class="token operator">></span> expensive <span class="token operator">=</span> books<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">maxBy</span><span class="token punctuation">(</span><span class="token function">comparing</span><span class="token punctuation">(</span>Book<span class="token operator">:</span><span class="token operator">:</span>getPrice<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ä»·æ ¼æœ€ä½çš„å›¾ä¹¦</span>Optional<span class="token operator">&lt;</span>Book<span class="token operator">></span> cheapest <span class="token operator">=</span> books<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">minBy</span><span class="token punctuation">(</span><span class="token function">comparing</span><span class="token punctuation">(</span>Book<span class="token operator">:</span><span class="token operator">:</span>getPrice<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä¸Šé¢çš„ä»£ç å‡è®¾ä½ å·²ç»ä½¿ç”¨é™æ€å¯¼å…¥äº†<code>Collectors</code>å’Œ<code>Comparator</code>ä¸¤ä¸ªç±»ï¼Œè¿™æ ·ä½ å°±ä¸ç”¨å†å»å†™<code>Collectors.counting()</code>å’Œ<code>Comparator.comparing()</code>è¿™æ ·çš„ä»£ç äº†ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>Collectors<span class="token punctuation">.</span>*<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Comparator<span class="token punctuation">.</span>*<span class="token punctuation">;</span></code></pre><p><code>Collectors</code>å·¥å…·ç±»ä¸ºæˆ‘ä»¬æä¾›äº†ç”¨äºæ±‡æ€»çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬<code>summarizingInt()</code>ï¼Œ<code>summarizingLong()</code>å’Œ<code>summarizingDouble()</code>ï¼Œç”±äºå›¾ä¹¦çš„ä»·æ ¼ä¸º<code>Double</code>ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨<code>summarizingDouble()</code>æ–¹æ³•è¿›è¡Œæ±‡æ€»ã€‚è¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª<code>DoubleSummaryStatistics</code>å¯¹è±¡ï¼ŒåŒ…å«ä¸€ç³»åˆ—å½’çº¦æ“ä½œçš„æ–¹æ³•ï¼Œå¦‚ï¼šæ±‡æ€»ã€è®¡ç®—å¹³å‡æ•°ã€æœ€å¤§å€¼ã€æœ€å°å€¼ã€è®¡ç®—æ€»æ•°ï¼š</p><pre class=" language-java"><code class="language-java">DoubleSummaryStatistics dss <span class="token operator">=</span> books<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">summarizingDouble</span><span class="token punctuation">(</span>Book<span class="token operator">:</span><span class="token operator">:</span>getPrice<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">double</span> sum <span class="token operator">=</span> dss<span class="token punctuation">.</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// æ±‡æ€»</span><span class="token keyword">double</span> average <span class="token operator">=</span> dss<span class="token punctuation">.</span><span class="token function">getAverage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// æ±‚å¹³å‡æ•°</span><span class="token keyword">long</span> count <span class="token operator">=</span> dss<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// è®¡ç®—æ€»æ•°</span><span class="token keyword">double</span> max <span class="token operator">=</span> dss<span class="token punctuation">.</span><span class="token function">getMax</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// æœ€å¤§å€¼</span><span class="token keyword">double</span> min <span class="token operator">=</span> dss<span class="token punctuation">.</span><span class="token function">getMin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// æœ€å°å€¼</span></code></pre><p><code>Collectors</code>ç±»è¿˜åŒ…å«ä¸€ä¸ª<code>joining()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºè¿æ¥å­—ç¬¦ä¸²ï¼š</p><pre class=" language-java"><code class="language-java">String str <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"D"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä¸Šé¢çš„ä»£ç ç”¨äºå°†æµä¸­çš„å­—ç¬¦ä¸²é€šè¿‡é€—å·è¿æ¥æˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ã€‚</p><h3 id="åˆ†ç»„"><a href="#åˆ†ç»„" class="headerlink" title="åˆ†ç»„"></a>åˆ†ç»„</h3><p>å’Œå…³ç³»æ•°æ®åº“ä¸€æ ·ï¼Œæµä¹Ÿæä¾›äº†ç±»ä¼¼äºæ•°æ®åº“ä¸­<code>GROUP BY</code>åˆ†ç»„çš„ç‰¹æ€§ï¼Œç”±<code>Collectors.groupingBy()</code>æ–¹æ³•æä¾›ï¼š</p><pre class=" language-java"><code class="language-java">Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Book<span class="token operator">>></span> booksGroup <span class="token operator">=</span> books<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">groupingBy</span><span class="token punctuation">(</span>Book<span class="token operator">:</span><span class="token operator">:</span>getPublisher<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä¸Šé¢çš„ä»£ç æŒ‰ç…§å‡ºç‰ˆç¤¾å¯¹å›¾ä¹¦è¿›è¡Œåˆ†ç»„ï¼Œåˆ†ç»„çš„ç»“æœæ˜¯ä¸€ä¸ª<code>Map</code>å¯¹è±¡ï¼Œ<code>Map</code>çš„<code>key</code>å€¼æ˜¯å‡ºç‰ˆç¤¾çš„åç§°ï¼Œ<code>value</code>å€¼æ˜¯æ¯ä¸ªå‡ºç‰ˆç¤¾åˆ†ç»„å¯¹åº”çš„é›†åˆã€‚åˆ†ç»„æ–¹æ³•<code>groupingBy()</code>æ¥æ”¶ä¸€ä¸ª<code>Function</code>æ¥å£ä½œä¸ºå‚æ•°ï¼Œä¸Šé¢çš„ä¾‹å­ä¸­æˆ‘ä»¬ä½¿ç”¨äº†æ–¹æ³•å¼•ç”¨ä¼ é€’äº†å‡ºç‰ˆç¤¾ä½œä¸ºåˆ†ç»„çš„ä¾æ®ï¼Œä½†å®é™…æƒ…å†µå¯èƒ½æ¯”è¿™å¤æ‚ï¼Œæ¯”å¦‚å°†ä»·æ ¼åœ¨0-50ä¹‹é—´çš„ä¹¦ç±åˆ†æˆä¸€ç»„ï¼Œ50-100ä¹‹é—´çš„åˆ†æˆä¸€ç»„ï¼Œè¶…è¿‡100çš„åˆ†æˆä¸€ç»„ï¼Œè¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨Lambdaè¡¨è¾¾å¼æ¥è¡¨ç¤ºè¿™ä¸ªåˆ†ç»„é€»è¾‘ï¼š</p><pre class=" language-java"><code class="language-java">Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Book<span class="token operator">>></span> booksGroup <span class="token operator">=</span> books    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">groupingBy</span><span class="token punctuation">(</span>book <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>book<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> book<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token string">"A"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>book<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">50</span> <span class="token operator">&amp;&amp;</span> book<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token string">"B"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token string">"C"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>groupingBy()</code>æ–¹æ³•è¿˜æ”¯æŒå¤šçº§åˆ†ç»„ï¼Œä»–æœ‰ä¸€ä¸ªé‡è½½æ–¹æ³•ï¼Œé™¤äº†æ¥æ”¶ä¸€ä¸ª<code>Function</code>ç±»å‹çš„å‚æ•°å¤–ï¼Œè¿˜æ¥æ”¶ä¸€ä¸ª<code>Collector</code>ç±»å‹çš„å‚æ•°ï¼š</p><pre class=" language-java"><code class="language-java">Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Book<span class="token operator">>>></span> booksGroup <span class="token operator">=</span> books<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>        <span class="token function">groupingBy</span><span class="token punctuation">(</span>Book<span class="token operator">:</span><span class="token operator">:</span>getPublisher<span class="token punctuation">,</span> <span class="token function">groupingBy</span><span class="token punctuation">(</span>book <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>book<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> book<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token string">"A"</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>book<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">50</span> <span class="token operator">&amp;&amp;</span> book<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token string">"B"</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token string">"C"</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä¸Šé¢çš„ä»£ç å°†ä¹‹å‰ä¸¤ä¸ªåˆ†ç»„åˆå¹¶æˆä¸€ä¸ªï¼Œå®ç°äº†å¤šçº§åˆ†ç»„ï¼Œé¦–å…ˆæŒ‰ç…§å‡ºç‰ˆç¤¾è¿›è¡Œåˆ†ç»„ï¼Œç„¶åæŒ‰ç…§ä»·æ ¼è¿›è¡Œåˆ†ç»„ï¼Œè¿”å›ç±»å‹æ˜¯ä¸€ä¸ª<code>Map&lt;String, Map&lt;String, List&lt;Book&gt;&gt;&gt;</code>ã€‚<code>groupingBy()</code>çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œåªè¦æ˜¯<code>Collector</code>æ¥å£çš„å®ä¾‹å°±å¯ä»¥ï¼Œæ¯”å¦‚å…ˆåˆ†ç»„ï¼Œå†ç»Ÿè®¡æ•°é‡ï¼š</p><pre class=" language-java"><code class="language-java">Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Long<span class="token operator">></span> countGroup <span class="token operator">=</span> books<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">groupingBy</span><span class="token punctuation">(</span>Book<span class="token operator">:</span><span class="token operator">:</span>getPublisher<span class="token punctuation">,</span> <span class="token function">counting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è¿˜å¯ä»¥åœ¨è¿›è¡Œåˆ†ç»„åè·å–æ¯ç»„ä¸­ä»·æ ¼æœ€é«˜çš„å›¾ä¹¦ï¼š</p><pre class=" language-java"><code class="language-java">Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Book<span class="token operator">></span> expensiveGroup <span class="token operator">=</span> books<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">groupingBy</span><span class="token punctuation">(</span>Book<span class="token operator">:</span><span class="token operator">:</span>getPublisher<span class="token punctuation">,</span> <span class="token function">collectingAndThen</span><span class="token punctuation">(</span>            <span class="token function">maxBy</span><span class="token punctuation">(</span><span class="token function">comparingDouble</span><span class="token punctuation">(</span>Book<span class="token operator">:</span><span class="token operator">:</span>getPrice<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                Optional<span class="token operator">:</span><span class="token operator">:</span>get        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="å¹¶è¡Œæ•°æ®å¤„ç†"><a href="#å¹¶è¡Œæ•°æ®å¤„ç†" class="headerlink" title="å¹¶è¡Œæ•°æ®å¤„ç†"></a>å¹¶è¡Œæ•°æ®å¤„ç†</h2><p>åœ¨Java 7ä¹‹å‰ï¼Œå¤„ç†å¹¶è¡Œæ•°æ®é›†åˆéå¸¸éº»çƒ¦ï¼Œé¦–å…ˆéœ€è¦å°†ä¸€ä¸ªåºå¤§æ•°æ®é›†åˆåˆ†æˆå‡ ä¸ªå­é›†åˆï¼›ç„¶åéœ€è¦ä¸ºæ¯ä¸€ä¸ªå­é›†åˆç¼–å†™å¤šçº¿ç¨‹å¤„ç†ç¨‹åºï¼Œè¿˜éœ€è¦å¯¹ä»–ä»¬åšçº¿ç¨‹åŒæ­¥æ¥é¿å…è®¿é—®å…±äº«å˜é‡å¯¼è‡´å¤„ç†ç»“æœä¸å‡†ç¡®ï¼›æœ€åï¼Œç­‰å¾…æ‰€æœ‰çº¿ç¨‹å¤„ç†å®Œæ¯•åå°†å¤„ç†ç»“æœåˆå¹¶ã€‚åœ¨Java 7ä¹‹åæ–°æ·»åŠ äº†ä¸€ä¸ª<code>fork/join</code>çš„æ¡†æ¶ï¼Œè®©è¿™ä¸€åˆ‡å˜å¾—æ›´åŠ ç®€å•ã€‚</p><h3 id="å¹¶è¡Œæµ"><a href="#å¹¶è¡Œæµ" class="headerlink" title="å¹¶è¡Œæµ"></a>å¹¶è¡Œæµ</h3><p>å¹¶è¡Œæµä½¿ç”¨é›†åˆçš„<code>parallelStream()</code>æ–¹æ³•å¯ä»¥è·å–ä¸€ä¸ªå¹¶è¡Œæµã€‚Javaå†…éƒ¨ä¼šå°†æµçš„å†…å®¹åˆ†å‰²æˆè‹¥å¹²ä¸ªå­éƒ¨åˆ†ï¼Œç„¶åå°†å®ƒä»¬äº¤ç»™å¤šä¸ªçº¿ç¨‹å¹¶è¡Œå¤„ç†ï¼Œè¿™æ ·å°±å°†å·¥ä½œçš„è´Ÿæ‹…äº¤ç»™å¤šæ ¸CPUçš„å…¶ä»–å†…æ ¸å¤„ç†ã€‚</p><p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•ç²—æš´çš„ä¾‹å­æ¼”ç¤ºå¹¶è¡Œæµçš„å¤„ç†æ€§èƒ½ã€‚å‡è®¾æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ªæ•°å­—nä½œä¸ºå‚æ•°ï¼Œè¿”å›ä»1åˆ°nçš„æ‰€æœ‰è‡ªç„¶æ•°ä¹‹å’Œï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">sequentialSum</span><span class="token punctuation">(</span><span class="token keyword">long</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> Stream<span class="token punctuation">.</span><span class="token function">iterate</span><span class="token punctuation">(</span>1L<span class="token punctuation">,</span> i <span class="token operator">-</span><span class="token operator">></span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>0L<span class="token punctuation">,</span> Long<span class="token operator">:</span><span class="token operator">:</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ä¸Šé¢çš„æ–¹æ³•ä¹Ÿå¯ä»¥é€šè¿‡ä¼ ç»Ÿçš„forå¾ªç¯æ–¹å¼å®ç°ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">iterativeSum</span><span class="token punctuation">(</span><span class="token keyword">long</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">long</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> 1L<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        result <span class="token operator">+=</span> i<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> result<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ç¼–å†™æµ‹è¯•ä»£ç ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">long</span> number <span class="token operator">=</span> 10000000L<span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Sequential Sum: "</span> <span class="token operator">+</span> <span class="token function">sumPerformanceTest</span><span class="token punctuation">(</span>StreamTest<span class="token operator">:</span><span class="token operator">:</span>sequentialSum<span class="token punctuation">,</span> number<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" æ¯«ç§’"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Iterative Sum: "</span> <span class="token operator">+</span> <span class="token function">sumPerformanceTest</span><span class="token punctuation">(</span>StreamTest<span class="token operator">:</span><span class="token operator">:</span>iterativeSum<span class="token punctuation">,</span> number<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" æ¯«ç§’"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">sumPerformanceTest</span><span class="token punctuation">(</span>Function<span class="token operator">&lt;</span>Long<span class="token punctuation">,</span> Long<span class="token operator">></span> function<span class="token punctuation">,</span> <span class="token keyword">long</span> number<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">long</span> maxValue <span class="token operator">=</span> Long<span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">long</span> start <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> sum <span class="token operator">=</span> function<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> end <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Result: "</span> <span class="token operator">+</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> time <span class="token operator">=</span> <span class="token punctuation">(</span> end <span class="token operator">-</span> start <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000000</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&lt;</span> maxValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>            maxValue <span class="token operator">=</span> time<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> maxValue<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬ç¼–å†™ä¸€ä¸ª<code>sumPerformanceTest()</code>æ–¹æ³•ï¼Œå‚æ•°<code>number</code>è¡¨ç¤ºç»™å®šçš„ä¸€ä¸ªæ•°ï¼Œç”¨äºè®¡ç®—ä»1åˆ°è¿™ä¸ªæ•°çš„æ‰€æœ‰è‡ªç„¶æ•°ä¹‹å’Œã€‚è¯¥æ–¹æ³•å†…éƒ¨æ‰§è¡Œ10æ¬¡è¿ç®—ï¼Œè¿”å›æ—¶é—´æœ€çŸ­çš„ä¸€æ¬¡è¿ç®—ç»“æœã€‚</p><p>è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š</p><pre class=" language-bash"><code class="language-bash">Result: 200000010000000Result: 200000010000000Result: 200000010000000Result: 200000010000000Result: 200000010000000Result: 200000010000000Result: 200000010000000Result: 200000010000000Result: 200000010000000Result: 200000010000000Sequential Sum: 159 æ¯«ç§’Result: 200000010000000Result: 200000010000000Result: 200000010000000Result: 200000010000000Result: 200000010000000Result: 200000010000000Result: 200000010000000Result: 200000010000000Result: 200000010000000Result: 200000010000000Iterative Sum: 5 æ¯«ç§’</code></pre><p>å¯ä»¥çœ‹å‡ºï¼Œé‡‡ç”¨ä¼ ç»Ÿçš„forå¾ªç¯æ›´å¿«ï¼Œå› ä¸ºå®ƒä¸ç”¨åšä»»ä½•è‡ªåŠ¨æ‹†ç®±/è£…ç®±æ“ä½œï¼Œæ“ä½œçš„éƒ½æ˜¯åŸºæœ¬ç±»å‹ã€‚è¿™ä¸ªæµ‹è¯•ç»“æœå¹¶ä¸å®¢è§‚ï¼Œæå‡çš„æ€§èƒ½å–å†³äºæœºå™¨çš„é…ç½®ï¼Œä»¥ä¸Šæ˜¯æˆ‘åœ¨å…¬å¸çš„å°å¼æœºï¼ˆæœºå™¨é…ç½®ä¸º<code>Intel(R) Core i7-6700 CPU 3.40HZ; 8GB RAM</code>ï¼‰ä¸Šè¿è¡Œçš„ç»“æœã€‚</p><p>ç°åœ¨æˆ‘ä»¬ä½¿ç”¨å¹¶è¡Œæµæµ‹è¯•ä¸€ä¸‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">parallelSum</span><span class="token punctuation">(</span><span class="token keyword">long</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> Stream<span class="token punctuation">.</span><span class="token function">iterate</span><span class="token punctuation">(</span>1L<span class="token punctuation">,</span> i <span class="token operator">-</span><span class="token operator">></span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>0L<span class="token punctuation">,</span> Long<span class="token operator">:</span><span class="token operator">:</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Parallel Sum: "</span> <span class="token operator">+</span> <span class="token function">sumPerformanceTest</span><span class="token punctuation">(</span>StreamTest<span class="token operator">:</span><span class="token operator">:</span>parallelSum<span class="token punctuation">,</span> number<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" æ¯«ç§’"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å¹¶è¡Œæµæ‰§è¡Œç»“æœä¸ºï¼š</p><pre class=" language-java"><code class="language-java">Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Parallel Sum<span class="token operator">:</span> <span class="token number">570</span> æ¯«ç§’</code></pre><p>å¹¶è¡Œçš„æ‰§è¡Œæ•ˆç‡æ¯”é¡ºåºæ‰§è¡Œè¿˜è¦æ…¢ï¼Œè¿™ä¸ªç»“æœè®©äººå¤§è·Œçœ¼é•œã€‚ä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼š</p><ol><li><code>iterate()</code>æ–¹æ³•ç”Ÿæˆçš„å¯¹è±¡æ˜¯åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»ï¼ˆä¹Ÿå°±æ˜¯<code>java.lang.Long</code>ç±»å‹ï¼‰ï¼Œå¿…é¡»è¿›è¡Œæ‹†ç®±æ“ä½œæ‰èƒ½è¿ç®—ã€‚</li><li><code>iterate()</code>æ–¹æ³•ä¸é€‚åˆç”¨å¹¶è¡Œæµå¤„ç†ã€‚</li></ol><p>ç¬¬ä¸€ä¸ªåŸå› å®¹æ˜“ç†è§£ï¼Œè‡ªåŠ¨æ‹†ç®±æ“ä½œç¡®å®éœ€è¦èŠ±è´¹ä¸€å®šçš„æ—¶é—´ï¼Œè¿™ä»å‰ä¸€ä¸ªä¾‹å­å¯ä»¥çœ‹å‡ºæ¥ã€‚ç¬¬äºŒä¸ªåŸå› ä¸­<code>iterate()</code>æ–¹æ³•ä¸é€‚åˆç”¨å¹¶è¡Œæµå¤„ç†ï¼Œä¸»è¦åŸå› æ˜¯<code>iterate()</code>æ–¹æ³•å†…éƒ¨æœºåˆ¶çš„é—®é¢˜ã€‚<code>iterate()</code>æ–¹æ³•æ¯æ¬¡æ‰§è¡Œéƒ½éœ€è¦ä¾èµ–å‰ä¸€æ¬¡çš„ç»“æœï¼Œæ¯”å¦‚æœ¬æ¬¡æ‰§è¡Œçš„è¾“å…¥å€¼ä¸º10ï¼Œè¿™ä¸ªè¾“å…¥å€¼å¿…é¡»æ˜¯å‰ä¸€æ¬¡è¿ç®—ç»“æœçš„è¾“å‡ºï¼Œå› æ­¤<code>iterate()</code>æ–¹æ³•å¾ˆéš¾ä½¿ç”¨å¹¶è¡Œæµåˆ†å‰²æˆä¸åŒå°å—å¤„ç†ã€‚å®é™…ä¸Šï¼Œä¸Šé¢çš„å¹¶è¡Œæµç¨‹åºè¿˜å¢åŠ äº†é¡ºåºå¤„ç†çš„é¢å¤–å¼€é”€ï¼Œå› ä¸ºéœ€è¦æŠŠæ¯æ¬¡æ“ä½œæ‰§è¡Œçš„ç»“æœåˆ†åˆ«åˆ†é…åˆ°ä¸åŒçš„çº¿ç¨‹ä¸­ã€‚</p><p>ä¸€ä¸ªæœ‰æ•ˆçš„å¤„ç†æ–¹å¼æ˜¯ä½¿ç”¨<code>LongStream.rangeClosed()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¼¥è¡¥äº†ä¸Šè¿°ä¾‹å­çš„ä¸¤ä¸ªç¼ºç‚¹ï¼Œå®ƒç”Ÿæˆçš„æ˜¯åŸºæœ¬ç±»å‹è€ŒéåŒ…è£…ç±»ï¼Œä¸ç”¨æ‹†ç®±æ“ä½œå°±å¯ä»¥è¿ç®—ï¼Œå¹¶ä¸”ï¼Œå®ƒç”Ÿæˆçš„æ˜¯ç”±èŒƒå›´çš„æ•°å­—ï¼Œå¾ˆå®¹æ˜“æ‹†åˆ†ã€‚å¦‚ï¼šç”Ÿæˆ1-20èŒƒå›´çš„æ•°å­—å¯ä»¥æ‹†åˆ†æˆ1-10, 11-20ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">rangedSum</span><span class="token punctuation">(</span><span class="token keyword">long</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> LongStream<span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>0L<span class="token punctuation">,</span> Long<span class="token operator">:</span><span class="token operator">:</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Ranged Sum: "</span> <span class="token operator">+</span> <span class="token function">sumPerformanceTest</span><span class="token punctuation">(</span>StreamTest<span class="token operator">:</span><span class="token operator">:</span>rangedSum<span class="token punctuation">,</span> number<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" æ¯«ç§’"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>æ‰§è¡Œç»“æœä¸ºï¼š</p><pre class=" language-java"><code class="language-java">Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Ranged Sum<span class="token operator">:</span> <span class="token number">8</span> æ¯«ç§’</code></pre><p>è¿™ä¸ªç»“æœæ¯”èµ·<code>sequentialSum()</code>æ–¹æ³•æ‰§è¡Œçš„ç»“æœè¿˜è¦å¿«ï¼Œæ‰€ä»¥é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„æœ‰æ—¶å€™æ¯”å¹¶è¡ŒåŒ–å¤„ç†æ›´é‡è¦ã€‚æˆ‘ä»¬å†å°†<code>rangeClosed()</code>æ–¹æ³•ç”Ÿæˆçš„æµè½¬åŒ–ä¸ºå¹¶è¡Œæµï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">parallelRangedSum</span><span class="token punctuation">(</span><span class="token keyword">long</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> LongStream<span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>0L<span class="token punctuation">,</span> Long<span class="token operator">:</span><span class="token operator">:</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Parallel Ranged Sum: "</span> <span class="token operator">+</span> <span class="token function">sumPerformanceTest</span><span class="token punctuation">(</span>StreamTest<span class="token operator">:</span><span class="token operator">:</span>parallelRangedSum<span class="token punctuation">,</span> number<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" æ¯«ç§’"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>æ‰§è¡Œç»“æœä¸ºï¼š</p><pre class=" language-java"><code class="language-java">Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Result<span class="token operator">:</span> <span class="token number">200000010000000</span>Parallel Ranged Sum<span class="token operator">:</span> <span class="token number">2</span> æ¯«ç§’</code></pre><p>æˆ‘ä»¬ç»ˆäºå¾—åˆ°äº†æƒ³è¦çš„ç»“æœï¼Œæ‰€ä»¥å¹¶è¡Œæ“ä½œéœ€è¦é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„ï¼Œå»ºè®®å¤šåšæµ‹è¯•ï¼Œæ‰¾åˆ°åˆé€‚çš„å¹¶è¡Œæ–¹å¼å†æ‰§è¡Œï¼Œå¦åˆ™å¾ˆå®¹æ˜“è·³åˆ°å‘é‡Œã€‚</p><h2 id="è·å–ä¸€ä¸ªåˆé€‚çš„IPåœ°å€"><a href="#è·å–ä¸€ä¸ªåˆé€‚çš„IPåœ°å€" class="headerlink" title="è·å–ä¸€ä¸ªåˆé€‚çš„IPåœ°å€"></a>è·å–ä¸€ä¸ªåˆé€‚çš„IPåœ°å€</h2><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**  * åˆé€‚çš„ipåœ°å€å‰ç¼€  */</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> List<span class="token operator">&lt;</span>String<span class="token operator">></span> PREFIX_IP <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"192.168"</span><span class="token punctuation">,</span> <span class="token string">"172.16"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">getPreferIp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        Enumeration<span class="token operator">&lt;</span>NetworkInterface<span class="token operator">></span> enumeration <span class="token operator">=</span> NetworkInterface<span class="token punctuation">.</span><span class="token function">getNetworkInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        List<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>String<span class="token operator">>></span> lists <span class="token operator">=</span> Collections<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>enumeration<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">-</span><span class="token operator">></span> Collections<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">getInetAddresses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                 <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                 <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>InetAddress<span class="token operator">:</span><span class="token operator">:</span>isSiteLocalAddress<span class="token punctuation">)</span>                 <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>InetAddress<span class="token operator">:</span><span class="token operator">:</span>getHostAddress<span class="token punctuation">)</span>                 <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Objects<span class="token operator">:</span><span class="token operator">:</span>nonNull<span class="token punctuation">)</span>                 <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>x <span class="token operator">-</span><span class="token operator">></span> <span class="token operator">!</span>x<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        AtomicReference<span class="token operator">&lt;</span>String<span class="token operator">></span> prefer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        PREFIX_IP<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>x <span class="token operator">-</span><span class="token operator">></span> lists<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>i <span class="token operator">-</span><span class="token operator">></span> i<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>a <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                prefer<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        String ip <span class="token operator">=</span> prefer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è·å–å¯ç”¨ipä¸ºï¼š {}"</span><span class="token punctuation">,</span> ip<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> ip<span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>        SocketException e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java8 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8 æ–°ç‰¹æ€§-æ—¥æœŸapi</title>
      <link href="2019/02/13/java8-localdatetime/"/>
      <url>2019/02/13/java8-localdatetime/</url>
      
        <content type="html"><![CDATA[<p>Java 8çš„ä¸€ä¸ªæ–°å¢çš„é‡è¦ç‰¹æ€§å°±æ˜¯å¼•å…¥äº†æ–°çš„æ—¶é—´å’Œæ—¥æœŸAPIï¼Œå®ƒä»¬è¢«åŒ…å«åœ¨<code>java.time</code>åŒ…ä¸­ã€‚å€ŸåŠ©æ–°çš„æ—¶é—´å’Œæ—¥æœŸAPIå¯ä»¥ä»¥æ›´ç®€æ´çš„æ–¹æ³•å¤„ç†æ—¶é—´å’Œæ—¥æœŸã€‚</p><p>åœ¨ä»‹ç»æœ¬ç¯‡æ–‡ç« å†…å®¹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è®¨è®ºJava 8ä¸ºä»€ä¹ˆè¦å¼•å…¥æ–°çš„æ—¥æœŸAPIï¼Œä¸ä¹‹å‰çš„æ—¶é—´å’Œæ—¥æœŸå¤„ç†æ–¹å¼æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</p><p>åœ¨Java 8ä¹‹å‰ï¼Œæ‰€æœ‰å…³äºæ—¶é—´å’Œæ—¥æœŸçš„APIéƒ½å­˜åœ¨å„ç§ä½¿ç”¨æ–¹é¢çš„ç¼ºé™·ï¼Œä¸»è¦æœ‰ï¼š</p><ol><li>Javaçš„<code>java.util.Date</code>å’Œ<code>java.util.Calendar</code>ç±»æ˜“ç”¨æ€§å·®ï¼Œä¸æ”¯æŒæ—¶åŒºï¼Œè€Œä¸”ä»–ä»¬éƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›</li><li>ç”¨äºæ ¼å¼åŒ–æ—¥æœŸçš„ç±»<code>DateFormat</code>è¢«æ”¾åœ¨<code>java.text</code>åŒ…ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ª<code>SimpleDateFormat</code>å¯¹è±¡æ¥å¤„ç†æ—¥æœŸæ ¼å¼åŒ–ï¼Œå¹¶ä¸”<code>DateFormat</code>ä¹Ÿæ˜¯éçº¿ç¨‹å®‰å…¨ï¼Œè¿™æ„å‘³ç€å¦‚æœä½ åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­è°ƒç”¨åŒä¸€ä¸ª<code>DateFormat</code>å¯¹è±¡ï¼Œä¼šå¾—åˆ°æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚</li><li>å¯¹æ—¥æœŸçš„è®¡ç®—æ–¹å¼ç¹çï¼Œè€Œä¸”å®¹æ˜“å‡ºé”™ï¼Œå› ä¸ºæœˆä»½æ˜¯ä»0å¼€å§‹çš„ï¼Œä»<code>Calendar</code>ä¸­è·å–çš„æœˆä»½éœ€è¦åŠ ä¸€æ‰èƒ½è¡¨ç¤ºå½“å‰æœˆä»½ã€‚</li></ol><p>ç”±äºä»¥ä¸Šè¿™äº›é—®é¢˜ï¼Œå‡ºç°äº†ä¸€äº›ä¸‰æ–¹çš„æ—¥æœŸå¤„ç†æ¡†æ¶ï¼Œä¾‹å¦‚Joda-Timeï¼Œdate4jç­‰å¼€æºé¡¹ç›®ã€‚ä½†æ˜¯ï¼ŒJavaéœ€è¦ä¸€å¥—æ ‡å‡†çš„ç”¨äºå¤„ç†æ—¶é—´å’Œæ—¥æœŸçš„æ¡†æ¶ï¼Œäºæ˜¯Java 8ä¸­å¼•å…¥äº†æ–°çš„æ—¥æœŸAPIã€‚æ–°çš„æ—¥æœŸAPIæ˜¯<a href="https://jcp.org/en/jsr/detail?id=310">JSR-310</a>è§„èŒƒçš„å®ç°ï¼ŒJoda-Timeæ¡†æ¶çš„ä½œè€…æ­£æ˜¯JSR-310çš„è§„èŒƒçš„å€¡å¯¼è€…ï¼Œæ‰€ä»¥èƒ½ä»Java 8çš„æ—¥æœŸAPIä¸­çœ‹åˆ°å¾ˆå¤šJoda-Timeçš„ç‰¹æ€§ã€‚</p><h2 id="Java-8æ—¥æœŸ-æ—¶é—´ç±»"><a href="#Java-8æ—¥æœŸ-æ—¶é—´ç±»" class="headerlink" title="Java 8æ—¥æœŸ/æ—¶é—´ç±»"></a>Java 8æ—¥æœŸ/æ—¶é—´ç±»</h2><p>Java 8çš„æ—¥æœŸå’Œæ—¶é—´ç±»åŒ…å«<code>LocalDate</code>ã€<code>LocalTime</code>ã€<code>Instant</code>ã€<code>Duration</code>ä»¥åŠ<code>Period</code>ï¼Œè¿™äº›ç±»éƒ½åŒ…å«åœ¨<code>java.time</code>åŒ…ä¸­ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹çœ‹è¿™äº›ç±»çš„ç”¨æ³•ã€‚</p><h3 id="LocalDateå’ŒLocalTime"><a href="#LocalDateå’ŒLocalTime" class="headerlink" title="LocalDateå’ŒLocalTime"></a><code>LocalDate</code>å’Œ<code>LocalTime</code></h3><p><code>LocalDate</code>ç±»è¡¨ç¤ºä¸€ä¸ªå…·ä½“çš„æ—¥æœŸï¼Œä½†ä¸åŒ…å«å…·ä½“æ—¶é—´ï¼Œä¹Ÿä¸åŒ…å«æ—¶åŒºä¿¡æ¯ã€‚å¯ä»¥é€šè¿‡<code>LocalDate</code>çš„é™æ€æ–¹æ³•<code>of()</code>åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œ<code>LocalDate</code>ä¹ŸåŒ…å«ä¸€äº›æ–¹æ³•ç”¨æ¥è·å–å¹´ä»½ï¼Œæœˆä»½ï¼Œå¤©ï¼Œæ˜ŸæœŸå‡ ç­‰ï¼š</p><pre class=" language-java"><code class="language-java">LocalDate localDate <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// åˆå§‹åŒ–ä¸€ä¸ªæ—¥æœŸï¼š2017-01-04</span><span class="token keyword">int</span> year <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">getYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment" spellcheck="true">// å¹´ä»½ï¼š2017</span>Month month <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment" spellcheck="true">// æœˆä»½ï¼šJANUARY</span><span class="token keyword">int</span> dayOfMonth <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">getDayOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// æœˆä»½ä¸­çš„ç¬¬å‡ å¤©ï¼š4</span>DayOfWeek dayOfWeek <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">getDayOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// ä¸€å‘¨çš„ç¬¬å‡ å¤©ï¼šWEDNESDAY</span><span class="token keyword">int</span> length <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">lengthOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment" spellcheck="true">// æœˆä»½çš„å¤©æ•°ï¼š31</span><span class="token keyword">boolean</span> leapYear <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">isLeapYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// æ˜¯å¦ä¸ºé—°å¹´ï¼šfalse</span></code></pre><p>ä¹Ÿå¯ä»¥è°ƒç”¨é™æ€æ–¹æ³•<code>now()</code>æ¥è·å–å½“å‰æ—¥æœŸï¼š</p><pre class=" language-java"><code class="language-java">LocalDate now <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>LocalTime</code>å’Œ<code>LocalDate</code>ç±»ä¼¼ï¼Œä»–ä»¬ä¹‹é—´çš„åŒºåˆ«åœ¨äº<code>LocalDate</code>ä¸åŒ…å«å…·ä½“æ—¶é—´ï¼Œè€Œ<code>LocalTime</code>åŒ…å«å…·ä½“æ—¶é—´ï¼Œä¾‹å¦‚ï¼š</p><pre class=" language-java"><code class="language-java">LocalTime localTime <span class="token operator">=</span> LocalTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// åˆå§‹åŒ–ä¸€ä¸ªæ—¶é—´ï¼š17:23:52</span><span class="token keyword">int</span> hour <span class="token operator">=</span> localTime<span class="token punctuation">.</span><span class="token function">getHour</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment" spellcheck="true">// æ—¶ï¼š17</span><span class="token keyword">int</span> minute <span class="token operator">=</span> localTime<span class="token punctuation">.</span><span class="token function">getMinute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment" spellcheck="true">// åˆ†ï¼š23</span><span class="token keyword">int</span> second <span class="token operator">=</span> localTime<span class="token punctuation">.</span><span class="token function">getSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment" spellcheck="true">// ç§’ï¼š52</span></code></pre><h3 id="LocalDateTime"><a href="#LocalDateTime" class="headerlink" title="LocalDateTime"></a><code>LocalDateTime</code></h3><p><code>LocalDateTime</code>ç±»æ˜¯<code>LocalDate</code>å’Œ<code>LocalTime</code>çš„ç»“åˆä½“ï¼Œå¯ä»¥é€šè¿‡<code>of()</code>æ–¹æ³•ç›´æ¥åˆ›å»ºï¼Œä¹Ÿå¯ä»¥è°ƒç”¨<code>LocalDate</code>çš„<code>atTime()</code>æ–¹æ³•æˆ–<code>LocalTime</code>çš„<code>atDate()</code>æ–¹æ³•å°†<code>LocalDate</code>æˆ–<code>LocalTime</code>åˆå¹¶æˆä¸€ä¸ª<code>LocalDateTime</code>ï¼š</p><pre class=" language-java"><code class="language-java">LocalDateTime ldt1 <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> Month<span class="token punctuation">.</span>JANUARY<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">)</span><span class="token punctuation">;</span>LocalDate localDate <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> Month<span class="token punctuation">.</span>JANUARY<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>LocalTime localTime <span class="token operator">=</span> LocalTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">)</span><span class="token punctuation">;</span>LocalDateTime ldt2 <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">atTime</span><span class="token punctuation">(</span>localTime<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>LocalDateTime</code>ä¹Ÿæä¾›ç”¨äºå‘<code>LocalDate</code>å’Œ<code>LocalTime</code>çš„è½¬åŒ–ï¼š</p><pre class=" language-java"><code class="language-java">LocalDate date <span class="token operator">=</span> ldt1<span class="token punctuation">.</span><span class="token function">toLocalDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>LocalTime time <span class="token operator">=</span> ldt1<span class="token punctuation">.</span><span class="token function">toLocalTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="Instant"><a href="#Instant" class="headerlink" title="Instant"></a><code>Instant</code></h3><p><code>Instant</code>ç”¨äºè¡¨ç¤ºä¸€ä¸ªæ—¶é—´æˆ³ï¼Œå®ƒä¸æˆ‘ä»¬å¸¸ä½¿ç”¨çš„<code>System.currentTimeMillis()</code>æœ‰äº›ç±»ä¼¼ï¼Œä¸è¿‡<code>Instant</code>å¯ä»¥ç²¾ç¡®åˆ°çº³ç§’ï¼ˆNano-Secondï¼‰ï¼Œ<code>System.currentTimeMillis()</code>æ–¹æ³•åªç²¾ç¡®åˆ°æ¯«ç§’ï¼ˆMilli-Secondï¼‰ã€‚å¦‚æœæŸ¥çœ‹<code>Instant</code>æºç ï¼Œå‘ç°å®ƒçš„å†…éƒ¨ä½¿ç”¨äº†ä¸¤ä¸ªå¸¸é‡ï¼Œ<code>seconds</code>è¡¨ç¤ºä»1970-01-01 00:00:00å¼€å§‹åˆ°ç°åœ¨çš„ç§’æ•°ï¼Œ<code>nanos</code>è¡¨ç¤ºçº³ç§’éƒ¨åˆ†ï¼ˆ<code>nanos</code>çš„å€¼ä¸ä¼šè¶…è¿‡<code>999,999,999</code>ï¼‰ã€‚<code>Instant</code>é™¤äº†ä½¿ç”¨<code>now()</code>æ–¹æ³•åˆ›å»ºå¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡<code>ofEpochSecond</code>æ–¹æ³•åˆ›å»ºï¼š</p><pre class=" language-java"><code class="language-java">Instant instant <span class="token operator">=</span> Instant<span class="token punctuation">.</span><span class="token function">ofEpochSecond</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>ofEpochSecond()</code>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç§’ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºçº³ç§’ï¼Œä¸Šé¢çš„ä»£ç è¡¨ç¤ºä»1970-01-01 00:00:00å¼€å§‹åä¸¤åˆ†é’Ÿçš„10ä¸‡çº³ç§’çš„æ—¶åˆ»ï¼Œæ§åˆ¶å°ä¸Šçš„è¾“å‡ºä¸ºï¼š</p><pre><code>1970-01-01T00:02:00.000100Z</code></pre><h3 id="Duration"><a href="#Duration" class="headerlink" title="Duration"></a><code>Duration</code></h3><p><code>Duration</code>çš„å†…éƒ¨å®ç°ä¸<code>Instant</code>ç±»ä¼¼ï¼Œä¹Ÿæ˜¯åŒ…å«ä¸¤éƒ¨åˆ†ï¼š<code>seconds</code>è¡¨ç¤ºç§’ï¼Œ<code>nanos</code>è¡¨ç¤ºçº³ç§’ã€‚ä¸¤è€…çš„åŒºåˆ«æ˜¯<code>Instant</code>ç”¨äºè¡¨ç¤ºä¸€ä¸ªæ—¶é—´æˆ³ï¼ˆæˆ–è€…è¯´æ˜¯ä¸€ä¸ªæ—¶é—´ç‚¹ï¼‰ï¼Œè€Œ<code>Duration</code>è¡¨ç¤ºä¸€ä¸ªæ—¶é—´æ®µï¼Œæ‰€ä»¥<code>Duration</code>ç±»ä¸­ä¸åŒ…å«<code>now()</code>é™æ€æ–¹æ³•ã€‚å¯ä»¥é€šè¿‡<code>Duration.between()</code>æ–¹æ³•åˆ›å»º<code>Duration</code>å¯¹è±¡ï¼š</p><pre class=" language-java"><code class="language-java">LocalDateTime from <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> Month<span class="token punctuation">.</span>JANUARY<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 2017-01-05 10:07:00</span>LocalDateTime to <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> Month<span class="token punctuation">.</span>FEBRUARY<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// 2017-02-05 10:07:00</span>Duration duration <span class="token operator">=</span> Duration<span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// è¡¨ç¤ºä» 2017-01-05 10:07:00 åˆ° 2017-02-05 10:07:00 è¿™æ®µæ—¶é—´</span><span class="token keyword">long</span> days <span class="token operator">=</span> duration<span class="token punctuation">.</span><span class="token function">toDays</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment" spellcheck="true">// è¿™æ®µæ—¶é—´çš„æ€»å¤©æ•°</span><span class="token keyword">long</span> hours <span class="token operator">=</span> duration<span class="token punctuation">.</span><span class="token function">toHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// è¿™æ®µæ—¶é—´çš„å°æ—¶æ•°</span><span class="token keyword">long</span> minutes <span class="token operator">=</span> duration<span class="token punctuation">.</span><span class="token function">toMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// è¿™æ®µæ—¶é—´çš„åˆ†é’Ÿæ•°</span><span class="token keyword">long</span> seconds <span class="token operator">=</span> duration<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">// è¿™æ®µæ—¶é—´çš„ç§’æ•°</span><span class="token keyword">long</span> milliSeconds <span class="token operator">=</span> duration<span class="token punctuation">.</span><span class="token function">toMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// è¿™æ®µæ—¶é—´çš„æ¯«ç§’æ•°</span><span class="token keyword">long</span> nanoSeconds <span class="token operator">=</span> duration<span class="token punctuation">.</span><span class="token function">toNanos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// è¿™æ®µæ—¶é—´çš„çº³ç§’æ•°</span></code></pre><p><code>Duration</code>å¯¹è±¡è¿˜å¯ä»¥é€šè¿‡<code>of()</code>æ–¹æ³•åˆ›å»ºï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªæ—¶é—´æ®µé•¿åº¦ï¼Œå’Œä¸€ä¸ªæ—¶é—´å•ä½ä½œä¸ºå‚æ•°ï¼š</p><pre class=" language-java"><code class="language-java">Duration duration1 <span class="token operator">=</span> Duration<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> ChronoUnit<span class="token punctuation">.</span>DAYS<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">// 5å¤©</span>Duration duration2 <span class="token operator">=</span> Duration<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> ChronoUnit<span class="token punctuation">.</span>MILLIS<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 1000æ¯«ç§’</span></code></pre><h3 id="Period"><a href="#Period" class="headerlink" title="Period"></a><code>Period</code></h3><p><code>Period</code>åœ¨æ¦‚å¿µä¸Šå’Œ<code>Duration</code>ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äº<code>Period</code>æ˜¯ä»¥å¹´æœˆæ—¥æ¥è¡¡é‡ä¸€ä¸ªæ—¶é—´æ®µï¼Œæ¯”å¦‚2å¹´3ä¸ªæœˆ6å¤©ï¼š</p><pre class=" language-java"><code class="language-java">Period period <span class="token operator">=</span> Period<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>Period</code>å¯¹è±¡ä¹Ÿå¯ä»¥é€šè¿‡<code>between()</code>æ–¹æ³•åˆ›å»ºï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”±äº<code>Period</code>æ˜¯ä»¥å¹´æœˆæ—¥è¡¡é‡æ—¶é—´æ®µï¼Œæ‰€ä»¥between()æ–¹æ³•åªèƒ½æ¥æ”¶LocalDateç±»å‹çš„å‚æ•°ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 2017-01-05 åˆ° 2017-02-05 è¿™æ®µæ—¶é—´</span>Period period <span class="token operator">=</span> Period<span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span>                LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="æ—¥æœŸçš„æ“ä½œå’Œæ ¼å¼åŒ–"><a href="#æ—¥æœŸçš„æ“ä½œå’Œæ ¼å¼åŒ–" class="headerlink" title="æ—¥æœŸçš„æ“ä½œå’Œæ ¼å¼åŒ–"></a>æ—¥æœŸçš„æ“ä½œå’Œæ ¼å¼åŒ–</h2><h3 id="å¢åŠ å’Œå‡å°‘æ—¥æœŸ"><a href="#å¢åŠ å’Œå‡å°‘æ—¥æœŸ" class="headerlink" title="å¢åŠ å’Œå‡å°‘æ—¥æœŸ"></a>å¢åŠ å’Œå‡å°‘æ—¥æœŸ</h3><p>Java 8ä¸­çš„æ—¥æœŸ/æ—¶é—´ç±»éƒ½æ˜¯ä¸å¯å˜çš„ï¼Œè¿™æ˜¯ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚å½“ç„¶ï¼Œæ–°çš„æ—¥æœŸ/æ—¶é—´ç±»ä¹Ÿæä¾›äº†æ–¹æ³•ç”¨äºåˆ›å»ºå¯¹è±¡çš„å¯å˜ç‰ˆæœ¬ï¼Œæ¯”å¦‚å¢åŠ ä¸€å¤©æˆ–è€…å‡å°‘ä¸€å¤©ï¼š</p><pre class=" language-java"><code class="language-java">LocalDate date <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// 2017-01-05</span>LocalDate date1 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">withYear</span><span class="token punctuation">(</span><span class="token number">2016</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment" spellcheck="true">// ä¿®æ”¹ä¸º 2016-01-05</span>LocalDate date2 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">withMonth</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// ä¿®æ”¹ä¸º 2017-02-05</span>LocalDate date3 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">withDayOfMonth</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment" spellcheck="true">// ä¿®æ”¹ä¸º 2017-01-01</span>LocalDate date4 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">plusYears</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// å¢åŠ ä¸€å¹´ 2018-01-05</span>LocalDate date5 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">minusMonths</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment" spellcheck="true">// å‡å°‘ä¸¤ä¸ªæœˆ 2016-11-05</span>LocalDate date6 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> ChronoUnit<span class="token punctuation">.</span>DAYS<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å¢åŠ 5å¤© 2017-01-10</span></code></pre><p>ä¸Šé¢ä¾‹å­ä¸­å¯¹äºæ—¥æœŸçš„æ“ä½œæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™æˆ‘ä»¬è¦é¢ä¸´æ›´å¤æ‚çš„æ—¶é—´æ“ä½œï¼Œæ¯”å¦‚å°†æ—¶é—´è°ƒåˆ°ä¸‹ä¸€ä¸ªå·¥ä½œæ—¥ï¼Œæˆ–è€…æ˜¯ä¸‹ä¸ªæœˆçš„æœ€åä¸€å¤©ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>with()</code>æ–¹æ³•çš„å¦ä¸€ä¸ªé‡è½½æ–¹æ³•ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª<code>TemporalAdjuster</code>å‚æ•°ï¼Œå¯ä»¥ä½¿æˆ‘ä»¬æ›´åŠ çµæ´»çš„è°ƒæ•´æ—¥æœŸï¼š</p><pre class=" language-java"><code class="language-java">LocalDate date7 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token function">nextOrSame</span><span class="token punctuation">(</span>DayOfWeek<span class="token punctuation">.</span>SUNDAY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// è¿”å›ä¸‹ä¸€ä¸ªè·ç¦»å½“å‰æ—¶é—´æœ€è¿‘çš„æ˜ŸæœŸæ—¥</span>LocalDate date9 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token function">lastInMonth</span><span class="token punctuation">(</span>DayOfWeek<span class="token punctuation">.</span>SATURDAY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// è¿”å›æœ¬æœˆæœ€åä¸€ä¸ªæ˜ŸæœŸå…­</span></code></pre><p>è¦ä½¿ä¸Šé¢çš„ä»£ç æ­£ç¡®ç¼–è¯‘ï¼Œä½ éœ€è¦ä½¿ç”¨é™æ€å¯¼å…¥<code>TemporalAdjusters</code>å¯¹è±¡ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>temporal<span class="token punctuation">.</span>TemporalAdjusters<span class="token punctuation">.</span>*<span class="token punctuation">;</span></code></pre><p><code>TemporalAdjusters</code>ç±»ä¸­åŒ…å«äº†å¾ˆå¤šé™æ€æ–¹æ³•å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸‹é¢çš„è¡¨æ ¼åˆ—å‡ºäº†ä¸€äº›æ–¹æ³•ï¼š</p><table><thead><tr><th>æ–¹æ³•å</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>dayOfWeekInMonth</code></td><td>è¿”å›åŒä¸€ä¸ªæœˆä¸­æ¯å‘¨çš„ç¬¬å‡ å¤©</td></tr><tr><td><code>firstDayOfMonth</code></td><td>è¿”å›å½“æœˆçš„ç¬¬ä¸€å¤©</td></tr><tr><td><code>firstDayOfNextMonth</code></td><td>è¿”å›ä¸‹æœˆçš„ç¬¬ä¸€å¤©</td></tr><tr><td><code>firstDayOfNextYear</code></td><td>è¿”å›ä¸‹ä¸€å¹´çš„ç¬¬ä¸€å¤©</td></tr><tr><td><code>firstDayOfYear</code></td><td>è¿”å›æœ¬å¹´çš„ç¬¬ä¸€å¤©</td></tr><tr><td><code>firstInMonth</code></td><td>è¿”å›åŒä¸€ä¸ªæœˆä¸­ç¬¬ä¸€ä¸ªæ˜ŸæœŸå‡ </td></tr><tr><td><code>lastDayOfMonth</code></td><td>è¿”å›å½“æœˆçš„æœ€åä¸€å¤©</td></tr><tr><td><code>lastDayOfNextMonth</code></td><td>è¿”å›ä¸‹æœˆçš„æœ€åä¸€å¤©</td></tr><tr><td><code>lastDayOfNextYear</code></td><td>è¿”å›ä¸‹ä¸€å¹´çš„æœ€åä¸€å¤©</td></tr><tr><td><code>lastDayOfYear</code></td><td>è¿”å›æœ¬å¹´çš„æœ€åä¸€å¤©</td></tr><tr><td><code>lastInMonth</code></td><td>è¿”å›åŒä¸€ä¸ªæœˆä¸­æœ€åä¸€ä¸ªæ˜ŸæœŸå‡ </td></tr><tr><td><code>next / previous</code></td><td>è¿”å›åä¸€ä¸ª/å‰ä¸€ä¸ªç»™å®šçš„æ˜ŸæœŸå‡ </td></tr><tr><td><code>nextOrSame / previousOrSame</code></td><td>è¿”å›åä¸€ä¸ª/å‰ä¸€ä¸ªç»™å®šçš„æ˜ŸæœŸå‡ ï¼Œå¦‚æœè¿™ä¸ªå€¼æ»¡è¶³æ¡ä»¶ï¼Œç›´æ¥è¿”å›</td></tr></tbody></table><p>å¦‚æœä¸Šé¢è¡¨æ ¼ä¸­åˆ—å‡ºçš„æ–¹æ³•ä¸èƒ½æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œä½ è¿˜å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„<code>TemporalAdjuster</code>æ¥å£çš„å®ç°ï¼Œ<code>TemporalAdjuster</code>ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Lambdaè¡¨è¾¾å¼ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@FunctionalInterface</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TemporalAdjuster</span> <span class="token punctuation">{</span>    Temporal <span class="token function">adjustInto</span><span class="token punctuation">(</span>Temporal temporal<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>æ¯”å¦‚ç»™å®šä¸€ä¸ªæ—¥æœŸï¼Œè®¡ç®—è¯¥æ—¥æœŸçš„ä¸‹ä¸€ä¸ªå·¥ä½œæ—¥ï¼ˆä¸åŒ…æ‹¬æ˜ŸæœŸå…­å’Œæ˜ŸæœŸå¤©ï¼‰ï¼š</p><pre class=" language-java"><code class="language-java">LocalDate date <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>date<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>temporal <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// å½“å‰æ—¥æœŸ</span>    DayOfWeek dayOfWeek <span class="token operator">=</span> DayOfWeek<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>temporal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ChronoField<span class="token punctuation">.</span>DAY_OF_WEEK<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ¯æ¬¡å¢åŠ ä¸€å¤©</span>    <span class="token keyword">int</span> dayToAdd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯æ˜ŸæœŸäº”ï¼Œå¢åŠ ä¸‰å¤©</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>dayOfWeek <span class="token operator">==</span> DayOfWeek<span class="token punctuation">.</span>FRIDAY<span class="token punctuation">)</span> <span class="token punctuation">{</span>        dayToAdd <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// å¦‚æœæ˜¯æ˜ŸæœŸå…­ï¼Œå¢åŠ ä¸¤å¤©</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>dayOfWeek <span class="token operator">==</span> DayOfWeek<span class="token punctuation">.</span>SATURDAY<span class="token punctuation">)</span> <span class="token punctuation">{</span>        dayToAdd <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> temporal<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span>dayToAdd<span class="token punctuation">,</span> ChronoUnit<span class="token punctuation">.</span>DAYS<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="æ ¼å¼åŒ–æ—¥æœŸ"><a href="#æ ¼å¼åŒ–æ—¥æœŸ" class="headerlink" title="æ ¼å¼åŒ–æ—¥æœŸ"></a>æ ¼å¼åŒ–æ—¥æœŸ</h3><p>æ–°çš„æ—¥æœŸAPIä¸­æä¾›äº†ä¸€ä¸ª<code>DateTimeFormatter</code>ç±»ç”¨äºå¤„ç†æ—¥æœŸæ ¼å¼åŒ–æ“ä½œï¼Œå®ƒè¢«åŒ…å«åœ¨<code>java.time.format</code>åŒ…ä¸­ï¼ŒJava 8çš„æ—¥æœŸç±»æœ‰ä¸€ä¸ª<code>format()</code>æ–¹æ³•ç”¨äºå°†æ—¥æœŸæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ª<code>DateTimeFormatter</code>ç±»å‹å‚æ•°ï¼š</p><pre class=" language-java"><code class="language-java">LocalDateTime dateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>String strDate1 <span class="token operator">=</span> dateTime<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span>BASIC_ISO_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 20170105</span>String strDate2 <span class="token operator">=</span> dateTime<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span>ISO_LOCAL_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 2017-01-05</span>String strDate3 <span class="token operator">=</span> dateTime<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span>ISO_LOCAL_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 14:20:16.998</span>String strDate4 <span class="token operator">=</span> dateTime<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// 2017-01-05</span>String strDate5 <span class="token operator">=</span> dateTime<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"ä»Šå¤©æ˜¯ï¼šYYYYå¹´ MMMM DDæ—¥ E"</span><span class="token punctuation">,</span> Locale<span class="token punctuation">.</span>CHINESE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ä»Šå¤©æ˜¯ï¼š2017å¹´ ä¸€æœˆ 05æ—¥ æ˜ŸæœŸå››</span></code></pre><p>åŒæ ·ï¼Œæ—¥æœŸç±»ä¹Ÿæ”¯æŒå°†ä¸€ä¸ªå­—ç¬¦ä¸²è§£ææˆä¸€ä¸ªæ—¥æœŸå¯¹è±¡ï¼Œä¾‹å¦‚ï¼š</p><pre class=" language-java"><code class="language-java">String strDate6 <span class="token operator">=</span> <span class="token string">"2017-01-05"</span><span class="token punctuation">;</span>String strDate7 <span class="token operator">=</span> <span class="token string">"2017-01-05 12:30:05"</span><span class="token punctuation">;</span>LocalDate date <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>strDate6<span class="token punctuation">,</span> DateTimeFormatter<span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>LocalDateTime dateTime1 <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>strDate7<span class="token punctuation">,</span> DateTimeFormatter<span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="æ—¶åŒº"><a href="#æ—¶åŒº" class="headerlink" title="æ—¶åŒº"></a>æ—¶åŒº</h2><p>Java 8ä¸­çš„æ—¶åŒºæ“ä½œè¢«å¾ˆå¤§ç¨‹åº¦ä¸Šç®€åŒ–äº†ï¼Œæ–°çš„æ—¶åŒºç±»<code>java.time.ZoneId</code>æ˜¯åŸæœ‰çš„<code>java.util.TimeZone</code>ç±»çš„æ›¿ä»£å“ã€‚<code>ZoneId</code>å¯¹è±¡å¯ä»¥é€šè¿‡<code>ZoneId.of()</code>æ–¹æ³•åˆ›å»ºï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>ZoneId.systemDefault()</code>è·å–ç³»ç»Ÿé»˜è®¤æ—¶åŒºï¼š</p><pre class=" language-java"><code class="language-java">ZoneId shanghaiZoneId <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Asia/Shanghai"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ZoneId systemZoneId <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>of()</code>æ–¹æ³•æ¥æ”¶ä¸€ä¸ªâ€œåŒºåŸŸ/åŸå¸‚â€çš„å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œä½ å¯ä»¥é€šè¿‡<code>getAvailableZoneIds()</code>æ–¹æ³•è·å–æ‰€æœ‰åˆæ³•çš„â€œåŒºåŸŸ/åŸå¸‚â€å­—ç¬¦ä¸²ï¼š</p><pre class=" language-java"><code class="language-java">Set<span class="token operator">&lt;</span>String<span class="token operator">></span> zoneIds <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">getAvailableZoneIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å¯¹äºè€çš„æ—¶åŒºç±»<code>TimeZone</code>ï¼ŒJava 8ä¹Ÿæä¾›äº†è½¬åŒ–æ–¹æ³•ï¼š</p><pre class=" language-java"><code class="language-java">ZoneId oldToNewZoneId <span class="token operator">=</span> TimeZone<span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toZoneId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æœ‰äº†<code>ZoneId</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†ä¸€ä¸ª<code>LocalDate</code>ã€<code>LocalTime</code>æˆ–<code>LocalDateTime</code>å¯¹è±¡è½¬åŒ–ä¸º<code>ZonedDateTime</code>å¯¹è±¡ï¼š</p><pre class=" language-java"><code class="language-java">LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ZonedDateTime zonedDateTime <span class="token operator">=</span> ZonedDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>localDateTime<span class="token punctuation">,</span> shanghaiZoneId<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å°†<code>zonedDateTime</code>æ‰“å°åˆ°æ§åˆ¶å°ä¸ºï¼š</p><pre class=" language-java"><code class="language-java"><span class="token number">2017</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span>05T15<span class="token operator">:</span><span class="token number">26</span><span class="token operator">:</span><span class="token number">56.147</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">[</span>Asia<span class="token operator">/</span>Shanghai<span class="token punctuation">]</span></code></pre><p><code>ZonedDateTime</code>å¯¹è±¡ç”±ä¸¤éƒ¨åˆ†æ„æˆï¼Œ<code>LocalDateTime</code>å’Œ<code>ZoneId</code>ï¼Œå…¶ä¸­<code>2017-01-05T15:26:56.147</code>éƒ¨åˆ†ä¸º<code>LocalDateTime</code>ï¼Œ<code>+08:00[Asia/Shanghai]</code>éƒ¨åˆ†ä¸º<code>ZoneId</code>ã€‚</p><p>å¦ä¸€ç§è¡¨ç¤ºæ—¶åŒºçš„æ–¹å¼æ˜¯ä½¿ç”¨<code>ZoneOffset</code>ï¼Œå®ƒæ˜¯ä»¥å½“å‰æ—¶é—´å’Œ<strong>ä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼ˆUTCï¼‰/æ ¼æ—å¨æ²»æ—¶é—´ï¼ˆGMTï¼‰</strong>çš„åå·®æ¥è®¡ç®—ï¼Œä¾‹å¦‚ï¼š</p><pre class=" language-java"><code class="language-java">ZoneOffset zoneOffset <span class="token operator">=</span> ZoneOffset<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"+09:00"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>OffsetDateTime offsetDateTime <span class="token operator">=</span> OffsetDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>localDateTime<span class="token punctuation">,</span> zoneOffset<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="å…¶ä»–å†æ³•"><a href="#å…¶ä»–å†æ³•" class="headerlink" title="å…¶ä»–å†æ³•"></a>å…¶ä»–å†æ³•</h2><p>Javaä¸­ä½¿ç”¨çš„å†æ³•æ˜¯ISO 8601æ—¥å†ç³»ç»Ÿï¼Œå®ƒæ˜¯ä¸–ç•Œæ°‘ç”¨å†æ³•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å…¬å†ã€‚å¹³å¹´æœ‰365å¤©ï¼Œé—°å¹´æ˜¯366å¤©ã€‚é—°å¹´çš„å®šä¹‰æ˜¯ï¼šéä¸–çºªå¹´ï¼Œèƒ½è¢«4æ•´é™¤ï¼›ä¸–çºªå¹´èƒ½è¢«400æ•´é™¤ã€‚ä¸ºäº†è®¡ç®—çš„ä¸€è‡´æ€§ï¼Œå…¬å…ƒ1å¹´çš„å‰ä¸€å¹´è¢«å½“åšå…¬å…ƒ0å¹´ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>æ­¤å¤–Java 8è¿˜æä¾›äº†4å¥—å…¶ä»–å†æ³•ï¼ˆå¾ˆå¥‡æ€ªä¸ºä»€ä¹ˆæ²¡æœ‰æ±‰æ—äººä½¿ç”¨çš„å†œå†ï¼‰ï¼Œæ¯å¥—å†æ³•éƒ½åŒ…å«ä¸€ä¸ªæ—¥æœŸç±»ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li><code>ThaiBuddhistDate</code>ï¼šæ³°å›½ä½›æ•™å†</li><li><code>MinguoDate</code>ï¼šä¸­åæ°‘å›½å†</li><li><code>JapaneseDate</code>ï¼šæ—¥æœ¬å†</li><li><code>HijrahDate</code>ï¼šä¼Šæ–¯å…°å†</li></ul><p>æ¯ä¸ªæ—¥æœŸç±»éƒ½ç»§æ‰¿<code>ChronoLocalDate</code>ç±»ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä¸çŸ¥é“å…·ä½“å†æ³•çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥æ“ä½œã€‚ä¸è¿‡è¿™äº›å†æ³•ä¸€èˆ¬ä¸å¸¸ç”¨ï¼Œé™¤éæ˜¯æœ‰æŸäº›ç‰¹æ®Šéœ€æ±‚æƒ…å†µä¸‹æ‰ä¼šä½¿ç”¨ã€‚</p><p>è¿™äº›ä¸åŒçš„å†æ³•ä¹Ÿå¯ä»¥ç”¨äºå‘å…¬å†è½¬æ¢ï¼š</p><pre class=" language-java"><code class="language-java">LocalDate date <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>JapaneseDate jpDate <span class="token operator">=</span> JapaneseDate<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ç”±äºå®ƒä»¬éƒ½ç»§æ‰¿<code>ChronoLocalDate</code>ç±»ï¼Œæ‰€ä»¥åœ¨ä¸çŸ¥é“å…·ä½“å†æ³•æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡<code>ChronoLocalDate</code>ç±»æ“ä½œæ—¥æœŸï¼š</p><pre class=" language-java"><code class="language-java">Chronology jpChronology <span class="token operator">=</span> Chronology<span class="token punctuation">.</span><span class="token function">ofLocale</span><span class="token punctuation">(</span>Locale<span class="token punctuation">.</span>JAPANESE<span class="token punctuation">)</span><span class="token punctuation">;</span>ChronoLocalDate jpChronoLocalDate <span class="token operator">=</span> jpChronology<span class="token punctuation">.</span><span class="token function">dateNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­åº”è¯¥å°½é‡é¿å…ä½¿ç”¨<code>ChronoLocalDate</code>ï¼Œå°½é‡ç”¨ä¸å†æ³•æ— å…³çš„æ–¹å¼æ“ä½œæ—¶é—´ï¼Œå› ä¸ºä¸åŒçš„å†æ³•è®¡ç®—æ—¥æœŸçš„æ–¹å¼ä¸ä¸€æ ·ï¼Œæ¯”å¦‚å¼€å‘è€…ä¼šåœ¨ç¨‹åºä¸­åšä¸€äº›å‡è®¾ï¼Œå‡è®¾ä¸€å¹´ä¸­æœ‰12ä¸ªæœˆï¼Œå¦‚æœæ˜¯ä¸­å›½å†œå†ä¸­åŒ…å«äº†é—°æœˆï¼Œä¸€å¹´æœ‰å¯èƒ½æ˜¯13ä¸ªæœˆï¼Œä½†å¼€å‘è€…è®¤ä¸ºæ˜¯12ä¸ªæœˆï¼Œå¤šå‡ºæ¥çš„ä¸€ä¸ªæœˆå±äºæ˜å¹´çš„ã€‚å†æ¯”å¦‚å‡è®¾å¹´ä»½æ˜¯ç´¯åŠ çš„ï¼Œè¿‡äº†ä¸€å¹´å°±åœ¨åŸæ¥çš„å¹´ä»½ä¸ŠåŠ ä¸€ï¼Œä½†æ—¥æœ¬å¤©çš‡åœ¨æ¢ä»£ä¹‹åéœ€è¦é‡æ–°çºªå¹´ï¼Œæ‰€ä»¥è¿‡äº†ä¸€å¹´å¹´ä»½å¯èƒ½ä¼šä»1å¼€å§‹è®¡ç®—ã€‚</p><p>åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­å»ºè®®ä½¿ç”¨<code>LocalDate</code>ï¼ŒåŒ…æ‹¬å­˜å‚¨ã€æ“ä½œã€ä¸šåŠ¡è§„åˆ™çš„è§£è¯»ï¼›é™¤ééœ€è¦å°†ç¨‹åºçš„è¾“å…¥æˆ–è€…è¾“å‡ºæœ¬åœ°åŒ–ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨<code>ChronoLocalDate</code>ç±»ã€‚</p><h2 id="Dateä¸LocalDateTimeç›¸äº’è½¬æ¢"><a href="#Dateä¸LocalDateTimeç›¸äº’è½¬æ¢" class="headerlink" title="Dateä¸LocalDateTimeç›¸äº’è½¬æ¢"></a>Dateä¸LocalDateTimeç›¸äº’è½¬æ¢</h2><ul><li>åœ¨Java 8ä¸­å°†Dateè½¬æ¢ä¸ºLocalDateTime</li></ul><blockquote><p>1.ä»æ—¥æœŸè·å–ZonedDateTimeå¹¶ä½¿ç”¨å…¶æ–¹æ³•toLocalDateTimeï¼ˆï¼‰è·å–LocalDateTime<br>2.ä½¿ç”¨LocalDateTimeçš„Instantï¼ˆï¼‰å·¥å‚æ–¹æ³•</p></blockquote><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**  * Date convert LocalDateTime  */</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Instant instant <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ZoneId zone <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">ofInstant</span><span class="token punctuation">(</span>instant<span class="token punctuation">,</span> zone<span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"localDateTime:{}"</span><span class="token punctuation">,</span> localDateTime<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/**  * Date convert LocalDate  */</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Instant instant <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ZoneId zone <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">ofInstant</span><span class="token punctuation">(</span>instant<span class="token punctuation">,</span> zone<span class="token punctuation">)</span><span class="token punctuation">;</span>    LocalDate localDate <span class="token operator">=</span> localDateTime<span class="token punctuation">.</span><span class="token function">toLocalDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"localDate:{}"</span><span class="token punctuation">,</span> localDate<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/**  * Date convert LocalTime  */</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Instant instant <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ZoneId zone <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">ofInstant</span><span class="token punctuation">(</span>instant<span class="token punctuation">,</span> zone<span class="token punctuation">)</span><span class="token punctuation">;</span>    LocalTime localTime <span class="token operator">=</span> localDateTime<span class="token punctuation">.</span><span class="token function">toLocalTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"localTime:{}"</span><span class="token punctuation">,</span> localTime<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨LocalDateTimeçš„FactoryInputï¼ˆï¼‰æ–¹æ³•ä½¿ç”¨ç³»ç»Ÿçš„é»˜è®¤æ—¶åŒºã€‚</span>LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">ofInstant</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> zoneId<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>åœ¨Java 8ä¸­å°†LocalDateTimeè½¬æ¢ä¸ºDate</li></ul><blockquote><p>1.ä½¿ç”¨atZoneï¼ˆï¼‰æ–¹æ³•å°†LocalDateTimeè½¬æ¢ä¸ºZonedDateTime<br>2.å°†ZonedDateTimeè½¬æ¢ä¸ºInstantï¼Œå¹¶ä»ä¸­è·å–Date</p></blockquote><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**  * LocalDateTime to Date  */</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ZoneId zone <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Instant instant <span class="token operator">=</span> localDateTime<span class="token punctuation">.</span><span class="token function">atZone</span><span class="token punctuation">(</span>zone<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date date <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>instant<span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"date:{}"</span><span class="token punctuation">,</span> date<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/**  * LocalDate to Date  */</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    LocalDate localDate <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ZoneId zone <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Instant instant <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">atStartOfDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">atZone</span><span class="token punctuation">(</span>zone<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date date <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>instant<span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"date:{}"</span><span class="token punctuation">,</span> date<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/**  * LocalTime to Date  */</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    LocalTime localTime <span class="token operator">=</span> LocalTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    LocalDate localDate <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>localDate<span class="token punctuation">,</span> localTime<span class="token punctuation">)</span><span class="token punctuation">;</span>    ZoneId zone <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Instant instant <span class="token operator">=</span> localDateTime<span class="token punctuation">.</span><span class="token function">atZone</span><span class="token punctuation">(</span>zone<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date date <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>instant<span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"date:{}"</span><span class="token punctuation">,</span> date<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="å¸¸ç”¨æ“ä½œapi"><a href="#å¸¸ç”¨æ“ä½œapi" class="headerlink" title="å¸¸ç”¨æ“ä½œapi"></a>å¸¸ç”¨æ“ä½œapi</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>*<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>format<span class="token punctuation">.</span>DateTimeFormatter<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019/2/12. */</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Java8DatetimeTest</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * Date convert LocalDateTime     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Instant instant <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ZoneId zone <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">ofInstant</span><span class="token punctuation">(</span>instant<span class="token punctuation">,</span> zone<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"localDateTime:{}"</span><span class="token punctuation">,</span> localDateTime<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Date convert LocalDate     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Instant instant <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ZoneId zone <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">ofInstant</span><span class="token punctuation">(</span>instant<span class="token punctuation">,</span> zone<span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDate localDate <span class="token operator">=</span> localDateTime<span class="token punctuation">.</span><span class="token function">toLocalDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"localDate:{}"</span><span class="token punctuation">,</span> localDate<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Date convert LocalTime     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Instant instant <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ZoneId zone <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">ofInstant</span><span class="token punctuation">(</span>instant<span class="token punctuation">,</span> zone<span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalTime localTime <span class="token operator">=</span> localDateTime<span class="token punctuation">.</span><span class="token function">toLocalTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"localTime:{}"</span><span class="token punctuation">,</span> localTime<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * LocalDateTime to Date     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ZoneId zone <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Instant instant <span class="token operator">=</span> localDateTime<span class="token punctuation">.</span><span class="token function">atZone</span><span class="token punctuation">(</span>zone<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date date <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>instant<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"date:{}"</span><span class="token punctuation">,</span> date<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * LocalDate to Date     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        LocalDate localDate <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ZoneId zone <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Instant instant <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">atStartOfDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">atZone</span><span class="token punctuation">(</span>zone<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date date <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>instant<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"date:{}"</span><span class="token punctuation">,</span> date<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * LocalTime to Date     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        LocalTime localTime <span class="token operator">=</span> LocalTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDate localDate <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>localDate<span class="token punctuation">,</span> localTime<span class="token punctuation">)</span><span class="token punctuation">;</span>        ZoneId zone <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Instant instant <span class="token operator">=</span> localDateTime<span class="token punctuation">.</span><span class="token function">atZone</span><span class="token punctuation">(</span>zone<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date date <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>instant<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"date:{}"</span><span class="token punctuation">,</span> date<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test6</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        String s1 <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"YYYY-mm-dd HH:mm:ss.SSS"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDate s2 <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalTime s3 <span class="token operator">=</span> LocalTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"s1:{}"</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"s2:{}"</span><span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"s3:{}"</span><span class="token punctuation">,</span> s3<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test7</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">long</span> l1 <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> l2 <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">atZone</span><span class="token punctuation">(</span>ZoneId<span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEpochMilli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"l1:{}"</span><span class="token punctuation">,</span> l1<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"l2:{}"</span><span class="token punctuation">,</span> l2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java8 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jenkins åå°è¿›ç¨‹</title>
      <link href="2019/02/13/jenkins-background-process/"/>
      <url>2019/02/13/jenkins-background-process/</url>
      
        <content type="html"><![CDATA[<p>é…ç½® Jenkins Job çš„æ—¶å€™ï¼Œafter <code>mvn package</code> ç”¨å‘½ä»¤è¡Œ <code>nohup java -jar project-1.0-SNAPSHOT.jar &gt; /dev/null 2&gt;&amp;1 &amp; </code>èµ·ä¸€ä¸ª spring-boot é¡¹ç›®ï¼Œæ­»æ´»ä¸ç”Ÿæ•ˆã€‚</p><p>ssh åˆ°æœåŠ¡å™¨ä¸ŠæŸ¥ä¸åˆ°å¯¹åº”çš„è¿›ç¨‹ï¼Œè€Œç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œæ˜¯å®Œå…¨ OK çš„ã€‚</p><p>Google ä¸€ç•ªåå¾—çŸ¥ï¼Œè¿™æ˜¯ Jenkins çš„ç‰¹æ€§ã€‚</p><blockquote><p>To reliably kill processes spawned by a job during a build, Jenkins contains a bit of native code to list up such processes and kill them. This is tested on several platforms and architectures, but if you find a show-stopper problem because of this, you can disable this feature by setting a Java property named â€œhudson.util.ProcessTree.disableâ€ to the value â€œtrueâ€. This can be done as a parameter to the â€œjavaâ€ binary when starting Jenkins:</p></blockquote><pre><code>`java -Dhudson.util.ProcessTree.disable=true -jar jenkins.war`</code></pre><blockquote><p>The ProcessTreeKiller takes advantage of the fact that by default a new process gets a copy of the environment variables of its spawning/creating process.</p></blockquote><blockquote><p>It sets a specific environment variable in the process executing the build job. Later, when the user requests to stop the build jobâ€™s process it gets a list of all processes running on the computer and their environment variables, and looks for the environment variable that it initially set for the build jobâ€™s process.</p></blockquote><p>å…·ä½“é“¾æ¥è¯·ç‚¹å‡» <a href="https://wiki.jenkins-ci.org/display/JENKINS/ProcessTreeKiller">ProcessTreeKiller</a>ã€‚</p><p>å¤§æ¦‚æ„æ€æ˜¯ Jenkins æ˜¯åœ¨å¯åŠ¨ Job çš„æ—¶å€™ä¼šç»™å­è¿›ç¨‹è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œåœ¨ç»“æŸ Job çš„æ—¶å€™ä¼šæ£€æŸ¥è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ï¼Œå¦‚æœåŒ…å« Jenkins ç”Ÿæˆçš„ï¼Œkill æ‰ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>å¯åŠ¨ Jenkins çš„æ—¶å€™åŠ ä¸Š <code>-Dhudson.util.ProcessTree.disable=true</code>ï¼Œä¹Ÿå°±æ˜¯ <code>java -Dhudson.util.ProcessTree.disable=true -jar jenkins.war</code></li><li>åœ¨åå°è¿›ç¨‹å‰åŠ ä¸Š <code>BUILD_ID=dontKillMe</code>, ä¹Ÿå°±æ˜¯ <code>BUILD_ID=dontKillMe nohup java -jar project-1.0-SNAPSHOT.jar &gt; /dev/null 2&gt;&amp;1 &amp;</code></li></ol><p>é™¤äº†ä¸Šé¢ä¸¤ç§æ–¹å¼ï¼Œç½‘ä¸Šä¹Ÿæœ‰è¯´è®²nohupæ¢æˆ setsidçš„æ–¹å¼ï¼Œå¦‚æœ‰éœ€è¦ï¼Œå¯è‡ªè¡Œæµ‹è¯•éªŒè¯</p>]]></content>
      
      
      <categories>
          
          <category> Jenkins </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Jenkins </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaæ‹†åˆ†shellå‘½ä»¤æˆæ•°ç»„</title>
      <link href="2019/01/29/java-spilt-command/"/>
      <url>2019/01/29/java-spilt-command/</url>
      
        <content type="html"><![CDATA[<h1 id="å‘½ä»¤è¡Œæ‹†åˆ†æˆstringæ•°ç»„"><a href="#å‘½ä»¤è¡Œæ‹†åˆ†æˆstringæ•°ç»„" class="headerlink" title="å‘½ä»¤è¡Œæ‹†åˆ†æˆstringæ•°ç»„"></a>å‘½ä»¤è¡Œæ‹†åˆ†æˆstringæ•°ç»„</h1><ul><li>åŸå§‹å‘½ä»¤å¦‚ä¸‹</li></ul><pre class=" language-shell"><code class="language-shell">-p /path -d "here's my description" --verbose other args</code></pre><ul><li>éœ€è¦çš„æ‹†åˆ†ç»“æœå¦‚ä¸‹</li></ul><pre><code>Array[0] = -pArray[1] = /pathArray[2] = -dArray[3] = here's my descriptionArray[4] = --verboseArray[5] = otherArray[6] = args</code></pre><p><a href="https://stackoverflow.com/questions/3259143/split-a-string-containing-command-line-parameters-into-a-string-in-java#">stackoverflowä¸Šçš„é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆ</a></p><p><a href="https://mvnrepository.com/artifact/org.apache.ant/ant">ä¾èµ–çš„ant jar</a></p><p>scala å¯ä»¥ç›´æ¥ä½¿ç”¨scala.tools.cmdæä¾›çš„api</p><ul><li>è§£å†³æ–¹æ¡ˆ</li></ul><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * [code borrowed from ant.jar] * Crack a command line. * @param toProcess the command line to process. * @return the command line broken into strings. * An empty or null toProcess parameter results in a zero sized array. */</span><span class="token keyword">public</span> <span class="token keyword">static</span> String<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">translateCommandline</span><span class="token punctuation">(</span>String toProcess<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>toProcess <span class="token operator">==</span> null <span class="token operator">||</span> toProcess<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//no command? no string</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// parse with a simple finite state machine</span>    <span class="token keyword">final</span> <span class="token keyword">int</span> normal <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> <span class="token keyword">int</span> inQuote <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> <span class="token keyword">int</span> inDoubleQuote <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> state <span class="token operator">=</span> normal<span class="token punctuation">;</span>    <span class="token keyword">final</span> StringTokenizer tok <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringTokenizer</span><span class="token punctuation">(</span>toProcess<span class="token punctuation">,</span> <span class="token string">"\"\' "</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> ArrayList<span class="token operator">&lt;</span>String<span class="token operator">></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> StringBuilder current <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">boolean</span> lastTokenHasBeenQuoted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>tok<span class="token punctuation">.</span><span class="token function">hasMoreTokens</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        String nextTok <span class="token operator">=</span> tok<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">case</span> inQuote<span class="token operator">:</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"\'"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>nextTok<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                lastTokenHasBeenQuoted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                state <span class="token operator">=</span> normal<span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                current<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>nextTok<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> inDoubleQuote<span class="token operator">:</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"\""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>nextTok<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                lastTokenHasBeenQuoted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                state <span class="token operator">=</span> normal<span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                current<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>nextTok<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">default</span><span class="token operator">:</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"\'"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>nextTok<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                state <span class="token operator">=</span> inQuote<span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"\""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>nextTok<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                state <span class="token operator">=</span> inDoubleQuote<span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>nextTok<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>lastTokenHasBeenQuoted <span class="token operator">||</span> current<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>current<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    current<span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                current<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>nextTok<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            lastTokenHasBeenQuoted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>lastTokenHasBeenQuoted <span class="token operator">||</span> current<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>current<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> inQuote <span class="token operator">||</span> state <span class="token operator">==</span> inDoubleQuote<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"unbalanced quotes in "</span> <span class="token operator">+</span> toProcess<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> result<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>result<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring mvcæ–‡ä»¶ä¸Šä¼ ä¸‹è½½</title>
      <link href="2019/01/29/spring-file-upload-download/"/>
      <url>2019/01/29/spring-file-upload-download/</url>
      
        <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>æ–‡ä»¶ä¸Šä¼ æ˜¯é¡¹ç›®å¼€å‘ä¸­æœ€å¸¸è§çš„åŠŸèƒ½ã€‚ä¸ºäº†èƒ½ä¸Šä¼ æ–‡ä»¶ï¼Œå¿…é¡»å°†è¡¨å•çš„methodè®¾ç½®ä¸ºPOSTï¼Œå¹¶å°†enctypeè®¾ç½®ä¸ºmultipart/form-dataã€‚åªæœ‰åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨æ‰ä¼šæŠŠç”¨æˆ·é€‰æ‹©çš„æ–‡ä»¶ä»¥äºŒè¿›åˆ¶æ•°æ®å‘é€ç»™æœåŠ¡å™¨ã€‚<br>ä¸€æ—¦è®¾ç½®äº†enctypeä¸ºmultipart/form-dataï¼Œæµè§ˆå™¨å³ä¼šé‡‡ç”¨äºŒè¿›åˆ¶æµçš„æ–¹å¼æ¥å¤„ç†è¡¨å•æ•°æ®ï¼Œè€Œå¯¹äºæ–‡ä»¶ä¸Šä¼ çš„å¤„ç†åˆ™æ¶‰åŠåœ¨æœåŠ¡å™¨ç«¯è§£æåŸå§‹çš„HTTPå“åº”ã€‚åœ¨2003å¹´ï¼ŒApache Software Foundationå‘å¸ƒäº†å¼€æºçš„Commons FileUploadç»„ä»¶ï¼Œå…¶å¾ˆå¿«æˆä¸ºServlet/JSPç¨‹åºå‘˜ä¸Šä¼ æ–‡ä»¶çš„æœ€ä½³é€‰æ‹©ã€‚<br>Servlet3.0è§„èŒƒå·²ç»æä¾›æ–¹æ³•æ¥å¤„ç†æ–‡ä»¶ä¸Šä¼ ï¼Œä½†è¿™ç§ä¸Šä¼ éœ€è¦åœ¨Servletä¸­å®Œæˆã€‚è€ŒSpring MVCåˆ™æä¾›äº†æ›´ç®€å•çš„å°è£…ã€‚<br>Spring MVCä¸ºæ–‡ä»¶ä¸Šä¼ æä¾›äº†ç›´æ¥çš„æ”¯æŒï¼Œè¿™ç§æ”¯æŒæ˜¯ç”¨å³æ’å³ç”¨çš„MultipartResolverå®ç°çš„ã€‚Spring MVCä½¿ç”¨Apache Commons FileUploadæŠ€æœ¯å®ç°äº†ä¸€ä¸ªMultipartResolverå®ç°ç±»ï¼šCommonsMultipartResolverã€‚å› æ­¤ï¼ŒSpringMVCçš„æ–‡ä»¶ä¸Šä¼ è¿˜éœ€è¦ä¾èµ–Apache Commons FileUploadçš„ç»„ä»¶ã€‚ </p><h1 id="æ ¸å¿ƒä»£ç "><a href="#æ ¸å¿ƒä»£ç " class="headerlink" title="æ ¸å¿ƒä»£ç "></a>æ ¸å¿ƒä»£ç </h1><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>api<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Logger<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>LoggerFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>MultipartConfigFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span>InputStreamResource<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Resource<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpHeaders<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>MediaType<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>ResponseEntity<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Base64Utils<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span>FileCopyUtils<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span>unit<span class="token punctuation">.</span>DataSize<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>*<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span>MultipartFile<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>MultipartConfigElement<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>ServletOutputStream<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServletResponse<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>*<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>Files<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>Path<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>Paths<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>*<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * # ç¦ç”¨ thymeleaf ç¼“å­˜ * spring.thymeleaf.cache=false * &lt;p> * # æ˜¯å¦æ”¯æŒæ‰¹é‡ä¸Šä¼    (é»˜è®¤å€¼ true) * spring.servlet.multipart.enabled=true * &lt;p> * # ä¸Šä¼ æ–‡ä»¶çš„ä¸´æ—¶ç›®å½• ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ä¸ç”¨ç‰¹æ„ä¿®æ”¹ï¼‰ * spring.servlet.multipart.location= * &lt;p> * # ä¸Šä¼ æ–‡ä»¶æœ€å¤§ä¸º 1M ï¼ˆé»˜è®¤å€¼ 1M æ ¹æ®è‡ªèº«ä¸šåŠ¡è‡ªè¡Œæ§åˆ¶å³å¯ï¼‰ * spring.servlet.multipart.max-file-size=1048576 * &lt;p> * # ä¸Šä¼ è¯·æ±‚æœ€å¤§ä¸º 10Mï¼ˆé»˜è®¤å€¼10M æ ¹æ®è‡ªèº«ä¸šåŠ¡è‡ªè¡Œæ§åˆ¶å³å¯ï¼‰ * spring.servlet.multipart.max-request-size=10485760 * &lt;p> * # æ–‡ä»¶å¤§å°é˜ˆå€¼ï¼Œå½“å¤§äºè¿™ä¸ªé˜ˆå€¼æ—¶å°†å†™å…¥åˆ°ç£ç›˜ï¼Œå¦åˆ™å­˜åœ¨å†…å­˜ä¸­ï¼Œï¼ˆé»˜è®¤å€¼0 ä¸€èˆ¬æƒ…å†µä¸‹ä¸ç”¨ç‰¹æ„ä¿®æ”¹ï¼‰ * spring.servlet.multipart.file-size-threshold=0 * &lt;p> * # åˆ¤æ–­æ˜¯å¦è¦å»¶è¿Ÿè§£ææ–‡ä»¶ï¼ˆç›¸å½“äºæ‡’åŠ è½½ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸ç”¨ç‰¹æ„ä¿®æ”¹ï¼‰ * spring.servlet.multipart.resolve-lazily=false * &lt;p> * Created by xiaozhangge on 2018/12/6. * http://localhost:8080/api/file/download2stream * http://localhost:8080/api/file/download */</span><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/api/file"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileApi</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Logger logger <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>FileApi<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> String FILE_NAME <span class="token operator">=</span> <span class="token string">"main.csv"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> String FILE_CONTENT <span class="token operator">=</span> <span class="token string">"key,value"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> String FILE_PATH <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user.dir"</span><span class="token punctuation">)</span> <span class="token operator">+</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">"tmp"</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">{</span>        File file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>FILE_PATH<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            file<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * é€šè¿‡ OutputStream æ¯æ¬¡å¾€å®¢æˆ·ç«¯å†™ buffer     *     * @param response     */</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/download"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">download</span><span class="token punctuation">(</span>HttpServletResponse response<span class="token punctuation">)</span> <span class="token punctuation">{</span>        InputStream inStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>FILE_CONTENT<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// è®¾ç½®å¼ºåˆ¶ä¸‹è½½ä¸æ‰“å¼€</span>        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/force-download"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// è®¾ç½®content-type</span>        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span>HttpHeaders<span class="token punctuation">.</span>CONTENT_TYPE<span class="token punctuation">,</span> <span class="token string">"application/octet-stream"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// è®¾ç½®æ–‡ä»¶å</span>        response<span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span>HttpHeaders<span class="token punctuation">.</span>CONTENT_DISPOSITION<span class="token punctuation">,</span> <span class="token string">"attachment;fileName="</span> <span class="token operator">+</span> FILE_NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        ServletOutputStream outStream <span class="token operator">=</span> null<span class="token punctuation">;</span>        BufferedInputStream bufferStream <span class="token operator">=</span> null<span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            outStream <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            bufferStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedInputStream</span><span class="token punctuation">(</span>inStream<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> len<span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> bufferStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                outStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            outStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            <span class="token function">close</span><span class="token punctuation">(</span>outStream<span class="token punctuation">,</span> bufferStream<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * æµå¼ä¸‹è½½     *     * @return     */</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/download2stream"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> ResponseEntity<span class="token operator">&lt;</span>Resource<span class="token operator">></span> <span class="token function">download2stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        InputStream inStream <span class="token operator">=</span> null<span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            inStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>FILE_CONTENT<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            Resource resource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputStreamResource</span><span class="token punctuation">(</span>inStream<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span>MediaType<span class="token punctuation">.</span><span class="token function">parseMediaType</span><span class="token punctuation">(</span><span class="token string">"application/octet-stream;charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span>HttpHeaders<span class="token punctuation">.</span>CONTENT_DISPOSITION<span class="token punctuation">,</span> <span class="token string">"attachment;fileName="</span> <span class="token operator">+</span> FILE_NAME<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"ä¸‹è½½å¼‚å¸¸:"</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            <span class="token function">close</span><span class="token punctuation">(</span>inStream<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * multipart/form-data     *     * @param file     * @return     */</span>    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/upload"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span> MultipartFile file<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è·å– resources ç›®å½•</span>        <span class="token comment" spellcheck="true">// String realPath = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest().getServletContext().getRealPath("");</span>        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"[æ–‡ä»¶ç±»å‹] - [{}]"</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"[æ–‡ä»¶åç§°] - [{}]"</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"[æ–‡ä»¶å¤§å°] - [{}]"</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            String fileName <span class="token operator">=</span> FILE_PATH <span class="token operator">+</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            Path path <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>            Files<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>            result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"contentType"</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"fileName"</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"fileSize"</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * å¤šæ–‡ä»¶ä¸Šä¼      *     * @param files     * @return     */</span>    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/multi-file-upload"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> List<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">>></span> <span class="token function">multiFileUpload</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span> MultipartFile<span class="token punctuation">[</span><span class="token punctuation">]</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>files <span class="token operator">==</span> null <span class="token operator">||</span> files<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> null<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        List<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">>></span> results <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map<span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>MultipartFile file <span class="token operator">:</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>                map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                String fileName <span class="token operator">=</span> FILE_PATH <span class="token operator">+</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                file<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"contentType"</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"fileName"</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"fileSize"</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                results<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> results<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * Base64æ–‡ä»¶ä¸Šä¼      * &lt;p>     * base64ç¼–ç ï¼š http://base64.xpcha.com/pic.html     *     * @param base64     * @return     */</span>    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/base64-upload"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">uploadBase64</span><span class="token punctuation">(</span>String base64<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// é˜²æ­¢æœ‰çš„ä¼ äº† data:image/png;base64, æœ‰çš„æ²¡ä¼ çš„æƒ…å†µ</span>        String<span class="token punctuation">[</span><span class="token punctuation">]</span> d <span class="token operator">=</span> base64<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"base64,"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> Base64Utils<span class="token punctuation">.</span><span class="token function">decodeFromString</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">?</span> d<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// BASE64 æ–¹å¼çš„ æ ¼å¼å’Œåå­—éœ€è¦è‡ªå·±æ§åˆ¶ï¼ˆå¦‚ png å›¾ç‰‡ç¼–ç åå‰ç¼€å°±ä¼šæ˜¯ data:image/png;base64,ï¼‰</span>        File tempFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>FILE_PATH <span class="token operator">+</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            FileCopyUtils<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> tempFile<span class="token punctuation">)</span><span class="token punctuation">;</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"fileSize"</span><span class="token punctuation">,</span> tempFile<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"fileName"</span><span class="token punctuation">,</span> tempFile<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"parent"</span><span class="token punctuation">,</span> tempFile<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> map<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span>Closeable<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> closeables<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>closeables <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span>Closeable io <span class="token operator">:</span> closeables<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>io <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        io<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"io close exception {}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> MultipartConfigElement <span class="token function">multipartConfigElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        MultipartConfigFactory factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MultipartConfigFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// æœ€å¤§æ”¯æŒæ–‡ä»¶å¤§å°</span>        factory<span class="token punctuation">.</span><span class="token function">setMaxFileSize</span><span class="token punctuation">(</span>DataSize<span class="token punctuation">.</span><span class="token function">ofMegabytes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// æœ€å¤§æ”¯æŒè¯·æ±‚å¤§å°</span>        factory<span class="token punctuation">.</span><span class="token function">setMaxRequestSize</span><span class="token punctuation">(</span>DataSize<span class="token punctuation">.</span><span class="token function">ofMegabytes</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// æ”¯æŒæ–‡ä»¶å†™å…¥ç£ç›˜.</span>        <span class="token comment" spellcheck="true">// factory.setFileSizeThreshold();</span>        <span class="token comment" spellcheck="true">// Sets the directory location where files will be stored.</span>        <span class="token comment" spellcheck="true">// factory.setLocation("ä¸Šä¼ æ–‡ä»¶çš„ä¸´æ—¶ç›®å½•");</span>        <span class="token keyword">return</span> factory<span class="token punctuation">.</span><span class="token function">createMultipartConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gitå¸¸ç”¨å‘½ä»¤</title>
      <link href="2019/01/29/git-command/"/>
      <url>2019/01/29/git-command/</url>
      
        <content type="html"><![CDATA[<h2 id="Gitå¸¸ç”¨å‘½ä»¤"><a href="#Gitå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Gitå¸¸ç”¨å‘½ä»¤"></a>Gitå¸¸ç”¨å‘½ä»¤</h2><h3 id="ä½¿ç”¨Gitç”Ÿæˆsshå¯†é’¥"><a href="#ä½¿ç”¨Gitç”Ÿæˆsshå¯†é’¥" class="headerlink" title="ä½¿ç”¨Gitç”Ÿæˆsshå¯†é’¥:"></a>ä½¿ç”¨Gitç”Ÿæˆsshå¯†é’¥:</h3><pre class=" language-shell"><code class="language-shell">ssh-keygen -t rsa -C "email@example.com"</code></pre><h3 id="è®¾ç½®å…¨å±€ç”¨æˆ·åå’Œé‚®ç®±"><a href="#è®¾ç½®å…¨å±€ç”¨æˆ·åå’Œé‚®ç®±" class="headerlink" title="è®¾ç½®å…¨å±€ç”¨æˆ·åå’Œé‚®ç®±:"></a>è®¾ç½®å…¨å±€ç”¨æˆ·åå’Œé‚®ç®±:</h3><pre class=" language-shell"><code class="language-shell">git config --global user.name "YourName"git config --global user.email "email@example.com"</code></pre><h3 id="åˆå§‹åŒ–ä»“åº“"><a href="#åˆå§‹åŒ–ä»“åº“" class="headerlink" title="åˆå§‹åŒ–ä»“åº“"></a>åˆå§‹åŒ–ä»“åº“</h3><pre class=" language-shell"><code class="language-shell">git init</code></pre><h3 id="æ·»åŠ æ–‡ä»¶åˆ°æš‚å­˜åŒº"><a href="#æ·»åŠ æ–‡ä»¶åˆ°æš‚å­˜åŒº" class="headerlink" title="æ·»åŠ æ–‡ä»¶åˆ°æš‚å­˜åŒº"></a>æ·»åŠ æ–‡ä»¶åˆ°æš‚å­˜åŒº</h3><pre class=" language-shell"><code class="language-shell">git add <filename>    #æ·»åŠ æŒ‡å®šæ–‡ä»¶åˆ°æš‚å­˜åŒºgit add .    #æ·»åŠ å·¥ä½œåŒºæ‰€æœ‰æ–‡ä»¶åˆ°æš‚å­˜åŒºgit add -i    #äº¤äº’æ–¹å¼æ·»åŠ æ–‡ä»¶åˆ°æš‚å­˜åŒºgit add -u    #å°†å·¥ä½œåŒºä¸­å·²ç»å˜åŠ¨çš„æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œå½“æ–°å¢åŠ çš„æ–‡ä»¶ä¸ä¼šè¢«æ·»åŠ </code></pre><h3 id="æäº¤æ–‡ä»¶åˆ°ä»“åº“"><a href="#æäº¤æ–‡ä»¶åˆ°ä»“åº“" class="headerlink" title="æäº¤æ–‡ä»¶åˆ°ä»“åº“"></a>æäº¤æ–‡ä»¶åˆ°ä»“åº“</h3><pre class=" language-shell"><code class="language-shell">git commit -m "æè¿°ä¿¡æ¯"        #æäº¤æ›´æ–°git commit -am "æè¿°ä¿¡æ¯"    #å¦‚æœå·¥ä½œç›®å½•ä¸­ä»…æ˜¯å·²è·Ÿè¸ªçš„æ–‡ä»¶è¢«ä¿®æ”¹æˆ–è¢«åˆ é™¤ï¼Œä½¿ç”¨æ­¤æäº¤å‘½ä»¤</code></pre><h3 id="åˆ†æ”¯çš„åˆ›å»ºã€åˆ é™¤ã€å’Œå¹³ã€åˆ‡æ¢ã€æŸ¥çœ‹"><a href="#åˆ†æ”¯çš„åˆ›å»ºã€åˆ é™¤ã€å’Œå¹³ã€åˆ‡æ¢ã€æŸ¥çœ‹" class="headerlink" title="åˆ†æ”¯çš„åˆ›å»ºã€åˆ é™¤ã€å’Œå¹³ã€åˆ‡æ¢ã€æŸ¥çœ‹"></a>åˆ†æ”¯çš„åˆ›å»ºã€åˆ é™¤ã€å’Œå¹³ã€åˆ‡æ¢ã€æŸ¥çœ‹</h3><pre class=" language-shell"><code class="language-shell">git branch    #æŸ¥çœ‹Gitä»“åº“ä¸­å·²æœ‰çš„åˆ†æ”¯git branch æ–°åˆ†æ”¯å [åˆ†æ”¯èµ·ç‚¹]    #åˆ›å»ºåˆ†æ”¯ï¼Œå¦‚æœæ²¡æœ‰åˆ†æ”¯èµ·ç‚¹çš„è¯ï¼Œåˆ™é»˜è®¤åœ¨å½“å‰åˆ†æ”¯çš„æœ€æ–°æäº¤ä¸Šåˆ›å»ºåˆ†æ”¯git checkout åˆ†æ”¯å    #åˆ‡æ¢åˆ†æ”¯git checkout -b æ–°åˆ†æ”¯å        #åˆ›å»ºåŒæ—¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯git merge è¦è¢«åˆå¹¶çš„åˆ†æ”¯å    #åˆå¹¶åˆ†æ”¯git branch -d è¦åˆ é™¤çš„åˆ†æ”¯å    #åˆ é™¤æŒ‡å®šåˆ†æ”¯ï¼ˆå¦‚æœåˆ†æ”¯æ²¡æœ‰è¢«åˆå¹¶è¿‡ï¼Œè¯¥å‘½ä»¤ä¼šæ‰§è¡Œå¤±è´¥ï¼‰git branch -D è¦åˆ é™¤çš„åˆ†æ”¯å    #åˆ é™¤æŒ‡å®šåˆ†æ”¯ï¼Œä¸ç®¡æœ‰æ²¡æœ‰è¢«åˆå¹¶è¿‡gitk                #ç”¨å›¾å½¢ç•Œé¢æŸ¥çœ‹åˆ†æ”¯æäº¤å†å²</code></pre><blockquote><p>åˆå¹¶åˆ†æ”¯è¿‡ç¨‹ä¸­å¦‚æœå‘ç”Ÿå†²çªåˆ™éœ€è¦è‡ªå·±æ‰‹åŠ¨è§£å†³å†²çªï¼Œç„¶åå†æäº¤ã€‚æœ‰å†²çªæ—¶ï¼ŒGitä¼šæ˜¾ç¤ºå“ªä¸ªæ–‡ä»¶æœ‰å†²çªï¼Œå¹¶åœ¨å†²çªçš„æ–‡ä»¶ä¸­åŠ ä¸Šç‰¹æ®Šçš„æ ‡è¯†ç¬¦å·ï¼Œè§£å†³å®Œå†²çªåï¼Œè¦æ‰‹åŠ¨å»æ‰è¿™äº›è¢«æ·»åŠ çš„æ ‡è¯†ç¬¦å·ã€‚å¦‚æœå†²çªæ¯”è¾ƒå¤æ‚çš„è¯ï¼Œæœ€å¥½ä½¿ç”¨å…¶ä»–å·¥å…·æ¥ååŠ©ï¼Œé€šè¿‡git mergetoolæ¥å¯åŠ¨ã€‚å†²çªä¸€èˆ¬æ˜¯åœ¨ä¸åŒçš„åˆ†æ”¯ä¸Šå¯¹åŒä¸€æ–‡ä»¶çš„åŒä¸€ä½ç½®å†…å®¹è¿›è¡Œäº†æ”¹åŠ¨ï¼Œå¹¶å·²æäº¤åˆ°ä»“åº“ä¸­ï¼Œè¿™æ ·åœ¨åˆå¹¶çš„æ—¶å€™å°±ä¼šå‘ç”Ÿå†²çªã€‚</p></blockquote><h3 id="æ ‡ç­¾çš„æ·»åŠ ã€åˆ é™¤ã€æŸ¥çœ‹"><a href="#æ ‡ç­¾çš„æ·»åŠ ã€åˆ é™¤ã€æŸ¥çœ‹" class="headerlink" title="æ ‡ç­¾çš„æ·»åŠ ã€åˆ é™¤ã€æŸ¥çœ‹"></a>æ ‡ç­¾çš„æ·»åŠ ã€åˆ é™¤ã€æŸ¥çœ‹</h3><pre class=" language-shell"><code class="language-shell">git tag        #æŸ¥çœ‹æ ‡ç­¾git tag æ ‡ç­¾å    #åˆ›å»ºç®€å•çš„æ ‡ç­¾git tag -a æ ‡ç­¾å -m 'é™„åŠ ä¿¡æ¯'    #åˆ›å»ºé™„åŠ ä¿¡æ¯çš„æ ‡ç­¾git show æ ‡ç­¾å    #é€šè¿‡æ ‡ç­¾æŸ¥çœ‹ä¿¡æ¯git tag -d æ ‡ç­¾å    #åˆ é™¤æ ‡ç­¾</code></pre><blockquote><p>æ ‡ç­¾å¯ä»¥åœ¨éœ€è¦çš„åœ°æ–¹ï¼Œä¸ºæŸä¸ªæäº¤å¯¹è±¡åˆ›å»ºåˆ«åï¼Œè¿™æ ·ä»¥åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ ‡ç­¾æ¥æŸ¥çœ‹ä¸€äº›ä¿¡æ¯ï¼Œåˆ›å»ºåˆ†æ”¯ç­‰ã€‚</p></blockquote><h3 id="æŸ¥çœ‹å·¥ä½œç›®å½•çŠ¶æ€"><a href="#æŸ¥çœ‹å·¥ä½œç›®å½•çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹å·¥ä½œç›®å½•çŠ¶æ€"></a>æŸ¥çœ‹å·¥ä½œç›®å½•çŠ¶æ€</h3><pre class=" language-shell"><code class="language-shell">git status</code></pre><blockquote><p>åœ¨gitå‘½ä»¤æ‰§è¡Œåï¼Œè¦å…»æˆé€šè¿‡git statusæŸ¥çœ‹gitçŠ¶æ€çš„ä¹ æƒ¯ï¼Œä»¥ä¾¿åŠæ—¶äº†è§£æ–‡ä»¶å˜åŒ–çš„æƒ…å†µã€‚é€šè¿‡git statuså¯ä»¥çŸ¥é“æ–‡ä»¶çš„çŠ¶æ€ï¼ˆå·²ä¿®æ”¹æœªæš‚å­˜ã€å·²åˆ é™¤ã€å·²ä¿®æ”¹å¹¶å·²æš‚å­˜ç­‰å¾…æäº¤ã€æœªè·Ÿè¸ªï¼‰ã€‚</p></blockquote><h3 id="æŸ¥çœ‹æäº¤å†å²"><a href="#æŸ¥çœ‹æäº¤å†å²" class="headerlink" title="æŸ¥çœ‹æäº¤å†å²"></a>æŸ¥çœ‹æäº¤å†å²</h3><pre class=" language-shell"><code class="language-shell">git loggit log -p    #æ˜¾ç¤ºæ¯æ¬¡æäº¤æ–‡ä»¶å˜åŒ–</code></pre><blockquote><p>é€šè¿‡git logå¯ä»¥æŸ¥çœ‹å½“å‰åˆ†æ”¯çš„æ‰€æœ‰æäº¤å†å²ï¼ŒçŸ¥é“æ¯æ¬¡æäº¤çš„commitå¯¹è±¡çš„IDä»¥åŠæäº¤æ—¶é™„åŠ çš„æè¿°ä¿¡æ¯ç­‰ã€‚è¦æ˜¾ç¤ºæ›´å¤šçš„ä¿¡æ¯ï¼Œéœ€è¦ä½¿ç”¨å…¶æ”¯æŒçš„é€‰é¡¹ï¼Œå¦‚git log -på¯ä»¥å°†æ¯æ¬¡æäº¤çš„æ–‡ä»¶å˜åŒ–ä¹Ÿæ˜¾ç¤ºå‡ºæ¥ã€‚</p></blockquote><h3 id="æŸ¥çœ‹æŒ‡å®šçš„æäº¤å¯¹è±¡"><a href="#æŸ¥çœ‹æŒ‡å®šçš„æäº¤å¯¹è±¡" class="headerlink" title="æŸ¥çœ‹æŒ‡å®šçš„æäº¤å¯¹è±¡"></a>æŸ¥çœ‹æŒ‡å®šçš„æäº¤å¯¹è±¡</h3><pre class=" language-shell"><code class="language-shell">git show commit_id    #æŸ¥çœ‹æŒ‡å®šçš„æŸæ¬¡æäº¤å†…å®¹git show --all        #æ˜¾ç¤ºæ‰€æœ‰çš„æäº¤å†å²å†…å®¹git shortlog -s -n    #æ˜¾ç¤ºæ€»çš„æäº¤æ¬¡æ•°</code></pre><blockquote><p>é€šè¿‡<code>git log</code>å¯ä»¥æ˜¾ç¤ºæ•´ä¸ªæäº¤å†å²ï¼Œè€Œé€šè¿‡<code>git show commit-id</code>åˆ™å¯ä»¥æŸ¥çœ‹æŒ‡å®šçš„æŸæ¬¡æäº¤å†…å®¹ï¼Œå½“ç„¶<code>git show -all</code>ä¹Ÿå¯ä»¥æ˜¾ç¤ºå‡ºæäº¤å†å²ï¼Œå¦å¤–è¿˜å¯ä»¥æ ¼å¼åŒ–æ˜¾ç¤ºå†…å®¹ã€‚</p></blockquote><p><strong>Note : commit-idå¯ä»¥æ˜¯commitå¯¹è±¡å¯¹åº”çš„IDï¼Œä¹Ÿå¯ä»¥æ˜¯HEADï¼Œåˆ†æ”¯åï¼Œtagç­‰ã€‚</strong></p><h3 id="æŸ¥çœ‹å·¥ä½œåŒºã€æš‚å­˜åŒºã€ä»“åº“ä¹‹é—´çš„å·®å¼‚"><a href="#æŸ¥çœ‹å·¥ä½œåŒºã€æš‚å­˜åŒºã€ä»“åº“ä¹‹é—´çš„å·®å¼‚" class="headerlink" title="æŸ¥çœ‹å·¥ä½œåŒºã€æš‚å­˜åŒºã€ä»“åº“ä¹‹é—´çš„å·®å¼‚"></a>æŸ¥çœ‹å·¥ä½œåŒºã€æš‚å­˜åŒºã€ä»“åº“ä¹‹é—´çš„å·®å¼‚</h3><pre class=" language-shell"><code class="language-shell">git diff        #æ¯”è¾ƒå·¥ä½œåŒºä¸æš‚å­˜åŒºçš„å·®å¼‚git diff HEAD        #æ¯”è¾ƒå·¥ä½œåŒºä¸ä»“åº“ä¸­æœ€è¿‘ä¸€æ¬¡çš„æäº¤é—´çš„å·®å¼‚git diff --cached    #æ¯”è¾ƒæš‚å­˜åŒºä¸ä»“åº“ä¸­æœ€è¿‘ä¸€æ¬¡æäº¤çš„å·®å¼‚git blame filename    #å¯ä»¥åˆ—å‡ºè¯¥æ–‡ä»¶æ¯æ¬¡è¢«ä¿®æ”¹çš„æ—¶é—´å’Œå†…å®¹ã€‚</code></pre><h3 id="ç‰ˆæœ¬å›é€€ã€æ’¤é”€æ“ä½œ"><a href="#ç‰ˆæœ¬å›é€€ã€æ’¤é”€æ“ä½œ" class="headerlink" title="ç‰ˆæœ¬å›é€€ã€æ’¤é”€æ“ä½œ"></a>ç‰ˆæœ¬å›é€€ã€æ’¤é”€æ“ä½œ</h3><pre class=" language-shell"><code class="language-shell">git reflog    #æ˜¾ç¤ºæäº¤å†å²çš„ç®€ä»‹git checkout -- filename    #ä¸¢å¼ƒå·¥ä½œåŒºçš„ä¿®æ”¹git reset --hard HEAD^        #å›é€€åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬git reset --hard commit_id    #å›é€€åˆ°æŒ‡å®šç‰ˆæœ¬git checkout -- filename    #æ¢å¤å·¥ä½œåŒºè¢«åˆ é™¤çš„æŒ‡å®šæ–‡ä»¶ï¼ˆæ–‡ä»¶ä¹‹å‰è¢«æäº¤åˆ°ä»“åº“ä¸­ï¼‰git checkout -f         #æ¢å¤å·¥ä½œåŒºä¸­æ‰€æœ‰è¢«åˆ é™¤çš„æ–‡ä»¶(æ–‡ä»¶ä¹‹å‰è¢«æäº¤åˆ°ä»“åº“ä¸­)git ls-files -d            #åˆ—å‡ºå·¥ä½œåŒºè¢«åˆ é™¤çš„æ–‡ä»¶ï¼ˆæ–‡ä»¶ä¹‹å‰è¢«æäº¤åˆ°ä»“åº“ä¸­ï¼‰</code></pre><blockquote><p>æœ‰æ—¶å€™ï¼Œç”±äºæˆ‘ä»¬çš„è¯¯æ“ä½œï¼Œäº§ç”Ÿäº†ä¸€äº›é”™è¯¯ï¼Œæˆ‘ä»¬å‘ç°åå¸Œæœ›èƒ½å¤ŸåŠæ—¶çº æ­£è¿™äº›å› ä¸ºè¯¯æ“ä½œè€Œäº§ç”Ÿçš„ç»“æœï¼Œå°†å·¥ä½œç›®å½•æ¢å¤åˆ°æŸä¸ªæ­£å¸¸çŠ¶æ€ã€‚</p></blockquote><ul><li>æ’¤é”€ä¿®æ”¹ï¼Œä½†è¿˜æ²¡æœ‰æ·»åŠ åˆ°æš‚å­˜åŒºï¼š <code>git checkout -- filename</code> ä¿®æ”¹çš„æ–‡ä»¶ä¼šè¢«æ¢å¤åˆ°ä¸Šæ¬¡æäº¤æ—¶çš„çŠ¶æ€ï¼Œä¿®æ”¹çš„å†…å®¹ä¼šä¸¢å¤±ã€‚</li><li>ç‰ˆæœ¬å›é€€ï¼šå…ˆé€šè¿‡<code>git reflog</code>æ‰¾åˆ°æŸä¸ªç‰ˆæœ¬çš„<code>commit_id</code>ï¼Œç„¶åç”¨<code>git reset --hard commit_id</code>å°†å·¥ä½œç›®å½•çš„æ–‡ä»¶æ¢å¤åˆ°æŒ‡å®šçš„ç‰ˆæœ¬ã€‚</li><li>æ¢å¤å·¥ä½œåŒºä¸­è¢«åˆ é™¤çš„æ–‡ä»¶ï¼ˆæ–‡ä»¶ä¹‹å‰è¢«æäº¤åˆ°ä»“åº“ä¸­ï¼‰ï¼š<code>git checkout -- filename</code> æˆ– <code>git checkout -f</code></li></ul><h3 id="å¤‡ä»½å·¥ä½œåŒº"><a href="#å¤‡ä»½å·¥ä½œåŒº" class="headerlink" title="å¤‡ä»½å·¥ä½œåŒº"></a>å¤‡ä»½å·¥ä½œåŒº</h3><pre class=" language-shell"><code class="language-shell">git stash            #å°†å·¥ä½œåŒºæ–‡ä»¶ä¿å­˜åœ¨Gitå†…éƒ¨æ ˆä¸­git stash list            #åˆ—å‡ºGitå†…éƒ¨æ ˆä¸­ä¿å­˜çš„å·¥ä½œåŒºæ–‡ä»¶åˆ—è¡¨git stash apply stash_id    #æ¢å¤å·¥ä½œåŒºåˆ°æŒ‡å®šçš„å†…éƒ¨æ ˆçŠ¶æ€git stash pop            #æ¢å¤å·¥ä½œåŒºåˆ°ä¸Šä¸€ä¸ªå†…éƒ¨æ ˆçŠ¶æ€git stash clear            #æ¸…ç©ºGitå†…éƒ¨æ ˆ</code></pre><blockquote><p>å¦‚æœæ­£åœ¨ä¸€ä¸ªdevelopåˆ†æ”¯ä¸Šæ­£åœ¨å¼€å‘æ–°åŠŸèƒ½ï¼Œä½†è¿™æ—¶masteråˆ†æ”¯(ç¨³å®šç‰ˆæœ¬)çªç„¶å‘ç°äº†bugï¼Œå¹¶éœ€è¦åŠæ—¶ä¿®å¤ï¼Œè€Œdevelopåˆ†æ”¯æ­¤æ—¶çš„å·¥ä½œè¿˜æ²¡æœ‰å®Œæˆï¼Œä¸”ä¸å¸Œæœ›å°†ä¹‹å‰çš„å·¥ä½œå°±è¿™æ ·æäº¤åˆ°ä»“åº“ä¸­æ—¶ï¼Œè¿™æ—¶å°±å¯ä»¥ç”¨<code>git stash</code>æ¥æš‚æ—¶ä¿å­˜è¿™äº›çŠ¶æ€åˆ°Gitå†…éƒ¨æ ˆä¸­ï¼Œå¹¶ç”¨å½“å‰åˆ†æ”¯ä¸Šä¸€æ¬¡çš„æäº¤å†…å®¹æ¥æ¢å¤å·¥ä½œç›®å½•ï¼Œç„¶ååˆ‡æ¢åˆ°masteråˆ†æ”¯è¿›è¡Œbugä¿®å¤å·¥ä½œï¼Œç­‰ä¿®å¤å®Œæ¯•å¹¶æäº¤åˆ°ä»“åº“ä¸Šåï¼Œå†ä½¿ç”¨<code>git stash apply [stash@{0}]</code>æˆ–è€…<code>git stash pop</code>å°†å·¥ä½œç›®å½•æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼Œç»§ç»­ä¹‹å‰çš„å·¥ä½œã€‚</p></blockquote><blockquote><p>åŒæ—¶ä¹Ÿå¯ä»¥å¤šæ¬¡ä½¿ç”¨git stashå°†æœªæäº¤çš„ä»£ç å‹å…¥åˆ°Gitæ ˆä¸­ï¼Œä½†å½“å¤šæ¬¡ä½¿ç”¨<code>git stash</code>å‘½ä»¤åï¼ŒGitæ ˆé‡Œå°†å……æ»¡äº†æœªæäº¤çš„ä»£ç ï¼Œè¿™æ—¶å€™åˆ°åº•è¦ç”¨å“ªä¸ªç‰ˆæœ¬æ¥æ¢å¤å·¥ä½œç›®å½•å‘¢ï¼Ÿ<code>git stash list</code>å‘½ä»¤å¯ä»¥å°†å½“å‰çš„Gitæ ˆä¿¡æ¯æ‰“å°å‡ºæ¥ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ‰¾åˆ°å¯¹åº”çš„ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚ä½¿ç”¨<code>git stash apply stash@{1}</code>å°±å¯ä»¥ç”¨ç‰ˆæœ¬å·ä¸ºstash@{1}çš„å†…å®¹æ¥æ¢å¤å·¥ä½œç›®å½•ã€‚</p></blockquote><blockquote><p>å½“Gitæ ˆä¸­æ‰€æœ‰çš„å†…å®¹éƒ½è¢«æ¢å¤åï¼Œå¯ä»¥ä½¿ç”¨<code>git stash clear</code>æ¥å°†æ ˆæ¸…ç©ºã€‚</p></blockquote><h3 id="å°†å½“å‰å·¥ä½œåŒºç›®å½•æ–‡ä»¶å‹ç¼©å½’æ¡£"><a href="#å°†å½“å‰å·¥ä½œåŒºç›®å½•æ–‡ä»¶å‹ç¼©å½’æ¡£" class="headerlink" title="å°†å½“å‰å·¥ä½œåŒºç›®å½•æ–‡ä»¶å‹ç¼©å½’æ¡£"></a>å°†å½“å‰å·¥ä½œåŒºç›®å½•æ–‡ä»¶å‹ç¼©å½’æ¡£</h3><pre class=" language-shell"><code class="language-shell">git archive --format=zip -o arch.zip HEADgit arch --format zip head>arch.zip</code></pre><h2 id="è¿œç¨‹æ“ä½œ"><a href="#è¿œç¨‹æ“ä½œ" class="headerlink" title="è¿œç¨‹æ“ä½œ"></a>è¿œç¨‹æ“ä½œ</h2><blockquote><p>Gitç›¸æ¯”å…¶ä»–ç‰ˆæœ¬æ§åˆ¶è½¯ä»¶çš„ä¸€ä¸ªä¼˜ç‚¹å°±æ˜¯å¤§å¤šæ•°çš„æ“ä½œéƒ½å¯ä»¥åœ¨æœ¬åœ°è¿›è¡Œï¼Œè€Œä¸ç”¨ç®¡è¿œç¨‹çš„ä»“åº“ï¼Œå› ä¸ºæ“ä½œæ˜¯åœ¨æœ¬åœ°ï¼Œä¸”æ“ä½œçš„æ•°æ®ä¹Ÿæ˜¯åœ¨æœ¬åœ°ï¼ŒåŠ ä¸ŠæŒ‡é’ˆç­‰åŸå› ï¼Œæ‰€ä»¥æ‰§è¡Œçš„é€Ÿåº¦å°±ä¼šæ¯”è¾ƒå¿«ã€‚ åœ¨å¤šäººåä½œçš„é¡¹ç›®ä¸­ï¼Œå°±éœ€è¦æ¶‰åŠä¸è¿œç¨‹ä»“åº“äº¤äº’çš„é—®é¢˜ï¼Œä¸»è¦æ˜¯å¦‚ä½•ä»è¿œç¨‹ä»“åº“æŠ“å–æœ€æ–°æ•°æ®åˆå¹¶åˆ°è‡ªå·±çš„æœ¬åœ°åˆ†æ”¯ä¸Šï¼Œå°†è‡ªå·±çš„æœ€æ–°æˆæœåˆ†äº«ç»™å…¶ä»–äººæˆ–è®©åˆ«äººå®¡æŸ¥ç­‰ ã€‚</p></blockquote><h3 id="è¿œç¨‹ä»“åº“çš„å…‹éš†ã€æ·»åŠ ã€æŸ¥çœ‹"><a href="#è¿œç¨‹ä»“åº“çš„å…‹éš†ã€æ·»åŠ ã€æŸ¥çœ‹" class="headerlink" title="è¿œç¨‹ä»“åº“çš„å…‹éš†ã€æ·»åŠ ã€æŸ¥çœ‹"></a>è¿œç¨‹ä»“åº“çš„å…‹éš†ã€æ·»åŠ ã€æŸ¥çœ‹</h3><pre class=" language-shell"><code class="language-shell">git remote    #æ˜¾ç¤ºå·²æ·»åŠ çš„è¿œç¨‹ä»“åº“ågit remote -v     #æ˜¾ç¤ºå·²æ·»åŠ çš„è¿œç¨‹ä»“åº“åå’Œåœ°å€git remote add è¿œç¨‹ä»“åº“å è¿œç¨‹ä»“åº“åœ°å€    #åœ¨æœ¬åœ°æ·»åŠ è¿œç¨‹ä»“åº“git remote rm è¿œç¨‹ä»“åº“å            #åˆ é™¤æœ¬åœ°æ·»åŠ çš„è¿œç¨‹ä»“åº“ågit remote rename åŸå æ–°å        #é‡å‘½åè¿œç¨‹ä»“åº“ågit clone è¿œç¨‹ä»“åº“åœ°å€ [å…‹éš†åˆ°æŒ‡å®šçš„æ–‡ä»¶å¤¹]    #å…‹éš†è¿œç¨‹ä»“åº“åˆ°æœ¬åœ°git clone -b [branch-name] è¿œç¨‹ä»“åº“åœ°å€ [å…‹éš†åˆ°æŒ‡å®šçš„æ–‡ä»¶å¤¹]    #å…‹éš†è¿œç¨‹ä»“åº“åˆ°æœ¬åœ° -bgit fetch è¿œç¨‹ä»“åº“å        #ä»è¿œç¨‹ä»“åº“æŠ“å–æœ€æ–°æ•°æ®åˆ°æœ¬åœ°ä½†ä¸ä¸æœ¬åœ°åˆ†æ”¯è¿›è¡Œåˆå¹¶ git pull è¿œç¨‹ä»“åº“å    æœ¬åœ°è¦åˆå¹¶çš„åˆ†æ”¯å    #ä»è¿œç¨‹ä»“åº“æŠ“å–æœ€æ–°æ•°æ®å¹¶è‡ªåŠ¨ä¸æœ¬åœ°åˆ†æ”¯è¿›è¡Œåˆå¹¶git push è¿œç¨‹ä»“åº“å æœ¬åœ°åˆ†æ”¯å    #å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“ä¸­git remote show è¿œç¨‹ä»“åº“å    #æŸ¥çœ‹è¿œç¨‹ä»“åº“ä¿¡æ¯git remote show            #æŸ¥çœ‹æ‰€æœ‰è¿œç¨‹ä»“åº“git push è¿œç¨‹ä»“åº“å æ ‡ç­¾å    #å°†æ ‡ç­¾æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼ˆGité»˜è®¤ä¸æ¨é€æ ‡ç­¾ï¼‰</code></pre><h3 id="ååŒæµç¨‹"><a href="#ååŒæµç¨‹" class="headerlink" title="ååŒæµç¨‹"></a>ååŒæµç¨‹</h3><ul><li>Forkè¿œç¨‹é¡¹ç›®</li><li>æŠŠForkçš„é¡¹ç›®cloneåˆ°æœ¬åœ°</li><li>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†åˆ«äººçš„åº“æ·»åŠ ä¸ºè¿œç«¯åº“</li></ul><pre class=" language-shell"><code class="language-shell">git remote add è¿œç«¯ä»“åº“å è¿œç«¯çš„åˆ†æ”¯</code></pre><ul><li>è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ‹‰å»åˆå¹¶åˆ°æœ¬åœ°</li></ul><pre class=" language-shell"><code class="language-shell">git pull è¿œç«¯ä»“åº“å è¿œç«¯åˆ†æ”¯å</code></pre><ul><li>ç¼–è¾‘å†…å®¹</li><li>commitä¹‹åpushåˆ°è‡ªå·±çš„åº“</li><li>ç™»å½•Githubï¼Œåœ¨ä½ çš„é¦–é¡µå¯ä»¥çœ‹åˆ°ä¸€ä¸ª<code>pull request</code>æŒ‰é’®ï¼Œç‚¹å‡»å®ƒï¼Œå¡«å†™ä¸€äº›è¯´æ˜ä¿¡æ¯ï¼Œæäº¤å³å¯ã€‚</li></ul><blockquote><p>åœ¨æœ¬åœ°ç¼–è¾‘å†…å®¹å‰å¿…é¡»æ‰§è¡Œpullæ“ä½œåŒæ­¥åˆ«äººçš„è¿œç«¯åº“ï¼ˆè¿™æ ·é¿å…å†²çªï¼‰</p></blockquote><h3 id="å®ç”¨æŠ€å·§"><a href="#å®ç”¨æŠ€å·§" class="headerlink" title="å®ç”¨æŠ€å·§"></a>å®ç”¨æŠ€å·§</h3><blockquote><p>å½“æ‰‹å¤´å·¥ä½œæ²¡æœ‰å®Œæˆæ—¶ï¼Œå…ˆæŠŠå·¥ä½œç°åœº<code>git stash</code>ä¸€ä¸‹ï¼Œç„¶åå»ä¿®å¤bugï¼Œä¿®å¤åï¼Œå†ä½¿ç”¨<code>git stash pop</code>ï¼Œå›åˆ°å·¥ä½œç°åœº.</p></blockquote><h3 id="å¤šäººåä½œæŠ€å·§"><a href="#å¤šäººåä½œæŠ€å·§" class="headerlink" title="å¤šäººåä½œæŠ€å·§"></a>å¤šäººåä½œæŠ€å·§</h3><blockquote><p>æŸ¥çœ‹è¿œç¨‹åº“ä¿¡æ¯ï¼Œä½¿ç”¨git remote -vï¼›<br>æœ¬åœ°æ–°å»ºçš„åˆ†æ”¯å¦‚æœä¸æ¨é€åˆ°è¿œç¨‹ï¼Œå¯¹å…¶ä»–äººå°±æ˜¯ä¸å¯è§çš„ï¼›<br>ä»æœ¬åœ°æ¨é€åˆ†æ”¯ï¼Œä½¿ç”¨<code>git push è¿œç¨‹ä»“åº“å åˆ†æ”¯å</code>ï¼Œå¦‚æœæ¨é€å¤±è´¥ï¼Œå…ˆç”¨<code>git pull</code>æŠ“å–è¿œç¨‹çš„æ–°æäº¤ï¼›<br>åœ¨æœ¬åœ°åˆ›å»ºå’Œè¿œç¨‹åˆ†æ”¯å¯¹åº”çš„åˆ†æ”¯ï¼Œä½¿ç”¨<code>git checkout -b branch-name origin/branch-name</code>ï¼Œæœ¬åœ°å’Œè¿œç¨‹åˆ†æ”¯çš„åç§°æœ€å¥½ä¸€è‡´ï¼›<br>å»ºç«‹æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯çš„å…³è”ï¼Œä½¿ç”¨<code>git branch --set-upstream branch-name origin/branch-name</code>ï¼›<br>ä»è¿œç¨‹æŠ“å–åˆ†æ”¯ï¼Œä½¿ç”¨git pullï¼Œå¦‚æœæœ‰å†²çªï¼Œè¦å…ˆå¤„ç†å†²çªã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> å·¥å…·ä½¿ç”¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Boot ç»“åˆ Quartz è®¾ç½®å®šæ—¶ä»»åŠ¡</title>
      <link href="2019/01/29/spring-quartz-scheduled/"/>
      <url>2019/01/29/spring-quartz-scheduled/</url>
      
        <content type="html"><![CDATA[<h2 id="Spring-Boot-åŸç”Ÿ-Scheduled"><a href="#Spring-Boot-åŸç”Ÿ-Scheduled" class="headerlink" title="Spring Boot åŸç”Ÿ @Scheduled"></a>Spring Boot åŸç”Ÿ @Scheduled</h2><h3 id="ä»»åŠ¡é…ç½®"><a href="#ä»»åŠ¡é…ç½®" class="headerlink" title="ä»»åŠ¡é…ç½®"></a>ä»»åŠ¡é…ç½®</h3><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledTask</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>fixedRate <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// è¡¨ç¤ºæ¯éš”5000msï¼ŒSpring schedulingä¼šè°ƒç”¨ä¸€æ¬¡è¯¥æ–¹æ³•ï¼Œä¸è®ºè¯¥æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´æ˜¯å¤šå°‘</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reportCurrentTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>fixedDelay <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// è¡¨ç¤ºå½“æ–¹æ³•æ‰§è¡Œå®Œæ¯•5000msåï¼ŒSpring schedulingä¼šå†æ¬¡è°ƒç”¨è¯¥æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reportCurrentTimeAfterSleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">"0 0 1 * * *"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// æä¾›äº†ä¸€ç§é€šç”¨çš„å®šæ—¶ä»»åŠ¡è¡¨è¾¾å¼ï¼Œè¿™é‡Œè¡¨ç¤ºæ¯éš”5ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œæ›´åŠ è¯¦ç»†çš„ä¿¡æ¯å¯ä»¥å‚è€ƒcronè¡¨è¾¾å¼ã€‚</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reportCurrentTimeCron</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableScheduling</span><span class="token comment" spellcheck="true">// å‘Šè¯‰Springåˆ›å»ºä¸€ä¸ªtask executorï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰è¿™ä¸ªæ ‡æ³¨ï¼Œæ‰€æœ‰@Scheduledæ ‡æ³¨éƒ½ä¸ä¼šæ‰§è¡Œ</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>App<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="Spring-Boot-ç»“åˆ-Quartz-å®ç°åŠ¨æ€è®¾ç½®å®šæ—¶ä»»åŠ¡"><a href="#Spring-Boot-ç»“åˆ-Quartz-å®ç°åŠ¨æ€è®¾ç½®å®šæ—¶ä»»åŠ¡" class="headerlink" title="Spring Boot ç»“åˆ Quartz å®ç°åŠ¨æ€è®¾ç½®å®šæ—¶ä»»åŠ¡"></a>Spring Boot ç»“åˆ Quartz å®ç°åŠ¨æ€è®¾ç½®å®šæ—¶ä»»åŠ¡</h2><ul><li>éœ€è¦spring bootç‰ˆæœ¬å¤§äº2.x</li><li><a href="http://www.quartz-scheduler.org/">http://www.quartz-scheduler.org/</a></li></ul><h3 id="æ·»åŠ ä¾èµ–é…ç½®"><a href="#æ·»åŠ ä¾èµ–é…ç½®" class="headerlink" title="æ·»åŠ ä¾èµ–é…ç½®"></a>æ·»åŠ ä¾èµ–é…ç½®</h3><pre class=" language-groovy"><code class="language-groovy"><span class="token comment" spellcheck="true">// implementation 'org.quartz-scheduler:quartz:2.3.0'</span><span class="token comment" spellcheck="true">// implementation 'org.quartz-scheduler:quartz-jobs:2.3.0'</span>implementation <span class="token string">'org.springframework.boot:spring-boot-starter-quartz'</span></code></pre><h3 id="é…ç½®-quartzJobFactory-å’Œ-scheduler-å¯¹è±¡"><a href="#é…ç½®-quartzJobFactory-å’Œ-scheduler-å¯¹è±¡" class="headerlink" title="é…ç½® quartzJobFactory å’Œ scheduler å¯¹è±¡"></a>é…ç½® quartzJobFactory å’Œ scheduler å¯¹è±¡</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>configure<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>Scheduler<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>spi<span class="token punctuation">.</span>TriggerFiredBundle<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>config<span class="token punctuation">.</span>AutowireCapableBeanFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>ApplicationContextAware<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>scheduling<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>SchedulerFactoryBean<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>scheduling<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>SpringBeanJobFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Component<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019/1/29. */</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QuartzConfiguration</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * è§£å†³Jobä¸­æ³¨å…¥Spring Beanä¸ºnullçš„é—®é¢˜     */</span>    <span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"quartzJobFactory"</span><span class="token punctuation">)</span>    <span class="token keyword">class</span> <span class="token class-name">QuartzJobFactory</span> <span class="token keyword">extends</span> <span class="token class-name">SpringBeanJobFactory</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContextAware</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è¿™ä¸ªå¯¹è±¡Springä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨æ³¨å…¥è¿›æ¥,ä¹Ÿå±äºSpringæŠ€æœ¯èŒƒç•´.</span>        <span class="token annotation punctuation">@Autowired</span>        <span class="token keyword">private</span> AutowireCapableBeanFactory capableBeanFactory<span class="token punctuation">;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> Object <span class="token function">createJobInstance</span><span class="token punctuation">(</span>TriggerFiredBundle bundle<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•</span>            <span class="token keyword">final</span> Object jobInstance <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">createJobInstance</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// è¿›è¡Œæ³¨å…¥,è¿™å±äºSpringçš„æŠ€æœ¯,ä¸æ¸…æ¥šçš„å¯ä»¥æŸ¥çœ‹Springçš„API.</span>            capableBeanFactory<span class="token punctuation">.</span><span class="token function">autowireBean</span><span class="token punctuation">(</span>jobInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> jobInstance<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * æ³¨å…¥scheduleråˆ°springï¼Œåœ¨ä¸‹é¢quartzManegeä¼šç”¨åˆ°     *     * @return     * @throws Exception     */</span>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"scheduler"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> Scheduler <span class="token function">scheduler</span><span class="token punctuation">(</span>SchedulerFactoryBean schedulerFactoryBean<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// schedulerFactoryBean.setJobFactory(quartzJobFactory);</span>        <span class="token comment" spellcheck="true">// è¯¥æ–¹æ³•ä¼šå†æ¬¡åˆå§‹åŒ– quartz è¿™é‡Œçš„åˆå§‹åŒ–ä»»åŠ¡äº¤ç»™springå®¹å™¨å³å¯</span>        <span class="token comment" spellcheck="true">// schedulerFactoryBean.afterPropertiesSet();</span>        Scheduler scheduler <span class="token operator">=</span> schedulerFactoryBean<span class="token punctuation">.</span><span class="token function">getScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        scheduler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> scheduler<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="æ–°å»ºä¸€ä¸ªbeanå¯¹è±¡ï¼Œç”¨æ¥ä¿å­˜åŸºæœ¬çš„jobä¿¡æ¯"><a href="#æ–°å»ºä¸€ä¸ªbeanå¯¹è±¡ï¼Œç”¨æ¥ä¿å­˜åŸºæœ¬çš„jobä¿¡æ¯" class="headerlink" title="æ–°å»ºä¸€ä¸ªbeanå¯¹è±¡ï¼Œç”¨æ¥ä¿å­˜åŸºæœ¬çš„jobä¿¡æ¯"></a>æ–°å»ºä¸€ä¸ªbeanå¯¹è±¡ï¼Œç”¨æ¥ä¿å­˜åŸºæœ¬çš„jobä¿¡æ¯</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>bean<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>AllArgsConstructor<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>Data<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>NoArgsConstructor<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019/1/18. */</span><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QuartzJob</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Integer STATUS_RUNNING <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Integer STATUS_NOT_RUNNING <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Integer CONCURRENT_IS <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Integer CONCURRENT_NOT <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> String jobId<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * cron è¡¨è¾¾å¼     */</span>    <span class="token keyword">private</span> String cronExpression<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * ä»»åŠ¡è°ƒç”¨çš„æ–¹æ³•å     */</span>    <span class="token keyword">private</span> String methodName<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * ä»»åŠ¡æ˜¯å¦æœ‰çŠ¶æ€     */</span>    <span class="token keyword">private</span> Integer isConcurrent<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * æè¿°     */</span>    <span class="token keyword">private</span> String description<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * ä»»åŠ¡æ‰§è¡Œæ—¶è°ƒç”¨å“ªä¸ªç±»çš„æ–¹æ³• åŒ…å+ç±»åï¼Œå®Œå…¨é™å®šå     */</span>    <span class="token keyword">private</span> String beanName<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * è§¦å‘å™¨åç§°     */</span>    <span class="token keyword">private</span> String triggerName<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * ä»»åŠ¡çŠ¶æ€     */</span>    <span class="token keyword">private</span> Integer jobStatus<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * ä»»åŠ¡å     */</span>    <span class="token keyword">private</span> String jobName<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="æ–°å»ºä¸€ä¸ªç»Ÿä¸€çš„QuartzManagerï¼Œç”¨æ¥ç»Ÿä¸€ç®¡ç†job"><a href="#æ–°å»ºä¸€ä¸ªç»Ÿä¸€çš„QuartzManagerï¼Œç”¨æ¥ç»Ÿä¸€ç®¡ç†job" class="headerlink" title="æ–°å»ºä¸€ä¸ªç»Ÿä¸€çš„QuartzManagerï¼Œç”¨æ¥ç»Ÿä¸€ç®¡ç†job"></a>æ–°å»ºä¸€ä¸ªç»Ÿä¸€çš„QuartzManagerï¼Œç”¨æ¥ç»Ÿä¸€ç®¡ç†job</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>configure<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>QuartzJob<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>*<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Component<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Resource<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>JobBuilder<span class="token punctuation">.</span>newJob<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>TriggerBuilder<span class="token punctuation">.</span>newTrigger<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019/1/18. */</span><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QuartzManager</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Resource</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"scheduler"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Scheduler scheduler<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addJob</span><span class="token punctuation">(</span>QuartzJob job<span class="token punctuation">)</span> <span class="token keyword">throws</span> SchedulerException<span class="token punctuation">,</span> ClassNotFoundException<span class="token punctuation">,</span> IllegalAccessException<span class="token punctuation">,</span> InstantiationException <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// é€šè¿‡ç±»åè·å–å®ä½“ç±»ï¼Œå³è¦æ‰§è¡Œçš„å®šæ—¶ä»»åŠ¡çš„ç±»</span>        Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> clazz <span class="token operator">=</span> Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>job<span class="token punctuation">.</span><span class="token function">getBeanName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Job jobEntity <span class="token operator">=</span> <span class="token punctuation">(</span>Job<span class="token punctuation">)</span> clazz<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// é€šè¿‡å®ä½“ç±»å’Œä»»åŠ¡ååˆ›å»º JobDetail</span>        JobDetail jobDetail <span class="token operator">=</span> <span class="token function">newJob</span><span class="token punctuation">(</span>jobEntity<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span>job<span class="token punctuation">.</span><span class="token function">getJobName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// é€šè¿‡è§¦å‘å™¨åå’Œcron è¡¨è¾¾å¼åˆ›å»º Trigger</span>        Trigger cronTrigger <span class="token operator">=</span> <span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span>job<span class="token punctuation">.</span><span class="token function">getTriggerName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">startNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span>CronScheduleBuilder<span class="token punctuation">.</span><span class="token function">cronSchedule</span><span class="token punctuation">(</span>job<span class="token punctuation">.</span><span class="token function">getCronExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// æ‰§è¡Œå®šæ—¶ä»»åŠ¡</span>        scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">,</span> cronTrigger<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * æ›´æ–°job cronè¡¨è¾¾å¼     *     * @param quartzJob     * @throws SchedulerException     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateJobCron</span><span class="token punctuation">(</span>QuartzJob quartzJob<span class="token punctuation">)</span> <span class="token keyword">throws</span> SchedulerException <span class="token punctuation">{</span>        TriggerKey triggerKey <span class="token operator">=</span> TriggerKey<span class="token punctuation">.</span><span class="token function">triggerKey</span><span class="token punctuation">(</span>quartzJob<span class="token punctuation">.</span><span class="token function">getJobName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        CronTrigger trigger <span class="token operator">=</span> <span class="token punctuation">(</span>CronTrigger<span class="token punctuation">)</span> scheduler<span class="token punctuation">.</span><span class="token function">getTrigger</span><span class="token punctuation">(</span>triggerKey<span class="token punctuation">)</span><span class="token punctuation">;</span>        CronScheduleBuilder scheduleBuilder <span class="token operator">=</span> CronScheduleBuilder<span class="token punctuation">.</span><span class="token function">cronSchedule</span><span class="token punctuation">(</span>quartzJob<span class="token punctuation">.</span><span class="token function">getCronExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        trigger <span class="token operator">=</span> trigger<span class="token punctuation">.</span><span class="token function">getTriggerBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span>triggerKey<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span>scheduleBuilder<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        scheduler<span class="token punctuation">.</span><span class="token function">rescheduleJob</span><span class="token punctuation">(</span>triggerKey<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * åˆ é™¤ä¸€ä¸ªjob     *     * @param quartzJob     * @throws SchedulerException     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteJob</span><span class="token punctuation">(</span>QuartzJob quartzJob<span class="token punctuation">)</span> <span class="token keyword">throws</span> SchedulerException <span class="token punctuation">{</span>        JobKey jobKey <span class="token operator">=</span> JobKey<span class="token punctuation">.</span><span class="token function">jobKey</span><span class="token punctuation">(</span>quartzJob<span class="token punctuation">.</span><span class="token function">getJobName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        scheduler<span class="token punctuation">.</span><span class="token function">deleteJob</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * æ¢å¤ä¸€ä¸ªjob     *     * @param quartzJob     * @throws SchedulerException     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">resumeJob</span><span class="token punctuation">(</span>QuartzJob quartzJob<span class="token punctuation">)</span> <span class="token keyword">throws</span> SchedulerException <span class="token punctuation">{</span>        JobKey jobKey <span class="token operator">=</span> JobKey<span class="token punctuation">.</span><span class="token function">jobKey</span><span class="token punctuation">(</span>quartzJob<span class="token punctuation">.</span><span class="token function">getJobName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        scheduler<span class="token punctuation">.</span><span class="token function">resumeJob</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * ç«‹å³æ‰§è¡Œjob     *     * @param quartzJob     * @throws SchedulerException     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">runAJobNow</span><span class="token punctuation">(</span>QuartzJob quartzJob<span class="token punctuation">)</span> <span class="token keyword">throws</span> SchedulerException <span class="token punctuation">{</span>        JobKey jobKey <span class="token operator">=</span> JobKey<span class="token punctuation">.</span><span class="token function">jobKey</span><span class="token punctuation">(</span>quartzJob<span class="token punctuation">.</span><span class="token function">getJobName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        scheduler<span class="token punctuation">.</span><span class="token function">triggerJob</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * æš‚åœä¸€ä¸ªjob     *     * @param quartzJob     * @throws SchedulerException     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pauseJob</span><span class="token punctuation">(</span>QuartzJob quartzJob<span class="token punctuation">)</span> <span class="token keyword">throws</span> SchedulerException <span class="token punctuation">{</span>        JobKey jobKey <span class="token operator">=</span> JobKey<span class="token punctuation">.</span><span class="token function">jobKey</span><span class="token punctuation">(</span>quartzJob<span class="token punctuation">.</span><span class="token function">getJobName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        scheduler<span class="token punctuation">.</span><span class="token function">pauseJob</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="æ–°å»ºjobä»»åŠ¡ï¼Œå®ç°org-quartz-Jobæ¥å£"><a href="#æ–°å»ºjobä»»åŠ¡ï¼Œå®ç°org-quartz-Jobæ¥å£" class="headerlink" title="æ–°å»ºjobä»»åŠ¡ï¼Œå®ç°org.quartz.Jobæ¥å£"></a>æ–°å»ºjobä»»åŠ¡ï¼Œå®ç°org.quartz.Jobæ¥å£</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>schedule<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>JobExecutionContext<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>scheduling<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>QuartzJobBean<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Component<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalDateTime<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>format<span class="token punctuation">.</span>DateTimeFormatter<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Locale<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019/1/29. */</span><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduleTask</span> <span class="token keyword">extends</span> <span class="token class-name">QuartzJobBean</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">executeInternal</span><span class="token punctuation">(</span>JobExecutionContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"execute task:{}"</span><span class="token punctuation">,</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">,</span> Locale<span class="token punctuation">.</span>CHINA<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="å¯åŠ¨ç±»é…ç½®"><a href="#å¯åŠ¨ç±»é…ç½®" class="headerlink" title="å¯åŠ¨ç±»é…ç½®"></a>å¯åŠ¨ç±»é…ç½®</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>quartz<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>QuartzJob<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xiaozhangge<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>configure<span class="token punctuation">.</span>QuartzManager<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>SchedulerException<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>CommandLineRunner<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>SpringApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>SpringBootApplication<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * Created by xiaozhangge on 2019/1/18. */</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QuartzSchedulerApplication</span> <span class="token keyword">implements</span> <span class="token class-name">CommandLineRunner</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> QuartzManager quartzManager<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>QuartzSchedulerApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            String scheduleTask <span class="token operator">=</span> <span class="token string">"com.xiaozhangge.quartz.schedule.ScheduleTask"</span><span class="token punctuation">;</span>            QuartzJob job <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QuartzJob</span><span class="token punctuation">(</span>scheduleTask<span class="token punctuation">,</span>                    <span class="token string">"*/1 * * * * ?"</span><span class="token punctuation">,</span>                    scheduleTask<span class="token punctuation">,</span>                    <span class="token number">1</span><span class="token punctuation">,</span>                    scheduleTask<span class="token punctuation">,</span>                    scheduleTask<span class="token punctuation">,</span>                    scheduleTask<span class="token punctuation">,</span>                    QuartzJob<span class="token punctuation">.</span>STATUS_NOT_RUNNING<span class="token punctuation">,</span>                    scheduleTask<span class="token punctuation">)</span><span class="token punctuation">;</span>            quartzManager<span class="token punctuation">.</span><span class="token function">addJob</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SchedulerException</span> <span class="token operator">|</span> ClassNotFoundException <span class="token operator">|</span> IllegalAccessException <span class="token operator">|</span> InstantiationException e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°å¼ å“¥</title>
      <link href="2018/09/05/wei-ni-xiong/"/>
      <url>2018/09/05/wei-ni-xiong/</url>
      
        <content type="html"><![CDATA[<p>è®°å½•å·¥ä½œä¸­çš„ä¸€äº›é—®é¢˜å’Œç¬”è®°ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> æœ‰å¿ƒæ€ä¹ˆä¼šåšä¸åˆ° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsä¸‹å®‰è£…MySQL-5.7.17è§£å‹ç‰ˆ</title>
      <link href="2018/08/10/windows-install-mysql-5-7-17/"/>
      <url>2018/08/10/windows-install-mysql-5-7-17/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸‹è½½MySQL-Community-Server"><a href="#ä¸‹è½½MySQL-Community-Server" class="headerlink" title="ä¸‹è½½MySQL Community Server"></a>ä¸‹è½½MySQL Community Server</h1><p>åœ°å€ï¼š<a href="http://dev.mysql.com/downloads/mysql/">http://dev.mysql.com/downloads/mysql/</a></p><p>é€‰æ‹©Windows (x86, 64-bit), ZIP Archiveè¿›è¡Œä¸‹è½½ã€‚</p><p>ç°åœ¨æœ€æ–°ç‰ˆæœ¬æ˜¯5.7.19ï¼Œç¬”è€…è¿™é‡Œæ˜¯5.7.17</p><p> <img src="https://upload-images.jianshu.io/upload_images/7779890-73ecf6d14210466b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸‹è½½mysql"></p><h1 id="é…ç½®mysql-ç¯å¢ƒå˜é‡"><a href="#é…ç½®mysql-ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®mysql ç¯å¢ƒå˜é‡"></a>é…ç½®mysql ç¯å¢ƒå˜é‡</h1><p>æˆ‘è¿™é‡Œå°†ä¸‹è½½å¥½çš„mysql-5.7.17 è§£å‹åˆ° C:\Program Files\mysql-5.7.17-winx64</p><p>é…ç½®</p><p><strong>MYSQL_HOME  â€”&gt;  C:\Program Files\mysql-5.7.17-winx64</strong></p><p><strong>Path ç¯å¢ƒå˜é‡ä¸­åŠ å…¥    %MYSQL_HOME%/bin;</strong></p><p>æ³¨æ„å¦‚æœpathæœ€åä¸€ä¸ªæ²¡æœ‰; è®°å¾—è‡ªå·±æ‰‹åŠ¨æ·»åŠ ;</p><p> <img src="https://upload-images.jianshu.io/upload_images/7779890-c82f23f38b84c1ca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="é…ç½®ç¯å¢ƒå˜é‡"></p><p> <img src="https://upload-images.jianshu.io/upload_images/7779890-1ed35c42cf341d90.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700"></p><p><img src="https://upload-images.jianshu.io/upload_images/7779890-a0475d1295ec9ce4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="é…ç½®MYSQL_HOME"> </p><h1 id="ä¿®æ”¹mysql-é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹mysql-é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹mysql é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹mysql é…ç½®æ–‡ä»¶</h1><p>å¤åˆ¶è§£å‹ç›®å½•ä¸‹çš„ my-default.ini æ–‡ä»¶å°†åç§°ä¿®æ”¹ä¸º my.ini ä¿®æ”¹æ–‡ä»¶å†…å®¹</p><p> <img src="https://upload-images.jianshu.io/upload_images/7779890-a6de142ab813ad8a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="å¤åˆ¶ my.ini æ–‡ä»¶"></p><p>æ‰“å¼€ my.ini ä¿®æ”¹æ–‡ä»¶å†…å®¹</p><p>basedir = C:\Program Files\mysql-5.7.17-winx64</p><p>datadir = C:\Program Files\mysql-5.7.17-winx64\data</p><p>port = 3306</p><p>æ³¨æ„ï¼šå»æ‰æºæ–‡ä»¶ä¸Šè¿°ä¸‰è¡Œå‰é¢çš„#</p><p><img src="https://upload-images.jianshu.io/upload_images/7779890-01482d69cb731a3c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="é…ç½® my.ini æ–‡ä»¶"> </p><h1 id="æ³¨å†Œwindowsç³»ç»ŸæœåŠ¡"><a href="#æ³¨å†Œwindowsç³»ç»ŸæœåŠ¡" class="headerlink" title="æ³¨å†Œwindowsç³»ç»ŸæœåŠ¡"></a>æ³¨å†Œwindowsç³»ç»ŸæœåŠ¡</h1><p>ä»¥ç®¡ç†å‘˜æƒé™æ‰“å¼€cmd</p><p>æ‰§è¡Œ</p><p>mysqld install MySQL â€“defaults-file=â€C:\Program Files\mysql-5.7.17-winx64\my.iniâ€</p><p> <img src="https://upload-images.jianshu.io/upload_images/7779890-4b560979e280ef7e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="å®‰è£…windowsç³»ç»ŸæœåŠ¡"></p><p>æ³¨å†Œè¡¨ä¸­æŸ¥çœ‹ImagePathçš„å€¼</p><p>æˆ‘çš„ä¸º</p><p>â€œC:\Program Files\mysql-5.7.17-winx64\bin\mysqldâ€ â€“defaults-file=â€C:\Program Files\mysql-5.7.17-winx64\my.iniâ€ MySQL</p><p>å…¶ä¸­åŒ…å«äº†mysqldï¼Œå°±ä¸ä¿®æ”¹äº†ã€‚</p><p>æ³¨å†Œè¡¨ä½ç½®ä¸ºï¼š</p><p>\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\MySQL</p><p> <img src="https://upload-images.jianshu.io/upload_images/7779890-764ad0cb56f7a1b4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="æŸ¥çœ‹æ³¨å†Œè¡¨"></p><h1 id="æ‰§è¡Œmysqld-â€“initializeè¿›è¡Œåˆå§‹åŒ–ï¼ˆç”Ÿæˆdataç›®å½•"><a href="#æ‰§è¡Œmysqld-â€“initializeè¿›è¡Œåˆå§‹åŒ–ï¼ˆç”Ÿæˆdataç›®å½•" class="headerlink" title="æ‰§è¡Œmysqld â€“initializeè¿›è¡Œåˆå§‹åŒ–ï¼ˆç”Ÿæˆdataç›®å½•"></a>æ‰§è¡Œmysqld â€“initializeè¿›è¡Œåˆå§‹åŒ–ï¼ˆç”Ÿæˆdataç›®å½•</h1><p><strong>æ‰§è¡Œ mysqld â€“initialize</strong></p><p> <img src="https://upload-images.jianshu.io/upload_images/7779890-54c06e5e88d80d03.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="ç”Ÿæˆdataç›®å½•"></p><h1 id="å¯åŠ¨-MySQL-æœåŠ¡"><a href="#å¯åŠ¨-MySQL-æœåŠ¡" class="headerlink" title="å¯åŠ¨ MySQL æœåŠ¡"></a>å¯åŠ¨ MySQL æœåŠ¡</h1><p>æ‰§è¡Œ net start mysql</p><p> <img src="https://upload-images.jianshu.io/upload_images/7779890-36b66e48a493be78.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="å¯åŠ¨mysqlæœåŠ¡"></p><h1 id="ç™»å½•mysql-ä¿®æ”¹-root-è´¦æˆ·é»˜è®¤å¯†ç "><a href="#ç™»å½•mysql-ä¿®æ”¹-root-è´¦æˆ·é»˜è®¤å¯†ç " class="headerlink" title="ç™»å½•mysql ä¿®æ”¹ root è´¦æˆ·é»˜è®¤å¯†ç "></a>ç™»å½•mysql ä¿®æ”¹ root è´¦æˆ·é»˜è®¤å¯†ç </h1><p>é»˜è®¤å¯†ç ä¿å­˜åœ¨ç”Ÿæˆdataç›®å½•ä¸‹é¢çš„ .err æ–‡ä»¶ä¸­ è®°äº‹æœ¬æ‰“å¼€ä»¥åæŸ¥æ‰¾åˆå§‹åŒ–å¯†ç </p><p>A temporary password is generated for root@localhost: [å¯†ç ]</p><p>æˆ‘çš„ä¸º</p><p> <img src="https://upload-images.jianshu.io/upload_images/7779890-f6105fb43d110ed3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="æŸ¥çœ‹mysqlé»˜è®¤å¯†ç "></p><p> <img src="https://upload-images.jianshu.io/upload_images/7779890-cee82bdbca026017.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="æŸ¥çœ‹mysqlé»˜è®¤å¯†ç "></p><p>æ‰§è¡Œ mysql â€“uroot â€“p  å¤åˆ¶åˆšåˆšä¸Šé¢çš„åˆå§‹åŒ–å¯†ç å®Œæˆç™»å½•</p><p>ä¿®æ”¹é»˜è®¤å¯†ç </p><p>æ‰§è¡Œ SET PASSWORD = PASSWORD(â€˜â€™);  æˆ‘è¿™é‡Œå°†å¯†ç è®¾ç½®ä¸ºç©º</p><p>æ‰§è¡Œå®Œæˆä»¥åé€€å‡ºmysql å°±å¯ä»¥ä½¿ç”¨æ–°å¯†ç è¿›è¡Œç™»å½•äº†</p><p><img src="https://upload-images.jianshu.io/upload_images/7779890-2e1ff6ff641fc0a1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="ä½¿ç”¨é»˜è®¤å¯†ç ç™»å½•mysql"> </p><p> <img src="https://upload-images.jianshu.io/upload_images/7779890-78b583f159ef7e16.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="ä¿®æ”¹rootè´¦æˆ·å¯†ç ä¸ºç©º"></p><h1 id="ä¿®æ”¹mysql-é»˜è®¤ç¼–ç "><a href="#ä¿®æ”¹mysql-é»˜è®¤ç¼–ç " class="headerlink" title="ä¿®æ”¹mysql é»˜è®¤ç¼–ç "></a>ä¿®æ”¹mysql é»˜è®¤ç¼–ç </h1><p>æ‰§è¡Œ show variables like â€˜character_set_%â€™;  æŸ¥çœ‹ mysql ç¼–ç </p><p> <img src="https://upload-images.jianshu.io/upload_images/7779890-f980b405e8a7a985.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="img"></p><p>æŸ¥çœ‹mysqlé»˜è®¤ç¼–ç å­—ç¬¦</p><p>ä¿®æ”¹ my.ini æ–‡ä»¶</p><p> <img src="https://upload-images.jianshu.io/upload_images/7779890-592115d4c335f4fe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="img"></p><p>ä¿®æ”¹é…ç½®mysqlç¼–ç </p><p>é‡å¯mysql</p><p> <img src="https://upload-images.jianshu.io/upload_images/7779890-b9fe603076e9cbb6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="img"></p><p>é‡å¯mysqlå¹¶ä¸”é‡æ–°ç™»å½•</p><p>æ‰§è¡Œ show variables like â€˜character_set_%â€™;  æŸ¥çœ‹ mysql ç¼–ç </p><p> <img src="https://upload-images.jianshu.io/upload_images/7779890-ce2989ab8b44781e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="img"></p><p>æŸ¥çœ‹ä¿®æ”¹ä»¥åçš„ç¼–ç å­—ç¬¦ utf8</p><p>æ³¨æ„ï¼š</p><p>ç½‘ä¸Šå¾ˆå¤šèµ„æºéƒ½æ˜¯åœ¨[mysqld]ä¸‹æ·»åŠ </p><p>default-character-set=utf8</p><p>å¦‚æœè¿™æ ·æ”¹ä¼šå¯¼è‡´5.7ç‰ˆæœ¬mysqlæ— æ³•æ‰“å¼€</p><p>æ‰€ä»¥è¦æ”¹ä¸º</p><p>character-set-server=utf8</p><p>æ”¹å®Œåï¼Œè¦åˆ é™¤æ•°æ®åº“ä¸­æ‰€æœ‰æ•°æ®ï¼Œæ‰èƒ½ä½¿ç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>macä½¿ç”¨parallelså®‰è£…é…ç½®centos7</title>
      <link href="2018/08/10/mac-install-parallel-centos7/"/>
      <url>2018/08/10/mac-install-parallel-centos7/</url>
      
        <content type="html"><![CDATA[<h3 id="å®‰è£…parallels"><a href="#å®‰è£…parallels" class="headerlink" title="å®‰è£…parallels"></a>å®‰è£…parallels</h3><p><a href="https://www.jianshu.com/p/76f38e6c0792">https://www.jianshu.com/p/76f38e6c0792</a></p><h3 id="é…ç½®-ssh-ç™»å½•"><a href="#é…ç½®-ssh-ç™»å½•" class="headerlink" title="é…ç½® ssh ç™»å½•"></a>é…ç½® ssh ç™»å½•</h3><blockquote><ol><li>æŸ¥çœ‹å®¿ä¸»æœºipå’Œç½‘å…³</li><li>ä¿®æ”¹ç½‘å¡é…ç½®æ–‡ä»¶</li><li>é…ç½®å¤–ç½‘dns</li><li>ä¿å­˜é‡å¯ç½‘ç»œ</li><li>ssh è¿æ¥ é…ç½®</li></ol></blockquote><h3 id="æŸ¥çœ‹å®¿ä¸»æœºIPå’Œç½‘å…³"><a href="#æŸ¥çœ‹å®¿ä¸»æœºIPå’Œç½‘å…³" class="headerlink" title="æŸ¥çœ‹å®¿ä¸»æœºIPå’Œç½‘å…³"></a>æŸ¥çœ‹å®¿ä¸»æœºIPå’Œç½‘å…³</h3><p>ifconfig</p><h3 id="ä¿®æ”¹ç½‘å¡é…ç½®æ–‡ä»¶å’ŒNDS"><a href="#ä¿®æ”¹ç½‘å¡é…ç½®æ–‡ä»¶å’ŒNDS" class="headerlink" title="ä¿®æ”¹ç½‘å¡é…ç½®æ–‡ä»¶å’ŒNDS"></a>ä¿®æ”¹ç½‘å¡é…ç½®æ–‡ä»¶å’ŒNDS</h3><blockquote><p>vi /etc/sysconfig/network-scripts/ifcfg-eth0</p></blockquote><pre><code>BOOTPROTO=static # ç½‘å¡è·å–IPçš„æ–¹å¼(é»˜è®¤ä¸ºdchp,è®¾ç½®ä¸ºé™æ€è·å–ã€‚IPADDR=192.168.1.254 # é™¤æœ€åéƒ¨åˆ†å…¶ä»–ä¸å®¿ä¸»æœºçš„ç½‘å…³ä¸€è‡´GATEWAY=192.168.1.1 # ä¸å®¿ä¸»æœºä¿æŒä¸€è‡´NETMASK=255.255.255.0ONBOOT=yesDNS1=192.168.1.1DNS2=8.8.8.8</code></pre><h3 id="ä¿å­˜é‡å¯ç½‘ç»œ"><a href="#ä¿å­˜é‡å¯ç½‘ç»œ" class="headerlink" title="ä¿å­˜é‡å¯ç½‘ç»œ"></a>ä¿å­˜é‡å¯ç½‘ç»œ</h3><pre><code>service network restart</code></pre><h3 id="ssh-è¿æ¥-é…ç½®"><a href="#ssh-è¿æ¥-é…ç½®" class="headerlink" title="ssh è¿æ¥ é…ç½®"></a>ssh è¿æ¥ é…ç½®</h3><pre><code>ssh root@192.168.1.254</code></pre><h3 id="å¼€æ”¾ç«¯å£"><a href="#å¼€æ”¾ç«¯å£" class="headerlink" title="å¼€æ”¾ç«¯å£"></a>å¼€æ”¾ç«¯å£</h3><ul><li>æ°¸ä¹…çš„å¼€æ”¾éœ€è¦çš„ç«¯å£</li></ul><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># æ·»åŠ å¼€æ”¾ç«¯å£</span><span class="token function">sudo</span> firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span>3000/tcp --permanent<span class="token comment" spellcheck="true"># å…³é—­å¼€æ”¾ç«¯å£</span><span class="token function">sudo</span> firewall-cmd --zone<span class="token operator">=</span>public --remove-port<span class="token operator">=</span>80/tcp --permanent<span class="token comment" spellcheck="true"># é‡æ–°åŠ è½½</span><span class="token function">sudo</span> firewall-cmd --reload</code></pre><ul><li>ä¹‹åæ£€æŸ¥æ–°çš„é˜²ç«å¢™è§„åˆ™</li></ul><pre class=" language-bash"><code class="language-bash">firewall-cmd --list-all</code></pre><h3 id="å…³é—­é˜²ç«å¢™"><a href="#å…³é—­é˜²ç«å¢™" class="headerlink" title="å…³é—­é˜²ç«å¢™"></a>å…³é—­é˜²ç«å¢™</h3><pre class=" language-bash"><code class="language-bash">//ä¸´æ—¶å…³é—­é˜²ç«å¢™,é‡å¯åä¼šé‡æ–°è‡ªåŠ¨æ‰“å¼€systemctl restart firewalld//æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€firewall-cmd --statefirewall-cmd --list-all//Disable firewallsystemctl disable firewalldsystemctl stop firewalldsystemctl status firewalld//Enable firewallsystemctl <span class="token function">enable</span> firewalldsystemctl start firewalldsystemctl status firewalld</code></pre>]]></content>
      
      
      <categories>
          
          <category> MacBook </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kafkaå¸¸ç”¨æ“ä½œç¬”è®°</title>
      <link href="2018/07/30/kafka-note/"/>
      <url>2018/07/30/kafka-note/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸‹è½½åœ°å€"><a href="#ä¸‹è½½åœ°å€" class="headerlink" title="ä¸‹è½½åœ°å€"></a>ä¸‹è½½åœ°å€</h2><pre class=" language-http"><code class="language-http"><span class="token header-name keyword">http:</span>//kafka.apache.org/downloads</code></pre><h2 id="å®‰è£…æ­¥éª¤"><a href="#å®‰è£…æ­¥éª¤" class="headerlink" title="å®‰è£…æ­¥éª¤"></a>å®‰è£…æ­¥éª¤</h2><blockquote><p>è§£å‹ä¸‹è½½æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ï¼Œæ¯”å¦‚ /usr/local</p><p>tar -zxvf /usr/local/kafka_2.12-1.0.0.tgz</p></blockquote><h2 id="åœæ­¢zookeeperä¸kafka"><a href="#åœæ­¢zookeeperä¸kafka" class="headerlink" title="åœæ­¢zookeeperä¸kafka"></a>åœæ­¢zookeeperä¸kafka</h2><pre class=" language-shell"><code class="language-shell">cd /usr/local./bin/zookeeper-server-stop.sh./bin/kafka-server-stop.sh</code></pre><h2 id="å¯åŠ¨-zookeeper"><a href="#å¯åŠ¨-zookeeper" class="headerlink" title="å¯åŠ¨ zookeeper"></a>å¯åŠ¨ zookeeper</h2><pre class=" language-shell"><code class="language-shell">cd /usr/local./bin/zookeeper-server-start.sh -daemon  ./config/zookeeper.properties</code></pre><blockquote><p>-daemon è¡¨ç¤ºåå°è¿è¡Œ</p></blockquote><h2 id="å¯åŠ¨kafka"><a href="#å¯åŠ¨kafka" class="headerlink" title="å¯åŠ¨kafka"></a>å¯åŠ¨kafka</h2><pre class=" language-shell"><code class="language-shell">cd /usr/local./bin/kafka-server-start.sh -daemon  ./config/server.properties</code></pre><h2 id="æŸ¥çœ‹kafkaä¸zookeeperæ˜¯å¦è¿è¡Œ"><a href="#æŸ¥çœ‹kafkaä¸zookeeperæ˜¯å¦è¿è¡Œ" class="headerlink" title="æŸ¥çœ‹kafkaä¸zookeeperæ˜¯å¦è¿è¡Œ"></a>æŸ¥çœ‹kafkaä¸zookeeperæ˜¯å¦è¿è¡Œ</h2><pre><code>netstat -ntpul | grep 2181netstat -ntpul | grep 9092</code></pre><h2 id="åˆ›å»º-topic"><a href="#åˆ›å»º-topic" class="headerlink" title="åˆ›å»º topic"></a>åˆ›å»º topic</h2><pre class=" language-shell"><code class="language-shell">./bin/kafka-topics.sh --create --zookeeper 192.168.1.200:2181 --replication-factor 1 --partitions 1 --topic TOPIC_001</code></pre><h2 id="åˆ é™¤topic"><a href="#åˆ é™¤topic" class="headerlink" title="åˆ é™¤topic"></a>åˆ é™¤topic</h2><blockquote><p><a href="http://blog.csdn.net/fengzheku/article/details/50585972">http://blog.csdn.net/fengzheku/article/details/50585972</a></p></blockquote><pre class=" language-shell"><code class="language-shell">./bin/kafka-topics.sh  --delete --zookeeper 192.168.1.200:2181  --topic TOPIC_001</code></pre><h2 id="æŸ¥çœ‹å·²ç»å­˜åœ¨çš„topic"><a href="#æŸ¥çœ‹å·²ç»å­˜åœ¨çš„topic" class="headerlink" title="æŸ¥çœ‹å·²ç»å­˜åœ¨çš„topic"></a>æŸ¥çœ‹å·²ç»å­˜åœ¨çš„topic</h2><pre class=" language-shell"><code class="language-shell">./bin/kafka-topics.sh --list --zookeeper localhost:2181</code></pre><h2 id="æŸ¥çœ‹topicçš„è¯¦ç»†ä¿¡æ¯"><a href="#æŸ¥çœ‹topicçš„è¯¦ç»†ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹topicçš„è¯¦ç»†ä¿¡æ¯"></a>æŸ¥çœ‹topicçš„è¯¦ç»†ä¿¡æ¯</h2><pre class=" language-shell"><code class="language-shell">./bin/kafka-topics.sh --describe --zookeeper 192.168.1.200:2181 --topic TOPIC_001</code></pre><h2 id="ç”Ÿäº§æ¶ˆæ¯"><a href="#ç”Ÿäº§æ¶ˆæ¯" class="headerlink" title="ç”Ÿäº§æ¶ˆæ¯"></a>ç”Ÿäº§æ¶ˆæ¯</h2><pre class=" language-shell"><code class="language-shell">./bin/kafka-console-producer.sh --broker-list 192.168.1.200:9092 --topic TOPIC_001</code></pre><h2 id="æ¶ˆè´¹æ¶ˆæ¯"><a href="#æ¶ˆè´¹æ¶ˆæ¯" class="headerlink" title="æ¶ˆè´¹æ¶ˆæ¯"></a>æ¶ˆè´¹æ¶ˆæ¯</h2><pre class=" language-shell"><code class="language-shell">./bin/kafka-console-consumer.sh --bootstrap-server 192.168.1.200:9092 --topic TOPIC_001 --from-beginning</code></pre><h2 id="è§£å†³kafkaæ— æ³•æ”¶å‘æ¶ˆæ¯"><a href="#è§£å†³kafkaæ— æ³•æ”¶å‘æ¶ˆæ¯" class="headerlink" title="è§£å†³kafkaæ— æ³•æ”¶å‘æ¶ˆæ¯"></a>è§£å†³kafkaæ— æ³•æ”¶å‘æ¶ˆæ¯</h2><blockquote><p>org.apache.kafka.common.errors.TimeoutException</p></blockquote><p><a href="https://www.jianshu.com/p/2db7abddb9e6">https://www.jianshu.com/p/2db7abddb9e6</a></p><pre class=" language-shell"><code class="language-shell">vim /usr/local/kafka/config/server.propertiesåŠ å…¥ä»¥ä¸‹é…ç½®ç„¶åé‡å¯zookeeperä¸kafkaadvertised.host.name=192.168.1.200advertised.port=9092</code></pre>]]></content>
      
      
      <categories>
          
          <category> Kafka </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨docker-composeæ„å»ºkafkaé›†ç¾¤</title>
      <link href="2018/07/28/docker-compose-zk-kafka/"/>
      <url>2018/07/28/docker-compose-zk-kafka/</url>
      
        <content type="html"><![CDATA[<p>â€ƒâ€ƒä¸Šç¯‡è¯´åˆ°äº†docker-composeçš„ä¸€äº›åŸºæœ¬å‘½ä»¤ï¼Œè¿™æ¬¡ä½¿ç”¨docker-composeæ„å»ºkafkaé›†ç¾¤ã€‚åœ¨è¯´kafkaä¹‹å‰ï¼Œå…ˆç®€å•äº†è§£ä¸€ä¸‹kafkaæ˜¯ä»€ä¹ˆä¸œè¥¿ã€‚</p><h2 id="Kafkaåˆ›å»ºèƒŒæ™¯"><a href="#Kafkaåˆ›å»ºèƒŒæ™¯" class="headerlink" title="Kafkaåˆ›å»ºèƒŒæ™¯"></a>Kafkaåˆ›å»ºèƒŒæ™¯</h2><p>Kafkaæ˜¯ä¸€ä¸ªæ¶ˆæ¯ç³»ç»Ÿï¼ŒåŸæœ¬å¼€å‘è‡ªLinkedInï¼Œç”¨ä½œLinkedInçš„æ´»åŠ¨æµï¼ˆActivity Streamï¼‰å’Œè¿è¥æ•°æ®å¤„ç†ç®¡é“ï¼ˆPipelineï¼‰çš„åŸºç¡€ã€‚ç°åœ¨å®ƒå·²è¢«å¤šå®¶ä¸åŒç±»å‹çš„å…¬å¸ä½œä¸ºå¤šç§ç±»å‹çš„æ•°æ®ç®¡é“å’Œæ¶ˆæ¯ç³»ç»Ÿä½¿ç”¨ã€‚</p><p>æ´»åŠ¨æµæ•°æ®æ˜¯å‡ ä¹æ‰€æœ‰ç«™ç‚¹åœ¨å¯¹å…¶ç½‘ç«™ä½¿ç”¨æƒ…å†µåšæŠ¥è¡¨æ—¶éƒ½è¦ç”¨åˆ°çš„æ•°æ®ä¸­æœ€å¸¸è§„çš„éƒ¨åˆ†ã€‚æ´»åŠ¨æ•°æ®åŒ…æ‹¬é¡µé¢è®¿é—®é‡ï¼ˆPage Viewï¼‰ã€è¢«æŸ¥çœ‹å†…å®¹æ–¹é¢çš„ä¿¡æ¯ä»¥åŠæœç´¢æƒ…å†µç­‰å†…å®¹ã€‚è¿™ç§æ•°æ®é€šå¸¸çš„å¤„ç†æ–¹å¼æ˜¯å…ˆæŠŠå„ç§æ´»åŠ¨ä»¥æ—¥å¿—çš„å½¢å¼å†™å…¥æŸç§æ–‡ä»¶ï¼Œç„¶åå‘¨æœŸæ€§åœ°å¯¹è¿™äº›æ–‡ä»¶è¿›è¡Œç»Ÿè®¡åˆ†æã€‚è¿è¥æ•°æ®æŒ‡çš„æ˜¯æœåŠ¡å™¨çš„æ€§èƒ½æ•°æ®ï¼ˆCPUã€IOä½¿ç”¨ç‡ã€è¯·æ±‚æ—¶é—´ã€æœåŠ¡æ—¥å¿—ç­‰ç­‰æ•°æ®)ã€‚è¿è¥æ•°æ®çš„ç»Ÿè®¡æ–¹æ³•ç§ç±»ç¹å¤šã€‚</p><p>è¿‘å¹´æ¥ï¼Œæ´»åŠ¨å’Œè¿è¥æ•°æ®å¤„ç†å·²ç»æˆä¸ºäº†ç½‘ç«™è½¯ä»¶äº§å“ç‰¹æ€§ä¸­ä¸€ä¸ªè‡³å…³é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œè¿™å°±éœ€è¦ä¸€å¥—ç¨å¾®æ›´åŠ å¤æ‚çš„åŸºç¡€è®¾æ–½å¯¹å…¶æä¾›æ”¯æŒã€‚</p><h2 id="Kafkaç®€ä»‹"><a href="#Kafkaç®€ä»‹" class="headerlink" title="Kafkaç®€ä»‹"></a>Kafkaç®€ä»‹</h2><p>Kafkaæ˜¯ä¸€ç§åˆ†å¸ƒå¼çš„ï¼ŒåŸºäºå‘å¸ƒ/è®¢é˜…çš„æ¶ˆæ¯ç³»ç»Ÿã€‚ä¸»è¦è®¾è®¡ç›®æ ‡å¦‚ä¸‹ï¼š</p><ul><li>ä»¥æ—¶é—´å¤æ‚åº¦ä¸ºO(1)çš„æ–¹å¼æä¾›æ¶ˆæ¯æŒä¹…åŒ–èƒ½åŠ›ï¼Œå³ä½¿å¯¹TBçº§ä»¥ä¸Šæ•°æ®ä¹Ÿèƒ½ä¿è¯å¸¸æ•°æ—¶é—´å¤æ‚åº¦çš„è®¿é—®æ€§èƒ½ã€‚</li><li>é«˜ååç‡ã€‚å³ä½¿åœ¨éå¸¸å»‰ä»·çš„å•†ç”¨æœºå™¨ä¸Šä¹Ÿèƒ½åšåˆ°å•æœºæ”¯æŒæ¯ç§’100Kæ¡ä»¥ä¸Šæ¶ˆæ¯çš„ä¼ è¾“ã€‚</li><li>æ”¯æŒKafka Serveré—´çš„æ¶ˆæ¯åˆ†åŒºï¼ŒåŠåˆ†å¸ƒå¼æ¶ˆè´¹ï¼ŒåŒæ—¶ä¿è¯æ¯ä¸ªPartitionå†…çš„æ¶ˆæ¯é¡ºåºä¼ è¾“ã€‚</li><li>åŒæ—¶æ”¯æŒç¦»çº¿æ•°æ®å¤„ç†å’Œå®æ—¶æ•°æ®å¤„ç†ã€‚</li><li>Scale outï¼šæ”¯æŒåœ¨çº¿æ°´å¹³æ‰©å±•ã€‚</li></ul><h3 id="ä¸ºä½•ä½¿ç”¨æ¶ˆæ¯ç³»ç»Ÿ"><a href="#ä¸ºä½•ä½¿ç”¨æ¶ˆæ¯ç³»ç»Ÿ" class="headerlink" title="ä¸ºä½•ä½¿ç”¨æ¶ˆæ¯ç³»ç»Ÿ"></a>ä¸ºä½•ä½¿ç”¨æ¶ˆæ¯ç³»ç»Ÿ</h3><ul><li><p>è§£è€¦</p><p>åœ¨é¡¹ç›®å¯åŠ¨ä¹‹åˆæ¥é¢„æµ‹å°†æ¥é¡¹ç›®ä¼šç¢°åˆ°ä»€ä¹ˆéœ€æ±‚ï¼Œæ˜¯æå…¶å›°éš¾çš„ã€‚æ¶ˆæ¯ç³»ç»Ÿåœ¨å¤„ç†è¿‡ç¨‹ä¸­é—´æ’å…¥äº†ä¸€ä¸ªéšå«çš„ã€åŸºäºæ•°æ®çš„æ¥å£å±‚ï¼Œä¸¤è¾¹çš„å¤„ç†è¿‡ç¨‹éƒ½è¦å®ç°è¿™ä¸€æ¥å£ã€‚è¿™å…è®¸ä½ ç‹¬ç«‹çš„æ‰©å±•æˆ–ä¿®æ”¹ä¸¤è¾¹çš„å¤„ç†è¿‡ç¨‹ï¼Œåªè¦ç¡®ä¿å®ƒä»¬éµå®ˆåŒæ ·çš„æ¥å£çº¦æŸã€‚</p></li><li><p>å†—ä½™</p></li></ul><p>  æœ‰äº›æƒ…å†µä¸‹ï¼Œå¤„ç†æ•°æ®çš„è¿‡ç¨‹ä¼šå¤±è´¥ã€‚é™¤éæ•°æ®è¢«æŒä¹…åŒ–ï¼Œå¦åˆ™å°†é€ æˆä¸¢å¤±ã€‚æ¶ˆæ¯é˜Ÿåˆ—æŠŠæ•°æ®è¿›è¡ŒæŒä¹…åŒ–ç›´åˆ°å®ƒä»¬å·²ç»è¢«å®Œå…¨å¤„ç†ï¼Œé€šè¿‡è¿™ä¸€æ–¹å¼è§„é¿äº†æ•°æ®ä¸¢å¤±é£é™©ã€‚è®¸å¤šæ¶ˆæ¯é˜Ÿåˆ—æ‰€é‡‡ç”¨çš„â€æ’å…¥-è·å–-åˆ é™¤â€èŒƒå¼ä¸­ï¼Œåœ¨æŠŠä¸€ä¸ªæ¶ˆæ¯ä»é˜Ÿåˆ—ä¸­åˆ é™¤ä¹‹å‰ï¼Œéœ€è¦ä½ çš„å¤„ç†ç³»ç»Ÿæ˜ç¡®çš„æŒ‡å‡ºè¯¥æ¶ˆæ¯å·²ç»è¢«å¤„ç†å®Œæ¯•ï¼Œä»è€Œç¡®ä¿ä½ çš„æ•°æ®è¢«å®‰å…¨çš„ä¿å­˜ç›´åˆ°ä½ ä½¿ç”¨å®Œæ¯•ã€‚</p><ul><li><p>æ‰©å±•æ€§</p><p>å› ä¸ºæ¶ˆæ¯é˜Ÿåˆ—è§£è€¦äº†ä½ çš„å¤„ç†è¿‡ç¨‹ï¼Œæ‰€ä»¥å¢å¤§æ¶ˆæ¯å…¥é˜Ÿå’Œå¤„ç†çš„é¢‘ç‡æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œåªè¦å¦å¤–å¢åŠ å¤„ç†è¿‡ç¨‹å³å¯ã€‚ä¸éœ€è¦æ”¹å˜ä»£ç ã€ä¸éœ€è¦è°ƒèŠ‚å‚æ•°ã€‚æ‰©å±•å°±åƒè°ƒå¤§ç”µåŠ›æŒ‰é’®ä¸€æ ·ç®€å•ã€‚</p></li><li><p>çµæ´»æ€§ &amp; å³°å€¼å¤„ç†èƒ½åŠ›</p><p>åœ¨è®¿é—®é‡å‰§å¢çš„æƒ…å†µä¸‹ï¼Œåº”ç”¨ä»ç„¶éœ€è¦ç»§ç»­å‘æŒ¥ä½œç”¨ï¼Œä½†æ˜¯è¿™æ ·çš„çªå‘æµé‡å¹¶ä¸å¸¸è§ï¼›å¦‚æœä¸ºä»¥èƒ½å¤„ç†è¿™ç±»å³°å€¼è®¿é—®ä¸ºæ ‡å‡†æ¥æŠ•å…¥èµ„æºéšæ—¶å¾…å‘½æ— ç–‘æ˜¯å·¨å¤§çš„æµªè´¹ã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—èƒ½å¤Ÿä½¿å…³é”®ç»„ä»¶é¡¶ä½çªå‘çš„è®¿é—®å‹åŠ›ï¼Œè€Œä¸ä¼šå› ä¸ºçªå‘çš„è¶…è´Ÿè·çš„è¯·æ±‚è€Œå®Œå…¨å´©æºƒã€‚</p></li><li><p>å¯æ¢å¤æ€§</p><p>ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ç»„ä»¶å¤±æ•ˆæ—¶ï¼Œä¸ä¼šå½±å“åˆ°æ•´ä¸ªç³»ç»Ÿã€‚æ¶ˆæ¯é˜Ÿåˆ—é™ä½äº†è¿›ç¨‹é—´çš„è€¦åˆåº¦ï¼Œæ‰€ä»¥å³ä½¿ä¸€ä¸ªå¤„ç†æ¶ˆæ¯çš„è¿›ç¨‹æŒ‚æ‰ï¼ŒåŠ å…¥é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä»ç„¶å¯ä»¥åœ¨ç³»ç»Ÿæ¢å¤åè¢«å¤„ç†ã€‚</p></li><li><p>é¡ºåºä¿è¯</p><p>åœ¨å¤§å¤šä½¿ç”¨åœºæ™¯ä¸‹ï¼Œæ•°æ®å¤„ç†çš„é¡ºåºéƒ½å¾ˆé‡è¦ã€‚å¤§éƒ¨åˆ†æ¶ˆæ¯é˜Ÿåˆ—æœ¬æ¥å°±æ˜¯æ’åºçš„ï¼Œå¹¶ä¸”èƒ½ä¿è¯æ•°æ®ä¼šæŒ‰ç…§ç‰¹å®šçš„é¡ºåºæ¥å¤„ç†ã€‚Kafkaä¿è¯ä¸€ä¸ªPartitionå†…çš„æ¶ˆæ¯çš„æœ‰åºæ€§ã€‚</p></li><li><p>ç¼“å†²</p><p>åœ¨ä»»ä½•é‡è¦çš„ç³»ç»Ÿä¸­ï¼Œéƒ½ä¼šæœ‰éœ€è¦ä¸åŒçš„å¤„ç†æ—¶é—´çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼ŒåŠ è½½ä¸€å¼ å›¾ç‰‡æ¯”åº”ç”¨è¿‡æ»¤å™¨èŠ±è´¹æ›´å°‘çš„æ—¶é—´ã€‚æ¶ˆæ¯é˜Ÿåˆ—é€šè¿‡ä¸€ä¸ªç¼“å†²å±‚æ¥å¸®åŠ©ä»»åŠ¡æœ€é«˜æ•ˆç‡çš„æ‰§è¡Œâ€”â€”â€”å†™å…¥é˜Ÿåˆ—çš„å¤„ç†ä¼šå°½å¯èƒ½çš„å¿«é€Ÿã€‚è¯¥ç¼“å†²æœ‰åŠ©äºæ§åˆ¶å’Œä¼˜åŒ–æ•°æ®æµç»è¿‡ç³»ç»Ÿçš„é€Ÿåº¦ã€‚</p></li><li><p>å¼‚æ­¥é€šä¿¡</p><p>å¾ˆå¤šæ—¶å€™ï¼Œç”¨æˆ·ä¸æƒ³ä¹Ÿä¸éœ€è¦ç«‹å³å¤„ç†æ¶ˆæ¯ã€‚æ¶ˆæ¯é˜Ÿåˆ—æä¾›äº†å¼‚æ­¥å¤„ç†æœºåˆ¶ï¼Œå…è®¸ç”¨æˆ·æŠŠä¸€ä¸ªæ¶ˆæ¯æ”¾å…¥é˜Ÿåˆ—ï¼Œä½†å¹¶ä¸ç«‹å³å¤„ç†å®ƒã€‚æƒ³å‘é˜Ÿåˆ—ä¸­æ”¾å…¥å¤šå°‘æ¶ˆæ¯å°±æ”¾å¤šå°‘ï¼Œç„¶ååœ¨éœ€è¦çš„æ—¶å€™å†å»å¤„ç†å®ƒä»¬ã€‚</p></li></ul><h2 id="å¸¸ç”¨Message-Queueå¯¹æ¯”"><a href="#å¸¸ç”¨Message-Queueå¯¹æ¯”" class="headerlink" title="å¸¸ç”¨Message Queueå¯¹æ¯”"></a>å¸¸ç”¨Message Queueå¯¹æ¯”</h2><ul><li><p><strong>RabbitMQ</strong></p><p>RabbitMQæ˜¯ä½¿ç”¨Erlangç¼–å†™çš„ä¸€ä¸ªå¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæœ¬èº«æ”¯æŒå¾ˆå¤šçš„åè®®ï¼šAMQPï¼ŒXMPP, SMTP, STOMPï¼Œä¹Ÿæ­£å› å¦‚æ­¤ï¼Œå®ƒéå¸¸é‡é‡çº§ï¼Œæ›´é€‚åˆäºä¼ä¸šçº§çš„å¼€å‘ã€‚åŒæ—¶å®ç°äº†Brokeræ„æ¶ï¼Œè¿™æ„å‘³ç€æ¶ˆæ¯åœ¨å‘é€ç»™å®¢æˆ·ç«¯æ—¶å…ˆåœ¨ä¸­å¿ƒé˜Ÿåˆ—æ’é˜Ÿã€‚å¯¹è·¯ç”±ï¼Œè´Ÿè½½å‡è¡¡æˆ–è€…æ•°æ®æŒä¹…åŒ–éƒ½æœ‰å¾ˆå¥½çš„æ”¯æŒã€‚</p></li><li><p><strong>Redis</strong></p><p>Redisæ˜¯ä¸€ä¸ªåŸºäºKey-Valueå¯¹çš„NoSQLæ•°æ®åº“ï¼Œå¼€å‘ç»´æŠ¤å¾ˆæ´»è·ƒã€‚è™½ç„¶å®ƒæ˜¯ä¸€ä¸ªKey-Valueæ•°æ®åº“å­˜å‚¨ç³»ç»Ÿï¼Œä½†å®ƒæœ¬èº«æ”¯æŒMQåŠŸèƒ½ï¼Œæ‰€ä»¥å®Œå…¨å¯ä»¥å½“åšä¸€ä¸ªè½»é‡çº§çš„é˜Ÿåˆ—æœåŠ¡æ¥ä½¿ç”¨ã€‚å¯¹äºRabbitMQå’ŒRedisçš„å…¥é˜Ÿå’Œå‡ºé˜Ÿæ“ä½œï¼Œå„æ‰§è¡Œ100ä¸‡æ¬¡ï¼Œæ¯10ä¸‡æ¬¡è®°å½•ä¸€æ¬¡æ‰§è¡Œæ—¶é—´ã€‚æµ‹è¯•æ•°æ®åˆ†ä¸º128Bytesã€512Bytesã€1Kå’Œ10Kå››ä¸ªä¸åŒå¤§å°çš„æ•°æ®ã€‚å®éªŒè¡¨æ˜ï¼šå…¥é˜Ÿæ—¶ï¼Œå½“æ•°æ®æ¯”è¾ƒå°æ—¶Redisçš„æ€§èƒ½è¦é«˜äºRabbitMQï¼Œè€Œå¦‚æœæ•°æ®å¤§å°è¶…è¿‡äº†10Kï¼ŒRedisåˆ™æ…¢çš„æ— æ³•å¿å—ï¼›å‡ºé˜Ÿæ—¶ï¼Œæ— è®ºæ•°æ®å¤§å°ï¼ŒRediséƒ½è¡¨ç°å‡ºéå¸¸å¥½çš„æ€§èƒ½ï¼Œè€ŒRabbitMQçš„å‡ºé˜Ÿæ€§èƒ½åˆ™è¿œä½äºRedisã€‚</p></li><li><p><strong>ZeroMQ</strong></p><p>ZeroMQå·ç§°æœ€å¿«çš„æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œå°¤å…¶é’ˆå¯¹å¤§ååé‡çš„éœ€æ±‚åœºæ™¯ã€‚ZeroMQèƒ½å¤Ÿå®ç°RabbitMQä¸æ“…é•¿çš„é«˜çº§/å¤æ‚çš„é˜Ÿåˆ—ï¼Œä½†æ˜¯å¼€å‘äººå‘˜éœ€è¦è‡ªå·±ç»„åˆå¤šç§æŠ€æœ¯æ¡†æ¶ï¼ŒæŠ€æœ¯ä¸Šçš„å¤æ‚åº¦æ˜¯å¯¹è¿™MQèƒ½å¤Ÿåº”ç”¨æˆåŠŸçš„æŒ‘æˆ˜ã€‚ZeroMQå…·æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„éä¸­é—´ä»¶çš„æ¨¡å¼ï¼Œä½ ä¸éœ€è¦å®‰è£…å’Œè¿è¡Œä¸€ä¸ªæ¶ˆæ¯æœåŠ¡å™¨æˆ–ä¸­é—´ä»¶ï¼Œå› ä¸ºä½ çš„åº”ç”¨ç¨‹åºå°†æ‰®æ¼”è¿™ä¸ªæœåŠ¡å™¨è§’è‰²ã€‚ä½ åªéœ€è¦ç®€å•çš„å¼•ç”¨ZeroMQç¨‹åºåº“ï¼Œå¯ä»¥ä½¿ç”¨NuGetå®‰è£…ï¼Œç„¶åä½ å°±å¯ä»¥æ„‰å¿«çš„åœ¨åº”ç”¨ç¨‹åºä¹‹é—´å‘é€æ¶ˆæ¯äº†ã€‚ä½†æ˜¯ZeroMQä»…æä¾›éæŒä¹…æ€§çš„é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå®•æœºï¼Œæ•°æ®å°†ä¼šä¸¢å¤±ã€‚å…¶ä¸­ï¼ŒTwitterçš„Storm 0.9.0ä»¥å‰çš„ç‰ˆæœ¬ä¸­é»˜è®¤ä½¿ç”¨ZeroMQä½œä¸ºæ•°æ®æµçš„ä¼ è¾“ï¼ˆStormä»0.9ç‰ˆæœ¬å¼€å§‹åŒæ—¶æ”¯æŒZeroMQå’ŒNettyä½œä¸ºä¼ è¾“æ¨¡å—ï¼‰ã€‚</p></li><li><p><strong>ActiveMQ</strong></p><p>ActiveMQæ˜¯Apacheä¸‹çš„ä¸€ä¸ªå­é¡¹ç›®ã€‚ ç±»ä¼¼äºZeroMQï¼Œå®ƒèƒ½å¤Ÿä»¥ä»£ç†äººå’Œç‚¹å¯¹ç‚¹çš„æŠ€æœ¯å®ç°é˜Ÿåˆ—ã€‚åŒæ—¶ç±»ä¼¼äºRabbitMQï¼Œå®ƒå°‘é‡ä»£ç å°±å¯ä»¥é«˜æ•ˆåœ°å®ç°é«˜çº§åº”ç”¨åœºæ™¯ã€‚</p></li><li><p><strong>Kafka/Jafka</strong></p><p>Kafkaæ˜¯Apacheä¸‹çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½è·¨è¯­è¨€åˆ†å¸ƒå¼å‘å¸ƒ/è®¢é˜…æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œè€ŒJafkaæ˜¯åœ¨Kafkaä¹‹ä¸Šå­µåŒ–è€Œæ¥çš„ï¼Œå³Kafkaçš„ä¸€ä¸ªå‡çº§ç‰ˆã€‚å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼šå¿«é€ŸæŒä¹…åŒ–ï¼Œå¯ä»¥åœ¨O(1)çš„ç³»ç»Ÿå¼€é”€ä¸‹è¿›è¡Œæ¶ˆæ¯æŒä¹…åŒ–ï¼›é«˜ååï¼Œåœ¨ä¸€å°æ™®é€šçš„æœåŠ¡å™¨ä¸Šæ—¢å¯ä»¥è¾¾åˆ°10W/sçš„ååé€Ÿç‡ï¼›å®Œå…¨çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼ŒBrokerã€Producerã€Consumeréƒ½åŸç”Ÿè‡ªåŠ¨æ”¯æŒåˆ†å¸ƒå¼ï¼Œè‡ªåŠ¨å®ç°è´Ÿè½½å‡è¡¡ï¼›æ”¯æŒHadoopæ•°æ®å¹¶è¡ŒåŠ è½½ï¼Œå¯¹äºåƒHadoopçš„ä¸€æ ·çš„æ—¥å¿—æ•°æ®å’Œç¦»çº¿åˆ†æç³»ç»Ÿï¼Œä½†åˆè¦æ±‚å®æ—¶å¤„ç†çš„é™åˆ¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚Kafkaé€šè¿‡Hadoopçš„å¹¶è¡ŒåŠ è½½æœºåˆ¶ç»Ÿä¸€äº†åœ¨çº¿å’Œç¦»çº¿çš„æ¶ˆæ¯å¤„ç†ã€‚Apache Kafkaç›¸å¯¹äºActiveMQæ˜¯ä¸€ä¸ªéå¸¸è½»é‡çº§çš„æ¶ˆæ¯ç³»ç»Ÿï¼Œé™¤äº†æ€§èƒ½éå¸¸å¥½ä¹‹å¤–ï¼Œè¿˜æ˜¯ä¸€ä¸ªå·¥ä½œè‰¯å¥½çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚</p></li></ul><h2 id="æ„å»ºzookeeperã€kakfaé›†ç¾¤"><a href="#æ„å»ºzookeeperã€kakfaé›†ç¾¤" class="headerlink" title="æ„å»ºzookeeperã€kakfaé›†ç¾¤"></a>æ„å»ºzookeeperã€kakfaé›†ç¾¤</h2><p>â€ƒâ€ƒé¦–å…ˆkafkaä¾èµ–äºzookeeperï¼Œæ‰€ä»¥åœ¨æ„å»ºkafkaé›†ç¾¤ä¹‹å‰æˆ‘ä»¬å…ˆæ¥æ„å»ºzookeeperé›†ç¾¤ï¼Œzookeeperçš„é›†ç¾¤æ„å»ºæ–¹å¼å¾ˆç®€å•ï¼Œdockerå®˜ç½‘éƒ½æœ‰ç»™å‡ºdocker-composeæ–‡ä»¶ã€‚zookeeperæœ‰å®˜æ–¹é•œåƒï¼Œkakfaæš‚æ—¶è¿˜æ²¡æœ‰ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©äº†ä¸€ä¸ªgithubä¸Šç›®å‰staræœ€é«˜çš„é•œåƒ<a href="https://github.com/wurstmeister/kafka-docker"><strong>kafka-docker</strong></a>ã€‚</p><h3 id="ç¼–å†™zookeeperçš„docker-composeæ–‡ä»¶"><a href="#ç¼–å†™zookeeperçš„docker-composeæ–‡ä»¶" class="headerlink" title="ç¼–å†™zookeeperçš„docker-composeæ–‡ä»¶"></a>ç¼–å†™zookeeperçš„docker-composeæ–‡ä»¶</h3><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.1'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">zoo1</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> zookeeper    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> zoo1    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> 2181<span class="token punctuation">:</span><span class="token number">2181</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"~/share/docker/compose-data/zookeeper/zoo1/data:/data"</span>      <span class="token punctuation">-</span> <span class="token string">"~/share/docker/compose-data/zookeeper/zoo1/datalog:/datalog"</span>      <span class="token punctuation">-</span> <span class="token string">"~/share/docker/compose-data/zookeeper/zoo1/conf:/conf"</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">ZOO_MY_ID</span><span class="token punctuation">:</span> <span class="token number">1</span>      <span class="token key atrule">ZOO_SERVERS</span><span class="token punctuation">:</span> server.1=0.0.0.0<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888 server.2=zoo2<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888 server.3=zoo3<span class="token punctuation">:</span>2888<span class="token punctuation">:</span><span class="token number">3888</span>  <span class="token key atrule">zoo2</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> zookeeper    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> zoo2    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> 2182<span class="token punctuation">:</span><span class="token number">2181</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"~/share/docker/compose-data/zookeeper/zoo2/data:/data"</span>      <span class="token punctuation">-</span> <span class="token string">"~/share/docker/compose-data/zookeeper/zoo2/datalog:/datalog"</span>      <span class="token punctuation">-</span> <span class="token string">"~/share/docker/compose-data/zookeeper/zoo2/conf:/conf"</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">ZOO_MY_ID</span><span class="token punctuation">:</span> <span class="token number">2</span>      <span class="token key atrule">ZOO_SERVERS</span><span class="token punctuation">:</span> server.1=zoo1<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888 server.2=0.0.0.0<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888 server.3=zoo3<span class="token punctuation">:</span>2888<span class="token punctuation">:</span><span class="token number">3888</span>  <span class="token key atrule">zoo3</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> zookeeper    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> zoo3    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> 2183<span class="token punctuation">:</span><span class="token number">2181</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"~/share/docker/compose-data/zookeeper/zoo3/data:/data"</span>      <span class="token punctuation">-</span> <span class="token string">"~/share/docker/compose-data/zookeeper/zoo3/datalog:/datalog"</span>      <span class="token punctuation">-</span> <span class="token string">"~/share/docker/compose-data/zookeeper/zoo3/conf:/conf"</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">ZOO_MY_ID</span><span class="token punctuation">:</span> <span class="token number">3</span>      <span class="token key atrule">ZOO_SERVERS</span><span class="token punctuation">:</span> server.1=zoo1<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888 server.2=zoo2<span class="token punctuation">:</span>2888<span class="token punctuation">:</span>3888 server.3=0.0.0.0<span class="token punctuation">:</span>2888<span class="token punctuation">:</span><span class="token number">3888</span></code></pre><p>â€ƒâ€ƒä¿å­˜æ–‡ä»¶åä¸ºã€docker-compose.ymlã€‘,æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•´ä¸ªcomposeæ–‡ä»¶ä¸­ä¸€å…±è¿è¡Œäº†ä¸‰ä¸ªzookeeperå®ä¾‹ï¼Œä¸ºä»€ä¹ˆæ˜¯ä¸‰ä¸ªï¼Ÿå› ä¸ºzookeeperå†…éƒ¨çš„é€‰ä¸¾æœºåˆ¶ï¼Œåœ¨é›†ç¾¤ä¸­æœ‰å…¶ä»–èŠ‚ç‚¹æŒ‚æ‰çš„è¯ï¼Œè‡³å°‘ä¿è¯n+1ä¸ªèŠ‚ç‚¹ç”¨æ¥é€‰ä¸¾leaderï¼Œæ‰€ä»¥é›†ç¾¤è‡³å°‘ä¸‰ä¸ªèŠ‚ç‚¹ã€‚</p><p>â€ƒâ€ƒç°åœ¨æ¥è¯´è¯´composeæ–‡ä»¶ä¸­çš„å‚æ•°å«ä¹‰ï¼š</p><ol><li>version: â€˜3.1â€™  è¡¨ç¤ºä½¿ç”¨ç¬¬ä¸‰ä»£composeè¯­æ³•</li><li>services è¡¨ç¤ºä¸€ä¸ªå®ä¾‹æœåŠ¡</li><li>zoo1ã€zoo2ã€zoo3æ˜¯æˆ‘è‡ªå·±ç»™å®ä¾‹æœåŠ¡èµ·çš„åå­—</li><li>image è¡¨ç¤ºéœ€è¦ä½¿ç”¨çš„dockeré•œåƒï¼Œè¿™é‡Œä½¿ç”¨çš„å®˜æ–¹é•œåƒï¼Œå¹¶ä¸”æ²¡æœ‰æŒ‡å®štarget</li><li>restart: always è¡¨ç¤ºæŒ‚æ‰ä¼šä¸€ç›´é‡å¯</li><li>ports å¯¼å‡ºçš„ç«¯å£å·ï¼Œå› ä¸ºæˆ‘è¿™æ˜¯åœ¨ä¸€å°æœºå™¨ï¼Œæ‰€ä»¥åˆ†åˆ«ä½¿ç”¨äº†2181ï¼Œ2182ï¼Œ2183ä¸‰ä¸ªç«¯å£</li><li>volumes æ•°æ®å·ç›®å½•</li><li>environment ç¯å¢ƒå‚æ•°ï¼Œè¿™é‡Œé¢ZOO_MY_IDè¡¨ç¤ºé›†ç¾¤ä¸­çš„zkç¼–å·ï¼Œä¸å¯é‡å¤ï¼ŒZOO_SERVERSè¡¨ç¤ºé›†ç¾¤ä¸­æ‰€æœ‰çš„zkæœåŠ¡å®ä¾‹</li></ol><h3 id="ç¼–å†™kakfaçš„docker-composeæ–‡ä»¶"><a href="#ç¼–å†™kakfaçš„docker-composeæ–‡ä»¶" class="headerlink" title="ç¼–å†™kakfaçš„docker-composeæ–‡ä»¶"></a>ç¼–å†™kakfaçš„docker-composeæ–‡ä»¶</h3><p>kakfaçš„composeæ–‡ä»¶å’Œzookeeperæœ‰äº›å°åŒºåˆ«ï¼Œä¸»è¦ä½“ç°åœ¨è¿è¡Œæ–¹å¼ä¸Šé¢å¹¶ä¸”æˆ‘ä»¬ç°åœ¨éœ€è¦åˆ›å»ºä¸‰ä¸ªdocker-composeæ–‡ä»¶ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯portä¸ä¸€æ ·ã€‚éœ€è¦æ³¨æ„çš„æ˜¯environmentå‚æ•°ä¸­çš„IPåœ°å€ä¸è¦ä½¿ç”¨localhostæˆ–è€…127.0.0.1ï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨IPåœ°å€</p><ul><li>docker-compose-9092.yml</li></ul><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.1'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">kafka</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> wurstmeister/kafka    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> kafka    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> 9092<span class="token punctuation">:</span><span class="token number">9092</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"~/share/docker/compose-data/kafka/kafka-9092/docker.sock:/var/run/docker.sock"</span>      <span class="token punctuation">-</span> <span class="token string">"~/share/docker/compose-data/kafka/kafka-9092:/kafka"</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">KAFKA_VERSION</span><span class="token punctuation">:</span> 1.1.0      <span class="token key atrule">KAFKA_ADVERTISED_HOST_NAME</span><span class="token punctuation">:</span> 192.168.1.6      <span class="token key atrule">KAFKA_ADVERTISED_PORT</span><span class="token punctuation">:</span> <span class="token number">9092</span>      <span class="token key atrule">KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation">:</span> 192.168.1.6<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>192.168.1.6<span class="token punctuation">:</span><span class="token number">2182</span><span class="token punctuation">,</span>192.168.1.6<span class="token punctuation">:</span><span class="token number">2183</span></code></pre><ul><li>docker-compose-9093.yml</li></ul><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.1'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">kafka</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> wurstmeister/kafka    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> kafka    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> 9093<span class="token punctuation">:</span><span class="token number">9092</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"~/share/docker/compose-data/kafka/kafka-9093/docker.sock:/var/run/docker.sock"</span>      <span class="token punctuation">-</span> <span class="token string">"~/share/docker/compose-data/kafka/kafka-9093:/kafka"</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">KAFKA_VERSION</span><span class="token punctuation">:</span> 1.1.0      <span class="token key atrule">KAFKA_ADVERTISED_HOST_NAME</span><span class="token punctuation">:</span> 192.168.1.6      <span class="token key atrule">KAFKA_ADVERTISED_PORT</span><span class="token punctuation">:</span> <span class="token number">9093</span>      <span class="token key atrule">KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation">:</span> 192.168.1.6<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>192.168.1.6<span class="token punctuation">:</span><span class="token number">2182</span><span class="token punctuation">,</span>192.168.1.6<span class="token punctuation">:</span><span class="token number">2183</span></code></pre><ul><li>docker-compose-9094.yml</li></ul><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.1'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">kafka</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> wurstmeister/kafka    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> kafka    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> 9094<span class="token punctuation">:</span><span class="token number">9092</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"~/share/docker/compose-data/kafka/kafka-9094/docker.sock:/var/run/docker.sock"</span>      <span class="token punctuation">-</span> <span class="token string">"~/share/docker/compose-data/kafka/kafka-9094:/kafka"</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">KAFKA_VERSION</span><span class="token punctuation">:</span> 1.1.0      <span class="token key atrule">KAFKA_ADVERTISED_HOST_NAME</span><span class="token punctuation">:</span> 192.168.1.6      <span class="token key atrule">KAFKA_ADVERTISED_PORT</span><span class="token punctuation">:</span> <span class="token number">9094</span>      <span class="token key atrule">KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation">:</span> 192.168.1.6<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>192.168.1.6<span class="token punctuation">:</span><span class="token number">2182</span><span class="token punctuation">,</span>192.168.1.6<span class="token punctuation">:</span><span class="token number">2183</span></code></pre><h3 id="è¿è¡Œzkä¸kakfaé›†ç¾¤"><a href="#è¿è¡Œzkä¸kakfaé›†ç¾¤" class="headerlink" title="è¿è¡Œzkä¸kakfaé›†ç¾¤"></a>è¿è¡Œzkä¸kakfaé›†ç¾¤</h3><p>â€ƒâ€ƒåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»æŠŠä¸¤ä¸ªç»„ä»¶çš„docker-composeæ–‡ä»¶å†™å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬æ¥è¿è¡Œé›†ç¾¤ã€‚</p><h4 id="è¿è¡Œzookeeperé›†ç¾¤"><a href="#è¿è¡Œzookeeperé›†ç¾¤" class="headerlink" title="è¿è¡Œzookeeperé›†ç¾¤"></a>è¿è¡Œzookeeperé›†ç¾¤</h4><p>åœ¨zookeeperçš„docker-composeæ–‡ä»¶å¤¹ä¸‹é¢æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œdocker-compose upï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨docker-compose up -d åå°è¿è¡Œ</p><pre class=" language-shell"><code class="language-shell">âœ  zk-kafka docker-compose upCreating network "zk-kafka_default" with the default driverPulling zoo1 (zookeeper:)...latest: Pulling from library/zookeeperDigest: sha256:a043534003831de15268779b582d407d37291bf7d22292ec7dce242c57a5a2beStatus: Downloaded newer image for zookeeper:latestCreating zk-kafka_zoo3_1 ... doneCreating zk-kafka_zoo2_1 ... doneCreating zk-kafka_zoo1_1 ... doneAttaching to zk-kafka_zoo1_1, zk-kafka_zoo3_1, zk-kafka_zoo2_1zoo1_1  | ZooKeeper JMX enabled by defaultzoo3_1  | ZooKeeper JMX enabled by defaultzoo1_1  | Using config: /conf/zoo.cfgzoo3_1  | Using config: /conf/zoo.cfgzoo2_1  | ZooKeeper JMX enabled by defaultzoo2_1  | Using config: /conf/zoo.cfgzoo1_1  | log4j:WARN No appenders could be found for logger (org.apache.zookeeper.server.quorum.QuorumPeerConfig).zoo1_1  | log4j:WARN Please initialize the log4j system properly.zoo1_1  | log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.zoo3_1  | log4j:WARN No appenders could be found for logger (org.apache.zookeeper.server.quorum.QuorumPeerConfig).zoo3_1  | log4j:WARN Please initialize the log4j system properly.zoo3_1  | log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.zoo2_1  | log4j:WARN No appenders could be found for logger (org.apache.zookeeper.server.quorum.QuorumPeerConfig).zoo2_1  | log4j:WARN Please initialize the log4j system properly.zoo2_1  | log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.</code></pre><h4 id="æŸ¥çœ‹zookeeperçš„è¿è¡Œæƒ…å†µ"><a href="#æŸ¥çœ‹zookeeperçš„è¿è¡Œæƒ…å†µ" class="headerlink" title="æŸ¥çœ‹zookeeperçš„è¿è¡Œæƒ…å†µ"></a>æŸ¥çœ‹zookeeperçš„è¿è¡Œæƒ…å†µ</h4><p>æ–°å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œdocker psï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å·²ç»æœ‰ä¸‰ä¸ªzookeeperå®ä¾‹å·²ç»è¿è¡Œèµ·æ¥äº†</p><pre class=" language-shell"><code class="language-shell">âœ  ~ docker psCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                        NAMES7278fca16a38        zookeeper           "/docker-entrypoint.â€¦"   24 seconds ago      Up 27 seconds       2888/tcp, 0.0.0.0:2181->2181/tcp, 3888/tcp   zk-kafka_zoo1_1bc396f78a9d4        zookeeper           "/docker-entrypoint.â€¦"   24 seconds ago      Up 27 seconds       2888/tcp, 3888/tcp, 0.0.0.0:2183->2181/tcp   zk-kafka_zoo3_1dd9b8be8eebe        zookeeper           "/docker-entrypoint.â€¦"   24 seconds ago      Up 26 seconds       2888/tcp, 3888/tcp, 0.0.0.0:2182->2181/tcp   zk-kafka_zoo2_1</code></pre><h4 id="è¿è¡Œkakfa"><a href="#è¿è¡Œkakfa" class="headerlink" title="è¿è¡Œkakfa"></a>è¿è¡Œkakfa</h4><p>åœ¨kakfaçš„docker-compose-909*.ymlæ–‡ä»¶å¤¹ä¸‹é¢åˆ†å¸ƒæ‰§è¡Œä¸‹é¢ä¸‰ä¸ªå‘½ä»¤</p><pre class=" language-shell"><code class="language-shell"># é›†ç¾¤å¯åŠ¨æ–¹å¼docker-compose -f docker-compose-9092.yml up -ddocker-compose -f docker-compose-9093.yml scale kafka=2docker-compose -f docker-compose-9094.yml scale kafka=3</code></pre><h4 id="æŸ¥çœ‹kafkaçš„è¿è¡Œæƒ…å†µ"><a href="#æŸ¥çœ‹kafkaçš„è¿è¡Œæƒ…å†µ" class="headerlink" title="æŸ¥çœ‹kafkaçš„è¿è¡Œæƒ…å†µ"></a>æŸ¥çœ‹kafkaçš„è¿è¡Œæƒ…å†µ</h4><p>docker ps å¯ä»¥çœ‹åˆ°ç°åœ¨å·²ç»æœ‰ä¸‰ä¸ªzookeeperå®ä¾‹å’Œä¸‰ä¸ªkafkaå®ä¾‹</p><pre class=" language-shell"><code class="language-shell">âœ  ~ docker psCONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS              PORTS                                        NAMES31e7e8ad1fc5        wurstmeister/kafka   "start-kafka.sh"         29 seconds ago      Up 37 seconds       0.0.0.0:9094->9092/tcp                       zk-kafka_kafka_3d9c1fa25f46e        wurstmeister/kafka   "start-kafka.sh"         35 seconds ago      Up 43 seconds       0.0.0.0:9093->9092/tcp                       zk-kafka_kafka_2caf6b21ba709        wurstmeister/kafka   "start-kafka.sh"         44 seconds ago      Up 52 seconds       0.0.0.0:9092->9092/tcp                       zk-kafka_kafka_17278fca16a38        zookeeper            "/docker-entrypoint.â€¦"   37 minutes ago      Up About a minute   2888/tcp, 0.0.0.0:2181->2181/tcp, 3888/tcp   zk-kafka_zoo1_1bc396f78a9d4        zookeeper            "/docker-entrypoint.â€¦"   37 minutes ago      Up About a minute   2888/tcp, 3888/tcp, 0.0.0.0:2183->2181/tcp   zk-kafka_zoo3_1dd9b8be8eebe        zookeeper            "/docker-entrypoint.â€¦"   37 minutes ago      Up About a minute   2888/tcp, 3888/tcp, 0.0.0.0:2182->2181/tcp   zk-kafka_zoo2_1</code></pre><h3 id="ä½¿ç”¨kafkaé›†ç¾¤è¿›è¡Œæ¶ˆæ¯ç”Ÿäº§ä¸æ¶ˆè´¹"><a href="#ä½¿ç”¨kafkaé›†ç¾¤è¿›è¡Œæ¶ˆæ¯ç”Ÿäº§ä¸æ¶ˆè´¹" class="headerlink" title="ä½¿ç”¨kafkaé›†ç¾¤è¿›è¡Œæ¶ˆæ¯ç”Ÿäº§ä¸æ¶ˆè´¹"></a>ä½¿ç”¨kafkaé›†ç¾¤è¿›è¡Œæ¶ˆæ¯ç”Ÿäº§ä¸æ¶ˆè´¹</h3><h4 id="è¿›å…¥kafkaå®¹å™¨"><a href="#è¿›å…¥kafkaå®¹å™¨" class="headerlink" title="è¿›å…¥kafkaå®¹å™¨"></a>è¿›å…¥kafkaå®¹å™¨</h4><p>docker exec -it [container-name] /bin/bashï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯å®¹å™¨çš„åç§°ï¼Œå› ä¸ºæœ‰ä¸‰ä¸ªkafkaé›†ç¾¤ï¼Œé€šè¿‡docker pså¯ä»¥çœ‹åˆ°åˆ†åˆ«æ˜¯ï¼ˆzk-kafka_kafka_1ï¼Œzk-kafka_kafka_2ï¼Œzk-kafka_kafka_3ï¼‰æ‰€ä»¥éšä¾¿ä¸€ä¸ªéƒ½å¯ä»¥</p><pre class=" language-shell"><code class="language-shell"># è¿›å…¥kafkaå®¹å™¨docker exec -it zk-kafka_kafka_1 /bin/bash# è¿›å…¥å®‰è£…ç›®å½•cd /opt/kafka/# æŸ¥çœ‹topicåˆ—è¡¨./bin/kafka-topics.sh --list --zookeeper 192.168.1.6:2181# åˆ›å»º topic./bin/kafka-topics.sh --create --zookeeper 192.168.1.6:2181 --replication-factor 1 --partitions 1 --topic test# ç”Ÿäº§æ¶ˆæ¯./bin/kafka-console-producer.sh --broker-list 192.168.1.6:9092 --topic test# æ¶ˆè´¹æ¶ˆæ¯./bin/kafka-console-consumer.sh --bootstrap-server 192.168.1.6:9092 --topic test --from-beginning</code></pre><h5 id="æŸ¥çœ‹topicåˆ—è¡¨"><a href="#æŸ¥çœ‹topicåˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹topicåˆ—è¡¨"></a>æŸ¥çœ‹topicåˆ—è¡¨</h5><pre class=" language-shell"><code class="language-shell">âœ  ~ docker exec -it zk-kafka_kafka_1 /bin/bashbash-4.4# cd /opt/kafkabash-4.4# pwd/opt/kafkabash-4.4# ./bin/kafka-topics.sh --list --zookeeper 192.168.1.6:2181bash-4.4#</code></pre><h5 id="åˆ›å»ºtopic"><a href="#åˆ›å»ºtopic" class="headerlink" title="åˆ›å»ºtopic"></a>åˆ›å»ºtopic</h5><pre class=" language-shell"><code class="language-shell">âœ  ~ docker exec -it zk-kafka_kafka_1 /bin/bashbash-4.4# cd /opt/kafkabash-4.4# pwd/opt/kafkabash-4.4# ./bin/kafka-topics.sh --list --zookeeper 192.168.1.6:2181ion-factor 1 --partitions 1 --topic test --zookeeper 192.168.1.6:2181 --replicatiCreated topic "test".bash-4.4#</code></pre><h5 id="æ¶ˆæ¯çš„ç”Ÿäº§ä¸æ¶ˆè´¹"><a href="#æ¶ˆæ¯çš„ç”Ÿäº§ä¸æ¶ˆè´¹" class="headerlink" title="æ¶ˆæ¯çš„ç”Ÿäº§ä¸æ¶ˆè´¹"></a>æ¶ˆæ¯çš„ç”Ÿäº§ä¸æ¶ˆè´¹</h5><p>æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯è¿›å…¥å®¹å™¨ï¼Œä¸€ä¸ªä½œä¸ºç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯ï¼Œä¸€ä¸ªä½œä¸ºæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯</p><ul><li>ç”Ÿäº§è€…ä½¿ç”¨zk-kafka_kafka_1å®¹å™¨ï¼Œzkä½¿ç”¨9092ç«¯å£</li></ul><pre class=" language-shell"><code class="language-shell">âœ  zk-kafka docker exec -it zk-kafka_kafka_1 /bin/bashbash-4.4# cd /opt/kafkabash-4.4# ./bin/kafka-console-producer.sh --broker-list 192.168.1.6:9092 --topic test>123>æµ‹è¯•æ•°æ®>test data>é˜¿ç‰›></code></pre><ul><li>æ¶ˆè´¹è€…zk-kafka_kafka_2ï¼Œzkä½¿ç”¨9093ç«¯å£</li></ul><pre class=" language-shell"><code class="language-shell">âœ  ~ docker exec -it zk-kafka_kafka_2 /bin/bashbash-4.4# cd /opt/kafkabash-4.4# ./bin/kafka-console-consumer.sh --bootstrap-server 192.168.1.6:9093 --topic test --from-beginning123æµ‹è¯•æ•°æ®test dataé˜¿ç‰›</code></pre><ul><li>æ¶ˆè´¹è€…zk-kafka_kafka_3ï¼Œzkä½¿ç”¨9094ç«¯å£</li></ul><pre class=" language-shell"><code class="language-shell">âœ  ~ docker exec -it zk-kafka_kafka_3 /bin/bashbash-4.4# cd /opt/kafkabash-4.4# ./bin/kafka-console-consumer.sh --bootstrap-server 192.168.1.6:9094 --topic test --from-beginning123æµ‹è¯•æ•°æ®test dataé˜¿ç‰›</code></pre><p>è‡³æ­¤ï¼Œzookeeperå’Œkakfaé›†ç¾¤æ­å»ºåˆ°æ­¤ç»“æŸ</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>ä¸­é—´è¸©äº†å¾ˆå¤šå‘ï¼Œç½‘ä¸Šå‚è€ƒäº†å¾ˆå¤šæ•™ç¨‹ï¼Œé‡ç‚¹è¿˜æ˜¯éœ€è¦è‡ªå·±åŠ¨æ‰‹æŠ˜è…¾</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://yeasy.gitbooks.io/docker_practice/compose/compose_file.html">dockerä»å…¥é—¨åˆ°å®è·µ</a></p><p><a href="https://github.com/wurstmeister/kafka-docker">kakfa-docker</a></p><p><a href="https://www.guonanjun.com/268.html">Dockeréƒ¨ç½²Kafkaé›†ç¾¤</a></p><p><a href="https://hub.docker.com/_/zookeeper/">zookeeper-docker</a></p>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker-compose-åŸºç¡€</title>
      <link href="2018/07/11/docker-compose-start/"/>
      <url>2018/07/11/docker-compose-start/</url>
      
        <content type="html"><![CDATA[<h3 id="docker-composeä»‹ç»"><a href="#docker-composeä»‹ç»" class="headerlink" title="docker-composeä»‹ç»"></a>docker-composeä»‹ç»</h3><p>Docker-Compose æ˜¯ Docker çš„ä¸€ç§ç¼–æ’æœåŠ¡ï¼Œæ˜¯ä¸€ä¸ªç”¨äºåœ¨ Docker ä¸Šå®šä¹‰å¹¶è¿è¡Œå¤æ‚åº”ç”¨çš„å·¥å…·ï¼Œå¯ä»¥è®©ç”¨æˆ·åœ¨é›†ç¾¤ä¸­éƒ¨ç½²åˆ†å¸ƒå¼åº”ç”¨ã€‚</p><p> Compose ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼š</p><ul><li>æœåŠ¡ (service) ï¼šä¸€ä¸ªåº”ç”¨çš„å®¹å™¨ï¼Œå®é™…ä¸Šå¯ä»¥åŒ…æ‹¬è‹¥å¹²è¿è¡Œç›¸åŒé•œåƒçš„å®¹å™¨å®ä¾‹ã€‚</li><li>é¡¹ç›® (project) ï¼šç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œåœ¨ docker-compose.yml æ–‡ä»¶ä¸­å®šä¹‰ã€‚</li></ul><p>ä¸€ä¸ªé¡¹ç›®å¯ä»¥ç”±å¤šä¸ªæœåŠ¡ï¼ˆå®¹å™¨ï¼‰å…³è”è€Œæˆï¼ŒCompose é¢å‘é¡¹ç›®è¿›è¡Œç®¡ç†ï¼Œé€šè¿‡å­å‘½ä»¤å¯¹é¡¹ç›®ä¸­çš„ä¸€ç»„å®¹å™¨è¿›è¡Œä¾¿æ·åœ°ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p><p>Compose é¡¹ç›®ç”± Python ç¼–å†™ï¼Œå®ç°ä¸Šè°ƒç”¨äº† Docker æœåŠ¡æä¾›çš„ API æ¥å¯¹å®¹å™¨è¿›è¡Œç®¡ç†ã€‚å› æ­¤ï¼Œåªè¦æ‰€æ“ä½œçš„å¹³å°æ”¯æŒ Docker APIï¼Œå°±å¯ä»¥åœ¨å…¶ä¸Šåˆ©ç”¨ Compose æ¥è¿›è¡Œç¼–æ’ç®¡ç†ã€‚</p><h3 id="docker-composeå®‰è£…"><a href="#docker-composeå®‰è£…" class="headerlink" title="docker-composeå®‰è£…"></a>docker-composeå®‰è£…</h3><p>docker-compose æ˜¯ Docker çš„ç‹¬ç«‹äº§å“ï¼Œå› æ­¤éœ€è¦å®‰è£… Docker ä¹‹ååœ¨å•ç‹¬å®‰è£… Docker Compose ã€‚</p><pre class=" language-shell"><code class="language-shell">#ä¸‹è½½sudo curl -L https://github.com/docker/compose/releases/download/1.20.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose#å®‰è£…chmod +x /usr/local/bin/docker-compose# æ˜¾ç¤ºdocker-composeç‰ˆæœ¬docker-compose version</code></pre><p>docker-composeè¡¥å…¨å·¥å…·å®‰è£…</p><pre class=" language-shell"><code class="language-shell">#å®‰è£…yum install bash-completion#ä¸‹è½½docker-composeè„šæœ¬curl -L https://raw.githubusercontent.com/docker/compose/$(docker-compose version --short)/contrib/completion/bash/docker-compose > /etc/bash_completion.d/docker-compose</code></pre><p>docker-composeå¸¸ç”¨å‘½ä»¤</p><pre class=" language-shell"><code class="language-shell">#æŸ¥çœ‹å¸®åŠ©docker-compose -h# -f  æŒ‡å®šä½¿ç”¨çš„ Compose æ¨¡æ¿æ–‡ä»¶ï¼Œé»˜è®¤ä¸º docker-compose.ymlï¼Œå¯ä»¥å¤šæ¬¡æŒ‡å®šã€‚docker-compose -f docker-compose.yml up -d #å¯åŠ¨æ‰€æœ‰å®¹å™¨ï¼Œ-d å°†ä¼šåœ¨åå°å¯åŠ¨å¹¶è¿è¡Œæ‰€æœ‰çš„å®¹å™¨docker-compose up -d#åœç”¨ç§»é™¤æ‰€æœ‰å®¹å™¨ä»¥åŠç½‘ç»œç›¸å…³docker-compose down#æŸ¥çœ‹æœåŠ¡å®¹å™¨çš„è¾“å‡ºdocker-compose logs#åˆ—å‡ºé¡¹ç›®ä¸­ç›®å‰çš„æ‰€æœ‰å®¹å™¨docker-compose ps#æ„å»ºï¼ˆé‡æ–°æ„å»ºï¼‰é¡¹ç›®ä¸­çš„æœåŠ¡å®¹å™¨ã€‚æœåŠ¡å®¹å™¨ä¸€æ—¦æ„å»ºåï¼Œå°†ä¼šå¸¦ä¸Šä¸€ä¸ªæ ‡è®°åï¼Œä¾‹å¦‚å¯¹äº web é¡¹ç›®ä¸­çš„ä¸€ä¸ª db å®¹å™¨ï¼Œå¯èƒ½æ˜¯ web_dbã€‚å¯ä»¥éšæ—¶åœ¨é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œ docker-compose build æ¥é‡æ–°æ„å»ºæœåŠ¡docker-compose build#æ‹‰å–æœåŠ¡ä¾èµ–çš„é•œåƒdocker-compose pull#é‡å¯é¡¹ç›®ä¸­çš„æœåŠ¡docker-compose restart#åˆ é™¤æ‰€æœ‰ï¼ˆåœæ­¢çŠ¶æ€çš„ï¼‰æœåŠ¡å®¹å™¨ã€‚æ¨èå…ˆæ‰§è¡Œ docker-compose stop å‘½ä»¤æ¥åœæ­¢å®¹å™¨ã€‚docker-compose rm #åœ¨æŒ‡å®šæœåŠ¡ä¸Šæ‰§è¡Œä¸€ä¸ªå‘½ä»¤ã€‚docker-compose run ubuntu ping docker.com#è®¾ç½®æŒ‡å®šæœåŠ¡è¿è¡Œçš„å®¹å™¨ä¸ªæ•°ã€‚é€šè¿‡ service=num çš„å‚æ•°æ¥è®¾ç½®æ•°é‡docker-compose scale web=3 db=2#å¯åŠ¨å·²ç»å­˜åœ¨çš„æœåŠ¡å®¹å™¨ã€‚docker-compose start#åœæ­¢å·²ç»å¤„äºè¿è¡ŒçŠ¶æ€çš„å®¹å™¨ï¼Œä½†ä¸åˆ é™¤å®ƒã€‚é€šè¿‡ docker-compose start å¯ä»¥å†æ¬¡å¯åŠ¨è¿™äº›å®¹å™¨ã€‚docker-compose stop</code></pre><p>æœ¬ç¯‡å…¨æ˜¯åŸºæœ¬çš„å®‰è£…å’Œå‘½ä»¤ï¼Œä¸‹ç¯‡é€šè¿‡dockerå’Œdocker-composeæ„å»ºä¸€äº›å¸¸ç”¨çš„è½¯ä»¶è¿è¡Œç¯å¢ƒ</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.ityouknow.com/docker/2018/03/22/docker-compose.html">Docker(å››)ï¼šDocker ä¸‰å‰‘å®¢ä¹‹ Docker Compose</a></p>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docke-å®‰è£…</title>
      <link href="2018/07/10/docker-start/"/>
      <url>2018/07/10/docker-start/</url>
      
        <content type="html"><![CDATA[<h3 id="dockerå®‰è£…"><a href="#dockerå®‰è£…" class="headerlink" title="dockerå®‰è£…"></a>dockerå®‰è£…</h3><p>å»ºè®®åœ¨linuxç¯å¢ƒä¸‹å®‰è£…Dockerï¼Œwindowç¯å¢ƒæ­å»ºæ¯”è¾ƒå¤æ‚ä¸”å®¹æ˜“å‡ºé”™ï¼Œä½¿ç”¨Centos7+yumæ¥å®‰è£…Dockerç¯å¢ƒå¾ˆæ–¹ä¾¿ã€‚</p><pre class=" language-shell"><code class="language-shell"># å¸è½½æ—§ç‰ˆæœ¬dockersudo yum remove docker \                  docker-client \                  docker-client-latest \                  docker-common \                  docker-latest \                  docker-latest-logrotate \                  docker-logrotate \                  docker-selinux \                  docker-engine-selinux \                  docker-engine# å®‰è£…yum-utilssudo yum install -y yum-utils \  device-mapper-persistent-data \  lvm2 # é…ç½®docker-ce.reposudo yum-config-manager \    --add-repo \    https://download.docker.com/linux/centos/docker-ce.repo# å®‰è£…docker-cesudo yum install docker-ce# å¯åŠ¨dockersudo systemctl start docker# Dockerå®ˆæŠ¤è¿›ç¨‹è‡ªå¯åŠ¨sudo systemctl enable docker.service# æ˜¾ç¤ºdockerç‰ˆæœ¬docker --version</code></pre><h3 id="è®¾ç½®ä¸­å›½é•œåƒåŠ é€Ÿå™¨"><a href="#è®¾ç½®ä¸­å›½é•œåƒåŠ é€Ÿå™¨" class="headerlink" title="è®¾ç½®ä¸­å›½é•œåƒåŠ é€Ÿå™¨"></a>è®¾ç½®ä¸­å›½é•œåƒåŠ é€Ÿå™¨</h3><pre class=" language-shell"><code class="language-shell"># ç¼–è¾‘daemon.jsonæ–‡ä»¶vim /etc/docker/daemon.json# æ·»åŠ åŠ é€Ÿå†…å®¹{    "registry-mirrors": ["https://registry.docker-cn.com"],    "live-restore": true}</code></pre><h3 id="dockerå¸¸ç”¨å‘½ä»¤"><a href="#dockerå¸¸ç”¨å‘½ä»¤" class="headerlink" title="dockerå¸¸ç”¨å‘½ä»¤"></a>dockerå¸¸ç”¨å‘½ä»¤</h3><ul><li>æ‹‰å–é•œåƒ <strong>docker pull [image_name]</strong></li></ul><pre class=" language-shell"><code class="language-shell"># è·å–redisé•œåƒdocker pull redisUsing default tag: latestlatest: Pulling from library/redis683abbb4ea60: Pull complete259238e792d8: Pull complete78399601c709: Pull completef397da474601: Pull completec57de4edc390: Pull completeb2ea05c9d9a1: Pull completeDigest: sha256:5534b92530acc653f0721ebfa14f31bc718f68bf9070cbba25bb00bc7aacfabbStatus: Downloaded newer image for redis:latest</code></pre><ul><li>æŸ¥çœ‹æ‰€æœ‰é•œåƒ**docker images **</li></ul><pre class=" language-shell"><code class="language-shell"># æŸ¥çœ‹æ‰€æœ‰é•œåƒdocker imagesREPOSITORY                                          TAG                 IMAGE ID            CREATED             SIZEjenkins                                             latest              e2541428ed0d        7 days ago          696MBredis                                               latest              71a81cb279e3        13 days ago         83.4MBzookeeper                                           latest              397be0d8fa45        3 weeks ago         146MB</code></pre><ul><li>åˆ é™¤é•œåƒ</li></ul><pre><code>docker rmi  redis  æˆ–è€…  docker rmi 71a81cb279e3</code></pre><ul><li>æŸ¥çœ‹æ‰€æœ‰è¿è¡Œçš„å®¹å™¨<strong>docker ps</strong></li></ul><pre class=" language-shell"><code class="language-shell">docker psCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                     NAMESeb5abaa4710a        mysql:5.7.20        "docker-entrypoint.sâ€¦"   6 weeks ago         Up 6 minutes        0.0.0.0:10100->3306/tcp   mysql# è¿™é‡Œå¯ä»¥æ·»åŠ  -a å‚æ•°ï¼ŒæŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ŒåŒ…æ‹¬æ²¡æœ‰è¿è¡Œçš„</code></pre><ul><li>æŸ¥çœ‹å®¹å™¨è¿è¡Œæ—¥å¿— **docker logs  -f â€“tail  20 [container_name] **</li></ul><pre class=" language-shell"><code class="language-shell"># -f è¡¨ç¤ºè·Ÿè¸ªæ—¥å¿—è¾“å‡º  --tail è¡¨ç¤ºæŒç»­è¾“å‡º 20è¡¨ç¤ºç¬¬ä¸€æ¬¡æŸ¥çœ‹çš„è¡Œæ•° æœ€åæ˜¯å®¹å™¨åç§°docker logs  -f --tail  20 [container_name]2018-07-10T14:49:21.476230Z 0 [Warning] CA certificate ca.pem is self signed.2018-07-10T14:49:21.481000Z 0 [Note] InnoDB: Buffer pool(s) load completed at 180710 </code></pre><ul><li>è¿›å…¥è¿è¡Œçš„å®¹å™¨**docker exec -it [container_name] bash **</li></ul><p>å½“ç„¶è¿›å…¥å®¹å™¨çš„æ–¹å¼å¾ˆå¤šï¼Œä½†æ˜¯å®˜æ–¹æ¨èæ­¤æ–¹å¼ï¼Œå…¶ä»–æ–¹å¼æ„Ÿå…´è¶£å¯ä»¥å‚è€ƒæ­¤æ–‡ç« ï¼š  </p><p><a href="https://github.com/cloudfstrife/note/blob/develop/docker/nsenter%E8%BF%9B%E5%85%A5%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C%E7%9A%84Docker%E5%AE%B9%E5%99%A8.md"><strong>nsenterè¿›å…¥åå°è¿è¡Œçš„Dockerå®¹å™¨</strong></a></p><pre class=" language-shell"><code class="language-shell"># è¿›å…¥å®¹å™¨docker exec -it redis bash# é€€å‡ºå®¹å™¨exit</code></pre><ul><li>åˆ é™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨</li></ul><pre class=" language-shell"><code class="language-shell">docker rm $(docker ps -a -q)</code></pre><ul><li>åˆ é™¤å®¹å™¨</li></ul><pre class=" language-shell"><code class="language-shell">docker rm container_name/container_id</code></pre><ul><li>å¯åŠ¨ã€åœæ­¢ã€é‡å¯å®¹å™¨</li></ul><pre class=" language-shell"><code class="language-shell">docker start container_name/container_iddocker stop container_name/container_iddocker restart container_name/container_id</code></pre><h3 id="dockerå®‰è£…å¸¸è§é—®é¢˜"><a href="#dockerå®‰è£…å¸¸è§é—®é¢˜" class="headerlink" title="dockerå®‰è£…å¸¸è§é—®é¢˜"></a>dockerå®‰è£…å¸¸è§é—®é¢˜</h3><p>å¯åŠ¨æŠ¥é”™</p><pre><code>Job for docker.service failed. See 'systemctl status docker.service' and 'journalctl -xn' for details.</code></pre><p>è§£å†³æ–¹æ¡ˆ1:</p><pre class=" language-shell"><code class="language-shell"># æŸ¥çœ‹SELinuxçŠ¶æ€ï¼š/usr/sbin/sestatus -v ##å¦‚æœSELinux statuså‚æ•°ä¸ºenabledå³ä¸ºå¼€å¯çŠ¶æ€SELinux status: enabledgetenforce ##ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªå‘½ä»¤æ£€æŸ¥# å…³é—­SELinuxï¼š1ã€ä¸´æ—¶å…³é—­ï¼ˆä¸ç”¨é‡å¯æœºå™¨ï¼‰ï¼šsetenforce 0 ##è®¾ç½®SELinux æˆä¸ºpermissiveæ¨¡å¼##setenforce 1 è®¾ç½®SELinux æˆä¸ºenforcingæ¨¡å¼2ã€ä¿®æ”¹é…ç½®æ–‡ä»¶éœ€è¦é‡å¯æœºå™¨ï¼šä¿®æ”¹/etc/selinux/config æ–‡ä»¶å°†SELINUX=enforcingæ”¹ä¸ºSELINUX=disabledé‡å¯æœºå™¨å³å¯</code></pre><p>è§£å†³æ–¹æ¡ˆ2:</p><pre class=" language-shell"><code class="language-shell"># å‡çº§yumï¼Œé‡æ–°å®‰è£…dockeryum update# å¸è½½dockersudo yum -y remove docker-cesudo rm -rf /var/lib/docker# é‡æ–°å®‰è£…</code></pre><h3 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h3><p><a href="https://docs.docker.com/install/linux/docker-ce/centos/">dockerå®˜ç½‘</a></p><p><a href="http://blog.51cto.com/bguncle/957315">å…³é—­SELinux</a></p>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>eclipse ä½¿ç”¨ maven æ„å»ºwebé¡¹ç›®</title>
      <link href="2017/09/28/eclipse-mvn-build-web-project/"/>
      <url>2017/09/28/eclipse-mvn-build-web-project/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h1><ul><li><a href="http://maven.apache.org/download.cgi">apache-maven-3.3.9</a></li><li><a href="http://tomcat.apache.org/download-80.cgi">apache-tomcat-8.5.20</a></li><li><a href="https://www.eclipse.org/downloads/eclipse-packages/">eclipse-jee-neon-3</a></li><li><a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk-netbeans-jsp-142931.html">jdk1.8.0_131</a></li></ul><h1 id="MavenåŸºæœ¬é…ç½®-ä¿®æ”¹-setting-xml-æ–‡ä»¶"><a href="#MavenåŸºæœ¬é…ç½®-ä¿®æ”¹-setting-xml-æ–‡ä»¶" class="headerlink" title="MavenåŸºæœ¬é…ç½® ä¿®æ”¹ setting.xml æ–‡ä»¶"></a>MavenåŸºæœ¬é…ç½® ä¿®æ”¹ setting.xml æ–‡ä»¶</h1><p>apache-tomcat-8.5.20/conf/settings.xml</p><blockquote><p>1.ä»“åº“æœ¬åœ°å­˜å‚¨ä½ç½® </p></blockquote><p><img src="http://upload-images.jianshu.io/upload_images/7779890-c8fb765b2c991b72.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æœ¬åœ°ä»“åº“ä½ç½®"></p><blockquote><p>2.é…ç½®é˜¿é‡Œäº‘å›½å†…çš„ä¸­å¤®ä»“åº“ï¼Œæå‡ä¸‹è½½é€Ÿåº¦  mirrors èŠ‚ç‚¹å†…</p></blockquote><pre><code>&lt;mirror&gt;        &lt;!-- é…ç½® é˜¿é‡Œäº‘ maven é•œåƒä»“åº“ï¼Œæå‡å›½å†…ä¸‹è½½é€Ÿåº¦ --&gt;        &lt;id&gt;alimaven&lt;/id&gt;            &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;            &lt;name&gt;aliyun maven&lt;/name&gt;            &lt;url&gt;http://maven.aliyun.com/nexus/content/repositories/central/&lt;/url&gt;        &lt;/mirror&gt;        &lt;mirror&gt;            &lt;id&gt;repo1&lt;/id&gt;            &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;            &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt;            &lt;url&gt;http://repo1.maven.org/maven2/&lt;/url&gt;        &lt;/mirror&gt;        &lt;mirror&gt;            &lt;id&gt;repo2&lt;/id&gt;            &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;            &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt;            &lt;url&gt;http://repo2.maven.org/maven2/&lt;/url&gt;        &lt;/mirror&gt;  &lt;/mirrors&gt;</code></pre><p><img src="http://upload-images.jianshu.io/upload_images/7779890-fdbaf1e3853ed100.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é˜¿é‡Œäº‘mavené•œåƒ"></p><blockquote><p>3.é…ç½®ç¼–è¯‘æ—¶çš„jdkç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨è¿™é‡Œé…ç½®å…¨å±€ï¼Œä¹Ÿå¯ä»¥æ ¹æ®é¡¹ç›®é…ç½®  profiles èŠ‚ç‚¹å†…</p></blockquote><pre><code>&lt;profile&gt;    &lt;!-- é…ç½®å…¨å±€çš„jdk --&gt;        &lt;id&gt;jdk1.8&lt;/id&gt;            &lt;activation&gt;               &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;                &lt;jdk&gt;1.8&lt;/jdk&gt;           &lt;/activation&gt;            &lt;properties&gt;               &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;                &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;                &lt;maven.compiler.compilerVersion&gt;1.8&lt;/maven.compiler.compilerVersion&gt;           &lt;/properties&gt;     &lt;/profile&gt;</code></pre><p><img src="http://upload-images.jianshu.io/upload_images/7779890-e1f345185ced9580.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å…¨å±€çš„jdkç‰ˆæœ¬é…ç½®"></p><h1 id="eclipse-é›†æˆmavenæ’ä»¶"><a href="#eclipse-é›†æˆmavenæ’ä»¶" class="headerlink" title="eclipse é›†æˆmavenæ’ä»¶"></a>eclipse é›†æˆmavenæ’ä»¶</h1><p><img src="http://upload-images.jianshu.io/upload_images/7779890-28a74e4a3f382413.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="eclipseé…ç½®maven"></p><p><img src="http://upload-images.jianshu.io/upload_images/7779890-88b11320dd52174c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…ç½®å…¨å±€å‚æ•°"></p><h1 id="æ–°å»ºmavené¡¹ç›®"><a href="#æ–°å»ºmavené¡¹ç›®" class="headerlink" title="æ–°å»ºmavené¡¹ç›®"></a>æ–°å»ºmavené¡¹ç›®</h1><p><img src="http://upload-images.jianshu.io/upload_images/7779890-6604d11226479dcf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–°å»ºmavené¡¹ç›®"></p><p><img src="http://upload-images.jianshu.io/upload_images/7779890-997fc5ccae6f10b6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–°å»ºmavené¡¹ç›®"></p><p><img src="http://upload-images.jianshu.io/upload_images/7779890-99ce19045b39d6e4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–°å»ºmavené¡¹ç›®"></p><p><img src="http://upload-images.jianshu.io/upload_images/7779890-9909613ef55aadd9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é¡¹ç›®ç»“æ„"></p><h1 id="å°†é¡¹ç›®è½¬æ¢æˆmaven-web-é¡¹ç›®"><a href="#å°†é¡¹ç›®è½¬æ¢æˆmaven-web-é¡¹ç›®" class="headerlink" title="å°†é¡¹ç›®è½¬æ¢æˆmaven web é¡¹ç›®"></a>å°†é¡¹ç›®è½¬æ¢æˆmaven web é¡¹ç›®</h1><p>å³é”®æ‰“å¼€é¡¹ç›®è®¾ç½®</p><p><img src="http://upload-images.jianshu.io/upload_images/7779890-ee1c890c8ecfe527.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¿®æ”¹é¡¹ç›®ç»“æ„"></p><p><img src="http://upload-images.jianshu.io/upload_images/7779890-a498a41384ef79f0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç”Ÿæˆweb.xml"></p><p><img src="http://upload-images.jianshu.io/upload_images/7779890-20c12ea65ea902f5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¿®æ”¹ä»¥åçš„é¡¹ç›®ç»“æ„"></p><ul><li>ä½†æ˜¯ç°åœ¨è¿™ä¸ªä¸æ˜¯ä¸€ä¸ªæ ‡å‡†çš„webé¡¹ç›®ï¼Œç»§ç»­ä¿®æ”¹é¡¹ç›®ç»“æ„ï¼Œå°†WebContentç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´åˆ°main/webappç›®å½•ä¸‹é¢ï¼Œåˆ é™¤WebContentç›®å½•ï¼Œç»“æ„å¦‚ä¸‹</li></ul><p><img src="http://upload-images.jianshu.io/upload_images/7779890-bc62b88cce18515e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åˆ é™¤WebContentç›®å½•ä»¥å"></p><p><img src="http://upload-images.jianshu.io/upload_images/7779890-6cd7c408aea55e6d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åˆ é™¤WebContent"></p><p><img src="http://upload-images.jianshu.io/upload_images/7779890-0589e69ddc98be2a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æŒ‡å®š webapp ç›®å½•"></p><p><img src="http://upload-images.jianshu.io/upload_images/7779890-0c5d4e9d5aeecea0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é€‰æ‹© webapp "></p><p><img src="http://upload-images.jianshu.io/upload_images/7779890-7d291661d94d9456.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é€‰æ‹© webapp"></p><p><img src="http://upload-images.jianshu.io/upload_images/7779890-6731709025e9acdf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¿®æ”¹å®Œæˆä»¥åçš„ç›®å½•ç»“æ„"></p><p><img src="http://upload-images.jianshu.io/upload_images/7779890-b47340bc89895406.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ›´æ–°é¡¹ç›®mavené…ç½®"></p><p><img src="http://upload-images.jianshu.io/upload_images/7779890-1ec60f2529acf211.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æç¤ºæ›´æ–°"></p><p><img src="http://upload-images.jianshu.io/upload_images/7779890-6a9678cfb6fa765a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é”™è¯¯è§£å†³ä»¥åæˆä¸ºä¸€ä¸ªæ ‡å‡†çš„webé¡¹ç›®"></p><h1 id="é…ç½®è¿è¡Œè¯¥é¡¹ç›®"><a href="#é…ç½®è¿è¡Œè¯¥é¡¹ç›®" class="headerlink" title="é…ç½®è¿è¡Œè¯¥é¡¹ç›®"></a>é…ç½®è¿è¡Œè¯¥é¡¹ç›®</h1><blockquote><ol><li>åœ¨webappå³é”®æ–°å»ºä¸€ä¸ªhtml æ–‡ä»¶</li></ol></blockquote><p><img src="http://upload-images.jianshu.io/upload_images/7779890-081eca38dc3869be.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–°å»º html æ–‡ä»¶ï¼Œç¼–å†™å†…å®¹"></p><blockquote><p>2.é…ç½® tomcat</p></blockquote><p><img src="http://upload-images.jianshu.io/upload_images/7779890-ebc8d197b81f8a55.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é…ç½®è¿è¡Œé¡¹ç›®"></p><p><img src="http://upload-images.jianshu.io/upload_images/7779890-628a5eaeca05c239.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é€‰æ‹©tomcatå¯¹åº”çš„ç‰ˆæœ¬"></p><p><img src="http://upload-images.jianshu.io/upload_images/7779890-97c2fb6d82f0dd12.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é€‰æ‹© tomcat å®‰è£…è·¯å¾„"></p><blockquote><p>3.è¿è¡Œ</p></blockquote><p><img src="http://upload-images.jianshu.io/upload_images/7779890-ef7e7c1fcba3897b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¿è¡Œé¡¹ç›®"></p><h1 id="eclipse-é›†æˆ-maven-æ„å»º-web-é¡¹ç›®å®Œæˆ"><a href="#eclipse-é›†æˆ-maven-æ„å»º-web-é¡¹ç›®å®Œæˆ" class="headerlink" title="eclipse é›†æˆ maven æ„å»º web é¡¹ç›®å®Œæˆ"></a>eclipse é›†æˆ maven æ„å»º web é¡¹ç›®å®Œæˆ</h1><ul><li>æœ€åæ¨èä¸€ç¯‡æ–‡ç« ï¼šåœ¨ idea ä¸­å¦‚ä½•ä½¿ç”¨ maven æ„å»ºé¡¹ç›®<br><a href="https://yq.aliyun.com/articles/111053">https://yq.aliyun.com/articles/111053</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å·¥å…·ä½¿ç”¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
